From davidkamphausen at mail.berlios.de  Mon Feb 16 21:01:31 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Mon, 16 Feb 2009 21:01:31 +0100
Subject: [Antargis-svn] r1283 - antargis/trunk/data/gui
Message-ID: <200902162001.n1GK1VDi005410@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-16 21:01:21 +0100 (Mon, 16 Feb 2009)
New Revision: 1283

Added:
   antargis/trunk/data/gui/icon_mask.png
   antargis/trunk/data/gui/install_bg.png
   antargis/trunk/data/gui/install_bg.xcf
Log:
some more images

Added: antargis/trunk/data/gui/icon_mask.png
===================================================================
(Binary files differ)


Property changes on: antargis/trunk/data/gui/icon_mask.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: antargis/trunk/data/gui/install_bg.png
===================================================================
(Binary files differ)


Property changes on: antargis/trunk/data/gui/install_bg.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: antargis/trunk/data/gui/install_bg.xcf
===================================================================
(Binary files differ)


Property changes on: antargis/trunk/data/gui/install_bg.xcf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From davidkamphausen at mail.berlios.de  Mon Feb 16 21:02:06 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Mon, 16 Feb 2009 21:02:06 +0100
Subject: [Antargis-svn] r1284 - in antargis/trunk/rookey: . examples
	examples/noruby examples/noruby/.deps examples/simplistic
	examples/templates examples/virtual
Message-ID: <200902162002.n1GK26sH005524@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-16 21:01:55 +0100 (Mon, 16 Feb 2009)
New Revision: 1284

Added:
   antargis/trunk/rookey/examples/
   antargis/trunk/rookey/examples/README
   antargis/trunk/rookey/examples/gargabe/
   antargis/trunk/rookey/examples/noruby/
   antargis/trunk/rookey/examples/noruby/.build_darwin9.0/
   antargis/trunk/rookey/examples/noruby/.deps/
   antargis/trunk/rookey/examples/noruby/.deps/main.cc
   antargis/trunk/rookey/examples/noruby/.deps/test.c
   antargis/trunk/rookey/examples/noruby/Rakefile
   antargis/trunk/rookey/examples/noruby/config_cache.rb
   antargis/trunk/rookey/examples/noruby/configure
   antargis/trunk/rookey/examples/noruby/main.cc
   antargis/trunk/rookey/examples/noruby/rookey.log
   antargis/trunk/rookey/examples/noruby/rookey_configuration.rb
   antargis/trunk/rookey/examples/noruby/test
   antargis/trunk/rookey/examples/noruby/test.c
   antargis/trunk/rookey/examples/simplistic/
   antargis/trunk/rookey/examples/simplistic/Rakefile
   antargis/trunk/rookey/examples/simplistic/a.cc
   antargis/trunk/rookey/examples/simplistic/a.h
   antargis/trunk/rookey/examples/simplistic/a.rb
   antargis/trunk/rookey/examples/simplistic/config_cache.rb
   antargis/trunk/rookey/examples/simplistic/rookey.log
   antargis/trunk/rookey/examples/simplistic/rookey_configuration.rb
   antargis/trunk/rookey/examples/simplistic/test
   antargis/trunk/rookey/examples/simplistic/test.bundle
   antargis/trunk/rookey/examples/simplistic/test.c
   antargis/trunk/rookey/examples/simplistic/test_interface.i
   antargis/trunk/rookey/examples/templates/
   antargis/trunk/rookey/examples/templates/Rakefile
   antargis/trunk/rookey/examples/templates/child.h
   antargis/trunk/rookey/examples/templates/config_cache.rb
   antargis/trunk/rookey/examples/templates/parent.cc
   antargis/trunk/rookey/examples/templates/parent.h
   antargis/trunk/rookey/examples/templates/rookey.log
   antargis/trunk/rookey/examples/templates/rookey_configuration.rb
   antargis/trunk/rookey/examples/templates/templates.bundle
   antargis/trunk/rookey/examples/templates/templates.i
   antargis/trunk/rookey/examples/templates/templates_interface.i
   antargis/trunk/rookey/examples/templates/test
   antargis/trunk/rookey/examples/templates/test.c
   antargis/trunk/rookey/examples/templates/test.rb
   antargis/trunk/rookey/examples/virtual/
   antargis/trunk/rookey/examples/virtual/Rakefile
   antargis/trunk/rookey/examples/virtual/car.cc
   antargis/trunk/rookey/examples/virtual/car.h
   antargis/trunk/rookey/examples/virtual/config_cache.rb
   antargis/trunk/rookey/examples/virtual/rookey.log
   antargis/trunk/rookey/examples/virtual/rookey_configuration.rb
   antargis/trunk/rookey/examples/virtual/test
   antargis/trunk/rookey/examples/virtual/test.c
   antargis/trunk/rookey/examples/virtual/vehicle.cc
   antargis/trunk/rookey/examples/virtual/vehicle.h
   antargis/trunk/rookey/examples/virtual/virtualExample.bundle
   antargis/trunk/rookey/examples/virtual/virtualExample_interface.i
   antargis/trunk/rookey/examples/virtual/virtualTest.rb
Log:
added examples

Added: antargis/trunk/rookey/examples/README
===================================================================
--- antargis/trunk/rookey/examples/README	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/README	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,61 @@
+== noruby
+contains an example for a plain C++ project, that you can build and deploy. 
+
+The Rakefile looks like this: First the rookey.rb base file is included.
+
+ require '../../rookey.rb'
+
+ objects=Rookey::compile(['main.cc'])
+ exe=Rookey::link_exe('test',objects)
+
+ task :default=>exe do
+ end
+
+After that you define a task for compilation of cc-files to objects. The name of the task is stored in 'objects'
+after that you can use these objects to create an executable with name base 'test'. On Unix-Systems the executable will
+be named 'test' - on Windows 'test.exe'. You can use 'objects' and 'exe' as tasks in definition like you can see in the
+definition of the default task. That's all you need for compilation. Just run 'rake' and it creates you executable.
+
+Note: Rookey does not use the typical rake-like syntax (task :xy=>:yz do ... end with symbols), because objects is an array
+of rule-targets that should not be included in the rake-tasklist. Apart from this you can compile objects using different
+configurations and link them into a single file.  
+
+When you have things to configure like creation of debug-symbol, you can add a configure script, that looks like this:
+ #!/usr/bin/env ruby
+
+ require File.join(File.split(__FILE__)[0],"..","..","lib","rookey_config.rb")
+
+ config=Rookey::Configure.new
+ config.run
+
+ puts
+ puts "Run 'rake clean' for changes to take effect on already built files!"
+ puts
+
+First you include the rookey_config.rb to get all the functionality. After that you start a configure-run.
+This can be shorten down to something like this:
+
+ require File.join(File.split(__FILE__)[0],"..","..","lib","rookey_config.rb")
+ Rookey::Configure.new.run
+ 
+If you want to configure your own options, have a look at optparse, which is used internally in rookey-configure.
+After that you can use it like this:
+
+ config=Rookey::Configure.new
+ config.run do |opts|
+
+   opts.on("--drmuser DRMUSER",
+     "set user for DRM") do |v|
+       config.set(:drmuser,v)
+   end
+  
+   opts.on("--drmpw DRMPASSWORD",
+     "set password for DRM") do |v|
+       config.set(:drmpass,v)
+   end  
+ end
+
+Rookey takes care of storing the settings to a rookey_configuration.rb file. There are no other configure files in
+the other examples, because they are not explicitly needed.
+
+ 
\ No newline at end of file

Added: antargis/trunk/rookey/examples/noruby/.deps/main.cc
===================================================================
--- antargis/trunk/rookey/examples/noruby/.deps/main.cc	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/noruby/.deps/main.cc	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,91 @@
+main.o: main.cc /usr/include/c++/4.0.0/iostream \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/c++config.h \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/os_defines.h \
+  /usr/include/c++/4.0.0/ostream /usr/include/c++/4.0.0/ios \
+  /usr/include/c++/4.0.0/iosfwd \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/c++locale.h \
+  /usr/include/c++/4.0.0/clocale /usr/include/locale.h \
+  /usr/include/_locale.h /usr/include/sys/cdefs.h /usr/include/_types.h \
+  /usr/include/sys/_types.h /usr/include/machine/_types.h \
+  /usr/include/i386/_types.h /usr/include/c++/4.0.0/cstring \
+  /usr/include/c++/4.0.0/cstddef \
+  /usr/lib/gcc/i686-apple-darwin9/4.0.1/include/stddef.h \
+  /usr/include/string.h /usr/include/c++/4.0.0/cstdio \
+  /usr/include/stdio.h \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/c++io.h \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/gthr.h \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/gthr-default.h \
+  /usr/include/pthread.h /usr/include/pthread_impl.h /usr/include/sched.h \
+  /usr/include/time.h /usr/include/_structs.h /usr/include/sys/_structs.h \
+  /usr/include/unistd.h /usr/include/sys/unistd.h \
+  /usr/include/sys/select.h /usr/include/sys/appleapiopts.h \
+  /usr/include/sys/_select.h /usr/include/c++/4.0.0/cctype \
+  /usr/include/ctype.h /usr/include/runetype.h \
+  /usr/include/c++/4.0.0/bits/stringfwd.h \
+  /usr/include/c++/4.0.0/bits/postypes.h /usr/include/c++/4.0.0/cwchar \
+  /usr/include/c++/4.0.0/ctime /usr/include/wchar.h \
+  /usr/lib/gcc/i686-apple-darwin9/4.0.1/include/stdarg.h \
+  /usr/include/_wctype.h \
+  /usr/lib/gcc/i686-apple-darwin9/4.0.1/include/stdint.h \
+  /usr/include/c++/4.0.0/bits/functexcept.h \
+  /usr/include/c++/4.0.0/exception_defines.h \
+  /usr/include/c++/4.0.0/exception \
+  /usr/include/c++/4.0.0/bits/char_traits.h \
+  /usr/include/c++/4.0.0/bits/stl_algobase.h \
+  /usr/include/c++/4.0.0/climits \
+  /usr/lib/gcc/i686-apple-darwin9/4.0.1/include/limits.h \
+  /usr/lib/gcc/i686-apple-darwin9/4.0.1/include/syslimits.h \
+  /usr/include/limits.h /usr/include/machine/limits.h \
+  /usr/include/i386/limits.h /usr/include/i386/_limits.h \
+  /usr/include/sys/syslimits.h /usr/include/c++/4.0.0/cstdlib \
+  /usr/include/stdlib.h /usr/include/available.h /usr/include/sys/wait.h \
+  /usr/include/sys/signal.h /usr/include/machine/signal.h \
+  /usr/include/i386/signal.h /usr/include/i386/_structs.h \
+  /usr/include/machine/_structs.h /usr/include/mach/i386/_structs.h \
+  /usr/include/sys/resource.h /usr/include/machine/endian.h \
+  /usr/include/i386/endian.h /usr/include/sys/_endian.h \
+  /usr/include/libkern/_OSByteOrder.h \
+  /usr/include/libkern/i386/_OSByteOrder.h /usr/include/alloca.h \
+  /usr/include/machine/types.h /usr/include/i386/types.h \
+  /usr/include/c++/4.0.0/bits/stl_pair.h \
+  /usr/include/c++/4.0.0/bits/cpp_type_traits.h \
+  /usr/include/c++/4.0.0/bits/stl_iterator_base_types.h \
+  /usr/include/c++/4.0.0/bits/stl_iterator_base_funcs.h \
+  /usr/include/c++/4.0.0/bits/concept_check.h \
+  /usr/include/c++/4.0.0/bits/stl_iterator.h \
+  /usr/include/c++/4.0.0/debug/debug.h /usr/include/c++/4.0.0/cassert \
+  /usr/include/assert.h /usr/include/c++/4.0.0/bits/localefwd.h \
+  /usr/include/c++/4.0.0/bits/ios_base.h \
+  /usr/include/c++/4.0.0/bits/atomicity.h \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/atomic_word.h \
+  /usr/include/c++/4.0.0/bits/locale_classes.h \
+  /usr/include/c++/4.0.0/string /usr/include/c++/4.0.0/memory \
+  /usr/include/c++/4.0.0/bits/allocator.h \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/c++allocator.h \
+  /usr/include/c++/4.0.0/ext/new_allocator.h /usr/include/c++/4.0.0/new \
+  /usr/include/c++/4.0.0/bits/stl_construct.h \
+  /usr/include/c++/4.0.0/bits/stl_uninitialized.h \
+  /usr/include/c++/4.0.0/bits/stl_raw_storage_iter.h \
+  /usr/include/c++/4.0.0/limits \
+  /usr/include/c++/4.0.0/bits/stl_function.h \
+  /usr/include/c++/4.0.0/bits/basic_string.h \
+  /usr/include/c++/4.0.0/algorithm /usr/include/c++/4.0.0/bits/stl_algo.h \
+  /usr/include/c++/4.0.0/bits/stl_heap.h \
+  /usr/include/c++/4.0.0/bits/stl_tempbuf.h \
+  /usr/include/c++/4.0.0/bits/basic_string.tcc \
+  /usr/include/c++/4.0.0/streambuf \
+  /usr/include/c++/4.0.0/bits/streambuf.tcc \
+  /usr/include/c++/4.0.0/bits/basic_ios.h \
+  /usr/include/c++/4.0.0/bits/streambuf_iterator.h \
+  /usr/include/c++/4.0.0/bits/locale_facets.h \
+  /usr/include/c++/4.0.0/cwctype /usr/include/wctype.h \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/ctype_base.h \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/ctype_inline.h \
+  /usr/include/c++/4.0.0/bits/codecvt.h \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/time_members.h \
+  /usr/include/c++/4.0.0/i686-apple-darwin9/bits/messages_members.h \
+  /usr/include/c++/4.0.0/bits/basic_ios.tcc \
+  /usr/include/c++/4.0.0/bits/ostream.tcc /usr/include/c++/4.0.0/locale \
+  /usr/include/c++/4.0.0/bits/locale_facets.tcc \
+  /usr/include/c++/4.0.0/typeinfo /usr/include/c++/4.0.0/istream \
+  /usr/include/c++/4.0.0/bits/istream.tcc

Added: antargis/trunk/rookey/examples/noruby/.deps/test.c
===================================================================
--- antargis/trunk/rookey/examples/noruby/.deps/test.c	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/noruby/.deps/test.c	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1 @@
+test.o: test.c

Added: antargis/trunk/rookey/examples/noruby/Rakefile
===================================================================
--- antargis/trunk/rookey/examples/noruby/Rakefile	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/noruby/Rakefile	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,6 @@
+require 'rookey.rb'
+
+objects=Rookey::compile(['main.cc'])
+exe=Rookey::link_exe('test',objects)
+
+task :default=>exe doend
\ No newline at end of file

Added: antargis/trunk/rookey/examples/noruby/config_cache.rb
===================================================================
--- antargis/trunk/rookey/examples/noruby/config_cache.rb	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/noruby/config_cache.rb	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,5 @@
+module Rookey
+  @@config=Marshal.load("o:Rookey::Config:
+ at hash{\"CC\"/usr/bin/gcc\"SWIG_OPTIONS\" -Wall -DAGEXPORT\"CCACHE\"/opt/local/bin/ccache\"	SWIG\" /opt/local/bin/swig\"CPP\"/usr/bin/g++\"CFLAGS\"V -arch ppc -arch i386 -Os -pipe -fno-common -O0 -g -D_GNU_SOURCE=1 -D_THREAD_SAFE\"host_os\"darwin9.0\"
+DLEXT\"bundle\"INCLUDEDIRS\"? /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL\"LDFLAGS\"? -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -g -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer -lpng\"GCC_BASE\"gcc\"GPP_BASE\"g++\"LDSHAREDFLAGS\"B -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup")
+end

Added: antargis/trunk/rookey/examples/noruby/configure
===================================================================
--- antargis/trunk/rookey/examples/noruby/configure	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/noruby/configure	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,10 @@
+#!/usr/bin/env ruby
+
+require File.join(File.split(__FILE__)[0],"..","..","lib","rookey_config.rb")
+
+config=Rookey::Configure.new
+config.run
+
+puts
+puts "Run 'rake clean' for changes to take effect on already built files!"
+puts


Property changes on: antargis/trunk/rookey/examples/noruby/configure
___________________________________________________________________
Name: svn:executable
   + *

Added: antargis/trunk/rookey/examples/noruby/main.cc
===================================================================
--- antargis/trunk/rookey/examples/noruby/main.cc	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/noruby/main.cc	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,7 @@
+#include <iostream>
+
+int main(int ,char**)
+{
+  std::cout<<"Hello World"<<std::endl;
+  return 0;
+}

Added: antargis/trunk/rookey/examples/noruby/rookey.log
===================================================================
--- antargis/trunk/rookey/examples/noruby/rookey.log	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/noruby/rookey.log	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,36 @@
+/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./config_class.rb:26:in `getConfig'
+/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/./rookey/tasks.rb:91:in `compile'
+/Users/davidkamphausen/projects.alt/antargis/rookey/examples/noruby/rakefile:3
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:2149:in `load'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:2149:in `raw_load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1897:in `load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1948:in `standard_exception_handling'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1896:in `load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1880:in `run'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1948:in `standard_exception_handling'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1878:in `run'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/bin/rake:31
+/usr/bin/rake:19:in `load'
+/usr/bin/rake:19
+Running configurator Rookey::SwigConfig
+#<Rookey::Config:0x5457e0 @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
+Running configurator Rookey::MinGWConfig
+#<Rookey::Config:0x5457e0 @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
+Running configurator Rookey::RubyConfig
+#<Rookey::Config:0x5457e0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::GLConfig
+#<Rookey::Config:0x5457e0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::DebugConfig
+#<Rookey::Config:0x5457e0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -O0 -g", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -g", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::CompilerConfig
+#<Rookey::Config:0x5457e0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -O0 -g", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -g", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::CcacheConfig
+#<Rookey::Config:0x5457e0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -O0 -g", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -g", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::Configurator
+#<Rookey::Config:0x5457e0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -O0 -g", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -g", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::ZConfig
+#<Rookey::Config:0x5457e0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -O0 -g", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -g -lz", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::SDLConfig
+#<Rookey::Config:0x5457e0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -O0 -g -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -g -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::PNGConfig
+#<Rookey::Config:0x5457e0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -O0 -g -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -g -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer -lpng", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>

Added: antargis/trunk/rookey/examples/noruby/rookey_configuration.rb
===================================================================
--- antargis/trunk/rookey/examples/noruby/rookey_configuration.rb	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/noruby/rookey_configuration.rb	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,3 @@
+ROOKEY_CONFIG={
+:debug=>'true'
+}

Added: antargis/trunk/rookey/examples/noruby/test
===================================================================
(Binary files differ)


Property changes on: antargis/trunk/rookey/examples/noruby/test
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: antargis/trunk/rookey/examples/noruby/test.c
===================================================================
--- antargis/trunk/rookey/examples/noruby/test.c	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/noruby/test.c	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,2 @@
+
+extern "C" void png_get_io_ptr();int main(int argc,char*argv[]){return 0;}

Added: antargis/trunk/rookey/examples/simplistic/Rakefile
===================================================================
--- antargis/trunk/rookey/examples/simplistic/Rakefile	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/simplistic/Rakefile	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,5 @@
+require 'rookey.rb'
+
+extension=Rookey::ruby_ext('test',Dir["*.h"]+Dir["*.cc"])
+
+task :default=>extension doend
\ No newline at end of file

Added: antargis/trunk/rookey/examples/simplistic/a.cc
===================================================================
--- antargis/trunk/rookey/examples/simplistic/a.cc	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/simplistic/a.cc	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,10 @@
+#include "a.h"
+
+#include <iostream>
+
+std::string A::x()
+{
+  std::string id="A::x()";
+  std::cout<<id<<std::endl;
+  return id;
+}

Added: antargis/trunk/rookey/examples/simplistic/a.h
===================================================================
--- antargis/trunk/rookey/examples/simplistic/a.h	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/simplistic/a.h	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,15 @@
+#include "rk_rubyobj.h"
+
+// The following keyword is used to define that this header-file is included into swig-based
+// export to ruby
+// INCLUDE_SWIG
+
+// AGRubyObject is needed for any object that's owned cross-language.
+// A good rule is that any class thats derived from should be derived from AGRubyObject
+// in the first place.
+class A:public AGRubyObject
+  {
+public:
+  virtual std::string x();
+
+  };

Added: antargis/trunk/rookey/examples/simplistic/a.rb
===================================================================
--- antargis/trunk/rookey/examples/simplistic/a.rb	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/simplistic/a.rb	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,23 @@
+#!/usr/bin/env ruby
+
+require 'test'
+
+a=Test::A.new
+if a.x=="A::x()"
+  puts "Everythings fine"
+else
+  raise "Somethings gone wrong in creation of Test::A"
+end
+
+class B<Test::A
+  def x
+    super+"new"
+  end
+end
+
+b=B.new
+if b.x=="A::x()new"
+  puts "Everythings fine"
+else
+  raise "Somethings gone wrong in creation of B"
+end

Added: antargis/trunk/rookey/examples/simplistic/config_cache.rb
===================================================================
--- antargis/trunk/rookey/examples/simplistic/config_cache.rb	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/simplistic/config_cache.rb	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,5 @@
+module Rookey
+  @@config=Marshal.load("o:Rookey::Config:
+ at hash{\"CC\"/usr/bin/gcc\"SWIG_OPTIONS\" -Wall -DAGEXPORT\"CCACHE\"/opt/local/bin/ccache\"	SWIG\" /opt/local/bin/swig\"CPP\"/usr/bin/g++\"CFLAGS\"O -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE\"host_os\"darwin9.0\"
+DLEXT\"bundle\"INCLUDEDIRS\"? /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL\"LDFLAGS\"? -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer -lpng\"GCC_BASE\"gcc\"GPP_BASE\"g++\"LDSHAREDFLAGS\"B -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup")
+end

Added: antargis/trunk/rookey/examples/simplistic/rookey.log
===================================================================
--- antargis/trunk/rookey/examples/simplistic/rookey.log	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/simplistic/rookey.log	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,36 @@
+/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./config_class.rb:26:in `getConfig'
+/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/./rookey/tasks.rb:164:in `ruby_ext'
+/Users/davidkamphausen/projects.alt/antargis/rookey/examples/simplistic/rakefile:3
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:2149:in `load'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:2149:in `raw_load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1897:in `load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1948:in `standard_exception_handling'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1896:in `load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1880:in `run'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1948:in `standard_exception_handling'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1878:in `run'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/bin/rake:31
+/usr/bin/rake:19:in `load'
+/usr/bin/rake:19
+Running configurator Rookey::SwigConfig
+#<Rookey::Config:0x5455d8 @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
+Running configurator Rookey::MinGWConfig
+#<Rookey::Config:0x5455d8 @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
+Running configurator Rookey::RubyConfig
+#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::GLConfig
+#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::DebugConfig
+#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::CompilerConfig
+#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::CcacheConfig
+#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::Configurator
+#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::ZConfig
+#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::SDLConfig
+#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::PNGConfig
+#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer -lpng", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>

Added: antargis/trunk/rookey/examples/simplistic/rookey_configuration.rb
===================================================================
--- antargis/trunk/rookey/examples/simplistic/rookey_configuration.rb	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/simplistic/rookey_configuration.rb	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,3 @@
+ROOKEY_CONFIG={
+
+}

Added: antargis/trunk/rookey/examples/simplistic/test
===================================================================
(Binary files differ)


Property changes on: antargis/trunk/rookey/examples/simplistic/test
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: antargis/trunk/rookey/examples/simplistic/test.bundle
===================================================================
(Binary files differ)


Property changes on: antargis/trunk/rookey/examples/simplistic/test.bundle
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: antargis/trunk/rookey/examples/simplistic/test.c
===================================================================
--- antargis/trunk/rookey/examples/simplistic/test.c	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/simplistic/test.c	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,2 @@
+
+extern "C" void png_get_io_ptr();int main(int argc,char*argv[]){return 0;}

Added: antargis/trunk/rookey/examples/simplistic/test_interface.i
===================================================================
--- antargis/trunk/rookey/examples/simplistic/test_interface.i	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/simplistic/test_interface.i	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,145 @@
+%module(directors="1") test
+%feature("autodoc","1");
+
+/*
+%feature("director:except") {
+ throw Swig::DirectorMethodException($error);
+}
+*/
+
+      %include <std_vector.i>
+      %include <std_list.i>
+      
+
+
+%include "stl.i"
+%include "std_list.i"
+%{
+#include "rk_string.h"
+#include "/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/./rookey/cpp/rk_rubyobj.h"
+#include "a.h"
+%}
+
+%wrapper %{namespace swig{
+        template <> struct traits_from_ptr<AGRubyObject> {
+          static VALUE from (AGRubyObject *val,int owner=0) {
+          
+            // insert Dynamic_cast(...)
+            swig_type_info *info=SWIGTYPE_p_AGRubyObject; //type_info<AGRubyObject>();
+            swig_type_info *ninfo=SWIG_TypeDynamicCast(info,(void**)&val);
+            if(ninfo==0)
+              ninfo=info;
+          
+            return SWIG_NewPointerObj(val, ninfo, owner);
+          }
+        };        
+        
+        template <> struct traits_from_ptr<A> {
+          static VALUE from (A *val,int owner=0) {
+          
+            // insert Dynamic_cast(...)
+            swig_type_info *info=SWIGTYPE_p_A; //type_info<A>();
+            swig_type_info *ninfo=SWIG_TypeDynamicCast(info,(void**)&val);
+            if(ninfo==0)
+              ninfo=info;
+          
+            return SWIG_NewPointerObj(val, ninfo, owner);
+          }
+        };        
+        }%}
+
+%feature("director") AGRubyObject;
+%feature("director") A;
+%markfunc AGRubyObject "general_markfunc"
+%markfunc A "general_markfunc"
+%{
+      /*
+template<class T>
+VALUE convertCpp2Ruby(T *cObject)
+{
+  return SWIG_RubyInstanceFor(cObject);
+}
+template<AGRubyObject>*/ 
+VALUE convertCpp2Ruby(AGRubyObject *cObject)
+{
+  return SWIG_RubyInstanceFor(cObject);
+}
+  
+
+%}
+
+%{
+
+%}
+%insert("init") %{
+
+%}
+
+
+%typemaps_std_string(AGString, char, SWIG_AsCharPtrAndSize, SWIG_FromCharPtrAndSize, %checkcode(STDSTRING));
+
+/*
+template <>
+ inline VALUE from<AGString>(const AGString& val) {
+   return SWIG_FromCharPtrAndSize(val.c_str(),val.length());
+   //return traits_from<Type>::from(val);
+ }
+ */
+ // oder
+ %wrapper %{
+ namespace swig
+ {
+ template<> struct traits_from<AGString>
+ {
+	 inline static VALUE from(const AGString &val)
+	 {
+     return SWIG_FromCharPtrAndSize(val.c_str(),val.length());
+	 }
+};
+}
+%}
+
+
+        
+        %typemap(out) AGRubyObject *, AGRubyObject & {
+          swig_type_info *ty = SWIG_TypeDynamicCast($1_descriptor,(void **) &$1);
+          $result = SWIG_NewPointerObj($1, ty, $owner);
+        }        
+        %typemap(directorin) AGRubyObject *, AGRubyObject & {
+          if($1)
+          {
+          swig_type_info *ty = SWIG_TypeDynamicCast($1_descriptor,(void **) &$1);
+          $input = SWIG_NewPointerObj($1, ty, $owner);
+          }
+        }        
+        %{
+        
+        swig_type_info* AGRubyObject_dynamic_cast(void **p)
+        {
+                AGRubyObject *a=(AGRubyObject*)(*p);
+        
+                
+                {
+	                A*b=dynamic_cast<A*>(a);
+	                if(b)
+	                {
+	                        *p=(void*)b;
+	                        return SWIGTYPE_p_A;
+	                }
+                }
+
+                return 0;
+        }
+        
+        %}
+        DYNAMIC_CAST(SWIGTYPE_p_AGRubyObject, AGRubyObject_dynamic_cast);
+
+%template(StringVector) std::vector<std::string>;
+%template(PStringVector) std::vector<std::string*>;
+
+
+%feature("trackobjects");
+
+%include "/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/./rookey/cpp/rk_rubyobj.h"
+%include "a.h"      
+

Added: antargis/trunk/rookey/examples/templates/Rakefile
===================================================================
--- antargis/trunk/rookey/examples/templates/Rakefile	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/templates/Rakefile	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,24 @@
+require 'rookey.rb'
+
+extension=Rookey::ruby_ext('templates',Dir["*.h"]+Dir["*.cc"]+Dir["*.i"])
+
+task :build=>extension doend
+
+
+begin
+  require 'spec/rake/spectask'
+  
+  Spec::Rake::SpecTask.new(:spec=>:build) do |t|
+    t.spec_files = FileList['test.rb'].map{|f|File.expand_path(f)}
+    t.warning = true
+    path="spec_output.html"
+    t.spec_opts=["--format html:"+File.expand_path(path)]
+  end
+
+  task :default=>:spec do
+  end
+  
+rescue LoadError=>e
+  task :default=>:build do
+  end
+end
\ No newline at end of file

Added: antargis/trunk/rookey/examples/templates/child.h
===================================================================
--- antargis/trunk/rookey/examples/templates/child.h	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/templates/child.h	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,13 @@
+#ifndef CHILD_H
+#define CHILD_H
+
+// INCLUDE_SWIG
+
+#include <rk_rubyobj.h>
+
+class Child:public AGRubyObject
+{
+
+};
+
+#endif

Added: antargis/trunk/rookey/examples/templates/config_cache.rb
===================================================================
--- antargis/trunk/rookey/examples/templates/config_cache.rb	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/templates/config_cache.rb	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,5 @@
+module Rookey
+  @@config=Marshal.load("o:Rookey::Config:
+ at hash{\"CC\"/usr/bin/gcc\"SWIG_OPTIONS\" -Wall -DAGEXPORT\"CCACHE\"/opt/local/bin/ccache\"	SWIG\" /opt/local/bin/swig\"CPP\"/usr/bin/g++\"CFLAGS\"O -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE\"host_os\"darwin9.0\"
+DLEXT\"bundle\"INCLUDEDIRS\"? /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL\"LDFLAGS\"? -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer -lpng\"GCC_BASE\"gcc\"GPP_BASE\"g++\"LDSHAREDFLAGS\"B -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup")
+end

Added: antargis/trunk/rookey/examples/templates/parent.cc
===================================================================
--- antargis/trunk/rookey/examples/templates/parent.cc	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/templates/parent.cc	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,30 @@
+#include "parent.h"
+
+Parent::Parent()
+{
+  mChildren.push_back(new Child());
+  mChildren.push_back(new Child());
+  mChildren.push_back(new Child());
+}
+
+Parent::~Parent() throw()
+{
+  for(std::list<Child*>::iterator i=mChildren.begin();i!=mChildren.end();i++)
+    saveDelete(*i);
+}
+
+void Parent::mark() throw()
+{
+  for(std::list<Child*>::iterator i=mChildren.begin();i!=mChildren.end();i++)
+    markObject(*i);
+}
+
+Child *Parent::getFirst()
+{
+  return *mChildren.begin();
+}
+
+std::list<Child*> Parent::getChildren()
+{
+  return mChildren;
+}

Added: antargis/trunk/rookey/examples/templates/parent.h
===================================================================
--- antargis/trunk/rookey/examples/templates/parent.h	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/templates/parent.h	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,25 @@
+#ifndef PARENT_H
+#define PARENT_H
+
+// INCLUDE_SWIG
+
+
+#include <rk_rubyobj.h>
+#include "child.h"
+#include <list>
+
+class Parent:public AGRubyObject
+{
+public:
+  Parent();
+  virtual ~Parent() throw();
+  virtual void mark() throw();
+
+  Child *getFirst();
+  std::list<Child*> getChildren();
+
+private:
+  std::list<Child*> mChildren;
+};
+
+#endif

Added: antargis/trunk/rookey/examples/templates/rookey.log
===================================================================
--- antargis/trunk/rookey/examples/templates/rookey.log	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/templates/rookey.log	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,36 @@
+/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./config_class.rb:26:in `getConfig'
+/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/./rookey/tasks.rb:164:in `ruby_ext'
+/Users/davidkamphausen/projects.alt/antargis/rookey/examples/templates/rakefile:3
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:2149:in `load'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:2149:in `raw_load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1897:in `load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1948:in `standard_exception_handling'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1896:in `load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1880:in `run'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1948:in `standard_exception_handling'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1878:in `run'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/bin/rake:31
+/usr/bin/rake:19:in `load'
+/usr/bin/rake:19
+Running configurator Rookey::SwigConfig
+#<Rookey::Config:0x544a98 @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
+Running configurator Rookey::MinGWConfig
+#<Rookey::Config:0x544a98 @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
+Running configurator Rookey::RubyConfig
+#<Rookey::Config:0x544a98 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::GLConfig
+#<Rookey::Config:0x544a98 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::DebugConfig
+#<Rookey::Config:0x544a98 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::CompilerConfig
+#<Rookey::Config:0x544a98 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::CcacheConfig
+#<Rookey::Config:0x544a98 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::Configurator
+#<Rookey::Config:0x544a98 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::ZConfig
+#<Rookey::Config:0x544a98 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::SDLConfig
+#<Rookey::Config:0x544a98 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::PNGConfig
+#<Rookey::Config:0x544a98 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer -lpng", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>

Added: antargis/trunk/rookey/examples/templates/rookey_configuration.rb
===================================================================
--- antargis/trunk/rookey/examples/templates/rookey_configuration.rb	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/templates/rookey_configuration.rb	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,3 @@
+ROOKEY_CONFIG={
+
+}

Added: antargis/trunk/rookey/examples/templates/templates.bundle
===================================================================
(Binary files differ)


Property changes on: antargis/trunk/rookey/examples/templates/templates.bundle
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: antargis/trunk/rookey/examples/templates/templates.i
===================================================================
--- antargis/trunk/rookey/examples/templates/templates.i	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/templates/templates.i	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1 @@
+%template(ChildList) std::list<Child*>;
\ No newline at end of file

Added: antargis/trunk/rookey/examples/templates/templates_interface.i
===================================================================
--- antargis/trunk/rookey/examples/templates/templates_interface.i	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/templates/templates_interface.i	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,173 @@
+%module(directors="1") templates
+%feature("autodoc","1");
+
+/*
+%feature("director:except") {
+ throw Swig::DirectorMethodException($error);
+}
+*/
+
+      %include <std_vector.i>
+      %include <std_list.i>
+      
+
+
+%include "stl.i"
+%include "std_list.i"
+%{
+#include "rk_string.h"
+#include "/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/./rookey/cpp/rk_rubyobj.h"
+#include "child.h"
+#include "parent.h"
+%}
+
+%wrapper %{namespace swig{
+        template <> struct traits_from_ptr<AGRubyObject> {
+          static VALUE from (AGRubyObject *val,int owner=0) {
+          
+            // insert Dynamic_cast(...)
+            swig_type_info *info=SWIGTYPE_p_AGRubyObject; //type_info<AGRubyObject>();
+            swig_type_info *ninfo=SWIG_TypeDynamicCast(info,(void**)&val);
+            if(ninfo==0)
+              ninfo=info;
+          
+            return SWIG_NewPointerObj(val, ninfo, owner);
+          }
+        };        
+        
+        template <> struct traits_from_ptr<Child> {
+          static VALUE from (Child *val,int owner=0) {
+          
+            // insert Dynamic_cast(...)
+            swig_type_info *info=SWIGTYPE_p_Child; //type_info<Child>();
+            swig_type_info *ninfo=SWIG_TypeDynamicCast(info,(void**)&val);
+            if(ninfo==0)
+              ninfo=info;
+          
+            return SWIG_NewPointerObj(val, ninfo, owner);
+          }
+        };        
+        
+        template <> struct traits_from_ptr<Parent> {
+          static VALUE from (Parent *val,int owner=0) {
+          
+            // insert Dynamic_cast(...)
+            swig_type_info *info=SWIGTYPE_p_Parent; //type_info<Parent>();
+            swig_type_info *ninfo=SWIG_TypeDynamicCast(info,(void**)&val);
+            if(ninfo==0)
+              ninfo=info;
+          
+            return SWIG_NewPointerObj(val, ninfo, owner);
+          }
+        };        
+        }%}
+
+%feature("director") AGRubyObject;
+%feature("director") Child;
+%feature("director") Parent;
+%markfunc AGRubyObject "general_markfunc"
+%markfunc Child "general_markfunc"
+%markfunc Parent "general_markfunc"
+%{
+      /*
+template<class T>
+VALUE convertCpp2Ruby(T *cObject)
+{
+  return SWIG_RubyInstanceFor(cObject);
+}
+template<AGRubyObject>*/ 
+VALUE convertCpp2Ruby(AGRubyObject *cObject)
+{
+  return SWIG_RubyInstanceFor(cObject);
+}
+  
+
+%}
+
+%{
+
+%}
+%insert("init") %{
+
+%}
+
+
+%typemaps_std_string(AGString, char, SWIG_AsCharPtrAndSize, SWIG_FromCharPtrAndSize, %checkcode(STDSTRING));
+
+/*
+template <>
+ inline VALUE from<AGString>(const AGString& val) {
+   return SWIG_FromCharPtrAndSize(val.c_str(),val.length());
+   //return traits_from<Type>::from(val);
+ }
+ */
+ // oder
+ %wrapper %{
+ namespace swig
+ {
+ template<> struct traits_from<AGString>
+ {
+	 inline static VALUE from(const AGString &val)
+	 {
+     return SWIG_FromCharPtrAndSize(val.c_str(),val.length());
+	 }
+};
+}
+%}
+
+
+        
+        %typemap(out) AGRubyObject *, AGRubyObject & {
+          swig_type_info *ty = SWIG_TypeDynamicCast($1_descriptor,(void **) &$1);
+          $result = SWIG_NewPointerObj($1, ty, $owner);
+        }        
+        %typemap(directorin) AGRubyObject *, AGRubyObject & {
+          if($1)
+          {
+          swig_type_info *ty = SWIG_TypeDynamicCast($1_descriptor,(void **) &$1);
+          $input = SWIG_NewPointerObj($1, ty, $owner);
+          }
+        }        
+        %{
+        
+        swig_type_info* AGRubyObject_dynamic_cast(void **p)
+        {
+                AGRubyObject *a=(AGRubyObject*)(*p);
+        
+                
+                {
+	                Child*b=dynamic_cast<Child*>(a);
+	                if(b)
+	                {
+	                        *p=(void*)b;
+	                        return SWIGTYPE_p_Child;
+	                }
+                }
+
+
+                {
+	                Parent*b=dynamic_cast<Parent*>(a);
+	                if(b)
+	                {
+	                        *p=(void*)b;
+	                        return SWIGTYPE_p_Parent;
+	                }
+                }
+
+                return 0;
+        }
+        
+        %}
+        DYNAMIC_CAST(SWIGTYPE_p_AGRubyObject, AGRubyObject_dynamic_cast);
+
+
+%template(StringVector) std::vector<std::string>;
+%template(PStringVector) std::vector<std::string*>;
+%include "templates.i"
+
+%feature("trackobjects");
+
+%include "/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/./rookey/cpp/rk_rubyobj.h"
+%include "child.h"
+%include "parent.h"      
+

Added: antargis/trunk/rookey/examples/templates/test
===================================================================
(Binary files differ)


Property changes on: antargis/trunk/rookey/examples/templates/test
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: antargis/trunk/rookey/examples/templates/test.c
===================================================================
--- antargis/trunk/rookey/examples/templates/test.c	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/templates/test.c	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,2 @@
+
+extern "C" void png_get_io_ptr();int main(int argc,char*argv[]){return 0;}

Added: antargis/trunk/rookey/examples/templates/test.rb
===================================================================
--- antargis/trunk/rookey/examples/templates/test.rb	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/templates/test.rb	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,41 @@
+#!/usr/bin/env ruby
+
+require 'templates'
+require 'pp'
+
+def printFormat(len,str)
+  str=str.to_s
+  str=str.gsub("\n","")
+  str=str[0..(len-1)]
+  str+=" "*(len-str.length)
+  print str
+end
+
+def showLine(line)
+  filename,line=line.split(":")
+  line=line.to_i
+  printFormat 80, File.open(filename).readlines[line-1]
+end
+
+$failed=false
+def assert(&p)
+  showLine(caller[0])
+  if p.call
+    puts "  ok"
+  else
+    puts "  failed"
+    $failed=true
+  end
+end
+
+parent=Templates::Parent.new
+
+children=parent.getChildren
+assert { children.length==3 }
+puts "...Reseting parent"
+parent=nil
+GC.start
+assert { children.length==3 }
+assert { children[0].is_a?(Templates::Child) }
+
+raise "Failed" if $failed
\ No newline at end of file


Property changes on: antargis/trunk/rookey/examples/templates/test.rb
___________________________________________________________________
Name: svn:executable
   + *

Added: antargis/trunk/rookey/examples/virtual/Rakefile
===================================================================
--- antargis/trunk/rookey/examples/virtual/Rakefile	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/virtual/Rakefile	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,5 @@
+require 'rookey.rb'
+
+extension=Rookey::ruby_ext('virtualExample',Dir["*.h"]+Dir["*.cc"])
+
+task :default=>extension doend
\ No newline at end of file

Added: antargis/trunk/rookey/examples/virtual/car.cc
===================================================================
--- antargis/trunk/rookey/examples/virtual/car.cc	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/virtual/car.cc	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,17 @@
+#include "car.h"
+
+size_t Car::countOfWheels() const
+{
+
+}
+
+void Car::travel(float time)
+{
+
+}
+
+
+size_t Car::countOfWindows() const
+{
+  return 8;
+}

Added: antargis/trunk/rookey/examples/virtual/car.h
===================================================================
--- antargis/trunk/rookey/examples/virtual/car.h	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/virtual/car.h	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,19 @@
+#ifndef CAR_H
+#define CAR_H
+
+#include "vehicle.h"
+
+// INCLUDE_SWIG
+
+class Car:public Vehicle
+{
+public:
+  virtual size_t countOfWheels() const;
+  virtual void travel(float time);
+
+  // a function being in this class alone
+  size_t countOfWindows() const;
+
+};
+
+#endif

Added: antargis/trunk/rookey/examples/virtual/config_cache.rb
===================================================================
--- antargis/trunk/rookey/examples/virtual/config_cache.rb	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/virtual/config_cache.rb	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,5 @@
+module Rookey
+  @@config=Marshal.load("o:Rookey::Config:
+ at hash{\"CC\"/usr/bin/gcc\"SWIG_OPTIONS\" -Wall -DAGEXPORT\"CCACHE\"/opt/local/bin/ccache\"	SWIG\" /opt/local/bin/swig\"CPP\"/usr/bin/g++\"CFLAGS\"O -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE\"host_os\"darwin9.0\"
+DLEXT\"bundle\"INCLUDEDIRS\"? /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL\"LDFLAGS\"? -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer -lpng\"GCC_BASE\"gcc\"GPP_BASE\"g++\"LDSHAREDFLAGS\"B -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup")
+end

Added: antargis/trunk/rookey/examples/virtual/rookey.log
===================================================================
--- antargis/trunk/rookey/examples/virtual/rookey.log	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/virtual/rookey.log	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,36 @@
+/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./config_class.rb:26:in `getConfig'
+/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/./rookey/tasks.rb:164:in `ruby_ext'
+/Users/davidkamphausen/projects.alt/antargis/rookey/examples/virtual/rakefile:3
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:2149:in `load'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:2149:in `raw_load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1897:in `load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1948:in `standard_exception_handling'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1896:in `load_rakefile'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1880:in `run'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1948:in `standard_exception_handling'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/lib/rake.rb:1878:in `run'
+/Library/Ruby/Gems/1.8/gems/rake-0.8.1/bin/rake:31
+/usr/bin/rake:19:in `load'
+/usr/bin/rake:19
+Running configurator Rookey::SwigConfig
+#<Rookey::Config:0x5454c0 @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
+Running configurator Rookey::MinGWConfig
+#<Rookey::Config:0x5454c0 @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
+Running configurator Rookey::RubyConfig
+#<Rookey::Config:0x5454c0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::GLConfig
+#<Rookey::Config:0x5454c0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::DebugConfig
+#<Rookey::Config:0x5454c0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::CompilerConfig
+#<Rookey::Config:0x5454c0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::CcacheConfig
+#<Rookey::Config:0x5454c0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::Configurator
+#<Rookey::Config:0x5454c0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::ZConfig
+#<Rookey::Config:0x5454c0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::SDLConfig
+#<Rookey::Config:0x5454c0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+Running configurator Rookey::PNGConfig
+#<Rookey::Config:0x5454c0 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer -lpng", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>

Added: antargis/trunk/rookey/examples/virtual/rookey_configuration.rb
===================================================================
--- antargis/trunk/rookey/examples/virtual/rookey_configuration.rb	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/virtual/rookey_configuration.rb	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,3 @@
+ROOKEY_CONFIG={
+
+}

Added: antargis/trunk/rookey/examples/virtual/test
===================================================================
(Binary files differ)


Property changes on: antargis/trunk/rookey/examples/virtual/test
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: antargis/trunk/rookey/examples/virtual/test.c
===================================================================
--- antargis/trunk/rookey/examples/virtual/test.c	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/virtual/test.c	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,2 @@
+
+extern "C" void png_get_io_ptr();int main(int argc,char*argv[]){return 0;}

Added: antargis/trunk/rookey/examples/virtual/vehicle.cc
===================================================================
--- antargis/trunk/rookey/examples/virtual/vehicle.cc	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/virtual/vehicle.cc	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,20 @@
+#include "vehicle.h"
+
+size_t Vehicle::countOfWheels() const
+{
+  return 0;
+}
+void Vehicle::travel(float time)
+{
+  travelWay(0);
+}
+
+float Vehicle::getWayTraveled() const
+{
+  return wayTravelled;
+}
+
+void Vehicle::travelWay(float way)
+{
+  wayTravelled+=way;
+}

Added: antargis/trunk/rookey/examples/virtual/vehicle.h
===================================================================
--- antargis/trunk/rookey/examples/virtual/vehicle.h	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/virtual/vehicle.h	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,22 @@
+#ifndef VEHICLE_H
+#define VEHICLE_H
+
+// SWIG_INCLUDE
+
+#include <rk_rubyobj.h>
+
+class Vehicle:public AGRubyObject
+{
+  public:
+    virtual size_t countOfWheels() const;
+    virtual void travel(float time);
+
+    float getWayTraveled() const;
+  protected:
+    void travelWay(float way);
+  private:
+
+    float wayTravelled;
+};
+
+#endif

Added: antargis/trunk/rookey/examples/virtual/virtualExample.bundle
===================================================================
(Binary files differ)


Property changes on: antargis/trunk/rookey/examples/virtual/virtualExample.bundle
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: antargis/trunk/rookey/examples/virtual/virtualExample_interface.i
===================================================================
--- antargis/trunk/rookey/examples/virtual/virtualExample_interface.i	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/virtual/virtualExample_interface.i	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,97 @@
+%module(directors="1") virtualExample
+%feature("autodoc","1");
+
+/*
+%feature("director:except") {
+ throw Swig::DirectorMethodException($error);
+}
+*/
+
+      %include <std_vector.i>
+      %include <std_list.i>
+      
+
+
+%include "stl.i"
+%include "std_list.i"
+%{
+#include "rk_string.h"
+#include "/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/./rookey/cpp/rk_rubyobj.h"
+#include "car.h"
+%}
+
+%wrapper %{namespace swig{
+        template <> struct traits_from_ptr<AGRubyObject> {
+          static VALUE from (AGRubyObject *val,int owner=0) {
+          
+            // insert Dynamic_cast(...)
+            swig_type_info *info=SWIGTYPE_p_AGRubyObject; //type_info<AGRubyObject>();
+            swig_type_info *ninfo=SWIG_TypeDynamicCast(info,(void**)&val);
+            if(ninfo==0)
+              ninfo=info;
+          
+            return SWIG_NewPointerObj(val, ninfo, owner);
+          }
+        };        
+        }%}
+
+%feature("director") AGRubyObject;
+%markfunc AGRubyObject "general_markfunc"
+%{
+      /*
+template<class T>
+VALUE convertCpp2Ruby(T *cObject)
+{
+  return SWIG_RubyInstanceFor(cObject);
+}
+template<AGRubyObject>*/ 
+VALUE convertCpp2Ruby(AGRubyObject *cObject)
+{
+  return SWIG_RubyInstanceFor(cObject);
+}
+  
+
+%}
+
+%{
+
+%}
+%insert("init") %{
+
+%}
+
+
+%typemaps_std_string(AGString, char, SWIG_AsCharPtrAndSize, SWIG_FromCharPtrAndSize, %checkcode(STDSTRING));
+
+/*
+template <>
+ inline VALUE from<AGString>(const AGString& val) {
+   return SWIG_FromCharPtrAndSize(val.c_str(),val.length());
+   //return traits_from<Type>::from(val);
+ }
+ */
+ // oder
+ %wrapper %{
+ namespace swig
+ {
+ template<> struct traits_from<AGString>
+ {
+	 inline static VALUE from(const AGString &val)
+	 {
+     return SWIG_FromCharPtrAndSize(val.c_str(),val.length());
+	 }
+};
+}
+%}
+
+
+
+%template(StringVector) std::vector<std::string>;
+%template(PStringVector) std::vector<std::string*>;
+
+
+%feature("trackobjects");
+
+%include "/Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/./rookey/cpp/rk_rubyobj.h"
+%include "car.h"      
+

Added: antargis/trunk/rookey/examples/virtual/virtualTest.rb
===================================================================
--- antargis/trunk/rookey/examples/virtual/virtualTest.rb	2009-02-16 20:01:21 UTC (rev 1283)
+++ antargis/trunk/rookey/examples/virtual/virtualTest.rb	2009-02-16 20:01:55 UTC (rev 1284)
@@ -0,0 +1,2 @@
+require 'virtualExample'
+



From davidkamphausen at mail.berlios.de  Mon Feb 16 21:13:01 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Mon, 16 Feb 2009 21:13:01 +0100
Subject: [Antargis-svn] r1285 - in antargis/trunk/rookey: . configs cpp lib
	lib/rookey lib/rookey/configs lib/rookey/cpp lib/rookey/swig
	maintainenance nbproject nbproject/private swig
Message-ID: <200902162013.n1GKD1r1006853@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-16 21:12:59 +0100 (Mon, 16 Feb 2009)
New Revision: 1285

Added:
   antargis/trunk/rookey/TODO
   antargis/trunk/rookey/lib/
   antargis/trunk/rookey/lib/rookey.rb
   antargis/trunk/rookey/lib/rookey/
   antargis/trunk/rookey/lib/rookey/compile.rb
   antargis/trunk/rookey/lib/rookey/config_class.rb
   antargis/trunk/rookey/lib/rookey/config_generator.rb
   antargis/trunk/rookey/lib/rookey/configs/
   antargis/trunk/rookey/lib/rookey/configs/ccache.rb
   antargis/trunk/rookey/lib/rookey/configs/compiler.rb
   antargis/trunk/rookey/lib/rookey/configs/debug.rb
   antargis/trunk/rookey/lib/rookey/configs/gl.rb
   antargis/trunk/rookey/lib/rookey/configs/mingw.rb
   antargis/trunk/rookey/lib/rookey/configs/png.rb
   antargis/trunk/rookey/lib/rookey/configs/ruby.rb
   antargis/trunk/rookey/lib/rookey/configs/sdl.rb
   antargis/trunk/rookey/lib/rookey/configs/swig.rb
   antargis/trunk/rookey/lib/rookey/configs/z.rb
   antargis/trunk/rookey/lib/rookey/cpp/
   antargis/trunk/rookey/lib/rookey/cpp/rk_base.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_debug.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_debug.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_exception.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_rtools.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_rtools.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_string.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_string.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_tools.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_tools.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_utf8.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_utf8.h
   antargis/trunk/rookey/lib/rookey/cpp/swig_dummy.cc
   antargis/trunk/rookey/lib/rookey/cpp_hierarchy_parser.rb
   antargis/trunk/rookey/lib/rookey/rookey_config.rb
   antargis/trunk/rookey/lib/rookey/rookey_rspec.rb
   antargis/trunk/rookey/lib/rookey/swig.rb
   antargis/trunk/rookey/lib/rookey/swig/
   antargis/trunk/rookey/lib/rookey/swig/swig_dyn_cast_containers.i
   antargis/trunk/rookey/lib/rookey/swig_ext.rb
   antargis/trunk/rookey/lib/rookey/swig_interface_builder.rb
   antargis/trunk/rookey/lib/rookey/tasks.rb
   antargis/trunk/rookey/lib/rookey/tools.rb
   antargis/trunk/rookey/maintainenance/antargis.iss
   antargis/trunk/rookey/maintainenance/tmp.iss
   antargis/trunk/rookey/nbproject/
   antargis/trunk/rookey/nbproject/private/
   antargis/trunk/rookey/nbproject/private/config.properties
   antargis/trunk/rookey/nbproject/private/private.properties
   antargis/trunk/rookey/nbproject/private/rake-d.txt
   antargis/trunk/rookey/nbproject/project.properties
   antargis/trunk/rookey/nbproject/project.xml
Removed:
   antargis/trunk/rookey/compile.rb
   antargis/trunk/rookey/config_class.rb
   antargis/trunk/rookey/config_generator.rb
   antargis/trunk/rookey/configs/ccache.rb
   antargis/trunk/rookey/configs/compiler.rb
   antargis/trunk/rookey/configs/debug.rb
   antargis/trunk/rookey/configs/gl.rb
   antargis/trunk/rookey/configs/mingw.rb
   antargis/trunk/rookey/configs/png.rb
   antargis/trunk/rookey/configs/ruby.rb
   antargis/trunk/rookey/configs/sdl.rb
   antargis/trunk/rookey/configs/swig.rb
   antargis/trunk/rookey/configs/z.rb
   antargis/trunk/rookey/cpp/ag_base.h
   antargis/trunk/rookey/cpp/ag_rubyobj.cc
   antargis/trunk/rookey/cpp/ag_rubyobj.h
   antargis/trunk/rookey/cpp/swig_dummy.cc
   antargis/trunk/rookey/cpp_hierarchy_parser.rb
   antargis/trunk/rookey/rookey.rb
   antargis/trunk/rookey/rookey_config.rb
   antargis/trunk/rookey/rookey_rspec.rb
   antargis/trunk/rookey/swig.rb
   antargis/trunk/rookey/swig/swig_dyn_cast_containers.i
   antargis/trunk/rookey/swig_ext.rb
   antargis/trunk/rookey/swig_interface_builder.rb
   antargis/trunk/rookey/tasks.rb
   antargis/trunk/rookey/tools.rb
Modified:
   antargis/trunk/rookey/README
   antargis/trunk/rookey/Rakefile
   antargis/trunk/rookey/maintainenance/Rakefile
Log:
rookey update

Modified: antargis/trunk/rookey/README
===================================================================
--- antargis/trunk/rookey/README	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/README	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,6 +1,7 @@
 == Overview
 Rookey is a simplified build-system in the manner of the autotools based on rake.
-It should make things much easier for c++-developers wanting to create ruby-extensions.
+It should make things much easier for c/++-developers wanting to create ruby-extensions.
+But it can build your plain-C/C++ projects, too.
 
 It uses swig for creation of the wrapping-code, but tries to handle the complicated
 configuration itself, so you shouldn't have to care about it too much.
@@ -14,5 +15,10 @@
 * directors and dynamic_casts are created automatically for children of AGRubyObject
 * marking is simplified, so that you only have to override the "mark()"-method and call markObject(.) for each object that you want to mark (for all AGRubyObject-derived classes)
 * Rookey takes care of the class-hierarchy and includes header-files in the correct order
+* cross-platform compilation
+* bundling packages/installers for different platforms
+* (in future cross-compiler configuration)
 
-Rookey is handled by a rake-alike syntax. Module Rookey describes how to use it.
\ No newline at end of file
+Rookey is handled by a rake-alike syntax. Module Rookey describes how to use it.
+
+link:files/examples/README.html contains several examples on how to use rookey. Apart from that have a look at the Antargis sources to get an impression of Rookey At Work.
\ No newline at end of file

Modified: antargis/trunk/rookey/Rakefile
===================================================================
--- antargis/trunk/rookey/Rakefile	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/Rakefile	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,18 +1,101 @@
 require 'rake/rdoctask.rb'
 require 'spec/rake/spectask'
-require 'rake/cleantask.rb'
+require 'rake/clean.rb'
+require 'rake/gempackagetask.rb'
+require 'pp'
 
+class MDir
+  def initialize(path)
+    @path=path
+    @files=[]
+    @dirs=[]
+  end
+  def file(f)
+    @files << f
+  end
+  def files(*f)
+    @files += f
+  end
+  def dir(name,&p)
+    dir = MDir.new(name)
+    dir.instance_eval(&p)
+    @dirs << dir
+  end
+  def dirs(*names,&p)
+    names.each{|name|
+      dir=MDir.new(name)
+      dir.instance_eval(&p)
+      @dirs << dir
+    }
+  end
+  def gather(base="")
+    a=[]
+    @files.each{|f|
+      a+=Dir[File.join(@path,f)]
+    }
+    @dirs.each{|dir|
+      a+=dir.gather(@path)
+    }
+    a
+  end
+end
+
+def dir(path,&p)
+  d=MDir.new(path)
+  d.instance_eval(&p)
+  d.gather
+end
+
+PKG_VERSION="0.1"
+PKG_FILES=dir(".") do
+  files "README","Rakefile"
+  dirs("spec","lib","maintenance","examples") do
+    files("**/*")
  end 
+  dir("externals") do
+    files("ext_config.rb","tools.rb")
  end
end
+
 Rake::RDocTask.new do |rd|
 	 rd.main = "README"
 	 rd.title="Rookey (Part of Battles of Antargis)"
 	 #rd.options << "--diagram"
 	 rd.rdoc_dir="docs/ruby"
 	 a=Dir["**/README"]+Dir["**/*.rb"]
-	 a=a.select{|f|not (f=~/_test/ or f=~/spec/)}
+	 a=a.select{|f|not (f=~/_test/ or f=~/spec/ or f=~/externals/ or f=~/maintainenance/)}
 	 rd.rdoc_files.include(a)
+	 
+	 # TODO: run examples
 end
- 
 
+# TODO: create gem
+spec = Gem::Specification.new do |s|
+    s.platform = Gem::Platform::RUBY
+    s.summary = "Ruby based make-like utility."
+    s.name = 'rookey'
+    s.author='David Kamphausen'
+    s.email='david.kamphausen at web.de'
+    s.homepage='http://antargis.berlios.de'
+    s.version = PKG_VERSION
+    s.requirements << 'rake'
+    s.require_path = 'lib'
+    #s.autorequire = 'rake'
+    s.files = PKG_FILES
+    s.has_rdoc=true
+    s.description = <<EOF
+  Rookey is an autotools-like tool to help you build c/c++ programs and extensions for ruby.
+  It contains some extra features for dependencies and packaging.
+EOF
+end
+
+Rake::GemPackageTask.new(spec) do |pkg|
+  pkg.need_zip = true
+  pkg.need_tar = true
+end
+
+
+
+# TODO: upload gem
+
+
 # rspec
 Spec::Rake::SpecTask.new(:spec) do |t|
 	t.spec_files = FileList['**/spec_*.rb']
@@ -23,5 +106,6 @@
 
 CLEAN << "spec_output.html"
 CLEAN << Dir["docs/ruby"]
+CLEAN << Dir["pkg"]
 
 task :default=>:spec
\ No newline at end of file

Added: antargis/trunk/rookey/TODO
===================================================================
--- antargis/trunk/rookey/TODO	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/TODO	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,9 @@
+TODOs
+* document public methods
+* improve interface so that it's more like rake's
+* complete examples
+* create gem
+* publish
+* run configures only when needed
+* make output more readable, store debug-info in file
+* store configuration in .dotfiles
\ No newline at end of file

Deleted: antargis/trunk/rookey/compile.rb
===================================================================
--- antargis/trunk/rookey/compile.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/compile.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,174 +0,0 @@
-module Rookey
-  class Compiler
-    def initialize(config)
-      @config=config
-    end
-  
-	  def Compiler.getDeps(t)
-	    # FIXME
-	    
-	    parseDepsFiles
-      
-      return t unless @@deps
-      p=File.join(Compiler.getDepsDir,t)
-	    return @@deps[p] if @@deps[p]
-      t
-	  end
-  
-	  def compile(target,sources)
-	    source=makeSource(target)
-	    
-      # FIXME check for c/c++
-      
-	    program=getCompiler(:cpp)
-
-	    
-	    options=[]
-	
-      pp @config
-      
-	    options << @config["CFLAGS"]
-	    
-	    includeDirs = @config["INCLUDEDIRS"].split(" ")
-	    includes=includeDirs.map{|d|"-I"+d}
-	    options+=includes
-	    
-      expanded_path=File.expand_path(source)
-      sourcepath=source
-      sourcepath=expanded_path if File.exists?(expanded_path) and not File.exists?(source)
-      sourcepath="/"+sourcepath if File.exists?("/"+sourcepath) and not File.exists?(sourcepath)
-      #pp sourcepath,source
-      #exit
-	    options << "-c "+sourcepath
-	    options << "-o "+target
-      
-      
-      depfile=File.join(Compiler.getDepsDir,source)
-      depdir=File.split(depfile)[0]
-      Rookey.mkdir(depdir)
-      
-      outdir=File.split(target)[0]      
-      Rookey.mkdir(outdir)
-
-      options << "-Wp,-MD,#{depfile}"
-	            
-	    call=program+" "+options.join(" ")
-	    sh call
-      puts
-	  
-	  end
-    
-    def linkEXE(name,objects)
-      program=getCompiler(:cpp)
-      options=[]
-      options << "-o "+name
-      options += objects.uniq
-      options << @config["LDFLAGS"] 
-      call=program+" "+options.join(" ")
-      sh call
-      puts
-    end
-      
-	  
-	  def linkDLL(t)
-	    programcall=getCompiler(:cpp)+" " + at config["LDSHAREDFLAGS"]
-      
-      options=[]
-      pp t.methods.sort
-      pp t.prerequisites
-      
-      options << "-o "+t.name
-      options += t.prerequisites
-      options << @config["LDFLAGS"] 
-      options << @config["LIBS"]
-      options << @config["LIBRUBYARG"] 
-      call=programcall+" "+options.join(" ")
-      sh call
-      puts
-	  end
-	  def linkSO(t)
-	  end
-	  def linkA(t)
-	  end
-	  
-	  def dllName(base)
-	    base+"."+ at config["DLEXT"]
-	  end
-	  
-    def exeName(base)
-      if @config["host_os"]=~/win/ and not @config["host_os"]=~/darwin/
-        base+".exe"
-      else
-        base
-      end
-    end
-    
-    # FIXME: include build-dirs
-	  def makeObject(sourceName)
-	    file=File.join(getBuildDir,sourceName+".o")
-      dir=File.split(file)[0]
-      begin
-#        pp @config
-#        pp "DIR:",dir
-        #if dir
-        Rookey.mkdir(dir) if dir.length>0
-      rescue Object
-        pp $!
-      end
-      file
-	  end
-	  
-	  def makeSource(objectName)
-	    objectName.sub(/\.o$/,"").sub(/^#{getBuildDir}[\/\\]/,"")
-	  end
-	  
-    def getPlainBuildDir
-      ".build_"+ at config["host_os"]
-    end
-    
-	  def getBuildDir
-	    File.join(Dir.pwd,getPlainBuildDir)
-	  end
-    def Compiler.getDepsDir
-      File.join(Dir.pwd,".deps")
-    end
-        
-    private
-    def getCompiler(type)
-       #FiXME
-      compiler= case type
-        when :cpp
-          @config["CPP"]
-        when :c
-          @config["CC"]
-        else
-          raise "Unknown compiler type #{type}"
-      end
-      ccache=@config["CCACHE"]
-      compiler=ccache+" "+compiler if ccache
-      compiler
-    end
-    
-    def findProgram(pattern)
-      
-    end
-    
-    @@deps=nil
-    def Compiler.parseDepsFiles
-      return @@deps if @@deps
-            
-      files=Dir[File.join(getDepsDir,"**","*")]
-      @@deps={}
-      files.each{|file|
-        unless File.directory?(file)
-	        fd=File.open(file)
-	        
-	        @@deps[file]=fd.read.gsub("\\\n","").split(" ")[1..-1]
-	        fd.close
-        end
-      }
-    end
-  end
-  
-  
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/config_class.rb
===================================================================
--- antargis/trunk/rookey/config_class.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/config_class.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,33 +0,0 @@
-module Rookey
-  
-  # Rookeys Config-hash. 
-  class Config
-    def initialize(hash={})
-      @hash=hash
-    end
-    def [](name)
-      @hash[name]||""
-    end
-    def []=(name,value)
-      @hash[name]=value
-    end
-    def add(name,value)
-      @hash[name]||=""
-      @hash[name]+=" "+value
-    end
-  end
-  @@config=nil
-  
-  def Rookey.getConfig
-    if @@config.nil?
-      if File.exists?(Rookey::CONFIG_FILENAME)
-        load Rookey::CONFIG_FILENAME
-      else 
-        runConfigure
-        hibe(@@config,Rookey::CONFIG_FILENAME)
-      end
-      CLEAN << Rookey::CONFIG_FILENAME
-    end
-    @@config
-  end 
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/config_generator.rb
===================================================================
--- antargis/trunk/rookey/config_generator.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/config_generator.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,159 +0,0 @@
-
-require File.join(File.split(__FILE__)[0],'config_class.rb')
-
-class Class
-  def provides(s=nil)
-    @provides||=[]
-    @provides << s if s
-    @provides
-  end
-  def needs(s=nil)
-    @needs||=[]
-    @needs << s if s
-    @needs
-  end     
-end
-
-module Rookey
-  
-  
-  CONFIG_FILENAME="config_cache.rb"
-  @@configured=[]
-  
-  # stores a dumpable ruby-object *what* into a file named *filename*
-  def Rookey.hibe(what,filename)
-    content=Marshal.dump(what).gsub("\"","\\\"")
-    File.open(filename,"w") do |f|
-      f.puts <<EOT
-module Rookey
-  @@config=Marshal.load("#{content}")
-end
-EOT
-    end
-  end
-  
-  class Configurator
-    def initialize
-    end
-    def run(config)
-    end
-    
-    def installLibDir
-      File.join(File.split(__FILE__)[0],"externals","build","lib")
-    end
-    def installIncludeDir
-      File.join(File.split(__FILE__)[0],"externals","build","include")
-    end
-    
-    def searchProgram(program)
-      searchPrograms(program)[0]
-    end
-    
-    def searchPrograms(program)
-      programs=[program].flatten
-      result=programs.map{|program|
-	      getPath.map{|dir|
-	        
-	        p=File.join(dir,program)
-          list=Dir[p]
-	        p=nil unless File.exists?(p)
-          p||=list[0]
-          p
-	      }
-      }.flatten.uniq-[nil]
-      pp result
-      result
-    end
-    def checkProgram(program)      
-    end
-    def checkLibrary(config,lib,funcname)
-      source="extern \"C\" void #{funcname}();int main(){return 0;}"
-      testSource="test.c"
-      fd=File.open(testSource,"w")
-      fd.puts source
-      fd.close
-      compiler=Compiler.new(config)
-      target=compiler.makeObject(testSource)
-      compiler.compile(target,testSource)
-      libadd="-l#{lib}"
-      exeName=compiler.exeName("test")
-      begin
-        compiler.linkEXE(exeName,[target,libadd])
-        `#{exeName}`
-        if $?
-          config.add("LDFLAGS",libadd)
-        end
-      rescue RuntimeError => e
-        return false
-      end
-      true
-    end
-    private
-    def getPath
-      # add paths in externals/build/*/bin
-      getEnvPath+Dir[File.expand_path(File.join(File.split(__FILE__)[0],"externals","built","*"))].map{|d|File.join(d,"bin")}
-    end
-    def getEnvPath
-      p=ENV["PATH"]
-      if File.join("a","b")=~/\\/
-        p.split(";")
-      else
-        p.split(":")
-      end
-    end
-    
-    def install(package)
-      #raise 1
-      ruby(File.join(File.split(__FILE__)[0],"externals","tools.rb"),package)
-    end    
-  end
-  
-  Dir[File.join(File.split(__FILE__)[0],"configs","*.rb")].each{|file|
-    require file
-  }
-  
-  def Rookey.log(*s)
-    puts(*s)
-  end
-  
- 
-  def Rookey.getDescendantsOfClass(p)
-    c=[]
-    ObjectSpace.each_object(Class){|a|c.push(a) if a.ancestors.member?(p)}
-    return c
-  end
-  
-  
-  def self.checkConfig(pClass)
-    
-  end
-  
-  def Rookey.runConfigure
-    configurators=getDescendantsOfClass(Configurator)
-    ok=[]
-    run=[]
-    config=Config.new
-    while run.length<configurators.length
-	    configurators.each{|c|
-	      unless run.member?(c)
-		      if c.needs.select{|s|not ok.member?(s)}.length == 0
-		        log "Running configurator #{c}"
-            #pp config
-            begin
-		          c.new.run(config)
-              @@configured << c
-            rescue
-              puts "Configuration of #{c} failed !"
-            end
-		        ok+=c.provides
-		        ok.uniq!
-		        run << c
-		      end
-	      end
-	    }
-    end
-    pp config
-    puts
-    @@config=config
-  end
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/configs/ccache.rb
===================================================================
--- antargis/trunk/rookey/configs/ccache.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/configs/ccache.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,13 +0,0 @@
-module Rookey
-  class CcacheConfig<Configurator
-    provides :compilerAddon
-    needs :compiler
-    
-    def run(config)
-      ccache=searchProgram("ccache")
-      if ccache
-        config["CCACHE"]=ccache
-      end
-    end
-  end
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/configs/compiler.rb
===================================================================
--- antargis/trunk/rookey/configs/compiler.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/configs/compiler.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,9 +0,0 @@
-module Rookey
-  class CompilerConfig<Configurator
-    needs :compiler
-    
-    def run(config)
-      config.add("INCLUDEDIRS",File.join(File.split(File.split(__FILE__)[0])[0],"cpp"))
-    end
-  end
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/configs/debug.rb
===================================================================
--- antargis/trunk/rookey/configs/debug.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/configs/debug.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,13 +0,0 @@
-module Rookey
-  class DebugConfig<Configurator
-    needs :compiler
-    
-    def run(config)
-      pp ROOKEY_CONFIG
-      if ROOKEY_CONFIG[:debug]
-	      config.add("CFLAGS","-O0 -g")
-	      config.add("LDFLAGS","-g")
-      end
-    end
-  end
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/configs/gl.rb
===================================================================
--- antargis/trunk/rookey/configs/gl.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/configs/gl.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,22 +0,0 @@
-require 'mkmf'
-require File.join(File.split(__FILE__)[0],"ruby.rb")
-
-module Rookey
-  class GLConfig<Configurator
-    provides :opengl
-    needs :compiler
-    
-    def run(config)
-      case config["host_os"]
-        when /darwin/
-          config.add("INCLUDEDIRS","/usr/X11/include")        
-          config.add("LDFLAGS","-Wl,-framework,OpenGL")
-        when /win32/
-          #config.add("INCLUDEDIRS","/usr/X11/include")        
-          config.add("LDFLAGS","-lopengl32 -lglu32")
-        else
-          config.add("LDFLAGS","-lGL -lGLU")
-      end      
-    end   
-  end 
-end

Deleted: antargis/trunk/rookey/configs/mingw.rb
===================================================================
--- antargis/trunk/rookey/configs/mingw.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/configs/mingw.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,35 +0,0 @@
-require 'mkmf'
-
-module Rookey
-  class MinGWConfig<Configurator
-    provides :compiler
-    
-    def run(config)
-      if ROOKEY_CONFIG[:extconfig]=='mingw32'
-	      #config.add("INCLUDEDIRS",get("archdir")+" "+get("includedir"))
-	      #config.add("CFLAGS",get("CFLAGS"))
-	      #config.add("LDFLAGS",get("LIBS"))
-	      #config.add("LDFLAGS",get("LIBRUBYARG"))
-	      #config.add("LDSHAREDFLAGS",get("LDSHARED").sub(/^[^ ]+ /,""))
-	      config["DLEXT"]="dll"
-	      config["host_os"]="win32"      
-	      config["GPP_BASE"]="i*mingw*g++"
-	      config["GCC_BASE"]="i*mingw*gcc"
-	
-	      {"CPP"=>"GPP_BASE","CC"=>"GCC_BASE"}.each{|name,base|      
-	        config[name]=searchProgram(config[base])
-	      }
-        base=config["CPP"].gsub(/bin\/[^\/]+/,"")
-        baseMingw=Dir[base+"i*mingw*"]
-        config.add("LDFLAGS","-L"+File.join(baseMingw,"lib"))
-        config.add("LDFLAGS","-L"+installLibDir)
-        config.add("INCLUDEDIRS",File.join(baseMingw,"include"))
-        config.add("INCLUDEDIRS",installIncludeDir)
-        
-        
-        #pp config
-        #exit
-      end
-    end
-  end    
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/configs/png.rb
===================================================================
--- antargis/trunk/rookey/configs/png.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/configs/png.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,17 +0,0 @@
-require 'mkmf'
-require File.join(File.split(__FILE__)[0],"ruby.rb")
-
-module Rookey
-  class PNGConfig<Configurator
-    provides :png
-    needs :compiler
-    needs :z
-        
-    def run(config)
-      unless checkLibrary(config,"png","png_get_io_ptr")
-        install("png")
-        checkLibrary(config,"png","png_get_io_ptr")
-      end
-    end   
-  end 
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/configs/ruby.rb
===================================================================
--- antargis/trunk/rookey/configs/ruby.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/configs/ruby.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,57 +0,0 @@
-require 'mkmf'
-
-module Rookey
-	  class RubyConfig<Configurator
-      if ROOKEY_CONFIG[:use_mkmf]==true or ROOKEY_CONFIG[:use_mkmf].nil? 
-		    provides :compiler
-		    
-		    def run(config)
-			      config.add("INCLUDEDIRS",get("archdir")+" "+get("includedir"))
-			      config.add("CFLAGS",get("CFLAGS"))
-			      config.add("LDFLAGS",get("LIBS"))
-			      config.add("LDFLAGS",get("LIBRUBYARG"))
-			      config.add("LDSHAREDFLAGS",get("LDSHARED").sub(/^[^ ]+ /,""))
-			      config["DLEXT"]=get("DLEXT")
-			      config["host_os"]=get("host_os")      
-			      config["GPP_BASE"]="g++"
-			      config["GCC_BASE"]="gcc"
-			
-			      {"CPP"=>"GPP_BASE","CC"=>"GCC_BASE"}.each{|name,base|      
-			        config[name]=searchProgram(config[base])
-			      }
-	          
-	          if config["host_os"]=~/darwin.*/ and false
-	            pgc="-finstrument-functions"
-	            pgl="-finstrument-functions -lSaturn"
-	          else
-	            pgc="-pg"
-	            pgl="-pg"
-	          end 
-	          config.add("CFLAGS",pgc) if ROOKEY_CONFIG[:profile]
-	          config.add("LDFLAGS",pgl) if ROOKEY_CONFIG[:profile]
-	          
-	          ["CFLAGS","CPPFLAGS","LDFLAGS"].each{|name|
-	            config.add(name,ENV[name]) if ENV[name]
-	          }
-	          
-		    end
-		    
-		  private
-		    # recurse through ruby's CONFIG structure 
-		    def get(n)
-		      return "" if n.nil?
-		      v=CONFIG[n]
-		      return "" if v.nil?
-		      v.gsub(/\$\(([^)]*\))/) {|a|
-		        f=a[2..-2]
-		        get(f)
-		      }      
-		    end
-		    
-      elsif ROOKEY_CONFIG[:extconfig]=='mingw32'
-        def run(config)
-          install("ruby")
-        end
-	  end
-	end
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/configs/sdl.rb
===================================================================
--- antargis/trunk/rookey/configs/sdl.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/configs/sdl.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,27 +0,0 @@
-module Rookey
-  class SDLConfig<Configurator
-    provides :sdl
-    needs :compiler
-    
-    def run(config)
-      # FIXME
-      sdlconfig="sdl-config"
-      
-      pp config
-      if config["host_os"]!="win32"
-	      cflags=`#{sdlconfig} --cflags`.chomp
-	      config.add("CFLAGS",cflags.split(" ").select{|f|not f=~/^-I/}.join(" "))
-	      config.add("INCLUDEDIRS",cflags.split(" ").select{|f|f=~/^-I/}.map{|f|f[2..-1]}.join(" "))
-	      config.add("LDFLAGS",`sdl-config --libs`.chomp)
-      else
-        ["sdl","sdl_image","sdl_ttf","sdl_mixer"].each{|lib|install(lib)}
-        config.add("INCLUDEDIRS",File.join(installIncludeDir,"SDL"))
-        
-      end      
-      
-      checkLibrary(config,"SDL_image","IMG_Load")
-      checkLibrary(config,"SDL_ttf","TTF_Quit")
-      checkLibrary(config,"SDL_mixer","Mix_LoadMus")
-    end
-  end
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/configs/swig.rb
===================================================================
--- antargis/trunk/rookey/configs/swig.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/configs/swig.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,34 +0,0 @@
-module Rookey
-  class SwigConfig<Configurator
-    provides :swig
-    VERSIONS=["1.3.33","1.3.34","1.3.35"]
-    
-    def run(config,firstrun=true)
-      swigs=searchPrograms("swig").select{|swig|checkVersion(swig)}
-      if swigs.length==0
-        puts "ERROR: no SWIG with version in #{VERSIONS.join(", ")} not found!"
-        if firstrun
-	        #buildSwig
-          install("swig")
-	        run(config,false)
-        end
-      else
-	      swig=swigs[0]
-	      # FIXME: search program
-	      config.add("SWIG_OPTIONS","-Wall -DAGEXPORT")
-	      config.add("SWIG",swig)
-      end
-    end
-    
-    private
-    def checkVersion(swig)
-      run="#{swig} -version"
-      output=`#{run}`
-      VERSIONS.select{|v|output=~/#{v}/}.length>0
-    end
-    #def buildSwig
-    #  ruby File.join(File.split(__FILE__)[0],"..","externals","swig","build.rb")
-    #end
-    
-  end
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/configs/z.rb
===================================================================
--- antargis/trunk/rookey/configs/z.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/configs/z.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,18 +0,0 @@
-require 'mkmf'
-require File.join(File.split(__FILE__)[0],"ruby.rb")
-
-module Rookey
-  class ZConfig<Configurator
-    provides :z
-    needs :compiler
-    
-    def run(config)
-      unless checkLibrary(config,"z","compress")
-        install("zlib")
-        puts "ARG"
-        config.add("LDFLAGS","-L"+installLibDir)
-        checkLibrary(config,"z","compress")
-      end
-    end   
-  end 
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/cpp/ag_base.h
===================================================================
--- antargis/trunk/rookey/cpp/ag_base.h	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/cpp/ag_base.h	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,39 +0,0 @@
-/**
- * This file provides a define "AGEXPORT" to be used for exporting functions and classes
- * out of DLLs on Windows.
- * For this to function you'll just insert it:
- * 1) before a function declaration:
- *    AGEXPORT void myFunction();
- * 2) or inbetween a class-definition:
- *    class AGEXPORT MyClass {
- *    .....
- *    };
- * No additional configuration should be needed.
- * including within swig is taken care of. 
- *  
- * */
-
-#ifndef AG_BASE_H
-#define AG_BASE_H
-
-#ifdef WIN32
-#ifdef AGIMPORT
-#define AGEXPORT __declspec(dllimport)
-#else
-#undef AGEXPORT
-#define AGEXPORT __declspec(dllexport)
-#endif // AGIMPORT
-#else
-
-#undef AGEXPORT
-#define AGEXPORT
-
-#endif // WIN32
-
-#ifdef SWIG
-#undef AGEXPORT
-#define AGEXPORT
-#endif
-
-
-#endif

Deleted: antargis/trunk/rookey/cpp/ag_rubyobj.cc
===================================================================
--- antargis/trunk/rookey/cpp/ag_rubyobj.cc	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/cpp/ag_rubyobj.cc	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,188 +0,0 @@
-#include "ag_base.h"
-#include "ag_rubyobj.h"
-#include <assert.h>
-#include <typeinfo>
-#include <set>
-#include <map>
-#include <iostream>
-
-
-#ifdef __WIN32__
-#include <winsock2.h> // fix problem with fd_set
-#endif
-#include <ruby.h>
-
-bool mRubyQuitting=false;
-
-// this set keeps track of all valid instances of AGRubyObject
-std::set<AGRubyObject*> mRubyObjects;
-std::set<AGRubyObject*> mRemovedRubyObjects;
-
-void setQuitting()
-  {
-    mRubyQuitting=true;
-  }
-
-// swig-function for handling "tracked" objects
-// BEWARE: this does not support multiple libraries yet (FIXME)
-VALUE convertCpp2Ruby(AGRubyObject *cObject);
-
-AGEXPORT void *getAddressOfRubyObject(AGRubyObject *o)
-  {
-    return o;
-  }
-
-AGEXPORT bool rubyObjectExists(void *po)
-  {
-    VALUE v=convertCpp2Ruby((AGRubyObject*)po);
-    return(v!=Qnil);
-  }
-
-AGRubyObject::AGRubyObject()
-  {
-    //std::cerr<<"AGRubyObject::new:"<<this<<std::endl;
-    assert(mRubyObjects.find(this)==mRubyObjects.end());
-    mRubyObjects.insert(this);
-    size_t oSize=mRemovedRubyObjects.size();
-
-    mRemovedRubyObjects.erase(this);
-    if(oSize!=mRemovedRubyObjects.size())
-      std::cerr<<"Collision - removed rubyobject's address is overwritten!"<<std::endl;
-    
-    std::cerr<<"current ruby#:"<<mRubyObjects.size()<<" removed:"<<mRemovedRubyObjects.size()<<std::endl;
-  }
-AGRubyObject::~AGRubyObject()
-  {
-    assert(mRubyObjects.find(this)!=mRubyObjects.end());
-    assert(mRemovedRubyObjects.find(this)==mRemovedRubyObjects.end());
-    //std::cerr<<"AGRubyObject::Removed:"<<this<<std::endl;
-    for(std::set<AGBaseObject*>::iterator i=mReferences.begin();i!=mReferences.end();i++)
-      (*i)->baseClear();
-    mRubyObjects.erase(this);
-    mRemovedRubyObjects.insert(this);
-  }
-
-
-/// override this function to mark your children
-void AGRubyObject::mark()
-  {
-  }
-
-
-// call this function with any object you want to mark.
-// recursive should be set true only in one direction, otherwise you'll generate endless-loops (!!)
-void AGRubyObject::markObject(AGRubyObject *o, bool recursive)
-  {
-    //std::cerr<<"markObject:"<<o<<std::endl;
-    // o must be a valid ruby-object
-    assert(mRubyObjects.find(o)!=mRubyObjects.end());
-
-    // look up, if it's registered within ruby
-    VALUE v=convertCpp2Ruby(o);
-    if(v!=Qnil)
-      {
-        assert(DATA_PTR(v)==o);
-        //std::cout<<"V:"<<v<<std::endl;
-        // then mark it
-        rb_gc_mark(v);
-        
-      }
-
-    assert(o);
-    // recurse through hierarchy
-    if(recursive)
-      o->mark(); // call this directly
-  }
-
-void AGRubyObject::clear()
-  {
-  }
-
-void AGRubyObject::addRef(AGBaseObject *o)
-  {
-    mReferences.insert(o);
-  }
-
-void AGRubyObject::deleteRef(AGBaseObject *o)
-  {
-    mReferences.erase(o);
-  }
-
-
-
-/// this is the marking function, that gets called by ruby
-/// it handles all the AGRubyObjects
-void general_markfunc(void *ptr)
-  {
-    if(!ptr)
-      {
-        std::cerr<<("WARNING: a ptr==0 was given in general_markfunc!")<<std::endl;
-        return; // ignore this !
-      }
-    assert(ptr);
-    // the given object must be a AGRubyObject and it must be valid (it's in mRubyObjects)
-    AGRubyObject *o=static_cast<AGRubyObject*>(ptr);
-    if(mRubyObjects.find(o)==mRubyObjects.end())
-      std::cerr<<"OLD RUBYOBJ:"<<(mRemovedRubyObjects.find(o)!=mRemovedRubyObjects.end())<<":"<<o<<std::endl;
-    assert(mRubyObjects.find(o)!=mRubyObjects.end());
-
-#ifdef GCDEBUG
-    printf("mark: 0x%lx\n",o->mRUBY);
-#endif
-
-    assert(o);
-    o->mark();
-  }
-
-
-/**
-   saveDelete is used to delete AGRubyObjects savely.
- */
-bool saveDelete(AGRubyObject *o)
-  {
-    if(mRubyQuitting)
-      return false; // we are quitting - so memory is discarded anyway - hopefully ;-)
-
-    // check, if this object is existant any longer
-    // in case we're quitting this the deletion order is not defined for ruby-objects !!
-    if(mRubyObjects.find(o)==mRubyObjects.end())
-      {
-#ifdef GC_DEBUG
-        std::cerr<<"RubyObject "<<o<<" no longer existant - maybe we're quitting ?!"<<std::endl;
-#endif
-        return false;
-      }
-
-    assert(o);
-    // send object a message, that it will be deleted. This can help with detachin connections
-    // between objects.
-    o->clear();
-    
-    VALUE v=convertCpp2Ruby(o);
-    if(v!=Qnil)
-      return false; // do not delete - it's under ruby's control!
-    
-    
-    delete o;
-    return true;
-  }
-
-
-
-AGBaseObject::AGBaseObject(AGRubyObject *p)
-:mp(p)
-    {
-      if(p)
-        p->addRef(this);
-    }
-
-AGBaseObject::~AGBaseObject()
-  {
-    if(mp)
-      mp->deleteRef(this);
-  }
-
-void AGBaseObject::baseClear()
-  {
-    mp=0;
-  }

Deleted: antargis/trunk/rookey/cpp/ag_rubyobj.h
===================================================================
--- antargis/trunk/rookey/cpp/ag_rubyobj.h	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/cpp/ag_rubyobj.h	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,132 +0,0 @@
-#ifndef RUBY_OBJ_H
-#define RUBY_OBJ_H
-
-// INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
-
-#ifdef WIN32
-#undef connect
-#undef close
-#endif
-
-/**
-   AGRubyObject does handling between ruby and c++ memory management.
-   Ruby has a garbage collector (GC) which is not really to be influenced.
-   Every object that is created in ruby is handled by the GC.
-   So we have to take care of that.
-
-   Ruby's GC has no reference counting whatsoever but it uses a mark-and-sweep
-   algorithm. When the GC is run the algorithm marks any known object and then calls
-   all the objects' mark-functions which therefore call mark-functions all the objects it
-   knowns. When anything known is marked, the algorithm kills any object that isn't marked.
-
-   So all we have to do is to mark any object that is connected to the current object in any way.
-   Normally you would mark any object that is a children of the current one.
-
-   To make things easier AGRubyObject takes care of objects which are not handled by ruby. They get called
-   recursively anyways. So all you have to do is overriding the mark() function and then calling 
-   markObject(AGRubyObject *o) for any object you want to mark.
-
-   If you need an explicit destructor-call at a specified time you must be content with a call to clear(), which
-   you can override. For deletion of any AGRubyObject you should use saveDelete. This calls clear() and deletes the
-   object, if it's not a ruby-managed one.
-
-   @see saveDelete(AGRubyObject *o)
- */
-
-// INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
-
-#include <string>
-#include <set>
-#include <ag_base.h>
-#include <stdexcept>
-
-class AGRubyObject;
-
-class AGEXPORT AGBaseObject
-{
-protected:
-  AGRubyObject *mp;
-public:
-  AGBaseObject(AGRubyObject *p) throw ();
-
-  ~AGBaseObject() throw ();
-  void baseClear() throw ();
-
-  bool valid() throw ()
-    {
-      return mp;
-    }
-};
-
-
-/**
- * gc_ptr<T> is a managed ptr to a (possibly) garbage-collected object
- * it will be redirected to 0, if the targeted object is destroyed. So
- * you'll get a null-pointer exception when the object is not longer
- * present. This prevents you from accessing random memory. 
- */
-template<class T>
-class AGEXPORT gc_ptr:public AGBaseObject
-{
-public:
-  gc_ptr(T*t):AGBaseObject(t)
-  {
-  }
-
-  T*operator->()
-    {
-      return (T*)mp;
-    }
-  T* getPtr()
-  {
-    if(!mp)
-      throw std::runtime_error("mp not defined!");
-    return (T*)mp;
-  }
-};
-
-/**
- * 
- * */
-class AGEXPORT AGRubyObject
-{
-public:
-  /**
-     This is copied from ruby.h, so that this header-file is not included all over the place.
-     FIXME: this must eventually be changed - when the ruby implementation changes
-   */
-  typedef unsigned long VALUE;
-
-  AGRubyObject() throw();
-  virtual ~AGRubyObject() throw();
-
-protected:
-#ifndef SWIG
-  // functions shouldn't be exported and NEVER be used in ruby!
-  virtual void clear() throw();
-  virtual void mark() throw();
-  void markObject(AGRubyObject *o,bool recursive=true) throw();
-
-#endif
-public:
-#ifndef SWIG
-
-#endif
-  friend void general_markfunc(void *ptr);
-  friend bool saveDelete(AGRubyObject *o);
-
-  void addRef(AGBaseObject *o);
-  void deleteRef(AGBaseObject *o);
-private:
-  std::set<AGBaseObject*> mReferences;
-};
-
-AGEXPORT void general_markfunc(void *ptr);
-AGEXPORT bool saveDelete(AGRubyObject *o);
-
-AGEXPORT void *getAddressOfRubyObject(AGRubyObject *object);
-AGEXPORT bool rubyObjectExists(void *o);
-
-AGEXPORT void setQuitting();
-
-#endif

Deleted: antargis/trunk/rookey/cpp/swig_dummy.cc
===================================================================
--- antargis/trunk/rookey/cpp/swig_dummy.cc	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/cpp/swig_dummy.cc	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,11 +0,0 @@
-#include "ag_rubyobj.h"
-
-#ifdef __WIN32__
-#include <winsock2.h> // fix problem with fd_set
-#endif
-#include <ruby.h>
-
-VALUE convertCpp2Ruby(AGRubyObject *cObject)
-  {
-    return Qnil;
-  }

Deleted: antargis/trunk/rookey/cpp_hierarchy_parser.rb
===================================================================
--- antargis/trunk/rookey/cpp_hierarchy_parser.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/cpp_hierarchy_parser.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,154 +0,0 @@
-require 'ostruct'
-
-module Rookey
-  
-  def Rookey.getRubyClasses(classes)
-    cs=[classes.select{|c|c.name=="AGRubyObject"}[0]]
-    begin
-      s=cs.length
-      cs=[cs+cs.map{|c|c.children}].flatten.uniq
-    end while s!=cs.length
-    cs
-  end
-  
-  def Rookey.getOrderedCppHeaders(classes)
-    map={}
-    order={}
-    
-    pp classes
-    
-    allClasses=classes.dup
-    classes=getRubyClasses(classes)
-    
-    classes.each{|c|
-      map[c.name.to_s]=c
-    }
-    classes.each{|c|
-      order[c.name]=0 if map[c.parent.to_s].nil? 
-    }
-    oneNotSet=false
-    maxNumber=0
-    begin
-      oneNotSet=false
-      classes.each{|c|
-        if order[c.name].nil?
-          if order[c.parent].nil?
-            oneNotSet=true
-          else
-            order[c.name]=order[c.parent]+1
-            maxNumber=[maxNumber,order[c.name]].max
-          end
-        end
-      }
-    end while oneNotSet
-    #puts "MAX:",maxNumber
-    cs=[]
-    (0..maxNumber).each{|i|
-      order.each{|k,v|
-        if v==i
-          cs << map[k]
-        end
-      }
-    }
-    pp order
-    allFiles=allClasses.map{|c|c.header_file}.uniq
-    result=classes.sort{|a,b|order[a.name]<=>order[b.name]}.map{|c|c.header_file}.uniq
-    result=result+(allFiles-result)
-    pp result
-    result
-    #cs.map{|c|c.header_file}.uniq
-  end
-  
-  
-  class CppHierarchyParser
-    CppClass=Struct.new(:name,:parent,:header_file,:children)
-	  
-    
-    def initialize(files)
-      @cppClasses=[]
-      parseFiles(files)
-      processDerivations
-    end
-	
-	  def getAllClasses
-	    @cppClasses
-	  end
-    
-    def getAllRubyClasses
-      clist=["AGRubyObject"]
-      while true
-        oldLength=clist.length
-        @cppClasses.each{|c|
-          if clist.member?(c.parent)
-            clist=(clist+[c]).uniq
-          end
-        }
-        break unless oldLength!=clist.length
-      end
-      clist
-    end
-    
-    # returns array of (subclass,superclass)
-    def getAllDerivations
-      @cppClasses.select{|c|c.parent}.map{|c|[c.name,c.parent]}
-    end
-    
-	  
-  private
-    
-    
-    def processDerivations
-      m={}
-      @cppClasses.each{|c|m[c.name]=c}
-      @cppClasses.each{|c|
-        if c.parent
-          if m[c.parent].nil? 
-            puts "parent unknown #{c.parent}"
-          else 
-	          m[c.parent].children << c
-          end
-        end
-      }
-    end
-    
-	  def parseFiles(files)	    
-		  class2File={}
-		  deriveList={} # x=>y :x is child of y
-		  allClasses=[]
-		
-		  files.each{|fn|
-		    file=File.open(fn)
-		    cn=""
-		    content=file.read.gsub(/\/\*([^*]|\*[^\/])*\*\//,"") # /*...*/ delete comments - FIXME: // comments will be ignored!!!
-		
-		    content.split("\n").each{|a|
-		      abak=a
-		      a.gsub!("AGEXPORT","")
-		      a.gsub!("EXPORT","")
-		      
-		      if a =~ /^ *class.*/ then
-		        cn=a.gsub(/ *class /,"").gsub(/:.*/,"").gsub("\n","").gsub(" ","")
-		        allClasses << cn.gsub(";","")
-		        if cn=~/^[A-Z].*/
-		          if a=~ /.*public.*/ then
-		            pn=a.gsub(/.*public /,"").gsub("\n","")
-	              @cppClasses << CppClass.new(cn,pn,fn,[])
-		            allClasses << pn
-		            deriveList[cn]=pn
-		            class2File[cn]=fn
-		          elsif not a=~/;/ then
-		            @cppClasses << CppClass.new(cn,nil,fn,[])
-		            deriveList[cn]=nil
-		            class2File[cn]=fn
-		          end
-		        end
-		      end
-		    
-		    }
-		  }
-		  classList = class2File.keys
-		  allClasses = allClasses.sort.uniq
-		end  
-  end
-
-end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/compile.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/compile.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/compile.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,170 @@
+module Rookey
+  class Compiler
+    def initialize(config)
+      @config=config
+    end
+  
+	  def Compiler.getDeps(t)
+	    # FIXME
+	    
+	    parseDepsFiles
+      
+      return t unless @@deps
+      p=File.join(Compiler.getDepsDir,t)
+	    return @@deps[p] if @@deps[p]
+      t
+	  end
+  
+	  def compile(target,sources)
+	    source=makeSource(target)
+	    
+      
+	    program=getCompiler(:cpp)
+
+	    
+	    options=[]
+	
+      #pp @config
+      
+	    options << @config["CFLAGS"]
+	    
+	    includeDirs = @config["INCLUDEDIRS"].split(" ")
+	    includes=includeDirs.map{|d|"-I"+d}
+	    options+=includes
+	    
+      expanded_path=File.expand_path(source)
+      sourcepath=source
+      sourcepath=expanded_path if File.exists?(expanded_path) and not File.exists?(source)
+      sourcepath="/"+sourcepath if File.exists?("/"+sourcepath) and not File.exists?(sourcepath)
+
+	    options << "-c "+sourcepath
+	    options << "-o "+target
+      
+      
+      depfile=File.join(Compiler.getDepsDir,source)
+      depdir=File.split(depfile)[0]
+      Rookey.mkdir(depdir)
+      
+      outdir=File.split(target)[0]      
+      Rookey.mkdir(outdir)
+
+      options << "-Wp,-MD,#{depfile}"
+	            
+	    call=program+" "+options.join(" ")
+	    sh call
+      puts
+	  
+	  end
+    
+    def linkEXE(name,objects)
+      program=getCompiler(:cpp)
+      options=[]
+      options << "-o "+name
+      options += objects.uniq
+      options << @config["LDFLAGS"] 
+      call=program+" "+options.join(" ")
+      sh call
+      puts
+    end
+      
+	  
+	  def linkDLL(t)
+	    programcall=getCompiler(:cpp)+" " + at config["LDSHAREDFLAGS"]
+      
+      options=[]
+      
+      options << "-o "+t.name
+      options += t.prerequisites
+      options << @config["LDFLAGS"] 
+      options << @config["LIBS"]
+      options << @config["LIBRUBYARG"] 
+      call=programcall+" "+options.join(" ")
+      sh call
+      puts
+	  end
+	  def linkSO(t)
+	  end
+	  def linkA(t)
+	  end
+	  
+	  def dllName(base)
+	    base+"."+ at config["DLEXT"]
+	  end
+	  
+    def exeName(base)
+      if @config["host_os"]=~/win/ and not @config["host_os"]=~/darwin/
+        base+".exe"
+      else
+        base
+      end
+    end
+    
+    # FIXME: include build-dirs
+	  def makeObject(sourceName)
+	    file=File.join(getBuildDir,sourceName+".o")
+      dir=File.split(file)[0]
+      begin
+#        pp @config
+#        pp "DIR:",dir
+        #if dir
+        Rookey.mkdir(dir) if dir.length>0
+      rescue Object
+        pp $!
+      end
+      file
+	  end
+	  
+	  def makeSource(objectName)
+	    objectName.sub(/\.o$/,"").sub(/^#{getBuildDir}[\/\\]/,"")
+	  end
+	  
+    def getPlainBuildDir
+      ".build_"+ at config["host_os"]
+    end
+    
+	  def getBuildDir
+	    File.join(Dir.pwd,getPlainBuildDir)
+	  end
+    def Compiler.getDepsDir
+      File.join(Dir.pwd,".deps")
+    end
+        
+    private
+    def getCompiler(type)
+       #FiXME
+      compiler= case type
+        when :cpp
+          @config["CPP"]
+        when :c
+          @config["CC"]
+        else
+          raise "Unknown compiler type #{type}"
+      end
+      ccache=@config["CCACHE"]
+      compiler=ccache+" "+compiler if ccache
+      compiler
+    end
+    
+    def findProgram(pattern)
+      
+    end
+    
+    @@deps=nil
+    def Compiler.parseDepsFiles
+      return @@deps if @@deps
+            
+      files=Dir[File.join(getDepsDir,"**","*")]
+      @@deps={}
+      files.each{|file|
+        unless File.directory?(file)
+	        fd=File.open(file)
+	        
+	        @@deps[file]=fd.read.gsub("\\\n","").split(" ")[1..-1]
+	        fd.close
+        end
+      }
+    end
+  end
+  
+  
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/config_class.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/config_class.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/config_class.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,33 @@
+module Rookey
+  
+  # Rookeys Config-hash. 
+  class Config
+    def initialize(hash={})
+      @hash=hash
+    end
+    def [](name)
+      @hash[name]||""
+    end
+    def []=(name,value)
+      @hash[name]=value
+    end
+    def add(name,value)
+      @hash[name]||=""
+      @hash[name]+=" "+value
+    end
+  end
+  @@config=nil
+  
+  def Rookey.getConfig
+    if @@config.nil?
+      if File.exists?(Rookey::CONFIG_FILENAME)
+        load Rookey::CONFIG_FILENAME
+      else 
+        runConfigure
+        hibe(@@config,Rookey::CONFIG_FILENAME)
+      end
+      CLEAN << Rookey::CONFIG_FILENAME
+    end
+    @@config
+  end 
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/config_generator.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/config_generator.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/config_generator.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,163 @@
+
+require File.join(File.split(__FILE__)[0],'config_class.rb')
+
+class Class
+  def provides(s=nil)
+    @provides||=[]
+    @provides << s if s
+    @provides
+  end
+  def needs(s=nil)
+    @needs||=[]
+    @needs << s if s
+    @needs
+  end     
+end
+
+module Rookey
+  
+  
+  CONFIG_FILENAME="config_cache.rb"
+  @@configured=[]
+  
+  # stores a dumpable ruby-object *what* into a file named *filename*
+  def Rookey.hibe(what,filename)
+    content=Marshal.dump(what).gsub("\"","\\\"")
+    File.open(filename,"w") do |f|
+      f.puts <<EOT
+module Rookey
+  @@config=Marshal.load("#{content}")
+end
+EOT
+    end
+  end
+  
+  class Configurator
+    def initialize
+    end
+    def run(config)
+    end
+    
+    def installLibDir
+      File.join(File.split(__FILE__)[0],"externals","build","lib")
+    end
+    def installIncludeDir
+      File.join(File.split(__FILE__)[0],"externals","build","include")
+    end
+    
+    def searchProgram(program)
+      searchPrograms(program)[0]
+    end
+    
+    def searchPrograms(program)
+      programs=[program].flatten
+      result=programs.map{|program|
+	      getPath.map{|dir|
+	        
+	        p=File.join(dir,program)
+          list=Dir[p]
+	        p=nil unless File.exists?(p)
+          p||=list[0]
+          p
+	      }
+      }.flatten.uniq-[nil]
+      pp result
+      result
+    end
+    def checkProgram(program)      
+    end
+    def checkLibrary(config,lib,funcname,includes=[])
+      includes+=config["NEEDED_INCLUDES"].split(" ")
+      includes=includes.map{|i|"#include <#{i}>"}.join("\n")
+      source="#{includes}\nextern \"C\" void #{funcname}();int main(int argc,char*argv[]){return 0;}"
+      pp source
+      testSource="test.c"
+      fd=File.open(testSource,"w")
+      fd.puts source
+      fd.close
+      compiler=Compiler.new(config)
+      target=compiler.makeObject(testSource)
+      compiler.compile(target,testSource)
+      libadd="-l#{lib}"
+      exeName=compiler.exeName("test")
+      begin
+        compiler.linkEXE(exeName,[target,libadd])
+        `#{exeName}`
+        if $?
+          config.add("LDFLAGS",libadd)
+        end
+      rescue RuntimeError => e
+        return false
+      end
+      true
+    end
+    private
+    def getPath
+      # add paths in externals/build/*/bin
+      getEnvPath+Dir[File.expand_path(File.join(File.split(__FILE__)[0],"externals","built","*"))].map{|d|File.join(d,"bin")}
+    end
+    def getEnvPath
+      p=ENV["PATH"]
+      if File.join("a","b")=~/\\/
+        p.split(";")
+      else
+        p.split(":")
+      end
+    end
+    
+    def install(package)
+      #raise 1
+      ruby(File.join(File.split(__FILE__)[0],"externals","tools.rb"),package)
+    end    
+  end
+  
+  Dir[File.join(File.split(__FILE__)[0],"configs","*.rb")].each{|file|
+    require file
+  }
+  
+  def Rookey.log(*s)
+    @@logFile||=File.open("rookey.log","w")
+    @@logFile.puts(*s)
+  end
+  
+ 
+  def Rookey.getDescendantsOfClass(p)
+    c=[]
+    ObjectSpace.each_object(Class){|a|c.push(a) if a.ancestors.member?(p)}
+    return c
+  end
+  
+  
+  def self.checkConfig(pClass)
+    
+  end
+  
+  def Rookey.runConfigure
+    log caller
+    configurators=getDescendantsOfClass(Configurator)
+    ok=[]
+    run=[]
+    config=Config.new
+    while run.length<configurators.length
+	    configurators.each{|c|
+	      unless run.member?(c)
+		      if c.needs.select{|s|not ok.member?(s)}.length == 0
+		        log "Running configurator #{c}"
+            #pp config
+            begin
+		          c.new.run(config)
+		          log config.inspect
+              @@configured << c
+            rescue
+              log "Configuration of #{c} failed !"
+            end
+		        ok+=c.provides
+		        ok.uniq!
+		        run << c
+		      end
+	      end
+	    }
+    end
+    @@config=config
+  end
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/configs/ccache.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/configs/ccache.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/configs/ccache.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,13 @@
+module Rookey
+  class CcacheConfig<Configurator
+    provides :compilerAddon
+    needs :compiler
+    
+    def run(config)
+      ccache=searchProgram("ccache")
+      if ccache
+        config["CCACHE"]=ccache
+      end
+    end
+  end
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/configs/compiler.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/configs/compiler.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/configs/compiler.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,10 @@
+module Rookey
+  class CompilerConfig<Configurator
+    needs :compiler
+    
+    def run(config)
+      config.add("INCLUDEDIRS",File.join(File.split(File.split(__FILE__)[0])[0],"cpp"))
+      config.add("LDFLAGS","-lMallocDebug") if ROOKEY_CONFIG[:malloc_debug]
+    end
+  end
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/configs/debug.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/configs/debug.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/configs/debug.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,13 @@
+module Rookey
+  class DebugConfig<Configurator
+    needs :compiler
+    
+    def run(config)
+      pp ROOKEY_CONFIG
+      if ROOKEY_CONFIG[:debug]=="true"
+	      config.add("CFLAGS","-O0 -g")
+	      config.add("LDFLAGS","-g")
+      end
+    end
+  end
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/configs/gl.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/configs/gl.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/configs/gl.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,22 @@
+require 'mkmf'
+require File.join(File.split(__FILE__)[0],"ruby.rb")
+
+module Rookey
+  class GLConfig<Configurator
+    provides :opengl
+    needs :compiler
+    
+    def run(config)
+      case config["host_os"]
+        when /darwin/
+          config.add("INCLUDEDIRS","/usr/X11/include")        
+          config.add("LDFLAGS","-Wl,-framework,OpenGL")
+        when /win32/
+          #config.add("INCLUDEDIRS","/usr/X11/include")        
+          config.add("LDFLAGS","-lopengl32 -lglu32")
+        else
+          config.add("LDFLAGS","-lGL -lGLU")
+      end      
+    end   
+  end 
+end

Added: antargis/trunk/rookey/lib/rookey/configs/mingw.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/configs/mingw.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/configs/mingw.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,35 @@
+require 'mkmf'
+
+module Rookey
+  class MinGWConfig<Configurator
+    provides :compiler
+    
+    def run(config)
+      if ROOKEY_CONFIG[:extconfig]=='mingw32'
+	      #config.add("INCLUDEDIRS",get("archdir")+" "+get("includedir"))
+	      #config.add("CFLAGS",get("CFLAGS"))
+	      #config.add("LDFLAGS",get("LIBS"))
+	      #config.add("LDFLAGS",get("LIBRUBYARG"))
+	      #config.add("LDSHAREDFLAGS",get("LDSHARED").sub(/^[^ ]+ /,""))
+	      config["DLEXT"]="dll"
+	      config["host_os"]="win32"      
+	      config["GPP_BASE"]="i*mingw*g++"
+	      config["GCC_BASE"]="i*mingw*gcc"
+	
+	      {"CPP"=>"GPP_BASE","CC"=>"GCC_BASE"}.each{|name,base|      
+	        config[name]=searchProgram(config[base])
+	      }
+        base=config["CPP"].gsub(/bin\/[^\/]+/,"")
+        baseMingw=Dir[base+"i*mingw*"]
+        config.add("LDFLAGS","-L"+File.join(baseMingw,"lib"))
+        config.add("LDFLAGS","-L"+installLibDir)
+        config.add("INCLUDEDIRS",File.join(baseMingw,"include"))
+        config.add("INCLUDEDIRS",installIncludeDir)
+        config.add("CFLAGS","-mthreads")        
+        
+        #pp config
+        #exit
+      end
+    end
+  end    
+end

Added: antargis/trunk/rookey/lib/rookey/configs/png.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/configs/png.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/configs/png.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,17 @@
+require 'mkmf'
+require File.join(File.split(__FILE__)[0],"ruby.rb")
+
+module Rookey
+  class PNGConfig<Configurator
+    provides :png
+    needs :compiler
+    needs :z
+        
+    def run(config)
+      unless checkLibrary(config,"png","png_get_io_ptr")
+        install("png")
+        checkLibrary(config,"png","png_get_io_ptr")
+      end
+    end   
+  end 
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/configs/ruby.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/configs/ruby.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/configs/ruby.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,96 @@
+
+module Rookey
+	  class RubyConfig<Configurator
+      provides :ruby
+      if ROOKEY_CONFIG[:use_mkmf]==true or ROOKEY_CONFIG[:use_mkmf].nil? 
+        #require 'mkmf'
+        provides :compiler
+		    
+		    def run(config)
+		      
+		      
+		      require 'mkmf'
+          
+          @config=CONFIG
+		      
+			      config.add("INCLUDEDIRS",get("archdir")+" "+get("includedir"))
+			      config.add("CFLAGS",get("CFLAGS"))
+			      config.add("LDFLAGS",get("LIBS"))
+			      config.add("LDFLAGS",get("LIBRUBYARG"))
+			      config.add("LDSHAREDFLAGS",get("LDSHARED").sub(/^[^ ]+ /,""))
+			      config["DLEXT"]=get("DLEXT")
+			      config["host_os"]=get("host_os")      
+			      config["GPP_BASE"]="g++"
+			      config["GCC_BASE"]="gcc"
+			
+			      {"CPP"=>"GPP_BASE","CC"=>"GCC_BASE"}.each{|name,base|      
+			        config[name]=searchProgram(config[base])
+			      }
+	          
+	          if config["host_os"]=~/darwin.*/ and false
+	            pgc="-finstrument-functions"
+	            pgl="-finstrument-functions -lSaturn"
+	          else
+	            pgc="-pg"
+	            pgl="-pg"
+	          end 
+	          config.add("CFLAGS",pgc) if ROOKEY_CONFIG[:profile]
+	          config.add("LDFLAGS",pgl) if ROOKEY_CONFIG[:profile]
+	          
+	          ["CFLAGS","CPPFLAGS","LDFLAGS"].each{|name|
+	            config.add(name,ENV[name]) if ENV[name]
+	          }
+	          
+		    end
+		    
+		    
+      elsif ROOKEY_CONFIG[:extconfig]=='mingw32'
+        def run(config)
+          puts "OK"
+          #install("ruby")
+          #exit
+          prefix=File.join(File.split(File.split(__FILE__)[0])[0],"externals","build")
+          @config=readConfig(File.join(prefix,"lib","ruby","1.8","i386-mingw32","rbconfig.rb"))
+          @config["prefix"]=prefix
+          puts "OK"
+          pp @config
+          
+          config.add("INCLUDEDIRS",get("archdir")+" "+get("includedir"))
+          puts "OK"
+          pp config
+          config.add("CFLAGS",get("CFLAGS").gsub("-g",""))
+          config.add("LDFLAGS",get("LIBS"))
+          config.add("LDFLAGS",get("LIBRUBYARG"))
+          config.add("LDSHAREDFLAGS",get("LDSHARED").sub(/^[^ ]+ /,""))
+          
+          pp config
+          puts "OK"
+          config
+          #exit
+        end
+        
+        def readConfig(filename)
+          config={}
+          File.open(filename).read.split("\n").each{|line|
+            if line=~/.*CONFIG\[.*\].*/
+              k,v=line.scan(/.*CONFIG\["(.*)"\] = "(.*)".*/)[0]
+              config[k]=v if v and k
+            end
+          }
+          config
+        end
+	  end
+    private
+      # recurse through ruby's CONFIG structure 
+      def get(n)
+        return "" if n.nil?
+        v=@config[n]
+        return "" if v.nil?
+        v.gsub(/\$\(([^)]*\))/) {|a|
+          f=a[2..-2]
+          get(f)
+        }      
+      end
+    
+	end
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/configs/sdl.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/configs/sdl.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/configs/sdl.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,33 @@
+module Rookey
+  class SDLConfig<Configurator
+    provides :sdl
+    needs :compiler
+    
+    def run(config)
+      # FIXME
+      sdlconfig="sdl-config"
+      
+      pp config
+      if config["host_os"]!="win32"
+	      cflags=`#{sdlconfig} --cflags`.chomp
+	      config.add("CFLAGS",cflags.split(" ").select{|f|not f=~/^-I/}.join(" "))
+	      config.add("INCLUDEDIRS",cflags.split(" ").select{|f|f=~/^-I/}.map{|f|f[2..-1]}.join(" "))
+	      config.add("LDFLAGS",`sdl-config --libs`.chomp)
+      else
+        ["sdl","sdl_image","sdl_ttf","sdl_mixer"].each{|lib|install(lib)}
+        config.add("INCLUDEDIRS",File.join(installIncludeDir,"SDL"))
+        sdlconfig=File.join(File.split(__FILE__)[0],"..","externals","build","bin","sdl-config")
+        config.add("LDFLAGS",`#{sdlconfig} --libs`.chomp)
+        config.add("CFLAGS",`#{sdlconfig} --cflags`.chomp)
+         
+        config.add("NEEDED_INCLUDES","SDL.h")
+      end      
+      pp config
+      
+      checkLibrary(config,"SDL_image","IMG_Load")
+      checkLibrary(config,"SDL_ttf","TTF_Quit")
+      checkLibrary(config,"SDL_mixer","Mix_LoadMus")
+      pp config
+    end
+  end
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/configs/swig.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/configs/swig.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/configs/swig.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,29 @@
+module Rookey
+  class SwigConfig<Configurator
+    provides :swig
+    VERSIONS=["1.3.33","1.3.34","1.3.35"]
+    
+    def run(config,firstrun=true)
+      swigs=searchPrograms("swig").select{|swig|checkVersion(swig)}
+      if swigs.length==0
+        puts "ERROR: no SWIG with version in #{VERSIONS.join(", ")} not found!"
+        if firstrun
+          install("swig")
+	        run(config,false)
+        end
+      else
+	      swig=swigs[0]
+	      # FIXME: search program
+	      config.add("SWIG_OPTIONS","-Wall -DAGEXPORT")
+	      config.add("SWIG",swig)
+      end
+    end
+    
+    private
+    def checkVersion(swig)
+      run="#{swig} -version"
+      output=`#{run}`
+      VERSIONS.select{|v|output=~/#{v}/}.length>0
+    end
+  end
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/configs/z.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/configs/z.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/configs/z.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,18 @@
+require 'mkmf'
+require File.join(File.split(__FILE__)[0],"ruby.rb")
+
+module Rookey
+  class ZConfig<Configurator
+    provides :z
+    needs :compiler
+    
+    def run(config)
+      unless checkLibrary(config,"z","compress")
+        install("zlib")
+        puts "ARG"
+        config.add("LDFLAGS","-L"+installLibDir)
+        checkLibrary(config,"z","compress")
+      end
+    end   
+  end 
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_base.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_base.h	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_base.h	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,39 @@
+/**
+ * This file provides a define "AGEXPORT" to be used for exporting functions and classes
+ * out of DLLs on Windows.
+ * For this to function you'll just insert it:
+ * 1) before a function declaration:
+ *    AGEXPORT void myFunction();
+ * 2) or inbetween a class-definition:
+ *    class AGEXPORT MyClass {
+ *    .....
+ *    };
+ * No additional configuration should be needed.
+ * including within swig is taken care of. 
+ *  
+ * */
+
+#ifndef AG_BASE_H
+#define AG_BASE_H
+
+#ifdef WIN32
+#ifdef AGIMPORT
+#define AGEXPORT __declspec(dllimport)
+#else
+#undef AGEXPORT
+#define AGEXPORT __declspec(dllexport)
+#endif // AGIMPORT
+#else
+
+#undef AGEXPORT
+#define AGEXPORT
+
+#endif // WIN32
+
+#ifdef SWIG
+#undef AGEXPORT
+#define AGEXPORT
+#endif
+
+
+#endif

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_debug.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_debug.cc	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_debug.cc	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,141 @@
+/*
+ * Copyright (c) 2005 by David Kamphausen. All rights reserved.
+ *
+ * ag_debug.cc
+ * by David Kamphausen (david.kamphausen at web.de)
+ *
+ * The "Antargis" project, including all files needed to compile it,
+ * is free software; you can redistribute it and/or use it and/or modify it
+ * under the terms of the GNU General Public License as published
+ * by the Free Software Foundation; either version 2 of the License,
+ * or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ *
+ * You should have received a copy of the GNU General Public
+ * License along with this program.
+ */
+
+#include "rk_debug.h"
+#include "ag_main.h"
+
+#include <fstream>
+#include <iostream>
+
+#ifdef __WIN32__
+#include <winsock2.h>
+#endif
+#include <ruby.h>
+#include <SDL.h>
+
+bool quietLog=false;
+void setQuiet()
+  {
+    quietLog=true;
+  }
+
+static bool gRubyRaising=false;
+void agRaise(const std::string &s)
+  {
+    cdebug("assertion failed:"<<s);
+    if(gRubyRaising)
+      rb_raise(rb_eRuntimeError,s.c_str(),"");
+    else
+      throw std::runtime_error(s);
+  }
+
+void setRubyRaising(bool flag)
+  {
+    gRubyRaising=flag;
+  }
+
+size_t gDebugLevel=0;
+
+size_t getDebugLevel()
+  {
+    return gDebugLevel;
+  }
+void setDebugLevel(size_t t)
+  {
+    gDebugLevel=t;
+  }
+
+
+#ifndef MNDEBUG
+int D::d=0;
+
+std::ofstream debugOFS("debug.txt");
+
+std::ostream &getDebug()
+  {
+    if(quietLog)
+      return debugOFS;
+    else
+      return std::cout;
+  }
+
+size_t gDebugIndex=0;
+
+size_t getDebugIndex()
+  {
+    return gDebugIndex;
+  }
+
+
+
+D::D(std::string c):
+  m(c)
+  {
+    indent();
+    gDebugIndex++;
+
+    debugout_checked(2,"start of:"<<c<<"("<<gDebugIndex<<")"<<std::endl);
+    d++;
+  }
+AGEXPORT D::~D()
+  {
+    d--;
+    indent();
+    debugout_checked(2,"end   of:"<<m<<std::endl);
+  }
+void D::indent()
+  {
+    for(int i=0;i<d;i++)
+      debugout_checked(2,"  ");
+  }
+
+
+#endif
+
+#ifdef __APPLE__
+
+//#include <mach-o/nlist.h>
+
+#include "execinfo.h"
+void printStacktrace()
+  {
+    void* callstack[128];
+    int i, frames = backtrace(callstack, 128);
+    char** strs = backtrace_symbols(callstack, frames);
+    printf("FRAMES:%d\n",frames);
+    for (i = 0; i < frames; ++i) {
+      printf("%s\n", strs[i]);
+    }
+    free(strs);
+    /*
+    struct nlist *nl;
+    int result=nlist("antargis.bundle",nl);
+    std::cout<<"RESULT:"<<result<<std::endl;
+*/
+  }
+
+#else
+
+void printStacktrace()
+  {
+  }
+
+#endif
+

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_debug.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_debug.h	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_debug.h	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,110 @@
+/*
+ * Copyright (c) 2005 by David Kamphausen. All rights reserved.
+ *
+ * ag_debug.h
+ * by David Kamphausen (david.kamphausen at web.de)
+ *
+ * The "Antargis" project, including all files needed to compile it,
+ * is free software; you can redistribute it and/or use it and/or modify it
+ * under the terms of the GNU General Public License as published
+ * by the Free Software Foundation; either version 2 of the License,
+ * or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ *
+ * You should have received a copy of the GNU General Public
+ * License along with this program.
+ */
+
+#ifndef AG_DEBUG_h
+#define AG_DEBUG_h
+#include <stdexcept>
+#include <iostream>
+#include <fstream>
+#include <assert.h>
+#include <sstream>
+#include <string>
+#include <vector>
+
+#include "rk_exception.h"
+#include "rk_tools.h"
+#include "rk_base.h"
+
+
+AGEXPORT void setQuiet();
+
+#ifdef MNDEBUG
+#define dbout(x,l)
+#define cdebug(x)
+#define ccdebug(x)
+#define debug(x)
+#define TRACE
+#define CTRACE
+#define CHECK_ZERO(x)
+#define STUB
+
+#else
+
+std::ostream & AGEXPORT getDebug();
+
+#define debug(c) mydebug(::toString(__FILE__),::toString(__LINE__),c)
+
+template<class T>
+inline void mydebug(std::string f,std::string l,const T&t)
+{
+  getDebug()<<"File "<<f<<" Line "<<l<<" : "<<t<<std::endl;
+}
+
+using std::endl;
+
+#define debugout(x) getDebug()<<x
+
+#define cdebug(x) debugout("("<<__FILE__<<":"<<__LINE__<<":"<<__PRETTY_FUNCTION__<<"):"<<x<<endl)
+#define ccdebug(x) debugout("("<<__FILE__<<":"<<__LINE__<<":"<<__PRETTY_FUNCTION__<<":"<<((void*)this)<<"):"<<x<<endl)
+
+AGEXPORT size_t getDebugIndex();
+AGEXPORT size_t getDebugLevel();
+AGEXPORT void setDebugLevel(size_t t);
+
+#define debugout_checked(level,x) { if(level>getDebugLevel()) { getDebug()<<x; }}
+#define dbout(level,x) {if(level>getDebugLevel()) { cdebug(x); }}
+
+/** A helper class for tracing the program's flow
+    Use it by instantiating it with a proper name, or simply use TRACE; (or CTRACE for classes) in your functions */
+class AGEXPORT D
+{
+  std::string m;
+  static int d;
+
+ public:
+  /// the given text will be output on creation and deletion of this object
+  D(std::string text);
+  ~D();
+private:
+  void indent();
+};
+
+#define LINEINFO(x) (::toString(__FILE__)+::toString(" ")+::toString(__LINE__)+::toString(" ")+::toString( __PRETTY_FUNCTION__)+::toString(" ")+::toString(x)).c_str()
+
+#define TRACE D test__LINE__(::toString(__FILE__)+::toString(" ")+::toString(__LINE__)+::toString(" ")+::toString( __PRETTY_FUNCTION__))
+#define CTRACE D test__LINE__(::toString(__FILE__)+::toString(" ")+::toString(__LINE__)+::toString(" ")+::toString( __PRETTY_FUNCTION__)+::toString(" ")+::toString(((void*)this))+::toString(" ")+typeid(*this).name())
+
+AGEXPORT void agRaise(const std::string &s);
+
+#ifndef __WIN32__
+#undef assert
+#define assert(x) {if(!(x)) agRaise((::toString("assert failed ")+LINEINFO(__STRING(x))).c_str()); }
+#endif
+
+#define STUB cdebug("STUB in File "<<__FILE__<<" line:"<<__LINE__<<" function:"<<__PRETTY_FUNCTION__)
+
+
+#endif
+
+void setRubyRaising(bool flag);
+void printStacktrace();
+
+
+#endif

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_exception.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_exception.h	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_exception.h	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,47 @@
+/*
+ * Copyright (c) 2005 by David Kamphausen. All rights reserved.
+ *
+ * ag_exception.h
+ * by David Kamphausen (david.kamphausen at web.de)
+ *
+ * The "Antargis" project, including all files needed to compile it,
+ * is free software; you can redistribute it and/or use it and/or modify it
+ * under the terms of the GNU General Public License as published
+ * by the Free Software Foundation; either version 2 of the License,
+ * or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ *
+ * You should have received a copy of the GNU General Public
+ * License along with this program.
+ */
+
+#ifndef __ANTARGISGUI_EXCEPTION_H__
+#define __ANTARGISGUI_EXCEPTION_H__
+
+#include <rk_base.h>
+#include <stdexcept>
+
+class AGEXPORT AGException:public std::exception
+{
+public:
+  AGException(const std::string &e):s(e)
+  {
+  }
+
+  virtual ~AGException() throw ()
+  {
+  }
+
+  const char*what() const throw()
+  {
+    return s.c_str();
+  }
+
+private:
+  std::string s;
+};
+
+#endif

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_rtools.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_rtools.cc	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_rtools.cc	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,145 @@
+#include <rk_rtools.h>
+
+#include <ruby.h>
+
+#include <iostream>
+#include <sstream>
+#include <stdexcept>
+
+std::string rubyHash(const std::string &p)
+{
+  rb_eval_string("require 'digest/md5'");
+  VALUE l=rb_eval_string("Digest::MD5");
+  VALUE r=rb_funcall(l,rb_intern("digest"),1,rb_str_new(p.c_str(),p.length()));
+
+  std::string s(RSTRING_PTR(r), RSTRING_LEN(r));
+
+  return binaryToHex(s,false);
+  
+}
+
+std::string rubyHashOld(const std::string &p)
+{
+  // FIXME: TRY USING ruby's Digest::MD5::digest("xy")
+  rb_eval_string("require 'digest/md5'");
+
+  //  VALUE l=rb_gv_get("Digest::MD5");
+  //  VALUE r=rb_funcall(l,rb_intern("digest"),1,rb_str_new2(p.c_str()));
+
+  std::ostringstream os;
+  os<<"s=''; Digest::MD5::digest('"<<p<<"').each_byte{|b|s+=sprintf('%X',b)};s";
+
+  VALUE r=rb_eval_string(os.str().c_str());
+
+  std::string s;
+
+  s=STR2CSTR(r);
+
+  return s;
+}
+
+
+
+
+
+bool rubyMatchRegex(const std::string &p,const std::string &pregex)
+  {
+    VALUE rp=rb_str_new(p.c_str(),p.length());
+    VALUE rregex=rb_str_new(pregex.c_str(),pregex.length());
+    
+    VALUE ret=rb_reg_match(rp,rregex);
+    return ret==Qtrue;
+  }
+
+
+
+
+unsigned char fromHexBS(unsigned char c) //throws(std::runtime_error)
+  {
+    if(c>='a' && c<='f')
+      return c-'a'+0xA;
+    if(c>='A' && c<='F')
+      return c-'A'+0xA;
+
+    if(c>='0' && c<='9')
+      return c-'0';
+    throw std::runtime_error("wrong input in fromHex()");
+  }
+
+void toHexBS(char c,std::ostream &os)
+  {
+    unsigned char c0=(c&0xF);
+    unsigned char c1=((c>>4)&0xF);
+
+    char a,b;
+    //  std::ostringstream os;
+    if(c0<10)
+      a=(c0+'0');
+    else
+      a=((c0-10)+'A');
+
+    if(c1<10)
+      b=(c1+'0');
+    else
+      b=((c1-10)+'A');
+
+    //  cdebug("a:"<<(int)a);
+    //  cdebug("b:"<<(int)b);
+    os<<b<<a;
+
+    //  return os.str();
+  }
+
+
+std::string binaryToHex(const std::string &s,bool separators)
+  {
+    std::ostringstream os;
+
+    for(size_t i=0;i<s.length();i++)
+      {
+        //      cdebug(i<<":"<<(int)s[i]);
+        toHexBS(s[i],os);
+        if(i>0 && separators)
+          {
+            if((i%32)==0)
+              os<<std::endl;
+            else if((i%4)==0)
+              os<<" ";
+          }
+      }
+    //  cdebug(os.getString());
+
+    return os.str();//getString();
+  }
+
+
+std::string hexToBinary(const std::string &s)
+  {
+    std::ostringstream os;
+    bool complete=false;
+    char current=0;
+
+    for(size_t i=0;i<s.length();i++)
+      {
+        char c=s[i];
+        if((c>='a' && c<='f') || (c>='A' && c<='F') || (c>='0' && c<='9'))
+          {
+            if(complete)
+              {
+                current<<=4;
+                current|=fromHexBS(c);
+                os<<current;
+                complete=false;
+              }
+            else
+              {
+                current=fromHexBS(c);
+                complete=true;
+              }
+          }
+
+      }
+
+
+    return os.str();
+  }

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_rtools.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_rtools.h	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_rtools.h	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,14 @@
+#ifndef AG_RTOOLS_H
+#define AG_RTOOLS_H
+
+#include <rk_base.h>
+#include <string>
+
+AGEXPORT std::string rubyHash(const std::string &p);
+AGEXPORT bool rubyMatchRegex(const std::string &p,const std::string &pregex);
+std::string rubySub(const std::string &p,const std::string &search,const std::string &repl);
+
+AGEXPORT std::string binaryToHex(const std::string &s,bool separators=true);
+AGEXPORT std::string hexToBinary(const std::string &s);
+
+#endif

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,188 @@
+#include "rk_base.h"
+#include "rk_rubyobj.h"
+#include <assert.h>
+#include <typeinfo>
+#include <set>
+#include <map>
+#include <iostream>
+
+
+#ifdef __WIN32__
+#include <winsock2.h> // fix problem with fd_set
+#endif
+#include <ruby.h>
+
+bool mRubyQuitting=false;
+
+// this set keeps track of all valid instances of AGRubyObject
+std::set<AGRubyObject*> mRubyObjects;
+std::set<AGRubyObject*> mRemovedRubyObjects;
+
+void setQuitting()
+  {
+    mRubyQuitting=true;
+  }
+
+// swig-function for handling "tracked" objects
+// BEWARE: this does not support multiple libraries yet (FIXME)
+VALUE convertCpp2Ruby(AGRubyObject *cObject);
+
+AGEXPORT void *getAddressOfRubyObject(AGRubyObject *o)
+  {
+    return o;
+  }
+
+AGEXPORT bool rubyObjectExists(void *po)
+  {
+    VALUE v=convertCpp2Ruby((AGRubyObject*)po);
+    return(v!=Qnil);
+  }
+
+AGRubyObject::AGRubyObject() throw()
+  {
+    //std::cerr<<"AGRubyObject::new:"<<this<<std::endl;
+    assert(mRubyObjects.find(this)==mRubyObjects.end());
+    mRubyObjects.insert(this);
+    size_t oSize=mRemovedRubyObjects.size();
+
+    mRemovedRubyObjects.erase(this);
+    if(oSize!=mRemovedRubyObjects.size())
+      std::cerr<<"Collision - removed rubyobject's address is overwritten!"<<std::endl;
+
+    std::cerr<<"current ruby#:"<<mRubyObjects.size()<<" removed:"<<mRemovedRubyObjects.size()<<std::endl;
+  }
+AGRubyObject::~AGRubyObject() throw()
+  {
+    assert(mRubyObjects.find(this)!=mRubyObjects.end());
+    assert(mRemovedRubyObjects.find(this)==mRemovedRubyObjects.end());
+    //std::cerr<<"AGRubyObject::Removed:"<<this<<std::endl;
+    for(std::set<AGBaseObject*>::iterator i=mReferences.begin();i!=mReferences.end();i++)
+      (*i)->baseClear();
+    mRubyObjects.erase(this);
+    mRemovedRubyObjects.insert(this);
+  }
+
+
+/// override this function to mark your children
+void AGRubyObject::mark() throw()
+  {
+  }
+
+
+// call this function with any object you want to mark.
+// recursive should be set true only in one direction, otherwise you'll generate endless-loops (!!)
+void AGRubyObject::markObject(AGRubyObject *o, bool recursive) throw()
+  {
+    //std::cerr<<"markObject:"<<o<<std::endl;
+    // o must be a valid ruby-object
+    assert(mRubyObjects.find(o)!=mRubyObjects.end());
+
+    // look up, if it's registered within ruby
+    VALUE v=convertCpp2Ruby(o);
+    if(v!=Qnil)
+      {
+        assert(DATA_PTR(v)==o);
+        //std::cout<<"V:"<<v<<std::endl;
+        // then mark it
+        rb_gc_mark(v);
+
+      }
+
+    assert(o);
+    // recurse through hierarchy
+    if(recursive)
+      o->mark(); // call this directly
+  }
+
+void AGRubyObject::clear() throw()
+  {
+  }
+
+void AGRubyObject::addRef(AGBaseObject *o)
+  {
+    mReferences.insert(o);
+  }
+
+void AGRubyObject::deleteRef(AGBaseObject *o)
+  {
+    mReferences.erase(o);
+  }
+
+
+
+/// this is the marking function, that gets called by ruby
+/// it handles all the AGRubyObjects
+void general_markfunc(void *ptr)
+  {
+    if(!ptr)
+      {
+        std::cerr<<("WARNING: a ptr==0 was given in general_markfunc!")<<std::endl;
+        return; // ignore this !
+      }
+    assert(ptr);
+    // the given object must be a AGRubyObject and it must be valid (it's in mRubyObjects)
+    AGRubyObject *o=static_cast<AGRubyObject*>(ptr);
+    if(mRubyObjects.find(o)==mRubyObjects.end())
+      std::cerr<<"OLD RUBYOBJ:"<<(mRemovedRubyObjects.find(o)!=mRemovedRubyObjects.end())<<":"<<o<<std::endl;
+    assert(mRubyObjects.find(o)!=mRubyObjects.end());
+
+#ifdef GCDEBUG
+    printf("mark: 0x%lx\n",o->mRUBY);
+#endif
+
+    assert(o);
+    o->mark();
+  }
+
+
+/**
+   saveDelete is used to delete AGRubyObjects savely.
+ */
+bool saveDelete(AGRubyObject *o)
+  {
+    if(mRubyQuitting)
+      return false; // we are quitting - so memory is discarded anyway - hopefully ;-)
+
+    // check, if this object is existant any longer
+    // in case we're quitting this the deletion order is not defined for ruby-objects !!
+    if(mRubyObjects.find(o)==mRubyObjects.end())
+      {
+#ifdef GC_DEBUG
+        std::cerr<<"RubyObject "<<o<<" no longer existant - maybe we're quitting ?!"<<std::endl;
+#endif
+        return false;
+      }
+
+    assert(o);
+    // send object a message, that it will be deleted. This can help with detachin connections
+    // between objects.
+    o->clear();
+
+    VALUE v=convertCpp2Ruby(o);
+    if(v!=Qnil)
+      return false; // do not delete - it's under ruby's control!
+
+
+    delete o;
+    return true;
+  }
+
+
+
+AGBaseObject::AGBaseObject(AGRubyObject *p) throw()
+:mp(p)
+    {
+      if(p)
+        p->addRef(this);
+    }
+
+AGBaseObject::~AGBaseObject() throw()
+  {
+    if(mp)
+      mp->deleteRef(this);
+  }
+
+void AGBaseObject::baseClear() throw()
+  {
+    mp=0;
+  }

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,134 @@
+#ifndef RUBY_OBJ_H
+#define RUBY_OBJ_H
+
+// INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
+
+#ifdef WIN32
+#undef connect
+#undef close
+#endif
+
+/**
+   AGRubyObject does handling between ruby and c++ memory management.
+   Ruby has a garbage collector (GC) which is not really to be influenced.
+   Every object that is created in ruby is handled by the GC.
+   So we have to take care of that.
+
+   Ruby's GC has no reference counting whatsoever but it uses a mark-and-sweep
+   algorithm. When the GC is run the algorithm marks any known object and then calls
+   all the objects' mark-functions which therefore call mark-functions all the objects it
+   knowns. When anything known is marked, the algorithm kills any object that isn't marked.
+
+   So all we have to do is to mark any object that is connected to the current object in any way.
+   Normally you would mark any object that is a children of the current one.
+
+   To make things easier AGRubyObject takes care of objects which are not handled by ruby. They get called
+   recursively anyways. So all you have to do is overriding the mark() function and then calling
+   markObject(AGRubyObject *o) for any object you want to mark.
+
+   If you need an explicit destructor-call at a specified time you must be content with a call to clear(), which
+   you can override. For deletion of any AGRubyObject you should use saveDelete. This calls clear() and deletes the
+   object, if it's not a ruby-managed one.
+
+   @see saveDelete(AGRubyObject *o)
+ */
+
+// INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
+
+#include <string>
+#include <set>
+#include <rk_base.h>
+#include <stdexcept>
+
+class AGRubyObject;
+
+class AGEXPORT AGBaseObject
+{
+protected:
+  AGRubyObject *mp;
+public:
+  // AGBaseObject(.) should never throw an exception, because it may be called from ruby-functions not expection it to do so
+  AGBaseObject(AGRubyObject *p) throw ();
+
+  // ~AGBaseObject should never throw an exception, because it may be called by ruby's garbage collector
+  ~AGBaseObject() throw ();
+  void baseClear() throw ();
+
+  bool valid() throw ()
+    {
+      return mp;
+    }
+};
+
+
+/**
+ * gc_ptr<T> is a managed ptr to a (possibly) garbage-collected object
+ * it will be redirected to 0, if the targeted object is destroyed. So
+ * you'll get a null-pointer exception when the object is not longer
+ * present. This prevents you from accessing random memory.
+ */
+template<class T>
+class AGEXPORT gc_ptr:public AGBaseObject
+{
+public:
+  gc_ptr(T*t):AGBaseObject(t)
+  {
+  }
+
+  T*operator->()
+    {
+      return (T*)mp;
+    }
+  T* getPtr()
+  {
+    if(!mp)
+      throw std::runtime_error("mp not defined!");
+    return (T*)mp;
+  }
+};
+
+/**
+ *
+ * */
+class AGEXPORT AGRubyObject
+{
+public:
+  /**
+     This is copied from ruby.h, so that this header-file is not included all over the place.
+     FIXME: this must eventually be changed - when the ruby implementation changes
+   */
+  typedef unsigned long VALUE;
+
+  AGRubyObject() throw();
+  virtual ~AGRubyObject() throw();
+
+protected:
+#ifndef SWIG
+  // functions shouldn't be exported and NEVER be used in ruby!
+  virtual void clear() throw();
+  virtual void mark() throw();
+  void markObject(AGRubyObject *o,bool recursive=true) throw();
+
+#endif
+public:
+#ifndef SWIG
+
+#endif
+  friend void general_markfunc(void *ptr);
+  friend bool saveDelete(AGRubyObject *o);
+
+  void addRef(AGBaseObject *o);
+  void deleteRef(AGBaseObject *o);
+private:
+  std::set<AGBaseObject*> mReferences;
+};
+
+AGEXPORT void general_markfunc(void *ptr);
+AGEXPORT bool saveDelete(AGRubyObject *o);
+
+AGEXPORT void *getAddressOfRubyObject(AGRubyObject *object);
+AGEXPORT bool rubyObjectExists(void *o);
+
+AGEXPORT void setQuitting();
+
+#endif

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_string.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_string.cc	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_string.cc	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,230 @@
+#include <rk_string.h>
+#include <rk_debug.h>
+#include <rk_utf8.h>
+#include <rk_rtools.h>
+
+///////////
+// AGString
+///////////
+
+AGString::AGString(int i)
+  {
+    std::ostringstream os;
+    os<<i;
+    *this=os.str();
+  }
+AGString::AGString(long i)
+  {
+    std::ostringstream os;
+    os<<i;
+    *this=os.str();
+  }
+AGString::AGString(size_t i)
+  {
+    std::ostringstream os;
+    os<<i;
+    *this=os.str();
+  }
+AGString::AGString(float f)
+  {
+    std::ostringstream os;
+    os<<f;
+    *this=os.str();
+  }
+
+
+AGString::AGString()
+  {
+  }
+
+AGString::AGString(const char*c):
+  std::string(c)
+  {
+  }
+
+AGString::AGString(const char*c,size_t size):
+  std::string(c,size)
+  {
+  }
+
+AGString::AGString(const std::string &p):
+  std::string(p)
+  {
+  }
+AGString::AGString(const std::string &p,size_t many):
+  std::string(p,many)
+  {
+  }
+AGString::AGString(const AGString &p):
+  std::string(p)
+  {
+  }
+
+AGString::AGString(const char c,size_t many):
+  std::string(c,many)
+  {
+  }
+
+AGString &AGString::operator=(const AGString &p)
+  {
+    std::string::operator=(p);
+    return *this;
+  }
+
+AGString &AGString::operator+=(const AGString &p)
+{
+  std::string::operator+=(p);
+  return *this;
+}
+
+size_t AGString::memory() const
+{
+  return length();
+}
+
+AGString AGString::substr(size_t from,size_t len) const
+{
+  return AGString(std::string::substr(from,len));
+}
+
+
+std::vector<AGString> AGString::split(const AGString &p) const
+{
+  std::vector<AGString> a;
+  size_t oi=0;
+  size_t i=find(p);
+  for(;;)
+    {
+      i=find(p,oi);
+      a.push_back(substr(oi,i-oi));
+      if(i==std::string::npos)
+        break;
+      oi=i+1;
+    }
+  return a;
+}
+
+AGString AGString::operator+(const AGString &p) const
+{
+  AGString n(*this);
+  n+=p;
+  return n;
+}
+AGString AGString::operator+(const char* p) const
+{
+  AGString n(*this);
+  n+=p;
+  return n;
+}
+AGString AGString::operator+(const std::string &p) const
+{
+  AGString n(*this);
+  n+=p;
+  return n;
+}
+
+
+AGString AGString::replace(const AGString &what, const AGString &by) const
+{
+  size_t i=0;
+  size_t oi=0;
+  AGString n;
+
+  while(i!=npos)
+    {
+      i=find(what,oi);
+      n+=substr(oi,i-oi);
+      if(i==npos)
+        break;
+      n+=by;
+      oi=i+1;
+    }
+  return n;
+}
+
+
+int AGString::toInt() const
+{
+  return atoi(c_str());
+}
+long AGString::toLong() const
+{
+  return atol(c_str());
+}
+float AGString::toFloat() const
+{
+  return atof(c_str());
+}
+
+Uint8 AGString::toUint8() const
+{
+  return toInt();
+}
+Sint16 AGString::toSint16() const
+{
+  return toInt();
+}
+
+
+int AGString::parseHex() const
+{
+  int i=0;
+  for(size_t j=0;j<length();j++)
+    {
+      int k=0;
+      i<<=4;
+      char c=operator[](j);
+      if(c>='A'&&c<='F')
+        k=c-'A'+10;
+      else if(c>='a' && c<='f')
+        k=c-'a'+10;
+      else if(c>='0' && c<='9')
+        k=c-'0';
+      i+=k;
+    }
+  return i;
+}
+
+AGString AGString::toHex(int i)
+  {
+    std::string s;
+    std::string c="0";
+    while(i!=0)
+      {
+        int k=i&0xF;
+
+        if(k>9)
+          c[0]='A'+k-10;
+        else
+          c[0]='0'+k;
+
+        s=c+s;
+        i>>=4;
+      }
+
+    while(s.length()<2)
+      s=std::string("0")+s;
+    return AGString(s);
+  }
+
+bool AGString::toBool() const
+{
+  if(length()==0)
+    return false;
+  if(operator[](0)=='1')
+    return true;
+  if(substr(0,4)=="true")
+    return true;
+  return false;
+}
+
+
+bool AGString::matches(const std::string &regex) const
+{
+  return rubyMatchRegex(*this,regex);
+}
+
+AGString AGString::last(size_t n) const
+{
+
+}

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_string.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_string.h	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_string.h	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,64 @@
+#ifndef AG_STRING
+#define AG_STRING
+
+#include <rk_base.h>
+#include <string>
+#include <vector>
+#include <SDL.h>
+
+
+/** A string class that natively supports UTF-8 */
+class AGEXPORT AGString:public std::string
+{
+public:
+  static const size_t npos = static_cast<size_t>(-1);
+
+  AGString();
+  AGString(const std::string &p);
+  AGString(const std::string &p,size_t many);
+  AGString(const AGString &p);
+  explicit AGString(int i);
+  explicit AGString(size_t i);
+  explicit AGString(long i);
+  explicit AGString(float f);
+  AGString(const char c,size_t many=1);
+  AGString(const char*c);
+  AGString(const char*c,size_t size);
+
+#ifndef SWIiG
+  AGString &operator=(const AGString &s);
+
+  AGString &operator+=(const AGString &p);
+#endif
+
+  // size in bytes
+  size_t memory() const;
+
+  AGString substr(size_t from,size_t len) const;
+
+  std::vector<AGString> split(const AGString &p) const;
+
+  AGString replace(const AGString &what, const AGString &by) const;
+
+  AGString last(size_t n) const;
+
+  AGString operator+(const AGString &s) const;
+  AGString operator+(const char *s) const;
+  AGString operator+(const std::string &s) const;
+
+  int toInt() const;
+  long toLong() const;
+  float toFloat() const;
+  bool toBool() const;
+
+  Uint8 toUint8() const;
+  Sint16 toSint16() const;
+
+  int parseHex() const;
+
+  static AGString toHex(int i);
+
+  bool matches(const std::string &regex) const;
+};
+
+#endif

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_tools.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_tools.cc	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_tools.cc	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,108 @@
+/*
+ * Copyright (c) 2005 by David Kamphausen. All rights reserved.
+ *
+ * ag_tools.cc
+ * by David Kamphausen (david.kamphausen at web.de)
+ *
+ * The "Antargis" project, including all files needed to compile it,
+ * is free software; you can redistribute it and/or use it and/or modify it
+ * under the terms of the GNU General Public License as published
+ * by the Free Software Foundation; either version 2 of the License,
+ * or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ *
+ * You should have received a copy of the GNU General Public
+ * License along with this program.
+ */
+
+#include "rk_tools.h"
+#include "rk_debug.h"
+
+#include <sstream>
+
+int toInt(const std::string &s)
+  {
+    return atoi(s.c_str());
+  }
+long toLong(const std::string &s)
+  {
+    return atol(s.c_str());
+  }
+float toFloat(const std::string &s)
+  {
+    float f=atof(s.c_str());
+    return f;
+  }
+
+int fromHex(const std::string &s)
+  {
+    int i=0;
+    for(size_t j=0;j<s.length();j++)
+      {
+        int k=0;
+        i<<=4;
+        char c=s[j];
+        if(c>='A'&&c<='F')
+          k=c-'A'+10;
+        else if(c>='a' && c<='f')
+          k=c-'a'+10;
+        else if(c>='0' && c<='9')
+          k=c-'0';
+        i+=k;
+      }
+    return i;
+  }
+std::string toHex(int i)
+  {
+    std::string s;
+    std::string c="0";
+    while(i!=0)
+      {
+        int k=i&0xF;
+
+        if(k>9)
+          c[0]='A'+k-10;
+        else
+          c[0]='0'+k;
+
+        s=c+s;
+        i>>=4;
+      }
+
+
+    while(s.length()<2)
+      s=std::string("0")+s;
+    return s;
+  }
+
+
+std::vector<std::string> split(const std::string &needle,const std::string &haystack)
+{
+  std::vector<std::string> d;
+  size_t i,last=0;
+  for(i=haystack.find(needle);i!=std::string::npos;i=haystack.find(needle,i+1))
+    {
+      d.push_back(haystack.substr(last,i-last));
+      last=i+needle.length();
+    }
+  i=haystack.length();
+  d.push_back(haystack.substr(last,i-last));
+  return d;
+}
+
+
+
+std::string replace(const std::string &s,const std::string &a,const std::string &b)
+  {
+    std::string str=s;
+    size_t i=str.find(a);
+    while(i!=str.npos)
+      {
+        str=str.substr(0,i)+b+str.substr(i+a.length(),str.length()-i-a.length());
+        i=str.find(a,i+b.length());
+      }
+    return str;
+  }

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_tools.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_tools.h	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_tools.h	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,87 @@
+/*
+ * Copyright (c) 2005 by David Kamphausen. All rights reserved.
+ *
+ * ag_tools.h
+ * by David Kamphausen (david.kamphausen at web.de)
+ *
+ * The "Antargis" project, including all files needed to compile it,
+ * is free software; you can redistribute it and/or use it and/or modify it
+ * under the terms of the GNU General Public License as published
+ * by the Free Software Foundation; either version 2 of the License,
+ * or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ *
+ * You should have received a copy of the GNU General Public
+ * License along with this program.
+ */
+
+#ifndef AG_TOOLS_H
+#define AG_TOOLS_H
+
+#include <string>
+#include <list>
+#include <sstream>
+#include <vector>
+
+#ifdef WIN32
+#include <windows.h>
+#include <winsock.h>
+#endif
+
+#include <rk_base.h>
+
+std::vector<std::string> AGEXPORT split(const std::string &n,const std::string &h);
+
+
+std::string AGEXPORT replace(const std::string &s,const std::string &a,const std::string &b);
+
+template<class T>
+inline std::string toString(const T&t)
+{
+  std::ostringstream os;
+  os<<t;
+  return os.str();
+}
+
+template<>
+inline std::string toString(const bool&b)
+{
+  if(b)
+    return "true";
+  else
+    return "false";
+}
+
+inline bool toBool(const std::string &s)
+{
+  return(s=="true");
+}
+
+AGEXPORT int toInt(const std::string &s);
+AGEXPORT long toLong(const std::string &s);
+AGEXPORT float toFloat(const std::string &s);
+AGEXPORT int fromHex(const std::string &s);
+AGEXPORT std::string toHex(int i);
+
+template<class T>
+void append(std::list<T> &l1,const std::list<T> &l2)
+{
+  typename std::list<T>::const_iterator i=l2.begin();
+  for(;i!=l2.end();i++)
+    l1.push_back(*i);
+}
+
+template<class T>
+void append(std::vector<T> &l1,const std::vector<T> &l2)
+{
+  typename std::vector<T>::const_iterator i=l2.begin();
+  for(;i!=l2.end();i++)
+    l1.push_back(*i);
+}
+
+#define AGsign(x) ((x)<0?-1:(x)>0?1:0)
+
+#endif

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_utf8.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_utf8.cc	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_utf8.cc	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,78 @@
+#include "rk_utf8.h"
+#include "rk_debug.h"
+#include <string>
+
+#include <SDL.h>
+
+size_t agFirstCharSize(const std::string &s,size_t pos)
+{
+  unsigned char c=s[pos];
+  size_t l=1;
+  if((c&0xF0)==0xF0)
+    l=4;
+  else if((c&0xE0)==0xE0)
+    l=3;
+  else if((c&0xC0)==0xC0)
+    l=2;
+  assert(l+pos<=s.length());
+  return l;
+    
+}
+size_t agStringLength(const std::string &s)
+{
+  size_t c=0;
+  size_t l=0;
+  //  cdebug("in:"<<s);
+  while(c<s.length())
+    {
+      size_t cl=agFirstCharSize(s,c);
+      //      cdebug(cl<<"::"<<c<<"  "<<s.length());
+      c+=cl;
+      l++;
+    }
+  //  cdebug("len:"<<l);
+  return l;
+}
+
+std::string agSubStr(const std::string &s,size_t from,size_t len)
+{
+  size_t i=0;
+  size_t c=0;
+  while(i<from && c<s.length())
+    {
+      c+=agFirstCharSize(s,c);
+      i++;
+    }
+  if(i<from)
+    return "";
+
+  std::string r;
+  size_t d;
+  for(i=0;i<len && c<s.length();i++)
+    {
+      d=agFirstCharSize(s,c);
+      r+=s.substr(c,d);
+      c+=d;
+    }
+  return r;
+}
+
+std::string unicode2Utf8(Uint16 unicode)
+{
+  std::ostringstream os;
+
+  if(unicode < 0x80)
+    os<<char(unicode & 0x7f);
+  else if(unicode < 0x800)
+    os<<char((unicode >>6)|0xc0)<<char((unicode & 0x3f)|0x80);
+#ifdef BIGGER_UNICODE
+  else if(unicode < 0x10000)
+    os<<char((unicode >>12)|0xe0)<<char(((unicode >> 6)&0x3f)|0x80)<<char((unicode&0x3f)|0x80);
+  else if(unicode <= 0x0010 FFFF)
+    os<<char((unicode >>18)|0xF0)<<char(((unicode >>12)&0x3f)|0x80)<<char(((unicode>>6)0x3f)|0x80)<<char((unicode&0x3f)|0x80);
+#else
+  else
+    os<<char((unicode >>12)|0xe0)<<char(((unicode >> 6)&0x3f)|0x80)<<char((unicode&0x3f)|0x80);
+#endif
+  return os.str();
+}

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_utf8.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_utf8.h	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_utf8.h	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,16 @@
+#ifndef AG_UTF8_H
+#define AG_UTF8_H
+
+// INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
+
+#include <rk_base.h>
+#include <string>
+#include <vector>
+#include <SDL.h>
+
+AGEXPORT size_t agFirstCharSize(const std::string &s,size_t pos=0);
+AGEXPORT size_t agStringLength(const std::string &s);
+AGEXPORT std::string agSubStr(const std::string &s,size_t from,size_t len);
+AGEXPORT std::string unicode2Utf8(Uint16 unicode);
+
+#endif

Added: antargis/trunk/rookey/lib/rookey/cpp/swig_dummy.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/swig_dummy.cc	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp/swig_dummy.cc	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,11 @@
+#include "rk_rubyobj.h"
+
+#ifdef __WIN32__
+#include <winsock2.h> // fix problem with fd_set
+#endif
+#include <ruby.h>
+
+VALUE convertCpp2Ruby(AGRubyObject *cObject)
+  {
+    return Qnil;
+  }

Added: antargis/trunk/rookey/lib/rookey/cpp_hierarchy_parser.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp_hierarchy_parser.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/cpp_hierarchy_parser.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,152 @@
+require 'ostruct'
+
+module Rookey
+  
+  # gather all classes that are derived from AGRubyObject 
+  def Rookey.getRubyClasses(classes)
+    cs=[classes.select{|c|c.name=="AGRubyObject"}[0]]
+    begin
+      s=cs.length
+      cs=[cs+cs.map{|c|c.children}].flatten.uniq
+    end while s!=cs.length
+    cs
+  end
+  
+  
+  # sort cpp-header files in the correct order, so that swig will have the classes in the
+  # order that usage of classes comes after definition (as long as this is possible)
+  def Rookey.getOrderedCppHeaders(classes)
+    map={}
+    order={}
+    
+    allClasses=classes.dup
+    classes=getRubyClasses(classes)
+    
+    classes.each{|c|
+      map[c.name.to_s]=c
+    }
+    classes.each{|c|
+      order[c.name]=0 if map[c.parent.to_s].nil? 
+    }
+    oneNotSet=false
+    maxNumber=0
+    begin
+      oneNotSet=false
+      classes.each{|c|
+        if order[c.name].nil?
+          if order[c.parent].nil?
+            oneNotSet=true
+          else
+            order[c.name]=order[c.parent]+1
+            maxNumber=[maxNumber,order[c.name]].max
+          end
+        end
+      }
+    end while oneNotSet
+    cs=[]
+    (0..maxNumber).each{|i|
+      order.each{|k,v|
+        if v==i
+          cs << map[k]
+        end
+      }
+    }
+    allFiles=allClasses.map{|c|c.header_file}.uniq
+    result=classes.sort{|a,b|order[a.name]<=>order[b.name]}.map{|c|c.header_file}.uniq
+    result=result+(allFiles-result)
+    result
+  end
+  
+  
+  class CppHierarchyParser
+    CppClass=Struct.new(:name,:parent,:header_file,:children)
+	  
+    
+    def initialize(files)
+      @cppClasses=[]
+      parseFiles(files)
+      processDerivations
+    end
+	
+	  def getAllClasses
+	    @cppClasses
+	  end
+    
+    def getAllRubyClasses
+      clist=["AGRubyObject"]
+      while true
+        oldLength=clist.length
+        @cppClasses.each{|c|
+          if clist.member?(c.parent)
+            clist=(clist+[c]).uniq
+          end
+        }
+        break unless oldLength!=clist.length
+      end
+      clist
+    end
+    
+    # returns array of (subclass,superclass)
+    def getAllDerivations
+      @cppClasses.select{|c|c.parent}.map{|c|[c.name,c.parent]}
+    end
+    
+	  
+  private
+    
+    
+    def processDerivations
+      m={}
+      @cppClasses.each{|c|m[c.name]=c}
+      @cppClasses.each{|c|
+        if c.parent
+          if m[c.parent].nil? 
+            puts "parent unknown #{c.parent}"
+          else 
+	          m[c.parent].children << c
+          end
+        end
+      }
+    end
+    
+	  def parseFiles(files)	    
+		  class2File={}
+		  deriveList={} # x=>y :x is child of y
+		  allClasses=[]
+		
+		  files.each{|fn|
+		    file=File.open(fn)
+		    cn=""
+		    content=file.read.gsub(/\/\*([^*]|\*[^\/])*\*\//,"") # /*...*/ delete comments - FIXME: // comments will be ignored!!!
+		
+		    content.split("\n").each{|a|
+		      abak=a
+		      a.gsub!("AGEXPORT","")
+		      a.gsub!("EXPORT","")
+		      
+		      if a =~ /^ *class.*/ then
+		        cn=a.gsub(/ *class /,"").gsub(/:.*/,"").gsub("\n","").gsub(" ","")
+		        allClasses << cn.gsub(";","")
+		        if cn=~/^[A-Z].*/
+		          if a=~ /.*public.*/ then
+		            pn=a.gsub(/.*public /,"").gsub("\n","")
+	              @cppClasses << CppClass.new(cn,pn,fn,[])
+		            allClasses << pn
+		            deriveList[cn]=pn
+		            class2File[cn]=fn
+		          elsif not a=~/;/ then
+		            @cppClasses << CppClass.new(cn,nil,fn,[])
+		            deriveList[cn]=nil
+		            class2File[cn]=fn
+		          end
+		        end
+		      end
+		    
+		    }
+		  }
+		  classList = class2File.keys
+		  allClasses = allClasses.sort.uniq
+		end  
+  end
+
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/rookey_config.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/rookey_config.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/rookey_config.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,127 @@
+require 'pp'
+require 'optparse'
+
+module Rookey
+  class Configure
+    attr_accessor :programs, :input, :filename
+    
+    FILENAME="rookey_configuration.rb"
+    
+    attr_reader :options
+    
+    def self.load(filename=nil)
+      filename||=FILENAME
+      unless File.exists?(filename)
+        if File.exists?("configure")
+          ruby("configure")
+        end
+        unless File.exists?(filename)
+          self.new.run
+        end
+      end 
+      Kernel.load(filename)
+    end
+    def self.cleanTask
+      ALLCLEAN << FILENAME
+    end
+    
+    def initialize
+      @programs=[]
+      @input=nil
+      @ons=[]
+      @options={}
+      @filename=FILENAME
+    end
+        
+    def set(k,v)
+      @options[k]=v
+    end
+    
+	  def run
+	    @input||=ARGV
+	    options={}
+	    opts=OptionParser.new do |opts|
+	      opts.banner = "Usage: configure [options]"
+	
+	      opts.separator ""
+	      opts.separator "Specific options:"
+	
+	      opts.on("-d", "--enable-debug",
+	              "enable debugging") do 
+	        @options[:debug]=true
+	      end
+	      opts.on("-g","--enable-gc-debug",
+	              "enable debugging of garbage collector") do
+	        @options[:gcdebug]=true
+	      end
+	
+	      opts.on("-p","--enable-profile",
+	              "enable c++ profiling") do 
+	        @options[:profile]=true
+	      end
+	
+	      opts.on("--disable-sdlconfig",
+	              "do not use sdl-config for configuration") do 
+	        @options[:use_sdlconfig]=false
+	      end
+	      opts.on("--disable-fallbacks",
+	              "do not use fallback dirs for X11 and GL") do 
+	        @options[:use_fallbacks]=false
+	      end
+
+        opts.on("--enable-malloc-debug",
+                "enable memory debugging") do 
+          @options[:malloc_debug]=true
+        end
+        
+        	
+	      opts.on("--prefix PREFIXDIR",
+	              "set prefix directory PREFIXDIR") do |dir|
+	        @options[:prefix]=dir
+	      end
+
+	      
+	      opts.on("-v","--version",
+	        "set release version of BoA") do |v|
+	          @options[:version]=v
+	      end
+	
+	      opts.on("--ext-config CONFIG",
+	        "use user-defined config instead of ruby's mkmf","CONFIG maybe in mingw32 or unix") do |extconfig|
+	          @options[:extconfig]=extconfig
+	          @options[:use_mkmf]=false
+	      end
+        
+	
+	      @programs.each{|program|
+	        opts.on("--path-"+program+" PATH",
+	          "set path to program '#{program}'") do |d|
+	          @options[program]=d
+	        end
+	      }
+        if block_given?
+        yield opts
+        end
+
+	    
+		  end	        
+      opts.parse!(@input)
+      save
+      @options
+	  end
+    private
+    def save
+      fd=File.open(@filename,"w")
+      fd.puts "ROOKEY_CONFIG={"
+      fd.puts @options.map{|k,v|
+        ":#{k}=>'#{v}'"
+      }.join(",\n")
+      fd.puts "}"
+      fd.close
+      begin
+        File.delete("config_cache.rb")
+      rescue
+      end
+    end
+  end
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/rookey_rspec.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/rookey_rspec.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/rookey_rspec.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,4 @@
+
+rule 'spec_*.rb'=>:default do |t|
+  p t
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/swig/swig_dyn_cast_containers.i
===================================================================
--- antargis/trunk/rookey/lib/rookey/swig/swig_dyn_cast_containers.i	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/swig/swig_dyn_cast_containers.i	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,20 @@
+%{
+namespace swig
+{
+  /*
+    Traits that provides the from method for an unknown type
+  */
+  template <int flags, class Type> struct traits_from_ptr {
+    static SWIG_Object from SWIG_FROM_DECL_ARGS(Type *val) {
+    
+      // insert Dynamic_cast(...)
+      swig_type_info *info=type_info<Type>();
+      swig_type_info *ninfo=SWIG_TypeDynamicCast(info,val);
+      if(ninfo==0)
+        ninfo=info;
+    
+      return SWIG_NewPointerObj(val, ninfo, flags);
+    }
+  };
+}
+%}
\ No newline at end of file


Property changes on: antargis/trunk/rookey/lib/rookey/swig/swig_dyn_cast_containers.i
___________________________________________________________________
Name: svn:executable
   + *

Added: antargis/trunk/rookey/lib/rookey/swig.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/swig.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/swig.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,71 @@
+require 'ftools'
+
+module Rookey
+  class Swig
+    def initialize(config,target=:ruby,cpp=true)
+      @config=config
+      @target=target
+      @cpp=cpp
+    end
+    def swig(t,interface)
+      options=[]
+      program=@config["SWIG"]
+      if program=="" or program.nil?
+        # check if a prepared file is in vicinity
+        puts t.name
+        filename=File.split(t.name)[1]
+        if File.exists?(filename)
+          File.copy(filename,t.name)
+          return
+        end
+        #exit
+        program="swig"
+      end
+      #program||="swig"
+      
+      #program="swig" if program==""
+      #if program
+      
+      options << "-#{@target}"
+      options << "-c++" if @cpp
+      swigOptions = @config["SWIG_OPTIONS"].split(" ")
+      swigOptions||=[]
+      includeDirs = @config["INCLUDEDIRS"].split(" ")
+      includeDirs||=[]
+      includes=includeDirs.map{|d|"-I"+d}
+      options+=swigOptions+includes
+      options << "-o "+t.name
+      options << interface
+      call=program+" "+options.join(" ")
+      begin
+        sh call
+      rescue
+        begin
+          File.delete(t.name)
+        rescue
+        end
+        raise
+      end
+      
+      # write deps
+      # rmove -o
+      options=options.select{|op|not op=~/^-o/}
+      depsfile=File.join(".deps",interface)
+      depsdir=File.split(depsfile)[0]
+      begin
+        Dir.mkdir(depsdir)
+      rescue
+      end
+      options=options[0..2]+["-o "+depsfile,"-M"]+options[3..-1]
+      call=program+" "+options.join(" ")
+      sh call
+      
+      puts    
+    end
+    
+    def Swig.getDeps(interface)
+      interface=[interface].flatten[0]
+      Compiler.getDeps(interface.sub(/\.d$/,".i"))
+    end
+  end
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/swig_ext.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/swig_ext.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/swig_ext.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,4 @@
+module Rookey
+  
+  
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/swig_interface_builder.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/swig_interface_builder.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/swig_interface_builder.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,245 @@
+module Rookey
+  class SwigInterfaceBuilder
+    def initialize(file,moduleName,classes,files,interfaces,inits,templates)
+      @file=file
+      @moduleName=moduleName
+      @classes=classes
+      @files=files
+      @interfaces=interfaces
+      @inits=inits
+      @templates=templates
+      #@information=information
+    end
+    
+    
+    def create(classes)
+      fd=File.open(@file,"w")
+      fd.puts generate()
+      fd.close
+    end
+    
+    def getFiles
+      @files
+    end
+    
+    def getClasses
+      Rookey.getRubyClasses(@classes)
+    end
+    
+    private
+    
+    def initDefs
+      @inits.map{|i|"void "+i+"();"}.join("\n")    
+    end
+    
+    def initCalls
+      @inits.map{|i|i+"();"}.join("\n")    
+    end
+    
+    def directors
+      getClasses.map{|c|"%feature(\"director\") #{c.name};"}.join("\n")
+    end
+    
+    def templates
+      @templates.map{|t|"%include \"#{t}\""}.join("\n")
+      #""
+    end
+    
+    def cpp2RubyFunctions
+#      r="template<class T>
+#VALUE convertCpp2Ruby(T *cObject)
+#{
+#  return Qnil;
+#}"
+#
+# r2=getClasses.map{|c| a="template<>
+#VALUE convertCpp2Ruby(#{c.name} *cObject)
+#{
+#  return SWIG_RubyInstanceFor(cObject);
+#}" }.join("\n")
+#     
+#     "%{"+r+r2+"%}"
+      
+      <<EOT
+      /*
+template<class T>
+VALUE convertCpp2Ruby(T *cObject)
+{
+  return SWIG_RubyInstanceFor(cObject);
+}
+template<AGRubyObject>*/ 
+VALUE convertCpp2Ruby(AGRubyObject *cObject)
+{
+  return SWIG_RubyInstanceFor(cObject);
+}
+  
+EOT
+      
+    end
+    
+    # include dyn-casts for template-containers like std::vector<SceneNode*>
+    # this is missing in the dyncast-implementation of swig (at the time of 1.3.34)
+    def dynFroms
+      str=""
+      str<<"%wrapper %{"
+      str<< "namespace swig{"
+      getClasses.each{|c|
+        name=c.name
+        str << "
+        template <> struct traits_from_ptr<#{name}> {
+          static VALUE from (#{name} *val,int owner=0) {
+          
+            // insert Dynamic_cast(...)
+            swig_type_info *info=SWIGTYPE_p_#{name}; //type_info<#{name}>();
+            swig_type_info *ninfo=SWIG_TypeDynamicCast(info,(void**)&val);
+            if(ninfo==0)
+              ninfo=info;
+          
+            return SWIG_NewPointerObj(val, ninfo, owner);
+          }
+        };        
+        "
+      }
+      str<<"}"
+      str<<"%}"
+      str
+    end
+    
+    def generate
+
+"%module(directors=\"1\") #{@moduleName}
+%feature(\"autodoc\",\"1\");
+
+/*
+%feature(\"director:except\") {
+ throw Swig::DirectorMethodException($error);
+}
+*/
+
+      %include <std_vector.i>
+      %include <std_list.i>
+      
+#{importInterfaces}
+
+#{stlIncludes}
+%{
+#include \"rk_string.h\"
+#{headerIncludes}
+%}
+
+#{dynFroms}
+
+#{directors}
+#{markers}
+%{
+#{cpp2RubyFunctions}
+%}
+
+%{
+#{initDefs}
+%}
+%insert(\"init\") %{
+#{initCalls}
+%}
+
+
+%typemaps_std_string(AGString, char, SWIG_AsCharPtrAndSize, SWIG_FromCharPtrAndSize, %checkcode(STDSTRING));
+
+/*
+template <>
+ inline VALUE from<AGString>(const AGString& val) {
+   return SWIG_FromCharPtrAndSize(val.c_str(),val.length());
+   //return traits_from<Type>::from(val);
+ }
+ */
+ // oder
+ %wrapper %{
+ namespace swig
+ {
+ template<> struct traits_from<AGString>
+ {
+	 inline static VALUE from(const AGString &val)
+	 {
+     return SWIG_FromCharPtrAndSize(val.c_str(),val.length());
+	 }
+};
+}
+%}
+
+
+#{dynamicCasts}
+%template(StringVector) std::vector<std::string>;
+%template(PStringVector) std::vector<std::string*>;
+#{templates}
+
+%feature(\"trackobjects\");
+
+#{headerSwigIncludes}      
+
+"
+    end
+    def importInterfaces
+      @interfaces.map{|i|
+        "%import \"#{i}\""
+      }.join("\n")
+    end
+    def stlIncludes
+      "%include \"stl.i\"\n%include \"std_list.i\""
+    end
+    def headerIncludes
+      getFiles.map{|file|"#include \"#{file}\""}.join("\n")
+    end
+    def headerSwigIncludes
+      getFiles.map{|file|"%include \"#{file}\""}.join("\n")
+    end
+    def markers
+      getClasses.map{|c|
+        "%markfunc #{c.name} \"general_markfunc\""
+      }.join("\n")
+    end
+    def dynamicCasts
+      getClasses.map{|c|
+        next if c.children.length ==0
+        
+        "        
+        %typemap(out) #{c.name} *, #{c.name} & {
+          swig_type_info *ty = SWIG_TypeDynamicCast($1_descriptor,(void **) &$1);
+          $result = SWIG_NewPointerObj($1, ty, $owner);
+        }        
+        %typemap(directorin) #{c.name} *, #{c.name} & {
+          if($1)
+          {
+          swig_type_info *ty = SWIG_TypeDynamicCast($1_descriptor,(void **) &$1);
+          $input = SWIG_NewPointerObj($1, ty, $owner);
+          }
+        }        
+        %{
+        
+        swig_type_info* #{c.name}_dynamic_cast(void **p)
+        {
+                #{c.name} *a=(#{c.name}*)(*p);
+        
+                "+
+
+                c.children.map{|child|
+                "
+                {
+	                #{child.name}*b=dynamic_cast<#{child.name}*>(a);
+	                if(b)
+	                {
+	                        *p=(void*)b;
+	                        return SWIGTYPE_p_#{child.name};
+	                }
+                }
+"                  
+                }.join("\n")+
+                "
+                return 0;
+        }
+        
+        %}
+        DYNAMIC_CAST(SWIGTYPE_p_#{c.name}, #{c.name}_dynamic_cast);"
+      }.join("\n")
+    end
+  end  
+end

Added: antargis/trunk/rookey/lib/rookey/tasks.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/tasks.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/tasks.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,201 @@
+require 'rake/clean.rb'
+#require '../rookey.rb'
+require './swig.rb'
+require './compile.rb'
+
+
+require './rookey_config.rb'
+Rookey::Configure.load
+Rookey::Configure.cleanTask
+
+require './config_generator.rb'
+require './cpp_hierarchy_parser.rb'
+require './swig_interface_builder.rb'
+
+require 'rake/clean.rb'
+require 'pp'
+
+# For using Rookey you'll create a Rakefile and include rookey, e.g. like this:
+#  require 'rookey/rookey.rb'
+# After this you're free to use the public methods of the Rookey module to define your
+# projects libraries, sources and so forth.
+#
+# All tasks are designed so that you can take their output as a new target, e.g.:
+#
+module Rookey
+
+  # call like this
+  #  swig_interface "antargis_gui"=>Dir["ext/gui/*.h"]+additionalInterfaces,"initalizers"=>["func1","func2",...]
+  # will generate an interface-file named "antargis_gui_interface.i" for module "antargis_gui"
+  def Rookey.swig_interface(ops)
+    target=""
+    source=""
+    inits=[]
+    ops.each{|n,v|
+      case n
+        when :initializers
+          inits=v
+        else
+		      target=n
+		      source=v
+      end
+    }
+    file=target+"_interface.i"
+    templates=[source].flatten.select{|f|f=~/i$/}
+    source=source.grep(/INCLUDE_SWIG/)+getAGRubyObjectHeader
+    
+    rule file=>source do
+	    parser=CppHierarchyParser.new([source].flatten.select{|f|f=~/h$/})
+	    classes=parser.getAllClasses
+	    
+	    files=(getOrderedCppHeaders(classes)+source).uniq
+	    interfaceBuilder=SwigInterfaceBuilder.new(file,target,classes,files,source.select{|f|f=~/i$/},inits,templates)
+	    interfaceBuilder.create(parser)
+    end
+    CLEAN << file
+    [file]
+  end
+  
+  def Rookey.swig(ops,config=nil)
+	  target=""
+	  source=""
+	  ops.each{|n,v|
+	    target=n
+	    source=v
+	  }
+	  swigDirect(target,source,config)
+	end
+	
+	def Rookey.swigDirect(output,interface,config=nil)
+	  config||=Rookey::getConfig
+	  swigCompiler=Rookey::Swig.new(config)
+	  
+	  
+	  # FIXME: handle deps
+	  
+	  rule output=>Swig.getDeps(interface) do |t|
+	    swigCompiler.swig(t,interface)
+	  end
+	  CLEAN << output << output.gsub(/\.cc?/,".h")
+	  getRookeyCPPSources+[output] #getAGRubyObjectSource
+	end
+
+  def Rookey.getRookeyCPPSources
+    Dir[File.join(File.split(__FILE__)[0],"cpp","*.cc")].select{|f|not f=~/.*dummy.*/}
+
+  end
+
+  def Rookey.getAGRubyObjectSource
+    [File.join(File.split(__FILE__)[0],"cpp","rk_rubyobj.cc")]
+  end
+  def Rookey.getAGRubyObjectHeader
+    [File.join(File.split(__FILE__)[0],"cpp","rk_rubyobj.h")]
+  end
+	
+	def Rookey.compile(files,config=nil)
+	  files=[files].flatten
+	  config||=Rookey::getConfig
+	  compiler=Rookey::Compiler.new(config)
+	  files.each{|file|
+	    t=compiler.makeObject(file)
+      s=Compiler.getDeps(file)
+	    rule t=>s do |t|
+	      compiler.compile(t.name,t.prerequisites)
+	    end
+	  }
+	  targets=files.map{|file|compiler.makeObject(file)}
+	  CLEAN << targets << compiler.getBuildDir << Compiler.getDepsDir
+	  targets
+	end
+	
+	# links a DLL named *name* out of the given *files* 
+	def Rookey.link_dll(name,files)
+    files.flatten!
+    files.uniq!
+	  config=Rookey::getConfig
+	  
+    linker=Rookey::Compiler.new(config)
+    
+    target=linker.dllName(name)
+    #pp target
+    desc "Link DLL #{name}"
+    task target=>files do |t|
+      linker.linkDLL(t)
+    end
+    CLEAN << target
+    
+    target
+	end
+
+	
+	# links an executable with name *name* out of the given *files*, you can give a config which should be of type RookeyConfig (or hash)
+  def Rookey.link_exe(name,files,config=nil)
+    files.flatten!
+    if files.select{|file|file=~/swig_.*/}.length>0
+      ["rk_rubyobj.cc","rk_string.cc"].each{|f|
+        files << compile(File.join(File.split(__FILE__)[0],"cpp",f),config)
+      }
+      files << compile(File.join(File.split(__FILE__)[0],"cpp","swig_dummy.cc"),config) if files.select{|f|f=~/swig/}.length==0
+    end
+    files.uniq!
+    config||=Rookey::getConfig
+    
+    linker=Rookey::Compiler.new(config)
+    
+    target=linker.exeName(name)
+    desc "Link EXE #{name}"
+    
+    task target=>files do |t|
+      linker.linkEXE(t.name,t.prerequisites)
+    end
+    CLEAN << target
+    
+    target    
+  end 
+
+  
+  # simple creation of ruby-extensions following the principle of antargis structure
+  # * name is the name of the resulting extension
+  # * files are the .h, .c and .cc (or .cpp) source-files 
+  def Rookey.ruby_ext(name,files,inits=[],fallbackInterface=nil)
+    headerFiles=files.select{|f|f=~/h$/}
+    libs=files.select{|f|f=~/so$/ or f=~/bundle/}
+
+    cppFiles=files.select{|f|f=~/c$/}
+
+    sourceDirs=files.map{|file|File.split(file)[0]}.sort.uniq
+
+    Rookey::checkConfig(SwigConfig)
+    
+    config=Rookey::getConfig
+    sourceDirs << "."
+    config.add("INCLUDEDIRS",sourceDirs.join(" "))
+    
+    compiler=Rookey::Compiler.new(config)
+            
+    #FIXME: check if swig is present
+    
+    swigInterfaces=libs.map{|f|f.sub(/\.[a-zA-Z]+$/,".i")}
+    swigInterfaces=files.select{|f|f=~/i$/}
+    swigInterface = Rookey::swig_interface(name=>headerFiles+swigInterfaces,:initializers=>inits)
+    swigTarget = Rookey::swig({File.join(compiler.getPlainBuildDir,name+"_swig.cc")=>swigInterface},config)
+    
+    
+    targets = Rookey::compile(cppFiles+[swigTarget],config)
+    alllibs=libs
+    
+    lib=Rookey::link_dll(name,targets+alllibs)
+  end
+  
+  # tries to require <name> and returns if this has succeeded
+  def Rookey.checkedRequire(name)
+    begin
+    require name
+    rescue LoadError => load_error
+      puts "Library #{name} not found!"
+      return false
+    end
+    return true
+  end
+  
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/tools.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/tools.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey/tools.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,76 @@
+require 'pp'
+
+class Array
+  
+  # *grep* goes through all files given by the filenames that should be contained in *self*
+  # and checks for a given RegEx
+  # example:
+  #
+  #  pp Dir["*.h"].grep(/INCLUDE_SWIG/)
+  #
+  # outputs all filenames of header-files containing the string INCLUDE_SWIG
+  def grep(s)
+    s=/#{s}/ if s.is_a?(String)
+    self.select{|f|
+      fd=File.open(f)
+      result=(s===fd.read)
+      fd.close
+      result
+    }
+  end
+end
+
+module Rookey
+  # creates a directory *dir* and parent-dirs if they don't exist
+  def Rookey.mkdir(dir)
+	  return if File.exists?(dir)
+	  begin
+	    Dir.mkdir(dir.to_s)
+	  rescue
+	    p=File.split(dir)[0]
+	    return if p==dir
+	    Rookey.mkdir(p)
+	    begin
+	      Dir.mkdir(dir)
+	    rescue
+	    end
+	  end
+	end
+end
+
+
+alias :requireRookeyOld :require
+
+def require(file)
+  if file[0..0]=="."
+    rel=caller[0].gsub(/:[0-9]+/,"")
+    rel=File.expand_path(rel)
+    dir=File.split(rel)[0]
+    file=File.join(dir,file)
+    #pp file
+  end
+  requireRookeyOld(file)
+end
+def requireRelative(f)
+  require f
+end
+
+class FalseClass
+  def <=>(o)
+    if o==true
+      -1
+    else
+      0
+    end
+  end
+end
+class TrueClass
+  def <=>(o)
+    if o==false
+      1
+    else
+      0
+    end
+  end
+end
+

Added: antargis/trunk/rookey/lib/rookey.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/lib/rookey.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,13 @@
+ALLCLEAN=[]
+
+require File.join(File.split(File.expand_path(__FILE__))[0],'rookey','tools.rb')
+require './rookey/tasks.rb'
+
+task :allclean=>:clean do
+  ALLCLEAN.each{|f|
+    begin
+      File.delete(f)
+    rescue
+    end
+  }
+end

Modified: antargis/trunk/rookey/maintainenance/Rakefile
===================================================================
--- antargis/trunk/rookey/maintainenance/Rakefile	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/maintainenance/Rakefile	2009-02-16 20:12:59 UTC (rev 1285)
@@ -98,17 +98,61 @@
       cp("../../"+f,sDir)
     }
     
-    #system "tar cfz #{sDir}.tar.gz #{sDir}"
-    #system "tar cfj #{sDir}.tar.bz2 #{sDir}"
-    #system "zip -r #{sDir}.zip #{sDir}"
+    system "tar cfz #{sDir}.tar.gz #{sDir}"
+    system "tar cfj #{sDir}.tar.bz2 #{sDir}"
+    system "zip -r #{sDir}.zip #{sDir}"
     checkSource(sDir)
   end
   
+  def distWin32
+    system("cd ../.. && ./configure --ext-config=mingw32 && rake")
+    sDir=sourceDir
+    system("rm -rf #{sDir}")
+    copyMainTo(sDir)
+    cp("../../antargis.exe",sDir)
+    cp("../../antargis.dll",sDir)
+    puts "--"
+    Dir["../externals/build/bin/*.dll"].each{|dll|
+      puts dll
+      cp(dll,sDir)
+    }
+    puts "--"
+    Dir["../externals/build/**/*.dll"].each{|dll|
+      puts dll
+      cp(dll,sDir)
+    }
+    filename=updateISS
+    system("wine \"c:\\Programme\\Inno Setup 5\\ISCC.exe\" /O. #{filename}")
+    
+  end
+  
+  
   def prepareDistribution
   end
   
   private
   
+  def updateISS
+    content=File.open(File.join(File.split(__FILE__)[0],"antargis.iss")).read
+      
+    vars={
+      "APPNAME"=>"Antargis",
+        "URL"=>"antargis.berlios.de",
+        "VERSION"=>@config.version,
+        "PUBLISHER"=>"The Antargis-team",
+        "SOURCEDIR"=>sourceDir,
+        "PROGNAME"=>"antargis"
+    }
+    vars.each{|n,v|
+      content.gsub!("${#{n}}",v)
+    }
+    filename="tmp.iss"
+    f=File.open(filename,"w")
+    f.puts content
+    f.close
+    filename
+  end
+  
   def checkSource(dir)
     system "cd #{dir} && export PATH=/usr/bin export LDFLAGS=-L/opt/local/lib && export CFLAGS='-I/opt/local/include -I/opt/local/include/SDL' && ./configure && rake --trace && rake spec"
     raise "Did not work" if $?!=0
@@ -182,15 +226,18 @@
 
 DistConfig=Struct.new(:name,:version)
 
+task :default=>:dist do
+  
end
+
 task :dist do
   config=DistConfig.new("antargis","0.3")
   d=RookeyDist.new(config)
   #d.distDarwin
-  d.distSource
-  #dist(:win32)
+  #d.distSource
+  d.distWin32
   #dist(:source)
 end
 
 task :clean do
-  system "rm -rf Antargis* antargis*"
+  system "rm -rf Antargis* antargis-* tmp.iss"
 end
\ No newline at end of file

Added: antargis/trunk/rookey/maintainenance/antargis.iss
===================================================================
--- antargis/trunk/rookey/maintainenance/antargis.iss	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/maintainenance/antargis.iss	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,65 @@
+; -- Example1.iss --
+; Demonstrates copying 3 files and creating an icon.
+
+; SEE THE DOCUMENTATION FOR DETAILS ON CREATING .ISS SCRIPT FILES!
+
+[Setup]
+AppName=${APPNAME}
+AppVerName=${APPNAME} ${VERSION}
+DefaultDirName={pf}\${APPNAME}
+DefaultGroupName=${APPNAME}
+UninstallDisplayIcon={app}\${APPNAME}.exe
+Compression=lzma/fast
+SolidCompression=yes
+OutputBaseFilename=${APPNAME}-${VERSION}-setup
+AppPublisher=Antargis-Team
+AppPublisherURL=${URL}
+AppVersion=${VERSION}
+
+
+[Files]
+Source: "${SOURCEDIR}\*"; DestDir: "{app}"; Flags:recursesubdirs
+
+[Icons]
+Name: "{group}\${APPNAME}"; Filename: "{app}\${APPNAME}.lnk" ; WorkingDir: "{app}"
+
+[Languages]
+Name: en; MessagesFile: "compiler:Default.isl"
+;Name: es; MessagesFile: "compiler:Languages\Spanish.isl"
+Name: de; MessagesFile: "compiler:Languages\German.isl"
+
+[UninstallDelete]
+Type: files; Name: "{app}\${APPNAME}.lnk"
+Type: files; Name: "{app}\error.txt"
+Type: dirifempty; Name: "{app}"
+
+[Code]
+function NextButtonClick(CurPageID: Integer): Boolean;
+var
+  ResultCode: Integer;
+begin
+  case CurPageID of
+    wpSelectDir:
+      begin
+        CreateDir(ExpandConstant('{app}'));
+        CreateShellLink(
+        ExpandConstant('{app}\${APPNAME}.lnk'),
+        '${APPNAME} ${VERSION}',
+        ExpandConstant('{app}\${PROGNAME}.exe'),
+        ExpandConstant('"{app}\${APPNAME}"'),
+        ExpandConstant('{app}'),
+          '',
+          0,
+          SW_SHOWNORMAL);
+      end;
+  end;
+
+  Result := True;
+end;
+
+
+procedure AfterMyProgInstall(S: String);
+begin
+  MsgBox('AfterMyProgInstall:' #13#13 'Setup just installed ' + S + ' as ' + CurrentFileName + '.', mbInformation, MB_OK);
+end;
+

Added: antargis/trunk/rookey/maintainenance/tmp.iss
===================================================================
--- antargis/trunk/rookey/maintainenance/tmp.iss	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/maintainenance/tmp.iss	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,65 @@
+; -- Example1.iss --
+; Demonstrates copying 3 files and creating an icon.
+
+; SEE THE DOCUMENTATION FOR DETAILS ON CREATING .ISS SCRIPT FILES!
+
+[Setup]
+AppName=Antargis
+AppVerName=Antargis 0.3
+DefaultDirName={pf}\Antargis
+DefaultGroupName=Antargis
+UninstallDisplayIcon={app}\Antargis.exe
+Compression=lzma/fast
+SolidCompression=yes
+OutputBaseFilename=Antargis-0.3-setup
+AppPublisher=Antargis-Team
+AppPublisherURL=antargis.berlios.de
+AppVersion=0.3
+
+
+[Files]
+Source: "antargis-0.3\*"; DestDir: "{app}"; Flags:recursesubdirs
+
+[Icons]
+Name: "{group}\Antargis"; Filename: "{app}\Antargis.lnk" ; WorkingDir: "{app}"
+
+[Languages]
+Name: en; MessagesFile: "compiler:Default.isl"
+;Name: es; MessagesFile: "compiler:Languages\Spanish.isl"
+Name: de; MessagesFile: "compiler:Languages\German.isl"
+
+[UninstallDelete]
+Type: files; Name: "{app}\Antargis.lnk"
+Type: files; Name: "{app}\error.txt"
+Type: dirifempty; Name: "{app}"
+
+[Code]
+function NextButtonClick(CurPageID: Integer): Boolean;
+var
+  ResultCode: Integer;
+begin
+  case CurPageID of
+    wpSelectDir:
+      begin
+        CreateDir(ExpandConstant('{app}'));
+        CreateShellLink(
+        ExpandConstant('{app}\Antargis.lnk'),
+        'Antargis 0.3',
+        ExpandConstant('{app}\antargis.exe'),
+        ExpandConstant('"{app}\Antargis"'),
+        ExpandConstant('{app}'),
+          '',
+          0,
+          SW_SHOWNORMAL);
+      end;
+  end;
+
+  Result := True;
+end;
+
+
+procedure AfterMyProgInstall(S: String);
+begin
+  MsgBox('AfterMyProgInstall:' #13#13 'Setup just installed ' + S + ' as ' + CurrentFileName + '.', mbInformation, MB_OK);
+end;
+

Added: antargis/trunk/rookey/nbproject/private/config.properties
===================================================================

Added: antargis/trunk/rookey/nbproject/private/private.properties
===================================================================
--- antargis/trunk/rookey/nbproject/private/private.properties	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/nbproject/private/private.properties	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1 @@
+platform.active=default

Added: antargis/trunk/rookey/nbproject/private/rake-d.txt
===================================================================
--- antargis/trunk/rookey/nbproject/private/rake-d.txt	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/nbproject/private/rake-d.txt	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,19 @@
+clean=Remove any temporary products.
+clobber=Remove any generated file.
+clobber_package=Remove package products
+clobber_rdoc=Remove rdoc products
+default=
+docs=
+docs/ruby=
+docs/ruby/index.html=
+gem=Build the gem file rookey-0.1.gem
+package=Build all the packages
+pkg=
+pkg/rookey-0.1=
+pkg/rookey-0.1.gem=
+pkg/rookey-0.1.tgz=
+pkg/rookey-0.1.zip=
+rdoc=Build the rdoc HTML Files
+repackage=Force a rebuild of the package files
+rerdoc=Force a rebuild of the RDOC files
+spec=Run specs

Added: antargis/trunk/rookey/nbproject/project.properties
===================================================================
--- antargis/trunk/rookey/nbproject/project.properties	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/nbproject/project.properties	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,15 @@
+javac.classpath=
+main.file=
+platform.active=default
+source.encoding=UTF-8
+src.configs.dir=configs
+src.cpp.dir=cpp
+src.docs.dir=docs
+src.examples.dir=examples
+src.externals.dir=externals
+src.lib.dir=lib
+src.maintainenance.dir=maintainenance
+src.nbproject.dir=nbproject
+src.pkg.dir=pkg
+src.spec.dir=spec
+src.swig.dir=swig

Added: antargis/trunk/rookey/nbproject/project.xml
===================================================================
--- antargis/trunk/rookey/nbproject/project.xml	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/nbproject/project.xml	2009-02-16 20:12:59 UTC (rev 1285)
@@ -0,0 +1,23 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<project xmlns="http://www.netbeans.org/ns/project/1">
+    <type>org.netbeans.modules.ruby.rubyproject</type>
+    <configuration>
+        <data xmlns="http://www.netbeans.org/ns/ruby-project/1">
+            <name>Rookey</name>
+            <source-roots>
+                <root id="src.configs.dir"/>
+                <root id="src.cpp.dir"/>
+                <root id="src.docs.dir"/>
+                <root id="src.examples.dir"/>
+                <root id="src.externals.dir"/>
+                <root id="src.lib.dir"/>
+                <root id="src.maintainenance.dir"/>
+                <root id="src.nbproject.dir"/>
+                <root id="src.pkg.dir"/>
+                <root id="src.spec.dir"/>
+                <root id="src.swig.dir"/>
+            </source-roots>
+            <test-roots/>
+        </data>
+    </configuration>
+</project>

Deleted: antargis/trunk/rookey/rookey.rb
===================================================================
--- antargis/trunk/rookey/rookey.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/rookey.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,12 +0,0 @@
-ALLCLEAN=[]
-
-require File.join(File.split(__FILE__)[0],'tools.rb')
-
-task :allclean=>:clean do
-  ALLCLEAN.each{|f|
-    begin
-      File.delete(f)
-    rescue
-    end
-  }
-end

Deleted: antargis/trunk/rookey/rookey_config.rb
===================================================================
--- antargis/trunk/rookey/rookey_config.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/rookey_config.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,121 +0,0 @@
-require 'pp'
-require 'optparse'
-
-module Rookey
-  class Configure
-    attr_accessor :programs, :input, :filename
-    
-    FILENAME="rookey_configuration.rb"
-    
-    attr_reader :options
-    
-    def self.load(filename=nil)
-      filename||=FILENAME
-      unless File.exists?(filename)
-        if File.exists?("configure")
-          ruby("configure")
-        end
-        unless File.exists?(filename)
-          self.new.run
-        end
-      end 
-      Kernel.load(filename)
-    end
-    def self.cleanTask
-      ALLCLEAN << FILENAME
-    end
-    
-    def initialize
-      @programs=[]
-      @input=nil
-      @ons=[]
-      @options={}
-      @filename=FILENAME
-    end
-        
-    def set(k,v)
-      @options[k]=v
-    end
-    
-	  def run
-	    @input||=ARGV
-	    options={}
-	    opts=OptionParser.new do |opts|
-	      opts.banner = "Usage: configure [options]"
-	
-	      opts.separator ""
-	      opts.separator "Specific options:"
-	
-	      opts.on("-d", "--enable-debug",
-	              "enable debugging") do 
-	        @options[:debug]=true
-	      end
-	      opts.on("-g","--enable-gc-debug",
-	              "enable debugging of garbage collector") do
-	        @options[:gcdebug]=true
-	      end
-	
-	      opts.on("-p","--enable-profile",
-	              "enable c++ profiling") do 
-	        @options[:profile]=true
-	      end
-	
-	      opts.on("--disable-sdlconfig",
-	              "do not use sdl-config for configuration") do 
-	        @options[:use_sdlconfig]=false
-	      end
-	      opts.on("--disable-fallbacks",
-	              "do not use fallback dirs for X11 and GL") do 
-	        @options[:use_fallbacks]=false
-	      end
-	
-	      opts.on("--prefix PREFIXDIR",
-	              "set prefix directory PREFIXDIR") do |dir|
-	        @options[:prefix]=dir
-	      end
-
-	      
-	      opts.on("-v","--version",
-	        "set release version of BoA") do |v|
-	          @options[:version]=v
-	      end
-	
-	      opts.on("--ext-config CONFIG",
-	        "use user-defined config instead of ruby's mkmf","CONFIG maybe in mingw32 or unix") do |extconfig|
-	          @options[:extconfig]=extconfig
-	          @options[:use_mkmf]=false
-	      end
-        
-	
-	      @programs.each{|program|
-	        opts.on("--path-"+program+" PATH",
-	          "set path to program '#{program}'") do |d|
-	          @options[program]=d
-	        end
-	      }
-        if block_given?
-        yield opts
-        end
-
-	    
-		  end	        
-      opts.parse!(@input)
-      save
-      @options
-	  end
-    private
-    def save
-      fd=File.open(@filename,"w")
-      fd.puts "ROOKEY_CONFIG={"
-      fd.puts @options.map{|k,v|
-        ":#{k}=>'#{v}'"
-      }.join(",\n")
-      fd.puts "}"
-      fd.close
-      begin
-        File.delete("config_cache.rb")
-      rescue
-      end
-    end
-  end
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/rookey_rspec.rb
===================================================================
--- antargis/trunk/rookey/rookey_rspec.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/rookey_rspec.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,4 +0,0 @@
-
-rule 'spec_*.rb'=>:default do |t|
-  p t
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/swig/swig_dyn_cast_containers.i
===================================================================
--- antargis/trunk/rookey/swig/swig_dyn_cast_containers.i	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/swig/swig_dyn_cast_containers.i	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,20 +0,0 @@
-%{
-namespace swig
-{
-  /*
-    Traits that provides the from method for an unknown type
-  */
-  template <int flags, class Type> struct traits_from_ptr {
-    static SWIG_Object from SWIG_FROM_DECL_ARGS(Type *val) {
-    
-      // insert Dynamic_cast(...)
-      swig_type_info *info=type_info<Type>();
-      swig_type_info *ninfo=SWIG_TypeDynamicCast(info,val);
-      if(ninfo==0)
-        ninfo=info;
-    
-      return SWIG_NewPointerObj(val, ninfo, flags);
-    }
-  };
-}
-%}
\ No newline at end of file

Deleted: antargis/trunk/rookey/swig.rb
===================================================================
--- antargis/trunk/rookey/swig.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/swig.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,71 +0,0 @@
-require 'ftools'
-
-module Rookey
-  class Swig
-    def initialize(config,target=:ruby,cpp=true)
-      @config=config
-      @target=target
-      @cpp=cpp
-    end
-    def swig(t,interface)
-      options=[]
-      program=@config["SWIG"]
-      if program=="" or program.nil?
-        # check if a prepared file is in vicinity
-        puts t.name
-        filename=File.split(t.name)[1]
-        if File.exists?(filename)
-          File.copy(filename,t.name)
-          return
-        end
-        #exit
-        program="swig"
-      end
-      #program||="swig"
-      
-      #program="swig" if program==""
-      #if program
-      
-      options << "-#{@target}"
-      options << "-c++" if @cpp
-      swigOptions = @config["SWIG_OPTIONS"].split(" ")
-      swigOptions||=[]
-      includeDirs = @config["INCLUDEDIRS"].split(" ")
-      includeDirs||=[]
-      includes=includeDirs.map{|d|"-I"+d}
-      options+=swigOptions+includes
-      options << "-o "+t.name
-      options << interface
-      call=program+" "+options.join(" ")
-      begin
-        sh call
-      rescue
-        begin
-          File.delete(t.name)
-        rescue
-        end
-        raise
-      end
-      
-      # write deps
-      # rmove -o
-      options=options.select{|op|not op=~/^-o/}
-      depsfile=File.join(".deps",interface)
-      depsdir=File.split(depsfile)[0]
-      begin
-        Dir.mkdir(depsdir)
-      rescue
-      end
-      options=options[0..2]+["-o "+depsfile,"-M"]+options[3..-1]
-      call=program+" "+options.join(" ")
-      sh call
-      
-      puts    
-    end
-    
-    def Swig.getDeps(interface)
-      interface=[interface].flatten[0]
-      Compiler.getDeps(interface.sub(/\.d$/,".i"))
-    end
-  end
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/swig_ext.rb
===================================================================
--- antargis/trunk/rookey/swig_ext.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/swig_ext.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,4 +0,0 @@
-module Rookey
-  
-  
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/swig_interface_builder.rb
===================================================================
--- antargis/trunk/rookey/swig_interface_builder.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/swig_interface_builder.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,240 +0,0 @@
-module Rookey
-  class SwigInterfaceBuilder
-    def initialize(file,moduleName,classes,files,interfaces,inits,templates)
-      @file=file
-      @moduleName=moduleName
-      @classes=classes
-      @files=files
-      @interfaces=interfaces
-      @inits=inits
-      @templates=templates
-      #@information=information
-    end
-    
-    
-    def create(classes)
-      fd=File.open(@file,"w")
-      fd.puts generate()
-      fd.close
-    end
-    
-    def getFiles
-      @files
-    end
-    
-    def getClasses
-      Rookey.getRubyClasses(@classes)
-    end
-    
-    private
-    
-    def initDefs
-      @inits.map{|i|"void "+i+"();"}.join("\n")    
-    end
-    
-    def initCalls
-      @inits.map{|i|i+"();"}.join("\n")    
-    end
-    
-    def directors
-      getClasses.map{|c|"%feature(\"director\") #{c.name};"}.join("\n")
-    end
-    
-    def templates
-      @templates.map{|t|"%include \"#{t}\""}.join("\n")
-      #""
-    end
-    
-    def cpp2RubyFunctions
-#      r="template<class T>
-#VALUE convertCpp2Ruby(T *cObject)
-#{
-#  return Qnil;
-#}"
-#
-# r2=getClasses.map{|c| a="template<>
-#VALUE convertCpp2Ruby(#{c.name} *cObject)
-#{
-#  return SWIG_RubyInstanceFor(cObject);
-#}" }.join("\n")
-#     
-#     "%{"+r+r2+"%}"
-      
-      <<EOT
-      /*
-template<class T>
-VALUE convertCpp2Ruby(T *cObject)
-{
-  return SWIG_RubyInstanceFor(cObject);
-}
-template<AGRubyObject>*/ 
-VALUE convertCpp2Ruby(AGRubyObject *cObject)
-{
-  return SWIG_RubyInstanceFor(cObject);
-}
-  
-EOT
-      
-    end
-    
-    # include dyn-casts for template-containers like std::vector<SceneNode*>
-    # this is missing in the dyncast-implementation of swig (at the time of 1.3.34)
-    def dynFroms
-      str=""
-      str<<"%wrapper %{"
-      str<< "namespace swig{"
-      getClasses.each{|c|
-        name=c.name
-        str << "
-        template <> struct traits_from_ptr<#{name}> {
-          static VALUE from (#{name} *val,int owner=0) {
-          
-            // insert Dynamic_cast(...)
-            swig_type_info *info=SWIGTYPE_p_#{name}; //type_info<#{name}>();
-            swig_type_info *ninfo=SWIG_TypeDynamicCast(info,(void**)&val);
-            if(ninfo==0)
-              ninfo=info;
-          
-            return SWIG_NewPointerObj(val, ninfo, owner);
-          }
-        };        
-        "
-      }
-      str<<"}"
-      str<<"%}"
-      str
-    end
-    
-    def generate
-
-"%module(directors=\"1\") #{@moduleName}
-%feature(\"autodoc\",\"1\");
-
-/*
-%feature(\"director:except\") {
- throw Swig::DirectorMethodException($error);
-}
-*/
-
-#{importInterfaces}
-
-#{stlIncludes}
-%{
-#{headerIncludes}
-%}
-
-#{dynFroms}
-
-#{directors}
-#{markers}
-%{
-#{cpp2RubyFunctions}
-%}
-
-%{
-#{initDefs}
-%}
-%insert(\"init\") %{
-#{initCalls}
-%}
-
-
-%typemaps_std_string(AGString, char, SWIG_AsCharPtrAndSize, SWIG_FromCharPtrAndSize, %checkcode(STDSTRING));
-
-/*
-template <>
- inline VALUE from<AGString>(const AGString& val) {
-   return SWIG_FromCharPtrAndSize(val.c_str(),val.length());
-   //return traits_from<Type>::from(val);
- }
- */
- // oder
- %wrapper %{
- namespace swig
- {
- template<> struct traits_from<AGString>
- {
-	 inline static VALUE from(const AGString &val)
-	 {
-     return SWIG_FromCharPtrAndSize(val.c_str(),val.length());
-	 }
-};
-}
-%}
-
-
-#{dynamicCasts}
-
-#{templates}
-
-%feature(\"trackobjects\");
-
-#{headerSwigIncludes}      
-
-"
-    end
-    def importInterfaces
-      @interfaces.map{|i|
-        "%import \"#{i}\""
-      }.join("\n")
-    end
-    def stlIncludes
-      "%include \"stl.i\"\n%include \"std_list.i\""
-    end
-    def headerIncludes
-      getFiles.map{|file|"#include \"#{file}\""}.join("\n")
-    end
-    def headerSwigIncludes
-      getFiles.map{|file|"%include \"#{file}\""}.join("\n")
-    end
-    def markers
-      getClasses.map{|c|
-        "%markfunc #{c.name} \"general_markfunc\""
-      }.join("\n")
-    end
-    def dynamicCasts
-      getClasses.map{|c|
-        next if c.children.length ==0
-        
-        "        
-        %typemap(out) #{c.name} *, #{c.name} & {
-          swig_type_info *ty = SWIG_TypeDynamicCast($1_descriptor,(void **) &$1);
-          $result = SWIG_NewPointerObj($1, ty, $owner);
-        }        
-        %typemap(directorin) #{c.name} *, #{c.name} & {
-          if($1)
-          {
-          swig_type_info *ty = SWIG_TypeDynamicCast($1_descriptor,(void **) &$1);
-          $input = SWIG_NewPointerObj($1, ty, $owner);
-          }
-        }        
-        %{
-        
-        swig_type_info* #{c.name}_dynamic_cast(void **p)
-        {
-                #{c.name} *a=(#{c.name}*)(*p);
-        
-                "+
-
-                c.children.map{|child|
-                "
-                {
-	                #{child.name}*b=dynamic_cast<#{child.name}*>(a);
-	                if(b)
-	                {
-	                        *p=(void*)b;
-	                        return SWIGTYPE_p_#{child.name};
-	                }
-                }
-"                  
-                }.join("\n")+
-                "
-                return 0;
-        }
-        
-        %}
-        DYNAMIC_CAST(SWIGTYPE_p_#{c.name}, #{c.name}_dynamic_cast);"
-      }.join("\n")
-    end
-  end  
-end

Deleted: antargis/trunk/rookey/tasks.rb
===================================================================
--- antargis/trunk/rookey/tasks.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/tasks.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,183 +0,0 @@
-require 'rake/clean.rb'
-require File.join(File.split(__FILE__)[0],'rookey.rb')
-require File.join(File.split(__FILE__)[0],'swig.rb')
-require File.join(File.split(__FILE__)[0],'compile.rb')
-
-
-require File.join(File.split(__FILE__)[0],'rookey_config.rb')
-Rookey::Configure.load
-Rookey::Configure.cleanTask
-
-require File.join(File.split(__FILE__)[0],'config_generator.rb')
-require File.join(File.split(__FILE__)[0],'cpp_hierarchy_parser.rb')
-require File.join(File.split(__FILE__)[0],'swig_interface_builder.rb')
-
-require 'rake/clean.rb'
-require 'pp'
-
-# For using Rookey you'll create a Rakefile and include rookey, e.g. like this:
-#  require 'rookey/rookey.rb'
-# After this you're free to use the public methods of the Rookey module to define your
-# projects libraries, sources and so forth.
-#
-# All tasks are designed so that you can take their output as a new target, e.g.:
-#
-module Rookey
-
-  # call like this
-  # swig_interface "antargis_gui"=>Dir["ext/gui/*.h"]+additionalInterfaces,"initalizers"=>["func1","func2",...]
-  # will generate an interface-file named "antargis_gui_interface.i" for module "antargis_gui"
-  def Rookey.swig_interface(ops)
-    target=""
-    source=""
-    inits=[]
-    ops.each{|n,v|
-      case n
-        when :initializers
-          inits=v
-        else
-		      target=n
-		      source=v
-      end
-    }
-    file=target+"_interface.i"
-    templates=[source].flatten.select{|f|f=~/i$/}
-    source=source.grep(/INCLUDE_SWIG/)+[getAGRubyObjectHeader]
-    
-    rule file=>source do
-	    parser=CppHierarchyParser.new([source].flatten.select{|f|f=~/h$/})
-	    classes=parser.getAllClasses
-	    
-	    files=(getOrderedCppHeaders(classes)+source).uniq
-	    interfaceBuilder=SwigInterfaceBuilder.new(file,target,classes,files,source.select{|f|f=~/i$/},inits,templates)
-	    interfaceBuilder.create(parser)
-    end
-    CLEAN << file
-    [file]
-  end
-  
-  def Rookey.swig(ops,config=nil)
-	  target=""
-	  source=""
-	  ops.each{|n,v|
-	    target=n
-	    source=v
-	  }
-	  swigDirect(target,source,config)
-	end
-	
-	def Rookey.swigDirect(output,interface,config=nil)
-	  config||=Rookey::getConfig
-	  swigCompiler=Rookey::Swig.new(config)
-	  
-	  
-	  # FIXME: handle deps
-	  
-	  rule output=>Swig.getDeps(interface) do |t|
-	    swigCompiler.swig(t,interface)
-	  end
-	  CLEAN << output << output.gsub(/\.cc?/,".h")
-	  [output,getAGRubyObjectSource]
-	end
-  def Rookey.getAGRubyObjectSource
-    File.join(File.split(__FILE__)[0],"cpp","ag_rubyobj.cc")
-  end
-  def Rookey.getAGRubyObjectHeader
-    File.join(File.split(__FILE__)[0],"cpp","ag_rubyobj.h")
-  end
-	
-	def Rookey.compile(files,config=nil)
-	  files=[files].flatten
-	  config||=Rookey::getConfig
-	  compiler=Rookey::Compiler.new(config)
-	  files.each{|file|
-	    t=compiler.makeObject(file)
-      s=Compiler.getDeps(file)
-	    rule t=>s do |t|
-	      compiler.compile(t.name,t.prerequisites)
-	    end
-	  }
-	  targets=files.map{|file|compiler.makeObject(file)}
-	  CLEAN << targets << compiler.getBuildDir << Compiler.getDepsDir
-	  targets
-	end
-	
-	def Rookey.link_dll(name,files)
-    files.flatten!
-    files.uniq!
-	  config=Rookey::getConfig
-	  
-    linker=Rookey::Compiler.new(config)
-    
-    target=linker.dllName(name)
-    #pp target
-    desc "Link DLL #{name}"
-    task target=>files do |t|
-      linker.linkDLL(t)
-    end
-    CLEAN << target
-    
-    target
-	end
-
-  def Rookey.link_exe(name,files,config=nil)
-    files.flatten!
-    files << compile(File.join(File.split(__FILE__)[0],"cpp","ag_rubyobj.cc"),config)
-    files << compile(File.join(File.split(__FILE__)[0],"cpp","swig_dummy.cc"),config) if files.select{|f|f=~/swig/}.length==0
-    files.uniq!
-    config||=Rookey::getConfig
-    
-    linker=Rookey::Compiler.new(config)
-    
-    target=linker.exeName(name)
-    desc "Link EXE #{name}"
-    task target=>files do |t|
-      linker.linkEXE(t.name,t.prerequisites)
-    end
-    CLEAN << target
-    
-    target    
-  end 
-
-  
-  def Rookey.ruby_ext(name,files,inits,fallbackInterface=nil)
-    headerFiles=files.select{|f|f=~/h$/}
-    libs=files.select{|f|f=~/so$/ or f=~/bundle/}
-
-    cppFiles=files.select{|f|f=~/c$/}
-
-    sourceDirs=files.map{|file|File.split(file)[0]}.sort.uniq
-
-    Rookey::checkConfig(SwigConfig)
-    
-    config=Rookey::getConfig
-    sourceDirs << "."
-    config.add("INCLUDEDIRS",sourceDirs.join(" "))
-    
-    compiler=Rookey::Compiler.new(config)
-            
-    #FIXME: check if swig is present
-    
-    swigInterfaces=libs.map{|f|f.sub(/\.[a-zA-Z]+$/,".i")}
-    swigInterfaces=files.select{|f|f=~/i$/}
-    swigInterface = Rookey::swig_interface(name=>headerFiles+swigInterfaces,:initializers=>inits)
-    swigTarget = Rookey::swig({File.join(compiler.getPlainBuildDir,name+"_swig.cc")=>swigInterface},config)
-    
-    
-    targets = Rookey::compile(cppFiles+[swigTarget],config)
-    alllibs=libs
-    
-    lib=Rookey::link_dll(name,targets+alllibs)
-  end
-  
-  def Rookey.checkedRequire(name)
-    begin
-    require name
-    rescue LoadError => load_error
-      puts "Library #{name} not found!"
-      return false
-    end
-    return true
-  end
-  
-end
\ No newline at end of file

Deleted: antargis/trunk/rookey/tools.rb
===================================================================
--- antargis/trunk/rookey/tools.rb	2009-02-16 20:01:55 UTC (rev 1284)
+++ antargis/trunk/rookey/tools.rb	2009-02-16 20:12:59 UTC (rev 1285)
@@ -1,37 +0,0 @@
-class Array
-  
-  # *grep* goes through all files given by the filenames that should be contained in *self*
-  # and checks for a given RegEx
-  # example:
-  #
-  #  pp Dir["*.h"].grep(/INCLUDE_SWIG/)
-  #
-  # outputs all filenames of header-files containing the string INCLUDE_SWIG
-  def grep(s)
-    s=/#{s}/ if s.is_a?(String)
-    self.select{|f|
-      fd=File.open(f)
-      result=(s===fd.read)
-      fd.close
-      result
-    }
-  end
-end
-
-module Rookey
-  # creates a directory *dir* and parent-dirs if they don't exist
-  def Rookey.mkdir(dir)
-	  return if File.exists?(dir)
-	  begin
-	    Dir.mkdir(dir.to_s)
-	  rescue
-	    p=File.split(dir)[0]
-	    return if p==dir
-	    Rookey.mkdir(p)
-	    begin
-	      Dir.mkdir(dir)
-	    rescue
-	    end
-	  end
-	end
-end
\ No newline at end of file



From davidkamphausen at mail.berlios.de  Mon Feb 16 21:13:34 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Mon, 16 Feb 2009 21:13:34 +0100
Subject: [Antargis-svn] r1286 - in antargis/trunk: . ext/3dengine ext/basic
	ext/external ext/game ext/gui ext/math ext/sound ext/test
	ext/video main ruby ruby/editor/campaign ruby/entities
Message-ID: <200902162013.n1GKDYNf007029@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-16 21:13:26 +0100 (Mon, 16 Feb 2009)
New Revision: 1286

Removed:
   antargis/trunk/ext/basic/ag_debug.cc
   antargis/trunk/ext/basic/ag_debug.h
   antargis/trunk/ext/basic/ag_exception.h
   antargis/trunk/ext/basic/ag_rtools.cc
   antargis/trunk/ext/basic/ag_rtools.h
   antargis/trunk/ext/basic/ag_string.cc
   antargis/trunk/ext/basic/ag_string.h
   antargis/trunk/ext/basic/ag_tools.cc
   antargis/trunk/ext/basic/ag_tools.h
   antargis/trunk/ext/basic/ag_utf8.cc
   antargis/trunk/ext/basic/ag_utf8.h
Modified:
   antargis/trunk/.project
   antargis/trunk/Rakefile
   antargis/trunk/TODO
   antargis/trunk/antargisStarter.rb
   antargis/trunk/ext/3dengine/ag_glsl.cc
   antargis/trunk/ext/3dengine/ag_glsl.h
   antargis/trunk/ext/3dengine/ag_glwidget.cc
   antargis/trunk/ext/3dengine/anim_mesh.cc
   antargis/trunk/ext/3dengine/anim_mesh.h
   antargis/trunk/ext/3dengine/anim_mesh_data.cc
   antargis/trunk/ext/3dengine/anim_mesh_data.h
   antargis/trunk/ext/3dengine/ant_camera.cc
   antargis/trunk/ext/3dengine/ant_camera.h
   antargis/trunk/ext/3dengine/ant_particle.cc
   antargis/trunk/ext/3dengine/ant_particle.h
   antargis/trunk/ext/3dengine/ant_projection.cc
   antargis/trunk/ext/3dengine/ant_renderer.cc
   antargis/trunk/ext/3dengine/boa_3d_wireframe.cc
   antargis/trunk/ext/3dengine/boa_3d_wireframe.h
   antargis/trunk/ext/3dengine/glsl.h
   antargis/trunk/ext/3dengine/init.cc
   antargis/trunk/ext/3dengine/mesh.cc
   antargis/trunk/ext/3dengine/mesh.h
   antargis/trunk/ext/3dengine/mesh_2d.cc
   antargis/trunk/ext/3dengine/mesh_2d.h
   antargis/trunk/ext/3dengine/mesh_2d_data.cc
   antargis/trunk/ext/3dengine/mesh_2d_data.h
   antargis/trunk/ext/3dengine/mesh_data.cc
   antargis/trunk/ext/3dengine/mesh_data.h
   antargis/trunk/ext/3dengine/mesh_optimizer.cc
   antargis/trunk/ext/3dengine/quadtree.h
   antargis/trunk/ext/3dengine/scene.cc
   antargis/trunk/ext/3dengine/scene.h
   antargis/trunk/ext/3dengine/scene_2d.cc
   antargis/trunk/ext/3dengine/scene_2d.h
   antargis/trunk/ext/3dengine/scene_base.cc
   antargis/trunk/ext/3dengine/scene_base.h
   antargis/trunk/ext/3dengine/scenenode.cc
   antargis/trunk/ext/3dengine/scenenode.h
   antargis/trunk/ext/basic/ag_collector.cc
   antargis/trunk/ext/basic/ag_collector.h
   antargis/trunk/ext/basic/ag_config.cc
   antargis/trunk/ext/basic/ag_config.h
   antargis/trunk/ext/basic/ag_fs.cc
   antargis/trunk/ext/basic/ag_fs.h
   antargis/trunk/ext/basic/ag_geometry.cc
   antargis/trunk/ext/basic/ag_geometry.h
   antargis/trunk/ext/basic/ag_kill.cc
   antargis/trunk/ext/basic/ag_kill.h
   antargis/trunk/ext/basic/ag_main.cc
   antargis/trunk/ext/basic/ag_main.h
   antargis/trunk/ext/basic/ag_message.cc
   antargis/trunk/ext/basic/ag_message.h
   antargis/trunk/ext/basic/ag_messageobject.cc
   antargis/trunk/ext/basic/ag_messageobject.h
   antargis/trunk/ext/basic/ag_mutex.h
   antargis/trunk/ext/basic/ag_plugin.cc
   antargis/trunk/ext/basic/ag_plugin.h
   antargis/trunk/ext/basic/ag_profiler.cc
   antargis/trunk/ext/basic/ag_profiler.h
   antargis/trunk/ext/basic/ag_rand_base.h
   antargis/trunk/ext/basic/ag_serial.cc
   antargis/trunk/ext/basic/ag_serial.h
   antargis/trunk/ext/basic/ag_singleton.cc
   antargis/trunk/ext/basic/ag_singleton.h
   antargis/trunk/ext/basic/ag_string_utf8.cc
   antargis/trunk/ext/basic/ag_string_utf8.h
   antargis/trunk/ext/basic/ag_stringstream.h
   antargis/trunk/ext/basic/ag_video_base.cc
   antargis/trunk/ext/basic/ag_video_base.h
   antargis/trunk/ext/basic/ag_xml.cc
   antargis/trunk/ext/basic/ag_xml.h
   antargis/trunk/ext/basic/init.cc
   antargis/trunk/ext/external/mtwist.h
   antargis/trunk/ext/game/ant_app.cc
   antargis/trunk/ext/game/ant_app.h
   antargis/trunk/ext/game/entity.cc
   antargis/trunk/ext/game/entity.h
   antargis/trunk/ext/game/entptr.cc
   antargis/trunk/ext/game/entptr.h
   antargis/trunk/ext/game/height_map.cc
   antargis/trunk/ext/game/height_map.h
   antargis/trunk/ext/game/heuristic.cc
   antargis/trunk/ext/game/init.cc
   antargis/trunk/ext/game/map.cc
   antargis/trunk/ext/game/map.h
   antargis/trunk/ext/game/minimap.cc
   antargis/trunk/ext/game/minimap.h
   antargis/trunk/ext/game/path.cc
   antargis/trunk/ext/game/path.h
   antargis/trunk/ext/game/terrain.cc
   antargis/trunk/ext/game/terrain.h
   antargis/trunk/ext/game/water.cc
   antargis/trunk/ext/game/water.h
   antargis/trunk/ext/gui/ag_application.cc
   antargis/trunk/ext/gui/ag_application.h
   antargis/trunk/ext/gui/ag_background.cc
   antargis/trunk/ext/gui/ag_button.cc
   antargis/trunk/ext/gui/ag_button.h
   antargis/trunk/ext/gui/ag_caption.cc
   antargis/trunk/ext/gui/ag_checkbox.cc
   antargis/trunk/ext/gui/ag_colorbutton.cc
   antargis/trunk/ext/gui/ag_colorbutton.h
   antargis/trunk/ext/gui/ag_combo.cc
   antargis/trunk/ext/gui/ag_combo.h
   antargis/trunk/ext/gui/ag_edit.cc
   antargis/trunk/ext/gui/ag_edit.h
   antargis/trunk/ext/gui/ag_frame.cc
   antargis/trunk/ext/gui/ag_frame.h
   antargis/trunk/ext/gui/ag_image.cc
   antargis/trunk/ext/gui/ag_image.h
   antargis/trunk/ext/gui/ag_layout.cc
   antargis/trunk/ext/gui/ag_layout.h
   antargis/trunk/ext/gui/ag_layoutfactory.cc
   antargis/trunk/ext/gui/ag_layoutfactory.h
   antargis/trunk/ext/gui/ag_listbox.cc
   antargis/trunk/ext/gui/ag_listbox.h
   antargis/trunk/ext/gui/ag_local.cc
   antargis/trunk/ext/gui/ag_local.h
   antargis/trunk/ext/gui/ag_menu.cc
   antargis/trunk/ext/gui/ag_menu.h
   antargis/trunk/ext/gui/ag_menuitem.cc
   antargis/trunk/ext/gui/ag_menuitem.h
   antargis/trunk/ext/gui/ag_radio.cc
   antargis/trunk/ext/gui/ag_radio.h
   antargis/trunk/ext/gui/ag_radiogroup.cc
   antargis/trunk/ext/gui/ag_radiogroup.h
   antargis/trunk/ext/gui/ag_screenwidget.cc
   antargis/trunk/ext/gui/ag_screenwidget.h
   antargis/trunk/ext/gui/ag_scroller.cc
   antargis/trunk/ext/gui/ag_scroller.h
   antargis/trunk/ext/gui/ag_table.cc
   antargis/trunk/ext/gui/ag_table.h
   antargis/trunk/ext/gui/ag_text.cc
   antargis/trunk/ext/gui/ag_text.h
   antargis/trunk/ext/gui/ag_theme.cc
   antargis/trunk/ext/gui/ag_theme.h
   antargis/trunk/ext/gui/ag_theme_v2.cc
   antargis/trunk/ext/gui/ag_theme_v2.h
   antargis/trunk/ext/gui/ag_tooltip.cc
   antargis/trunk/ext/gui/ag_tooltip.h
   antargis/trunk/ext/gui/ag_widget.cc
   antargis/trunk/ext/gui/ag_widget.h
   antargis/trunk/ext/gui/ag_window.cc
   antargis/trunk/ext/gui/ag_window.h
   antargis/trunk/ext/gui/init.cc
   antargis/trunk/ext/math/ag_algebra.cc
   antargis/trunk/ext/math/ag_algebra.h
   antargis/trunk/ext/math/ag_rand.cc
   antargis/trunk/ext/math/ag_rand.h
   antargis/trunk/ext/math/ant_frustum.cc
   antargis/trunk/ext/math/init.cc
   antargis/trunk/ext/sound/ag_mixer.cc
   antargis/trunk/ext/sound/ag_mixer.h
   antargis/trunk/ext/sound/init.cc
   antargis/trunk/ext/test/gl_text_3d.cc
   antargis/trunk/ext/video/ag_clip_painttarget.cc
   antargis/trunk/ext/video/ag_clip_painttarget.h
   antargis/trunk/ext/video/ag_color.cc
   antargis/trunk/ext/video/ag_color.h
   antargis/trunk/ext/video/ag_fbo.h
   antargis/trunk/ext/video/ag_font.h
   antargis/trunk/ext/video/ag_fontengine.cc
   antargis/trunk/ext/video/ag_fontengine.h
   antargis/trunk/ext/video/ag_glpainter.cc
   antargis/trunk/ext/video/ag_glscreen.cc
   antargis/trunk/ext/video/ag_glscreen.h
   antargis/trunk/ext/video/ag_gltexture.cc
   antargis/trunk/ext/video/ag_gradient.cc
   antargis/trunk/ext/video/ag_painter.cc
   antargis/trunk/ext/video/ag_painter.h
   antargis/trunk/ext/video/ag_painttarget.h
   antargis/trunk/ext/video/ag_projection.cc
   antargis/trunk/ext/video/ag_projection.h
   antargis/trunk/ext/video/ag_rendercontext.cc
   antargis/trunk/ext/video/ag_screen.cc
   antargis/trunk/ext/video/ag_screen.h
   antargis/trunk/ext/video/ag_sdlscreen.cc
   antargis/trunk/ext/video/ag_surface.cc
   antargis/trunk/ext/video/ag_surface.h
   antargis/trunk/ext/video/ag_surfacemanager.cc
   antargis/trunk/ext/video/ag_surfacemanager.h
   antargis/trunk/ext/video/ag_texture.cc
   antargis/trunk/ext/video/ag_texture.h
   antargis/trunk/ext/video/ag_texturecache.h
   antargis/trunk/ext/video/ag_vdebug.cc
   antargis/trunk/ext/video/ag_vdebug.h
   antargis/trunk/ext/video/ag_video.cc
   antargis/trunk/ext/video/init.cc
   antargis/trunk/main/starter.cc
   antargis/trunk/ruby/ant_tools.rb
   antargis/trunk/ruby/antargislib.rb
   antargis/trunk/ruby/editor/campaign/drag_grid.rb
   antargis/trunk/ruby/editor/campaign/ruby_layouts.rb
   antargis/trunk/ruby/editor/campaign/ruby_tools.rb
   antargis/trunk/ruby/entities/ant_house.rb
Log:
big cleanup

Modified: antargis/trunk/.project
===================================================================
--- antargis/trunk/.project	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/.project	2009-02-16 20:13:26 UTC (rev 1286)
@@ -10,38 +10,34 @@
 			<triggers>clean,full,incremental,</triggers>
 			<arguments>
 				<dictionary>
-					<key>org.eclipse.cdt.make.core.fullBuildTarget</key>
-					<value>all</value>
+					<key>?children?</key>
+					<value>?name?=outputEntries\|?children?=?name?=entry\\\\\\\\\\\\\\\|\\\\\\\|\||</value>
 				</dictionary>
 				<dictionary>
-					<key>org.eclipse.cdt.make.core.buildLocation</key>
-					<value>${workspace_loc:/antargis}</value>
+					<key>?name?</key>
+					<value></value>
 				</dictionary>
 				<dictionary>
-					<key>org.eclipse.cdt.make.core.enableAutoBuild</key>
-					<value>false</value>
+					<key>org.eclipse.cdt.make.core.append_environment</key>
+					<value>true</value>
 				</dictionary>
 				<dictionary>
-					<key>?name?</key>
-					<value></value>
+					<key>org.eclipse.cdt.make.core.autoBuildTarget</key>
+					<value>all</value>
 				</dictionary>
 				<dictionary>
-					<key>?children?</key>
-					<value>?name?=outputEntries\|?children?=?name?=entry\\\\\\\\\\\\\\\|\\\\\\\|\||</value>
+					<key>org.eclipse.cdt.make.core.buildArguments</key>
+					<value></value>
 				</dictionary>
 				<dictionary>
-					<key>org.eclipse.cdt.make.core.enableFullBuild</key>
-					<value>true</value>
+					<key>org.eclipse.cdt.make.core.buildCommand</key>
+					<value>make</value>
 				</dictionary>
 				<dictionary>
-					<key>org.eclipse.cdt.make.core.enableCleanBuild</key>
-					<value>true</value>
+					<key>org.eclipse.cdt.make.core.buildLocation</key>
+					<value>${workspace_loc:/antargis}</value>
 				</dictionary>
 				<dictionary>
-					<key>org.eclipse.cdt.make.core.append_environment</key>
-					<value>true</value>
-				</dictionary>
-				<dictionary>
 					<key>org.eclipse.cdt.make.core.cleanBuildTarget</key>
 					<value>clean</value>
 				</dictionary>
@@ -50,25 +46,29 @@
 					<value>org.eclipse.cdt.make.core.activeConfigSettings</value>
 				</dictionary>
 				<dictionary>
-					<key>org.eclipse.cdt.make.core.useDefaultBuildCmd</key>
-					<value>true</value>
+					<key>org.eclipse.cdt.make.core.enableAutoBuild</key>
+					<value>false</value>
 				</dictionary>
 				<dictionary>
-					<key>org.eclipse.cdt.make.core.buildArguments</key>
-					<value></value>
+					<key>org.eclipse.cdt.make.core.enableCleanBuild</key>
+					<value>true</value>
 				</dictionary>
 				<dictionary>
-					<key>org.eclipse.cdt.make.core.buildCommand</key>
-					<value>make</value>
+					<key>org.eclipse.cdt.make.core.enableFullBuild</key>
+					<value>true</value>
 				</dictionary>
 				<dictionary>
-					<key>org.eclipse.cdt.make.core.autoBuildTarget</key>
+					<key>org.eclipse.cdt.make.core.fullBuildTarget</key>
 					<value>all</value>
 				</dictionary>
 				<dictionary>
 					<key>org.eclipse.cdt.make.core.stopOnError</key>
 					<value>true</value>
 				</dictionary>
+				<dictionary>
+					<key>org.eclipse.cdt.make.core.useDefaultBuildCmd</key>
+					<value>true</value>
+				</dictionary>
 			</arguments>
 		</buildCommand>
 		<buildCommand>

Modified: antargis/trunk/Rakefile
===================================================================
--- antargis/trunk/Rakefile	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/Rakefile	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,5 @@
-require File.join(File.split(__FILE__)[0],'rookey','tasks.rb')
+$: << "rookey/lib"
+require 'rookey.rb'
 
 $rspec=Rookey.checkedRequire('spec/rake/spectask')
 

Modified: antargis/trunk/TODO
===================================================================
--- antargis/trunk/TODO	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/TODO	2009-02-16 20:13:26 UTC (rev 1286)
@@ -62,16 +62,7 @@
 [[Development]]
 ==========================================================
 
-[Segfaults]
-------------------------------------------------------
-None known.
 
-[AI]
-------------------------------------------------------
-[H] heuristic compression for path-finding
-[H] map-weighting based on min/max of surrounding
-
-
 [Gui/View - GUI-library]
 ------------------------------------------------------
 [H] fix texture-painting on GeForce - backgrounds are always black, but they should be transparent (like FPS-display)
@@ -157,10 +148,6 @@
 [VL] story-telling:
 	- browsing facility (scene=>number(person)=>text)
 
-[Artificial Intelligence]
-------------------------------------------------------
-[L] computer-player only attacks when stock is used up
-
 [Multiplayer]
 ------------------------------------------------------
 [M] choosing/making player for multiplayer

Modified: antargis/trunk/antargisStarter.rb
===================================================================
--- antargis/trunk/antargisStarter.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/antargisStarter.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -2,10 +2,23 @@
 
 # run intro - mainmenu will be called automatically
 
+def puts(*s)
+  $debugFile||=File.open("antargisSt.log","w")
+  $debugFile.puts(*s)
+  $debugFile.flush
+end
+puts "MY LOG"
+puts "MY LOG2"
+
 Dir.chdir(File.split(__FILE__)[0])
-
-require 'ruby/intro.rb'
+puts "MY LOG2"
+puts Dir.pwd
+puts $:
+puts "--"
+require File.join('ruby','intro.rb')
+puts "MY LOG2"
 require 'ruby/mainmenu.rb'
+puts "MY LOG2"
 
 
 

Modified: antargis/trunk/ext/3dengine/ag_glsl.cc
===================================================================
--- antargis/trunk/ext/3dengine/ag_glsl.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ag_glsl.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -2,7 +2,6 @@
 #include "ag_glsl.h"
 #include "ag_vdebug.h"
 #include "ag_main.h"
-//#include "scene.h"
 
 std::map<std::string,AGVertexProgram*> mVertexPrograms;
 std::map<std::string,AGFragProgram*> mFragPrograms;

Modified: antargis/trunk/ext/3dengine/ag_glsl.h
===================================================================
--- antargis/trunk/ext/3dengine/ag_glsl.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ag_glsl.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,8 +22,7 @@
 #define AG_GLSL_H
 
 #include "ag_gl.h"
-//#include "renderer.h"
-#include "ag_tools.h"
+#include "rk_tools.h"
 #include "ag_geometry.h"
 
 #include <map>
@@ -62,7 +61,7 @@
 class AGEXPORT AGShaderParameter
 {
  public:
-  
+
 };
 
 class AGEXPORT AGShaderProgram
@@ -74,7 +73,7 @@
   float *matrixBuf;
   bool on;
   std::string name;
- protected:  
+ protected:
   GLhandleARB p;
 
  public:

Modified: antargis/trunk/ext/3dengine/ag_glwidget.cc
===================================================================
--- antargis/trunk/ext/3dengine/ag_glwidget.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ag_glwidget.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,6 @@
+#include "rk_debug.h"
+
 #include "ag_glwidget.h"
-#include "ag_debug.h"
 #include "ag_screen.h"
 #include <GL/glu.h>
 
@@ -10,9 +11,9 @@
 
 void AGGLWidget::drawGL()
 {
-  
+
 }
-  
+
 void AGGLWidget::drawAll(AGPainter &p)
 {
   beginGL();
@@ -48,9 +49,9 @@
   glDepthMask(true);
   glEnable(GL_DEPTH_TEST);
   glEnable(GL_LIGHTING);
-  
-  
-  
+
+
+
 }
 
 float AGGLWidget::getRatio() const

Modified: antargis/trunk/ext/3dengine/anim_mesh.cc
===================================================================
--- antargis/trunk/ext/3dengine/anim_mesh.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/anim_mesh.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -88,7 +88,7 @@
 
   }
 
-AnimMesh::~AnimMesh()
+AnimMesh::~AnimMesh() throw()
   {
     //  CTRACE;
   }
@@ -383,7 +383,7 @@
     return true;
   }
 
-void AnimMesh::mark()
+void AnimMesh::mark() throw()
   {
     markObject(mData);
   }

Modified: antargis/trunk/ext/3dengine/anim_mesh.h
===================================================================
--- antargis/trunk/ext/3dengine/anim_mesh.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/anim_mesh.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -37,7 +37,7 @@
 
 public:
   AnimMesh(Scene *pScene,AnimMeshData *data);
-  virtual ~AnimMesh();
+  virtual ~AnimMesh() throw();
 
   void setTransform(const AGMatrix4 &m);
 
@@ -55,7 +55,7 @@
   virtual void drawPick();
   virtual void advance(float time);
 
-  virtual void mark();
+  virtual void mark() throw();
 
   void setEntity(AntEntity *e);
 

Modified: antargis/trunk/ext/3dengine/anim_mesh_data.cc
===================================================================
--- antargis/trunk/ext/3dengine/anim_mesh_data.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/anim_mesh_data.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -118,7 +118,7 @@
     mName=AGString(xmlFilename);
   }
 
-AnimMeshData::~AnimMeshData()
+AnimMeshData::~AnimMeshData() throw()
   {
     CTRACE;
     cdebug(mName);

Modified: antargis/trunk/ext/3dengine/anim_mesh_data.h
===================================================================
--- antargis/trunk/ext/3dengine/anim_mesh_data.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/anim_mesh_data.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -92,7 +92,7 @@
 
  public:
   AnimMeshData(const AGString &xmlFilename);
-  ~AnimMeshData();
+  ~AnimMeshData() throw();
 
   AGBox3 bbox() const;
 

Modified: antargis/trunk/ext/3dengine/ant_camera.cc
===================================================================
--- antargis/trunk/ext/3dengine/ant_camera.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_camera.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #include <SDL_opengl.h>
 #include <math.h>
 
-#include "ag_debug.h"
+#include "rk_debug.h"
 
 AntCamera::AntCamera(int w,int h)
   {
@@ -100,7 +100,7 @@
 
 
 
-        lp=AGVector4(-0.5,1.5,-0.5,1); // should be something like this 
+        lp=AGVector4(-0.5,1.5,-0.5,1); // should be something like this
         lp*=100;
 
 

Modified: antargis/trunk/ext/3dengine/ant_camera.h
===================================================================
--- antargis/trunk/ext/3dengine/ant_camera.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_camera.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,10 +23,11 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
+#include <rk_rubyobj.h>
+
 #include "ag_gl.h"
 #include <ant_frustum.h>
 #include <ant_projection.h>
-#include <ag_rubyobj.h>
 
 /**
    \brief a camera object for moving over a height map
@@ -77,7 +78,7 @@
 
 
   /// this position is changed when moving around
-  AGVector4 scenePosition; 
+  AGVector4 scenePosition;
   /// camera and light position are fixed - to be understand as relative positions to scenePosition
   AGVector4 cameraPosition;
   AGVector4 lightPosition;
@@ -88,7 +89,7 @@
   AGMatrix4 cameraPick;
 
   /// use perspective shadow maps ?
-  bool mPSM; 
+  bool mPSM;
 
   int mWidth,mHeight;
 };

Modified: antargis/trunk/ext/3dengine/ant_particle.cc
===================================================================
--- antargis/trunk/ext/3dengine/ant_particle.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_particle.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -45,7 +45,7 @@
     enabled=true;
   }
 
-AntParticle::~AntParticle()
+AntParticle::~AntParticle() throw()
   {
     for(std::list<Piece*>::iterator i=mPieces.begin();i!=mPieces.end();i++)
       delete *i;

Modified: antargis/trunk/ext/3dengine/ant_particle.h
===================================================================
--- antargis/trunk/ext/3dengine/ant_particle.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_particle.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -38,7 +38,7 @@
   /// make some smoke (or fire) in Scene pScene with output frequency f
   AntParticle(Scene *pScene,float f);
   
-  virtual ~AntParticle();
+  virtual ~AntParticle() throw();
 
   /// if f is true this object will display a fire - otherwise it's smoke
   /// default is smoke

Modified: antargis/trunk/ext/3dengine/ant_projection.cc
===================================================================
--- antargis/trunk/ext/3dengine/ant_projection.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_projection.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,7 @@
 #include "ant_projection.h"
-#include <ag_debug.h>
 
+#include <rk_debug.h>
+
 #include <GL/glu.h>
 
 
@@ -20,7 +21,7 @@
 
   GLdouble mv[16],pr[16];
   for(int i=0;i<16;i++)
-    { 
+    {
       mv[i]=((const float*)modelview)[i];
       pr[i]=((const float*)projection)[i];
     }
@@ -35,7 +36,7 @@
 
   GLdouble mv[16],pr[16];
   for(int i=0;i<16;i++)
-    { 
+    {
       mv[i]=((const float*)modelview)[i];
       pr[i]=((const float*)projection)[i];
     }

Modified: antargis/trunk/ext/3dengine/ant_renderer.cc
===================================================================
--- antargis/trunk/ext/3dengine/ant_renderer.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_renderer.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,9 +1,9 @@
 #include "ant_renderer.h"
 #include "scene.h"
 #include "ag_vdebug.h"
-#include "ag_kill.h"
 #include "ag_config.h"
 #include "ag_fbo.h"
+#include "ag_kill.h"
 
 Renderer *gRenderer=0;
 

Modified: antargis/trunk/ext/3dengine/boa_3d_wireframe.cc
===================================================================
--- antargis/trunk/ext/3dengine/boa_3d_wireframe.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/boa_3d_wireframe.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include "boa_3d_wireframe.h"
 #include <ag_rendercontext.h>
-#include <ag_debug.h>
+#include <rk_debug.h>
 
 Boa3dWireframe::Boa3dWireframe(Scene *pScene,const AGVector4 &pColor,float pWidth):
   SceneNode(pScene,AGVector4(0,0,0,0),AGBox3(AGVector3(0,0,0),AGVector3(100,100,100))),
@@ -10,6 +10,9 @@
   mChanged=true;
 }
 
+Boa3dWireframe::~Boa3dWireframe() throw()
+  {}
+
 void Boa3dWireframe::draw()
 {
   //  std::cout<<"Mcdebug("<<std::endl;
@@ -20,7 +23,7 @@
       // update vertex array
     }
 
-  
+
   AGRenderContext c;
   glLineWidth(mWidth);
 
@@ -32,7 +35,7 @@
   c.setColor(mColor);
   c.begin();
   glBegin(GL_LINES);
- 
+
   for(std::vector<Line>::iterator i=mLines.begin();i!=mLines.end();i++)
     {
       glVertex3fv((float*)a);
@@ -41,10 +44,10 @@
       glVertex3fv((float*)i->b);
     }
   glEnd();
-  
 
-  
 
+
+
 }
 
 void Boa3dWireframe::addLine(const AGVector3 &a,const AGVector3 &b)

Modified: antargis/trunk/ext/3dengine/boa_3d_wireframe.h
===================================================================
--- antargis/trunk/ext/3dengine/boa_3d_wireframe.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/boa_3d_wireframe.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -15,6 +15,7 @@
 
  public:
   Boa3dWireframe(Scene *pScene,const AGVector4 &pColor,float pWidth);
+  virtual ~Boa3dWireframe() throw();
 
   void draw();
 

Modified: antargis/trunk/ext/3dengine/glsl.h
===================================================================
--- antargis/trunk/ext/3dengine/glsl.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/glsl.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,8 +1,9 @@
 #ifndef ANT_GLSL_H
 #define ANT_GLSL_H
 
+#include "rk_tools.h"
+
 #include "ant_renderer.h"
-#include "ag_tools.h"
 #include "ag_geometry.h"
 #include "ag_glscreen.h"
 
@@ -42,7 +43,7 @@
 class AGEXPORT AntShaderParameter
 {
  public:
-  
+
 };
 
 class AGEXPORT AntShaderProgram:public AGGLObject
@@ -56,7 +57,7 @@
   bool on;
   std::string name;
 
- protected:  
+ protected:
   GLhandleARB p;
 
  public:

Modified: antargis/trunk/ext/3dengine/init.cc
===================================================================
--- antargis/trunk/ext/3dengine/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,4 @@
-#include <ag_debug.h>
+#include <rk_debug.h>
 
 AGEXPORT void AG_Init_libantargis3dengine()
 {

Modified: antargis/trunk/ext/3dengine/mesh.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -34,7 +34,7 @@
     mVisible=true;
   }
 
-Mesh::~Mesh()
+Mesh::~Mesh() throw()
   {
   }
 
@@ -142,7 +142,7 @@
   }
 
 
-void Mesh::mark()
+void Mesh::mark() throw()
   {
     markObject(getData());
   }

Modified: antargis/trunk/ext/3dengine/mesh.h
===================================================================
--- antargis/trunk/ext/3dengine/mesh.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -27,7 +27,7 @@
  public:
   Mesh(Scene *pScene);
   Mesh(Scene *pScene,MeshData &data,const AGVector4 &pPos,float pRot);
-  virtual ~Mesh();
+  virtual ~Mesh()  throw();
 
   void draw();
   void drawDepth();
@@ -46,7 +46,7 @@
 
   MeshData *getData();
 
-  void mark();
+  void mark() throw();
 
   virtual bool transparent();
 

Modified: antargis/trunk/ext/3dengine/mesh_2d.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh_2d.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_2d.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,5 @@
 #include "mesh_2d.h"
-#include <ag_debug.h>
+#include <rk_debug.h>
 #include <ag_painter.h>
 
 Mesh2D::Mesh2D(Scene2D *pScene):
@@ -11,7 +11,7 @@
   mData(&data)
 {
 }
-Mesh2D::~Mesh2D()
+Mesh2D::~Mesh2D() throw()
 {
 }
 
@@ -74,7 +74,7 @@
   return mData;
 }
 
-void Mesh2D::mark()
+void Mesh2D::mark() throw()
 {
   markObject(mData);
 }
@@ -87,7 +87,7 @@
       // check if texture is !=transparent there
       AGVector2 p=screenPos-dRect.getV0();
       return mData->getTexture()->getPixel(p[0],p[1]).a>10; // some threshold here
-      
+
     }
   return false;
 }

Modified: antargis/trunk/ext/3dengine/mesh_2d.h
===================================================================
--- antargis/trunk/ext/3dengine/mesh_2d.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_2d.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -13,7 +13,7 @@
  public:
   Mesh2D(Scene2D *pScene);
   Mesh2D(Scene2D *pScene,Mesh2DData &data,const AGVector4 &pPos,float pRot);
-  virtual ~Mesh2D();
+  virtual ~Mesh2D() throw();
 
   void draw();
 
@@ -27,7 +27,7 @@
 
   Mesh2DData *getData();
 
-  void mark();
+  void mark() throw();
 
   bool hit(const AGVector2 &screenPos);
 

Modified: antargis/trunk/ext/3dengine/mesh_2d_data.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh_2d_data.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_2d_data.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -5,7 +5,7 @@
 {
 }
   
-void Mesh2DData::mark()
+void Mesh2DData::mark() throw()
 {
   markObject(mTexture);
 }

Modified: antargis/trunk/ext/3dengine/mesh_2d_data.h
===================================================================
--- antargis/trunk/ext/3dengine/mesh_2d_data.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_2d_data.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -10,7 +10,7 @@
  public:
   Mesh2DData(AGTexture *pTexture);
   
-  void mark();
+  void mark() throw();
 
   AGTexture *getTexture();
 

Modified: antargis/trunk/ext/3dengine/mesh_data.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh_data.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_data.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -124,7 +124,7 @@
   mPickable=true;
 }
 
-MeshData::~MeshData()
+MeshData::~MeshData() throw()
   {
     //  TRACE;
   }

Modified: antargis/trunk/ext/3dengine/mesh_data.h
===================================================================
--- antargis/trunk/ext/3dengine/mesh_data.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_data.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -30,7 +30,7 @@
  public:
   MeshData(const std::string &filename,float zoom,const std::string &pTexture="",bool pShadow=true);
   MeshData(const VertexArray &va,const std::string &pTexture,bool pShadow=true);
-  ~MeshData();
+  ~MeshData() throw();
 
   void draw(const AGVector4 &pColor);
   void drawShadow();

Modified: antargis/trunk/ext/3dengine/mesh_optimizer.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh_optimizer.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_optimizer.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,5 @@
 #include "mesh_optimizer.h"
-#include <ag_debug.h>
+#include <rk_debug.h>
 #include <ag_serial.h>
 
 //////////////////////////////////////////////////////////////////////
@@ -18,12 +18,12 @@
     if(c[i]<p.c[i])
       return true;
 
-  for(i=0;i<3;i++) 
-    if(n[i]<p.n[i]) 
-      return true; 
+  for(i=0;i<3;i++)
+    if(n[i]<p.n[i])
+      return true;
 
   for(i=0;i<2;i++)
-    if(t[i]<p.t[i]) 
+    if(t[i]<p.t[i])
       return true;
 
   return false;
@@ -99,7 +99,7 @@
     for(size_t i=0;i<mIndices.size();i+=3)
       {
         tris.push_back(MeshTriangle(mIndices[i],mIndices[i+1],mIndices[i+2]));
-      }  
+      }
     sort(tris.begin(),tris.end(),TriCompare(this,AGVector3(0,-10,10)));
 
     for(std::vector<MeshTriangle>::iterator i=tris.begin();i!=tris.end();i++)

Modified: antargis/trunk/ext/3dengine/quadtree.h
===================================================================
--- antargis/trunk/ext/3dengine/quadtree.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/quadtree.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,7 +22,7 @@
 #define QUADTREE_H
 
 #include <ag_geometry.h>
-#include <ag_debug.h>
+#include <rk_debug.h>
 
 #include <set>
 

Modified: antargis/trunk/ext/3dengine/scene.cc
===================================================================
--- antargis/trunk/ext/3dengine/scene.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -2,10 +2,8 @@
 #include "scene.h"
 
 #include <SDL_opengl.h>
-//#include <GL/gl.h>
-//#include <GL/glu.h>
 
-#include <ag_debug.h>
+#include <rk_debug.h>
 #include <ag_vdebug.h>
 #include <ag_video.h>
 #include <ag_rendercontext.h>
@@ -45,7 +43,7 @@
   }
 
 
-Scene::~Scene()
+Scene::~Scene() throw()
   {
   }
 
@@ -254,7 +252,7 @@
         glNewList(displayList,GL_COMPILE);
 #endif
 
-        STACKTRACE; 
+        STACKTRACE;
 
         // this is used for frustum cullin
         AntFrustum cFrustum=mCamera.getCameraProjection().getFrustum();
@@ -441,7 +439,7 @@
 
     ptr = (GLuint *) buffer;
     minZ = 0xffffffff;
-    for (i = 0; i < (unsigned int)hits; i++) { 
+    for (i = 0; i < (unsigned int)hits; i++) {
       names = *ptr;
       ptr++;
       if (*ptr < minZ) {

Modified: antargis/trunk/ext/3dengine/scene.h
===================================================================
--- antargis/trunk/ext/3dengine/scene.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -45,7 +45,7 @@
   ////  typedef std::list<SceneNode*> NodeList;
 
   Scene(int w,int h);
-  virtual ~Scene();
+  virtual ~Scene() throw();
 
   void draw();
 

Modified: antargis/trunk/ext/3dengine/scene_2d.cc
===================================================================
--- antargis/trunk/ext/3dengine/scene_2d.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene_2d.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,14 +3,14 @@
 #include "scene_2d.h"
 #include "mesh_2d.h"
 #include "mesh_sort.h"
-#include <ag_debug.h>
+#include <rk_debug.h>
 
 Scene2D::Scene2D(int w,int h):
   SceneBase(w,h),mPainter(0)
   {
   }
 
-Scene2D::~Scene2D()
+Scene2D::~Scene2D() throw()
   {
   }
 

Modified: antargis/trunk/ext/3dengine/scene_2d.h
===================================================================
--- antargis/trunk/ext/3dengine/scene_2d.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene_2d.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -12,7 +12,7 @@
   typedef std::list<SceneNode*> NodeList;
 
   Scene2D(int w,int h);
-  virtual ~Scene2D();
+  virtual ~Scene2D() throw();
 
   void draw();
 

Modified: antargis/trunk/ext/3dengine/scene_base.cc
===================================================================
--- antargis/trunk/ext/3dengine/scene_base.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene_base.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -11,7 +11,7 @@
   }
 
 
-SceneBase::~SceneBase()
+SceneBase::~SceneBase() throw()
   {
     // tell nodes, that I'm no longer there :-)
     for(Nodes::iterator i=mNodes.begin();i!=mNodes.end();i++)
@@ -74,7 +74,7 @@
       }
   }
 
-void SceneBase::clear()
+void SceneBase::clear() throw()
   {
     for(std::vector<SceneNode*>::iterator i=mNodes.begin();i!=mNodes.end();i++)
       {
@@ -121,7 +121,7 @@
   return mCamera.getHeight();
 }
 
-void SceneBase::mark()
+void SceneBase::mark() throw()
   {
     //  std::cout<<"SceneBase::mark()"<<std::endl;
     SceneBase::Nodes::iterator i=mNodes.begin();

Modified: antargis/trunk/ext/3dengine/scene_base.h
===================================================================
--- antargis/trunk/ext/3dengine/scene_base.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene_base.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -35,7 +35,7 @@
   //
 
   SceneBase(int w,int h);
-  virtual ~SceneBase();
+  virtual ~SceneBase() throw();
 
 //  void draw();
 
@@ -46,7 +46,7 @@
   void prepareUpdate(SceneNode *node);
   void updatePos(SceneNode *node);
 
-  void clear();
+  void clear() throw();
 
   // (mx,my,0)
   void setCamera(AGVector4 v);
@@ -69,7 +69,7 @@
   float width() const;
   float height() const;
 
-  void mark();
+  void mark() throw();
 
 
   /** get currently visible nodes */

Modified: antargis/trunk/ext/3dengine/scenenode.cc
===================================================================
--- antargis/trunk/ext/3dengine/scenenode.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scenenode.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include "scenenode.h"
 #include "scene.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 
 SceneNode::SceneNode(SceneBase *s,const AGVector4 &pPos,const AGBox3 &b):
   mPos(pPos),mBBox(b)
@@ -14,7 +14,7 @@
     mScene->addNode(this);
 }
 
-SceneNode::~SceneNode()
+SceneNode::~SceneNode() throw()
 {
   if(mScene)
     mScene->removeNode(this);
@@ -35,7 +35,7 @@
   mScene=0;
 }
 
-/// this function is deprecated. It was once used for drawing 
+/// this function is deprecated. It was once used for drawing
 /// shadow in a 3rd render-pass.
 void SceneNode::drawShadow()
 {
@@ -120,7 +120,7 @@
 }
 
 
-void SceneNode::clear()
+void SceneNode::clear() throw()
 {
   //  cdebug(typeid(*this).name());
   if(mScene)

Modified: antargis/trunk/ext/3dengine/scenenode.h
===================================================================
--- antargis/trunk/ext/3dengine/scenenode.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scenenode.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,8 +3,9 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
+#include <rk_rubyobj.h>
+
 #include <ag_geometry.h>
-#include <ag_rubyobj.h>
 
 class SceneBase;
 
@@ -25,7 +26,7 @@
    A scenenode is created for exactly one scene and it can't be
    assigned to any other scene, which shouldn't be necessary.
 
-   Scene and SceneNode give each other information about their 
+   Scene and SceneNode give each other information about their
    "destroy-state". That means the destructor notifies the other object.
 
 */
@@ -33,7 +34,7 @@
 {
  public:
   SceneNode(SceneBase *s,const AGVector4 &pPos,const AGBox3 &pBox);
-  virtual ~SceneNode();
+  virtual ~SceneNode() throw();
 
   /// reset my scene pointer - should not be called in "normal" code - only by the Scene-object
   virtual void resetScene();
@@ -68,7 +69,7 @@
   AGBox3 bbox() const;
   AGRect2 getRect() const;
 
-  virtual void clear();
+  virtual void clear() throw();
 
   SceneBase *getScene();
   /// this checks, if the current object is inserted into a scene
@@ -80,7 +81,7 @@
   /// there is a drawing order, used by the scene-manager, which priorized. look at Scene::drawScene for more info.
   void setOrder(int o);
   int getOrder() const;
-  
+
  private:
   void setScene(SceneBase *pScene);
 

Modified: antargis/trunk/ext/basic/ag_collector.cc
===================================================================
--- antargis/trunk/ext/basic/ag_collector.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_collector.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,7 +1,12 @@
 #include <ag_collector.h>
-#include <ag_debug.h>
+#include <rk_debug.h>
 #include <ag_main.h>
 
+AGCollector::~AGCollector() throw()
+  {
+
+  }
+
 void AGCollector::insertGlobal(AGRubyObject *pObject)
   {
     // cdebug(pObject<<":"<<typeid(*pObject).name());
@@ -14,7 +19,7 @@
     mGlobals.erase(pObject);
   }
 
-void AGCollector::mark()
+void AGCollector::mark() throw()
   {
     for(std::set<AGRubyObject*>::iterator i=mGlobals.begin();i!=mGlobals.end();i++)
       {

Modified: antargis/trunk/ext/basic/ag_collector.h
===================================================================
--- antargis/trunk/ext/basic/ag_collector.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_collector.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,21 +1,22 @@
 #ifndef AG_COLLECTOR_H
 #define AG_COLLECTOR_H
 
-#include <ag_base.h>
-#include <ag_rubyobj.h>
+#include <rk_base.h>
+#include <rk_rubyobj.h>
 
 #include <set>
 
 class AGEXPORT AGCollector:public AGRubyObject
 {
  public:
+   ~AGCollector() throw();
   void insertGlobal(AGRubyObject *pObject);
   void removeGlobal(AGRubyObject *pObject);
 
-  virtual void mark();
+  virtual void mark() throw ();
  private:
   std::set<AGRubyObject*> mGlobals;
-  
+
 };
 
 AGEXPORT AGCollector *getCollector();

Modified: antargis/trunk/ext/basic/ag_config.cc
===================================================================
--- antargis/trunk/ext/basic/ag_config.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_config.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,6 @@
 #include "ag_config.h"
 #include "ag_xml.h"
+#include "ag_fs.h"
 
 // TODO: AGConfig should switch to a ruby-based configuration (maybe YAML)
 // TODO: commenting should be possible !! (no overwriting)

Modified: antargis/trunk/ext/basic/ag_config.h
===================================================================
--- antargis/trunk/ext/basic/ag_config.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_config.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,8 +23,9 @@
 #ifndef AG_CONFIG_H
 #define AG_CONFIG_H
 
+#include <rk_string.h>
+
 #include <map>
-#include <ag_string.h>
 
 class AGEXPORT AGConfig
 {

Deleted: antargis/trunk/ext/basic/ag_debug.cc
===================================================================
--- antargis/trunk/ext/basic/ag_debug.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_debug.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,141 +0,0 @@
-/*
- * Copyright (c) 2005 by David Kamphausen. All rights reserved.
- *
- * ag_debug.cc
- * by David Kamphausen (david.kamphausen at web.de)
- *
- * The "Antargis" project, including all files needed to compile it,
- * is free software; you can redistribute it and/or use it and/or modify it
- * under the terms of the GNU General Public License as published
- * by the Free Software Foundation; either version 2 of the License,
- * or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
- *
- * You should have received a copy of the GNU General Public
- * License along with this program.
- */
-
-#include "ag_debug.h"
-#include "ag_main.h"
-
-#include <fstream>
-#include <iostream>
-
-#ifdef __WIN32__
-#include <winsock2.h>
-#endif
-#include <ruby.h>
-#include <SDL.h>
-
-bool quietLog=false;
-void setQuiet()
-  {
-    quietLog=true;
-  }
-
-static bool gRubyRaising=false;
-void agRaise(const std::string &s)
-  {
-    cdebug("assertion failed:"<<s);
-    if(gRubyRaising)
-      rb_raise(rb_eRuntimeError,s.c_str(),"");
-    else
-      throw std::runtime_error(s);
-  }
-
-void setRubyRaising(bool flag)
-  {
-    gRubyRaising=flag;
-  }
-
-size_t gDebugLevel=0;
-
-size_t getDebugLevel()
-  {
-    return gDebugLevel;
-  }
-void setDebugLevel(size_t t)
-  {
-    gDebugLevel=t;
-  }
-
-
-#ifndef MNDEBUG
-int D::d=0;
-
-std::ofstream debugOFS("debug.txt");
-
-std::ostream &getDebug()
-  {
-    if(quietLog)
-      return debugOFS;
-    else
-      return std::cout;
-  }
-
-size_t gDebugIndex=0;
-
-size_t getDebugIndex()
-  {
-    return gDebugIndex;
-  }
-
-
-
-D::D(std::string c):
-  m(c)
-  {
-    indent();
-    gDebugIndex++;
-
-    debugout_checked(2,"start of:"<<c<<"("<<gDebugIndex<<")"<<std::endl);
-    d++;
-  }
-AGEXPORT D::~D()
-  {
-    d--;
-    indent();
-    debugout_checked(2,"end   of:"<<m<<std::endl);
-  }
-void D::indent()
-  {
-    for(int i=0;i<d;i++)
-      debugout_checked(2,"  ");
-  }
-
-
-#endif
-
-#ifdef __APPLE__
-
-//#include <mach-o/nlist.h>
-
-#include "execinfo.h"
-void printStacktrace()
-  {
-    void* callstack[128];
-    int i, frames = backtrace(callstack, 128);
-    char** strs = backtrace_symbols(callstack, frames);
-    printf("FRAMES:%d\n",frames);
-    for (i = 0; i < frames; ++i) {
-      printf("%s\n", strs[i]);
-    }
-    free(strs);
-    /*
-    struct nlist *nl;
-    int result=nlist("antargis.bundle",nl);
-    std::cout<<"RESULT:"<<result<<std::endl;
-*/
-  }
-
-#else
-
-void printStacktrace()
-  {
-  }
-
-#endif
-

Deleted: antargis/trunk/ext/basic/ag_debug.h
===================================================================
--- antargis/trunk/ext/basic/ag_debug.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_debug.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,121 +0,0 @@
-/*
- * Copyright (c) 2005 by David Kamphausen. All rights reserved.
- *
- * ag_debug.h
- * by David Kamphausen (david.kamphausen at web.de)
- *
- * The "Antargis" project, including all files needed to compile it,
- * is free software; you can redistribute it and/or use it and/or modify it
- * under the terms of the GNU General Public License as published
- * by the Free Software Foundation; either version 2 of the License,
- * or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
- *
- * You should have received a copy of the GNU General Public
- * License along with this program.
- */
-
-#ifndef AG_DEBUG_h
-#define AG_DEBUG_h
-#include <stdexcept>
-#include <iostream>
-#include <fstream>
-#include <assert.h>
-#include <sstream>
-#include <string>
-#include <vector>
-//#include "ag_gl.h"
-
-#include "ag_exception.h"
-#include "ag_tools.h"
-#include "ag_base.h"
-
-
-AGEXPORT void setQuiet();
-
-#ifdef MNDEBUG
-#define dbout(x,l)
-#define cdebug(x)
-#define ccdebug(x)
-#define debug(x)
-#define TRACE
-#define CTRACE
-#define CHECK_ZERO(x)
-#define STUB
-//#define assertGL
-
-#else
-
-std::ostream & AGEXPORT getDebug();
-
-#define debug(c) mydebug(::toString(__FILE__),::toString(__LINE__),c)
-
-template<class T>
-inline void mydebug(std::string f,std::string l,const T&t)
-{
-  getDebug()<<"File "<<f<<" Line "<<l<<" : "<<t<<std::endl;
-}
-
-
-using std::endl;
-
-#define debugout(x) getDebug()<<x
-
-#define cdebug(x) debugout("("<<__FILE__<<":"<<__LINE__<<":"<<__PRETTY_FUNCTION__<<"):"<<x<<endl)
-#define ccdebug(x) debugout("("<<__FILE__<<":"<<__LINE__<<":"<<__PRETTY_FUNCTION__<<":"<<((void*)this)<<"):"<<x<<endl)
-
-AGEXPORT size_t getDebugIndex();
-AGEXPORT size_t getDebugLevel();
-AGEXPORT void setDebugLevel(size_t t);
-
-#define debugout_checked(level,x) { if(level>getDebugLevel()) { getDebug()<<x; }}
-#define dbout(level,x) {if(level>getDebugLevel()) { cdebug(x); }}
-
-/** A helper class for tracing the program's flow
-    Use it by instantiating it with a proper name, or simply use TRACE; (or CTRACE for classes) in your functions */
-class AGEXPORT D
-{
-  std::string m;
-  static int d;
-
- public:
-  /// the given text will be output on creation and deletion of this object
-  D(std::string text);
-  ~D();
-private:
-  void indent();
-};
-
-#define LINEINFO(x) (::toString(__FILE__)+::toString(" ")+::toString(__LINE__)+::toString(" ")+::toString( __PRETTY_FUNCTION__)+::toString(" ")+::toString(x)).c_str()
-
-#define TRACE D test__LINE__(::toString(__FILE__)+::toString(" ")+::toString(__LINE__)+::toString(" ")+::toString( __PRETTY_FUNCTION__))
-#define CTRACE D test__LINE__(::toString(__FILE__)+::toString(" ")+::toString(__LINE__)+::toString(" ")+::toString( __PRETTY_FUNCTION__)+::toString(" ")+::toString(((void*)this))+::toString(" ")+typeid(*this).name())
-
-AGEXPORT void agRaise(const std::string &s);
-
-#ifndef __WIN32__
-#undef assert
-#define assert(x) {if(!(x)) agRaise((::toString("assert failed ")+LINEINFO(__STRING(x))).c_str()); }
-#endif
-
-#define Assert(x) assert(x)
-
-#define STUB cdebug("STUB in File "<<__FILE__<<" line:"<<__LINE__<<" function:"<<__PRETTY_FUNCTION__)
-
-#ifdef __WIN32__
-#define CHECK_ZERO(x) assert(x);
-#else
-#define CHECK_ZERO(x) if(!x) throw AGException(std::string(__STRING(x))+" is zero in "+__FILE__+" line:"+toString(__LINE__)+" functin:"+__PRETTY_FUNCTION__);
-#endif
-
-
-#endif
-
-void setRubyRaising(bool flag);
-void printStacktrace();
-
-
-#endif

Deleted: antargis/trunk/ext/basic/ag_exception.h
===================================================================
--- antargis/trunk/ext/basic/ag_exception.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_exception.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,47 +0,0 @@
-/*
- * Copyright (c) 2005 by David Kamphausen. All rights reserved.
- *
- * ag_exception.h
- * by David Kamphausen (david.kamphausen at web.de)
- *
- * The "Antargis" project, including all files needed to compile it,
- * is free software; you can redistribute it and/or use it and/or modify it
- * under the terms of the GNU General Public License as published
- * by the Free Software Foundation; either version 2 of the License,
- * or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
- *
- * You should have received a copy of the GNU General Public
- * License along with this program.
- */
-
-#ifndef __ANTARGISGUI_EXCEPTION_H__
-#define __ANTARGISGUI_EXCEPTION_H__
-
-#include <ag_base.h>
-#include <stdexcept>
-
-class AGEXPORT AGException:public std::exception
-{
-public:
-  AGException(const std::string &e):s(e)
-  {
-  }
-
-  virtual ~AGException() throw ()
-  {
-  }
-
-  const char*what() const throw()
-  {
-    return s.c_str();
-  }
-
-private:
-  std::string s;
-};
-
-#endif

Modified: antargis/trunk/ext/basic/ag_fs.cc
===================================================================
--- antargis/trunk/ext/basic/ag_fs.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_fs.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -29,16 +29,16 @@
 #include <dirent.h>
 #include <errno.h>
 #include <sys/stat.h>
+
 #ifdef WIN32
 #include <windows.h>
 #include <shlobj.h>
-//#include <strsafe.h>
-
 #endif
 
-#include "ag_debug.h"
+#include "rk_debug.h"
+#include "rk_tools.h"
+
 #include "ag_main.h"
-#include "ag_tools.h"
 #include "ag_serial.h"
 #include <zlib.h>
 
@@ -149,7 +149,7 @@
         {
         case EEXIST:
           return; // everything's fine - directory exists already;
-        case EACCES: 
+        case EACCES:
           return; // probably exists - we don't have access
         default:
           dbout(0,"could not create dir:"<<s);
@@ -611,6 +611,6 @@
   {
     std::vector<AGString> a;
     std::copy(gFilesystemPathes.begin(),gFilesystemPathes.end(),std::back_inserter(a));
-    
+
     return a;
   }

Modified: antargis/trunk/ext/basic/ag_fs.h
===================================================================
--- antargis/trunk/ext/basic/ag_fs.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_fs.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,11 +23,11 @@
 #ifndef __FS_H
 #define __FS_H
 
-#include <ag_string.h>
+#include <rk_string.h>
+#include <rk_base.h>
+
 #include <vector>
 
-#include <ag_base.h>
-
 struct FileNotFound
   {
     FileNotFound(const std::string &f):filename(f){}

Modified: antargis/trunk/ext/basic/ag_geometry.cc
===================================================================
--- antargis/trunk/ext/basic/ag_geometry.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_geometry.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,15 +19,14 @@
  */
 
 #include <ag_geometry.h>
-#include <ag_tools.h>
-#include <ag_debug.h>
+#include <rk_tools.h>
+#include <rk_debug.h>
+
 #include <assert.h>
 #include <cmath>
 #include <map>
 #include <list>
-#include <ag_tools.h>
 #include <ag_xml.h>
-#include <ag_debug.h>
 #include <ag_stringstream.h>
 #include <ag_gauss.h>
 
@@ -1460,19 +1459,19 @@
 std::vector<AGRect2> AGRect2::tile(size_t x,size_t y) const
 {
   std::vector<AGRect2> l;
-  
+
   if(x==0 || y==0)
   return l;
-  
+
   float w=width()/x;
   float h=height()/y;
-  
+
   for(size_t i=0;i<x;i++)
     for(size_t j=0;j<y;j++)
       {
         l.push_back(AGRect2(x0()+w*i,y0()+h*j,w,h));
       }
-  
+
   return l;
 }
 
@@ -1770,7 +1769,7 @@
 
       if(m == lm)
         return AGVector2(0,0); // parallel
-      float x=(lb-b)/(m-lm); 
+      float x=(lb-b)/(m-lm);
       p=AGVector2(x,m*x+b);
     }
   return p;

Modified: antargis/trunk/ext/basic/ag_geometry.h
===================================================================
--- antargis/trunk/ext/basic/ag_geometry.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_geometry.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -27,8 +27,8 @@
 #include <iostream>
 #include <list>
 #include <vector>
-#include <ag_base.h>
-#include <ag_string.h>
+#include <rk_base.h>
+#include <rk_string.h>
 #include <stdexcept>
 
 /* There are following classes:
@@ -54,38 +54,36 @@
 
 /** \brief Simple structure holding an angle in degrees
  */
-struct AGEXPORT AGAngle
-  {
+struct AGEXPORT AGAngle {
     float angle;
 
     /// @param an angle in degrees
     explicit AGAngle(float a);
-  };
+};
 
-class GeometryException
-  {
-    public:
-      GeometryException(const std::string &p):s(p)
-    {}
+class GeometryException {
+public:
+
+    GeometryException(const std::string &p) : s(p) {
+    }
 #ifdef SWIG
-      %rename(to_s) what() const;
+    %rename(to_s) what() const;
 #endif
-      std::string what() const
-      {
+
+    std::string what() const {
         return s;
-      }
-      
-    private:
-      std::string s;
-  };
+    }
 
-class AGEXPORT AGVector2
-  {
-  public:
+private:
+    std::string s;
+};
+
+class AGEXPORT AGVector2 {
+public:
     float v[2];
 
     AGVector2(const AGString &s);
-    AGVector2(float pX,float pY);
+    AGVector2(float pX, float pY);
     AGVector2(const AGAngle &a);
     AGVector2(const AGVector2 &a);
     AGVector2();
@@ -111,12 +109,12 @@
     AGVector2 operator-() const;
     AGVector2 operator-(const AGVector2 &p) const;
     AGVector2 operator+(const AGVector2 &p) const;
-    AGVector2 &operator+=(const AGVector2 &p);
-    AGVector2 &operator-=(const AGVector2 &p);
+    AGVector2 & operator+=(const AGVector2 &p);
+    AGVector2 & operator-=(const AGVector2 &p);
 
     float operator*(const AGVector2 &p) const;
-    AGVector2 &operator*=(float f);
-    AGVector2 &operator/=(float f);
+    AGVector2 & operator*=(float f);
+    AGVector2 & operator/=(float f);
     AGVector2 operator*(float f) const;
     AGVector2 operator/(float f) const;
 
@@ -148,19 +146,19 @@
     AGString toString() const;
 
 #ifndef SWIG
-    (operator float*)();
-    (operator const float*)() const;
+    (operator float*) ();
+    (operator const float*) () const;
 #endif
-  };
+};
 
 // 2-dim homogenous vector
-class AGEXPORT AGVector3
-  {
-  public:
+
+class AGEXPORT AGVector3 {
+public:
     float v[3];
 
-    AGVector3(const AGVector2 &p,float h=1.0f);
-    AGVector3(float pX,float pY,float pZ=0.0f);
+    AGVector3(const AGVector2 &p, float h = 1.0f);
+    AGVector3(float pX, float pY, float pZ = 0.0f);
     AGVector3(const AGAngle &a);
     AGVector3(const AGVector3 &a);
     AGVector3();
@@ -189,12 +187,12 @@
     %rename(add) operator+=(const AGVector3 &p);
     %rename(sub) operator-=(const AGVector3 &p);
 #endif
-    AGVector3 &operator+=(const AGVector3 &p);
-    AGVector3 &operator-=(const AGVector3 &p);
+    AGVector3 & operator+=(const AGVector3 &p);
+    AGVector3 & operator-=(const AGVector3 &p);
 
     float operator*(const AGVector3 &p) const;
-    AGVector3 &operator*=(float f);
-    AGVector3 &operator/=(float f);
+    AGVector3 & operator*=(float f);
+    AGVector3 & operator/=(float f);
     AGVector3 operator*(float f) const;
     AGVector3 operator/(float f) const;
     AGVector3 operator%(const AGVector3 &a) const;
@@ -226,41 +224,38 @@
     AGString toString() const;
 
 #ifndef SWIG
-    (operator float*)();
+    (operator float*) ();
 #endif
-  };
+};
 
-
-class AGEXPORT AGMatrix3
-  {
+class AGEXPORT AGMatrix3 {
     float a[3][3];
-  public:
-    struct Row
-      {
+public:
+
+    struct Row {
         AGMatrix3 *matrix;
         int y;
 
-        float &operator[](size_t x)
-        {
-          return matrix->get(x,y);
+        float &operator[](size_t x) {
+            return matrix->get(x, y);
         }
-        float operator[](size_t x) const
-        {
-          return matrix->get(x,y);
+
+        float operator[](size_t x) const {
+            return matrix->get(x, y);
         }
-      };
+    };
 
     AGMatrix3();
     AGMatrix3(const AGAngle &a); // rotate
     AGMatrix3(const AGVector3 &a); // transpose
-    AGMatrix3(float x,float y); // scale
+    AGMatrix3(float x, float y); // scale
     AGMatrix3(const AGMatrix3 &m);
-    void set(size_t x,size_t y,float f);
-    float get(size_t x,size_t y) const;
-    float &get(size_t x,size_t y);
+    void set(size_t x, size_t y, float f);
+    float get(size_t x, size_t y) const;
+    float &get(size_t x, size_t y);
 
     AGMatrix3 operator*(const AGMatrix3 &m) const;
-    AGMatrix3 &operator*=(const AGMatrix3 &m);
+    AGMatrix3 & operator*=(const AGMatrix3 &m);
 
     AGVector3 operator*(const AGVector3 &v) const;
     //  AGVector2 operator*(const AGVector2 &v) const;
@@ -273,8 +268,8 @@
     Row operator[](size_t y);
     const Row operator[](size_t y) const;
 
-    void swapRows(size_t a,size_t b);
-    void swapCols(size_t a,size_t b);
+    void swapRows(size_t a, size_t b);
+    void swapCols(size_t a, size_t b);
 
     bool operator==(const AGMatrix3&p) const;
 
@@ -283,14 +278,13 @@
     %rename(to_s) toString() const;
 #endif
     AGString toString() const;
-  };
+};
 
-class AGEXPORT AGLine2
-  {
-    AGVector2 v0,v1;
-  public:
+class AGEXPORT AGLine2 {
+    AGVector2 v0, v1;
+public:
     AGLine2();
-    AGLine2(const AGVector2 &pv0,const AGVector2 &pv1);
+    AGLine2(const AGVector2 &pv0, const AGVector2 &pv1);
 
     AGVector2 getV0() const;
     AGVector2 getV1() const;
@@ -309,21 +303,20 @@
 
     float distance(const AGVector2 &v) const;
 
-    AGVector2 &operator[](size_t i);
+    AGVector2 & operator[](size_t i);
     AGVector2 operator[](size_t i) const;
 
 #ifdef SWIG
     %rename(to_s) toString() const;
 #endif
     AGString toString() const;
-  };
+};
 
-class AGEXPORT AGLine3
-  {
-    AGVector3 v0,v1;
-  public:
+class AGEXPORT AGLine3 {
+    AGVector3 v0, v1;
+public:
     AGLine3();
-    AGLine3(const AGVector3 &pv0,const AGVector3 &pv1);
+    AGLine3(const AGVector3 &pv0, const AGVector3 &pv1);
 
     AGVector3 getV0() const;
     AGVector3 getV1() const;
@@ -348,20 +341,18 @@
     %rename(to_s) toString() const;
 #endif
     AGString toString() const;
-  };
+};
 
-class AGEXPORT AGCollisionData
-  {
-  };
+class AGEXPORT AGCollisionData {
+};
 
 class AGRect2;
 
-class AGEXPORT AGTriangle2
-  {
+class AGEXPORT AGTriangle2 {
     AGVector2 p[3];
-  public:
+public:
     AGTriangle2();
-    AGTriangle2(const AGVector2 &v0,const AGVector2 &v1,const AGVector2 &v2);
+    AGTriangle2(const AGVector2 &v0, const AGVector2 &v1, const AGVector2 &v2);
 
     AGVector2 operator[](int index) const;
 
@@ -390,20 +381,19 @@
     AGLine2 nearestLine(const AGVector2 &v) const;
 
     std::vector<AGLine2> getLines() const;
-    
+
     void flip();
 #ifdef SWIG
     %rename(to_s) toString() const;
 #endif
     AGString toString() const;
-  };
+};
 
-class AGEXPORT AGCircle2
-  {
+class AGEXPORT AGCircle2 {
     AGVector2 p;
     float radius;
-  public:
-    AGCircle2(const AGVector2 &v,float rad);
+public:
+    AGCircle2(const AGVector2 &v, float rad);
 
     bool inCircle(const AGTriangle2 &t) const;
     bool outCircle(const AGTriangle2 &t) const;
@@ -414,16 +404,16 @@
     float getRadius() const;
 
     std::list<AGVector2> collide(const AGLine2 &pLine) const;
-  };
+};
 
 class AGVector4;
-class AGEXPORT AGTriangle3
-  {
+
+class AGEXPORT AGTriangle3 {
     AGVector3 p[3];
-  public:
-    AGTriangle3(const AGVector3 &v0,const AGVector3 &v1,const AGVector3 &v2);
+public:
+    AGTriangle3(const AGVector3 &v0, const AGVector3 &v1, const AGVector3 &v2);
 
-    // (x,y,z,0) for no collision 
+    // (x,y,z,0) for no collision
     // (x,y,z,1) for collision in point (x,y,z)
     AGVector4 collide(const AGLine3 &pLine) const;
 #ifdef SWIG
@@ -433,17 +423,16 @@
     AGString toString() const;
 
     AGVector3 operator[](int index) const;
-    
+
     void flip();
-  };
+};
 
-class AGEXPORT AGRect2
-  {
-    AGVector2 v0,v1;
-  public:
+class AGEXPORT AGRect2 {
+    AGVector2 v0, v1;
+public:
     AGRect2();
-    AGRect2(const AGVector2 &pv0,const AGVector2 &pv1);
-    AGRect2(float x,float y,float w,float h);
+    AGRect2(const AGVector2 &pv0, const AGVector2 &pv1);
+    AGRect2(float x, float y, float w, float h);
     AGRect2(const AGString &ps);
     AGRect2(const SDL_Rect &r);
 
@@ -453,10 +442,10 @@
 
     AGRect2 operator+(const AGVector2 &v) const;
     AGRect2 operator-(const AGVector2 &v) const;
-    AGRect2 &operator+=(const AGVector2 &v);
-    AGRect2 &operator-=(const AGVector2 &v);
+    AGRect2 & operator+=(const AGVector2 &v);
+    AGRect2 & operator-=(const AGVector2 &v);
 
-    AGRect2& operator+=(const AGRect2 &r);
+    AGRect2 & operator+=(const AGRect2 &r);
 
     bool contains(const AGVector2 &v) const;
     bool contains(const AGRect2 &v) const;
@@ -464,7 +453,7 @@
     std::list<AGRect2> split() const;
 
     AGVector2 operator[](size_t i) const;
-    AGVector2 &operator[](size_t i);
+    AGVector2 & operator[](size_t i);
 
     AGVector2 getV0() const;
     AGVector2 getV1() const;
@@ -474,15 +463,15 @@
     AGVector2 getMiddle() const;
 
     AGRect2 shrink(float f) const;
-    AGRect2 shrink(float w,float h) const;
-    AGRect2 shrinkToTopLeft(float w,float h) const;
+    AGRect2 shrink(float w, float h) const;
+    AGRect2 shrinkToTopLeft(float w, float h) const;
     AGRect2 grow(float f) const;
 
     void setX(float p);
     void setY(float p);
 
     void setLeft(float p); // attention - modifies right, too
-    void setTop(float p);  // attention - modifies bottom, too
+    void setTop(float p); // attention - modifies bottom, too
 
     void setRight(float p);
     void setBottom(float p);
@@ -511,12 +500,14 @@
 
     //result=this-r
     std::vector<AGRect2> difference(const AGRect2 &r) const;
-    std::vector<AGRect2> tile(size_t x,size_t y) const;
+    std::vector<AGRect2> tile(size_t x, size_t y) const;
 
     SDL_Rect sdl() const;
 
     bool operator==(const AGRect2 &r) const;
+#ifndef SWIG
     bool operator!=(const AGRect2 &r) const;
+#endif
 
     void check() const;
 
@@ -528,17 +519,15 @@
     %rename(to_s) toString() const;
 #endif
     AGString toString() const;
-  };
+};
 
-
-class AGEXPORT AGVector4
-  {
-  public:
+class AGEXPORT AGVector4 {
+public:
     float v[4];
 
-    AGVector4(float pX,float pY,float pZ,float pW=1.0f);
+    AGVector4(float pX, float pY, float pZ, float pW = 1.0f);
     AGVector4(const AGVector4 &a);
-    AGVector4(const AGVector3 &a,float h);
+    AGVector4(const AGVector3 &a, float h);
     AGVector4();
 
     void setX(float pX);
@@ -564,12 +553,12 @@
     %rename(add) operator+=(const AGVector4 &p);
     %rename(sub) operator-=(const AGVector4 &p);
 #endif
-    AGVector4 &operator+=(const AGVector4 &p);
-    AGVector4 &operator-=(const AGVector4 &p);
+    AGVector4 & operator+=(const AGVector4 &p);
+    AGVector4 & operator-=(const AGVector4 &p);
 
     float operator*(const AGVector4 &p) const;
-    AGVector4 &operator*=(float f);
-    AGVector4 &operator/=(float f);
+    AGVector4 & operator*=(float f);
+    AGVector4 & operator/=(float f);
     AGVector4 operator*(float f) const;
     AGVector4 operator/(float f) const;
     AGVector4 operator-() const;
@@ -601,9 +590,9 @@
     // vector-cross-product
     // ignores 4th coordinate
     AGVector4 operator%(const AGVector4 &a) const;
-    AGVector4 cross(const AGVector4 &a) const
-    {
-      return operator%(a);
+
+    AGVector4 cross(const AGVector4 &a) const {
+        return operator%(a);
     }
 
 
@@ -616,48 +605,46 @@
     AGString toString() const;
 
 #ifndef SWIG
-    (operator float*)();
-    (operator const float*)() const;
+    (operator float*) ();
+    (operator const float*) () const;
 #endif
-  };
+};
 
-class AGEXPORT AGMatrix4
-  {
+class AGEXPORT AGMatrix4 {
     float a[16];
-  public:
-    struct MRow
-      {
+public:
+
+    struct MRow {
         AGMatrix4 *matrix;
         int y;
 
-        float &operator[](size_t x)
-        {
-          return matrix->get(x,y);
+        float &operator[](size_t x) {
+            return matrix->get(x, y);
         }
-        float operator[](size_t x) const
-        {
-          return matrix->get(x,y);
+
+        float operator[](size_t x) const {
+            return matrix->get(x, y);
         }
-      };
+    };
 
     AGMatrix4();
     AGMatrix4(float v[16]);
-    AGMatrix4(float angle,const AGVector3 &d);
+    AGMatrix4(float angle, const AGVector3 &d);
     AGMatrix4(const AGVector4 &a);
-    void set(size_t x,size_t y,float f);
-    float get(size_t x,size_t y) const;
-    float &get(size_t x,size_t y);
+    void set(size_t x, size_t y, float f);
+    float get(size_t x, size_t y) const;
+    float &get(size_t x, size_t y);
 
     AGMatrix4 operator*(const AGMatrix4 &m) const;
-    AGMatrix4 &operator*=(const AGMatrix4 &m);
-    AGMatrix4 &operator+=(const AGMatrix4 &m);
+    AGMatrix4 & operator*=(const AGMatrix4 &m);
+    AGMatrix4 & operator+=(const AGMatrix4 &m);
 
-    AGMatrix3 get3x3(size_t x,size_t y) const;
+    AGMatrix3 get3x3(size_t x, size_t y) const;
 
     AGVector4 operator*(const AGVector4 &v) const;
 
-    float operator()(size_t x,size_t y) const;
-    float &operator()(size_t x,size_t y);
+    float operator()(size_t x, size_t y) const;
+    float &operator()(size_t x, size_t y);
 
     AGMatrix4 inverted() const;
     AGMatrix4 transposed() const;
@@ -665,8 +652,8 @@
     MRow operator[](size_t y);
     //  const Row operator[](size_t y) const;
 
-    void swapRows(size_t a,size_t b);
-    void swapCols(size_t a,size_t b);
+    void swapRows(size_t a, size_t b);
+    void swapCols(size_t a, size_t b);
 
 #ifdef SWIG
     %rename(to_s) toString() const;
@@ -674,34 +661,34 @@
     AGString toString() const;
 
 #ifndef SWIG
-    (operator float*)();
-    (operator const float*)() const;
+    (operator float*) ();
+    (operator const float*) () const;
     //  (operator const double*)() const;
 #endif
 
     AGVector4 getRow(size_t i) const;
-  };
+};
 
 // axis-aligned
-class AGEXPORT AGRect3
-  {
-    AGVector3 base,dir;
-  public:
-    AGRect3(const AGVector3 &pBase,const AGVector3 &pDir);
 
+class AGEXPORT AGRect3 {
+    AGVector3 base, dir;
+public:
+    AGRect3(const AGVector3 &pBase, const AGVector3 &pDir);
+
     bool collides(const AGLine3&pLine) const;
 
     AGString toString() const;
-  };
+};
 
 // axis-aligned
-class AGEXPORT AGBox3
-  {
-  public:
-    AGVector3 base,dir;
 
+class AGEXPORT AGBox3 {
+public:
+    AGVector3 base, dir;
+
     AGBox3();
-    AGBox3(const AGVector3 &pBase,const AGVector3 &pDir);
+    AGBox3(const AGVector3 &pBase, const AGVector3 &pDir);
 
     void include(const AGVector3&p);
     bool includes(const AGBox3 &b);
@@ -728,19 +715,19 @@
 
     bool valid() const;
 
-  private:
+private:
     bool mValid;
-  };
+};
 
 #ifndef SWIG
-AGEXPORT std::ostream &operator<<(std::ostream &o,const AGVector2&v);
-AGEXPORT std::ostream &operator<<(std::ostream &o,const AGVector3&v);
-AGEXPORT std::ostream &operator<<(std::ostream &o,const AGVector4&v);
-AGEXPORT std::ostream &operator<<(std::ostream &o,const AGRect2&v);
-AGEXPORT std::ostream &operator<<(std::ostream &o,const AGBox3&v);
+AGEXPORT std::ostream & operator<<(std::ostream &o, const AGVector2&v);
+AGEXPORT std::ostream & operator<<(std::ostream &o, const AGVector3&v);
+AGEXPORT std::ostream & operator<<(std::ostream &o, const AGVector4&v);
+AGEXPORT std::ostream & operator<<(std::ostream &o, const AGRect2&v);
+AGEXPORT std::ostream & operator<<(std::ostream &o, const AGBox3&v);
 
-AGEXPORT std::ostream &operator<<(std::ostream &o,const AGMatrix3&v);
-AGEXPORT std::ostream &operator<<(std::ostream &o,const AGMatrix4&v);
+AGEXPORT std::ostream & operator<<(std::ostream &o, const AGMatrix3&v);
+AGEXPORT std::ostream & operator<<(std::ostream &o, const AGMatrix4&v);
 #endif
 
 #include "ag_geometry_inline.cc"

Modified: antargis/trunk/ext/basic/ag_kill.cc
===================================================================
--- antargis/trunk/ext/basic/ag_kill.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_kill.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,10 +19,10 @@
  */
 
 
-// TODO: Is this still used ? 
+// TODO: Is this still used ?
 
 #include "ag_kill.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 
 AGInstanceKiller *mInstanceKiller=0;
 bool mIndirectInstance=false;

Modified: antargis/trunk/ext/basic/ag_kill.h
===================================================================
--- antargis/trunk/ext/basic/ag_kill.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_kill.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,8 +21,9 @@
 #ifndef __ANT_KILL_H__
 #define __ANT_KILL_H__
 
+#include <rk_base.h>
+
 #include <set>
-#include <ag_base.h>
 
 class AGEXPORT AGInstanceBase
 {

Modified: antargis/trunk/ext/basic/ag_main.cc
===================================================================
--- antargis/trunk/ext/basic/ag_main.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_main.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,12 +20,12 @@
 
 #include <iostream>
 
-#include "ag_base.h"
-#include "ag_debug.h"
-#include "ag_tools.h"
+#include "rk_base.h"
+#include "rk_debug.h"
+#include "rk_tools.h"
+
 #include "ag_main.h"
 #include "ag_fs.h"
-#include "ag_debug.h"
 
 #include <ruby.h>
 
@@ -90,7 +90,7 @@
     mVideo=0;
   }
 
-AGMain::~AGMain()
+AGMain::~AGMain() throw()
   {
     CTRACE;
     saveDelete(mVideo);
@@ -157,7 +157,7 @@
 }
 
 
-void AGMain::mark()
+void AGMain::mark() throw()
   {
     markObject(getCollector());
     markObject(mRand);

Modified: antargis/trunk/ext/basic/ag_main.h
===================================================================
--- antargis/trunk/ext/basic/ag_main.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_main.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -24,7 +24,7 @@
 #define __AG_MAIN
 
 #include <string>
-#include <ag_rubyobj.h>
+#include <rk_rubyobj.h>
 #include <ag_collector.h>
 #include <ag_rand_base.h>
 #include <ag_video_base.h>
@@ -33,7 +33,7 @@
 /**
  * \defgroup AntargisGUI AntargisGUI
  * \brief the GUI-library of the game Battles of Antargis
- * 
+ *
  * This library consists of different mechanisms to make your life easier
  * with graphical user interfaces:
  * \see widgets
@@ -59,7 +59,7 @@
 {
  public:
   AGMain();
-  ~AGMain();
+  ~AGMain() throw ();
 
   long getTicks() const;
 
@@ -76,7 +76,7 @@
   void delay(int ms);
 
  protected:
-  virtual void mark();
+  virtual void mark() throw();
 
  private:
   AGVideoBase *mVideo;

Modified: antargis/trunk/ext/basic/ag_message.cc
===================================================================
--- antargis/trunk/ext/basic/ag_message.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_message.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,5 @@
 #include "ag_message.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 
 AGMessageData::AGMessageData(size_t pID):
   mID(pID)
@@ -24,11 +24,12 @@
     assert(mMessageQueue);
     mMessageQueue->insertTransceiver(this);
   }
-AGMessageTransceiver::~AGMessageTransceiver()
+AGMessageTransceiver::~AGMessageTransceiver() throw()
   {
     if(mMessageQueue)
       mMessageQueue->eraseTransceiver(this);
   }
+
 void AGMessageTransceiver::sendMessage(const AGString &pName,AGMessageData *pData)
   {
     assert(mMessageQueue);
@@ -72,7 +73,7 @@
 
 AGMessageSource::AGMessageSource(AGMessageTransceiver *pSender,const AGString &pName):
   mSender(pSender),mName(pName)
-  {   
+  {
   }
 
 bool AGMessageSource::operator<(const AGMessageSource &pSource) const
@@ -125,7 +126,7 @@
 AGMessageQueue::AGMessageQueue():
   mMessageID(0)
   {
-    
+
   }
 
 

Modified: antargis/trunk/ext/basic/ag_message.h
===================================================================
--- antargis/trunk/ext/basic/ag_message.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_message.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,8 +3,9 @@
 #ifndef AG_MESSAGE_H_
 #define AG_MESSAGE_H_
 
-#include <ag_string.h>
-#include <ag_rubyobj.h>
+#include <rk_string.h>
+#include <rk_rubyobj.h>
+
 #include <map>
 #include <set>
 #include <list>
@@ -22,7 +23,7 @@
 public:
   AGMessageData(size_t pID);
   virtual ~AGMessageData() {}
-  
+
   size_t getMessageID() const;
 private:
   size_t mID;
@@ -45,7 +46,7 @@
 {
 public:
   AGMessageDataReceipt(size_t pID,size_t pSentID);
-  
+
   size_t getSentMessageID() const;
 private:
   size_t mSentID;
@@ -61,7 +62,7 @@
 class AGMessageTransceiver : public AGRubyObject
 {
   AGMessageTransceiver(AGMessageQueue *pQueue);
-  virtual ~AGMessageTransceiver();
+  virtual ~AGMessageTransceiver() throw();
   void sendMessage(const AGString &pName,AGMessageData *pData=0);
 
   // generate an empty message data object
@@ -117,7 +118,7 @@
   const AGMessageSource &getSource() const;
   AGMessageTransceiver *getSender();
 private:
-  AGMessage(const AGMessage&):mData(0) 
+  AGMessage(const AGMessage&):mData(0)
   {}
 };
 

Modified: antargis/trunk/ext/basic/ag_messageobject.cc
===================================================================
--- antargis/trunk/ext/basic/ag_messageobject.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_messageobject.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,9 @@
  */
 
 #include "ag_messageobject.h"
-#include "ag_debug.h"
+
+#include "rk_debug.h"
+
 #include "ag_main.h"
 #include "ag_stringstream.h"
 #include "ag_widget.h"
@@ -32,7 +34,7 @@
       {
         mClipped=false;
       }
-AGEvent::~AGEvent()
+AGEvent::~AGEvent() throw()
   {
     if(mMousePosition)
       delete mMousePosition;
@@ -48,7 +50,7 @@
 
 bool AGEvent::isClipped() const
 {
-  return mClipped; 
+  return mClipped;
 }
 void AGEvent::setClipped(bool f)
   {
@@ -199,7 +201,7 @@
   {
   }
 
-AGListener::~AGListener()
+AGListener::~AGListener() throw()
   {
   }
 
@@ -343,7 +345,7 @@
         {
         }
 
-AGMessageObject::~AGMessageObject()
+AGMessageObject::~AGMessageObject() throw()
   {
     std::set<AGSignal*> sigs=mSignals;
     std::set<AGSignal*>::iterator i=sigs.begin();
@@ -362,10 +364,10 @@
   }
 
 
-// 
+//
 // exchange with a processEvent(const AGEvent &event)
 
-bool AGMessageObject::processEvent(AGEvent* agEvent) 
+bool AGMessageObject::processEvent(AGEvent* agEvent)
   {
     bool rc=false;
 

Modified: antargis/trunk/ext/basic/ag_messageobject.h
===================================================================
--- antargis/trunk/ext/basic/ag_messageobject.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_messageobject.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -28,8 +28,8 @@
 #include <set>
 
 #include "ag_geometry.h"
-#include "ag_rubyobj.h"
-#include <ag_string.h>
+#include "rk_rubyobj.h"
+#include "rk_string.h"
 
 #if SDL_COMPILEDVERSION>1300
 #define MSDLMod Uint16
@@ -45,7 +45,7 @@
 
     AntargisGUI contains a small event handling mechanism for both ruby and C++.
     However they do work a little different.
-    
+
     Each object that wants to send or receive a message (or event) must be derived from
     AGMessageObject.
 
@@ -57,20 +57,20 @@
     You can however derive from it and pass it through a signal.
     But you shouldn't delete it for yourself.
  */
-class AGEXPORT AGEvent
+class AGEXPORT AGEvent:public AGRubyObject
 {
  public:
   AGEvent(AGListener *pCaller,const AGString &pName,const SDL_Event &pEvent=NullEvent);
-  virtual ~AGEvent();
+  virtual ~AGEvent() throw();
 
   AGListener *getCaller() const;
-  
+
   void setCaller(AGListener *pCaller);
   AGString getName() const;
 
   void setRelMousePosition(const AGVector2 &p);
   AGVector2 getRelMousePosition() const;
-  
+
   AGVector2 getMousePosition() const;
   SDLKey getKey() const;
   MSDLMod getMod() const;
@@ -85,12 +85,12 @@
 
   void setVector(const AGVector2 &v);
   AGVector2 getVector() const;
-  
+
   bool isClipped() const;
   void setClipped(bool f);
 
   bool isMouseEvent() const;
-  
+
  private:
   AGListener *mCaller;
   AGString mName;
@@ -100,7 +100,7 @@
   AGVector2 mVector;
   AGVector2 *mMousePosition;
   AGVector2 *mRelMousePosition;
-  
+
   bool mClipped;
 
  protected:
@@ -118,9 +118,9 @@
 {
  public:
   AGListener();
-  virtual ~AGListener();
+  virtual ~AGListener() throw();
   virtual bool signal(AGEvent *m);
-  
+
 };
 
 /**
@@ -147,7 +147,7 @@
   typedef bool (T::*FKT)(AGEvent *m);
   T *base;
   FKT f;
-  
+
   AGSlot0(T *pBase,FKT pF):
     base(pBase),f(pF)
     {
@@ -164,7 +164,7 @@
 
 class AGMessageObject;
 
-/** AGSignal is a placeholder-class for a function which calls all the Slots, which 
+/** AGSignal is a placeholder-class for a function which calls all the Slots, which
     are connected to this signal.
     For instance a button named "close" holds a sigClick signal and a dialog box has a slotClose.
     You call sigClick(event) in the button and the connected slot is automatically called.
@@ -202,7 +202,7 @@
 {
  public:
   AGMessageObject();
-  virtual ~AGMessageObject();
+  virtual ~AGMessageObject() throw();
 
   bool processEvent(AGEvent *pEvent);
 
@@ -250,7 +250,7 @@
 AGEXPORT AGEvent *newEvent(AGListener *pCaller,const AGString &pName,const SDL_Event &s);
 
 /**
- */   
+ */
 
 template<class T>
 AGCPPListener *slot(T *base,bool (T::*f)(AGEvent *))

Modified: antargis/trunk/ext/basic/ag_mutex.h
===================================================================
--- antargis/trunk/ext/basic/ag_mutex.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_mutex.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,7 +1,7 @@
 #ifndef AG_MUTEX
 #define AG_MUTEX
 
-#include <ag_base.h>
+#include <rk_base.h>
 #include <SDL.h>
 #include <SDL_thread.h>
 

Modified: antargis/trunk/ext/basic/ag_plugin.cc
===================================================================
--- antargis/trunk/ext/basic/ag_plugin.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_plugin.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -5,7 +5,7 @@
 #   include <windows.h>
 #include <ag_debug.h>
 
-AGPlugin::~AGPlugin()
+AGPlugin::~AGPlugin() throw()
 {
   FreeLibrary((HINSTANCE__*)myptr);
 }
@@ -46,7 +46,7 @@
 
 #include <dlfcn.h>
 
-AGPlugin::~AGPlugin()
+AGPlugin::~AGPlugin() throw()
 {
   dlclose(myptr);
 }

Modified: antargis/trunk/ext/basic/ag_plugin.h
===================================================================
--- antargis/trunk/ext/basic/ag_plugin.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_plugin.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,13 +1,14 @@
 #ifndef AG_PLUGIN_H
 #define AG_PLUGIN_H
 
+#include <rk_rubyobj.h>
+
 #include <string>
-#include <ag_rubyobj.h>
 
 class AGEXPORT AGPlugin:public AGRubyObject
 {
  public:
-  virtual ~AGPlugin();
+  virtual ~AGPlugin() throw();
 
  private:
   void *myptr;

Modified: antargis/trunk/ext/basic/ag_profiler.cc
===================================================================
--- antargis/trunk/ext/basic/ag_profiler.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_profiler.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,139 +1,140 @@
-#include <time.h> 
-#include <algorithm> 
-#include <sstream> 
-#include <fstream> 
-#include <stack> 
-#include <list> 
-#include <set> 
+#include <time.h>
+#include <algorithm>
+#include <sstream>
+#include <fstream>
+#include <stack>
+#include <list>
+#include <set>
 
-#include "ag_profiler.h" 
-#include "ag_debug.h" 
+#include "ag_profiler.h"
 
+#include "rk_debug.h"
+
 #include <SDL.h>
 
 #ifdef MPROFILE
 
-#define RDTSC_TIMER 
+#define RDTSC_TIMER
 
-double 
-volatile Uint64 get_time_unit() 
-  { 
-    unsigned int a = 0, b = 0; 
-#ifdef RDTSC_TIMER 
-#  if defined(__GNUC__) 
-    asm ("RDTSC": "=a" (a), "=d" (b) : ); 
-#  elif defined(_MSC_VER) 
-    __asm RDTSC 
-    __asm mov a, eax 
-    __asm mov b, edx 
-#  endif 
-#endif 
-    return ( (Uint64)a + ((Uint64)b<<32)); 
-  } 
+double
+volatile Uint64 get_time_unit()
+  {
+    unsigned int a = 0, b = 0;
+#ifdef RDTSC_TIMER
+#  if defined(__GNUC__)
+    asm ("RDTSC": "=a" (a), "=d" (b) : );
+#  elif defined(_MSC_VER)
+    __asm RDTSC
+    __asm mov a, eax
+    __asm mov b, edx
+#  endif
+#endif
+    return ( (Uint64)a + ((Uint64)b<<32));
+  }
 
-Uint64 convert_time(Uint64 t) 
-  { 
-    static double period = 0; 
-    if(period) 
-      return (Uint64)(t*period); 
-    Uint64 b = get_time_unit(); 
+Uint64 convert_time(Uint64 t)
+  {
+    static double period = 0;
+    if(period)
+      return (Uint64)(t*period);
+    Uint64 b = get_time_unit();
 #ifdef WIN32
     SDL_Delay(50);
-    period = 50000.0/((get_time_unit()-b)); 
+    period = 50000.0/((get_time_unit()-b));
 #else
-    usleep(1000000); 
-#ifdef RDTSC_TIMER 
-    period = 1000.0/((get_time_unit()-b)); 
-#else 
-    period = 1; 
-#endif 
+    usleep(1000000);
+#ifdef RDTSC_TIMER
+    period = 1000.0/((get_time_unit()-b));
+#else
+    period = 1;
 #endif
-    return convert_time(t); 
-  } 
+#endif
+    return convert_time(t);
+  }
 
-struct StackTraceEnter 
-{ 
-  SOURCE_LINE* mSrcline; 
-  Uint64 mStartTime; 
-}; 
+struct StackTraceEnter
+{
+  SOURCE_LINE* mSrcline;
+  Uint64 mStartTime;
+};
 
-static std::stack<StackTraceEnter> call_stack; 
-static std::set<SOURCE_LINE*> used_functions; 
+static std::stack<StackTraceEnter> call_stack;
+static std::set<SOURCE_LINE*> used_functions;
 
-static std::string getStackNodeString(const SOURCE_LINE* stNode) 
-  {      
-    std::string strName; 
-    if(stNode->name!=NULL) 
-      strName = std::string(" ") + stNode->name; 
-    std::stringstream s; 
+static std::string getStackNodeString(const SOURCE_LINE* stNode)
+  {
+    std::string strName;
+    if(stNode->name!=NULL)
+      strName = std::string(" ") + stNode->name;
+    std::stringstream s;
     s<<stNode->file<<", line "<<stNode->line<<" fn: "<<stNode->funct+strName<<" time: "<<convert_time(stNode->time)<<" count: "<<stNode->count;
     if(stNode->count>0)
       s<<" per call:"<<convert_time(stNode->time)/double(stNode->count);
-    s<<std::endl; 
-    return s.str(); 
-  } 
+    s<<std::endl;
+    return s.str();
+  }
 
-UserStackTraceHelper::UserStackTraceHelper( SOURCE_LINE* srcline) 
-  { 
-    StackTraceEnter st; 
-    st.mStartTime = get_time_unit(); 
-    st.mSrcline = srcline; 
-    srcline->count++; 
-    call_stack.push(st); 
-    used_functions.insert(srcline); 
-  } 
+UserStackTraceHelper::UserStackTraceHelper( SOURCE_LINE* srcline)
+  {
+    StackTraceEnter st;
+    st.mStartTime = get_time_unit();
+    st.mSrcline = srcline;
+    srcline->count++;
+    call_stack.push(st);
+    used_functions.insert(srcline);
+  }
 
-UserStackTraceHelper::~UserStackTraceHelper() 
-  { 
-    StackTraceEnter st=call_stack.top(); 
-    call_stack.pop(); 
-    st.mSrcline->time += get_time_unit() - st.mStartTime; 
-  } 
+UserStackTraceHelper::~UserStackTraceHelper()
+  {
+    StackTraceEnter st=call_stack.top();
+    call_stack.pop();
+    st.mSrcline->time += get_time_unit() - st.mStartTime;
+  }
 
 
-std::string UserStackTraceHelper::getStackTraceString() 
-  { 
-    std::string stack_string = ""; 
+std::string UserStackTraceHelper::getStackTraceString()
+  {
+    std::string stack_string = "";
 
-    std::stack<StackTraceEnter> tmp; 
-    tmp = call_stack; 
-    while(!tmp.empty()) 
-      { 
-        StackTraceEnter stNode = tmp.top(); 
-        stack_string += getStackNodeString(stNode.mSrcline); 
-        tmp.pop(); 
-      } 
-    return stack_string; 
-  } 
+    std::stack<StackTraceEnter> tmp;
+    tmp = call_stack;
+    while(!tmp.empty())
+      {
+        StackTraceEnter stNode = tmp.top();
+        stack_string += getStackNodeString(stNode.mSrcline);
+        tmp.pop();
+      }
+    return stack_string;
+  }
 
-class _getProfilerString 
-{ 
-  std::string mAll; 
-public: 
-  _getProfilerString(){mAll = "";}; 
+class _getProfilerString
+{
+  std::string mAll;
+public:
+  _getProfilerString(){mAll = "";};
 
-  void operator()(const SOURCE_LINE* l) 
-  { 
-    mAll+= getStackNodeString(l); 
-  } 
-  operator std::string() 
-    { 
-      return mAll; 
-    } 
-}; 
+  void operator()(const SOURCE_LINE* l)
+  {
+    mAll+= getStackNodeString(l);
+  }
+  operator std::string()
+    {
+      return mAll;
+    }
+};
 
-static bool cmpTime(const SOURCE_LINE* a, const SOURCE_LINE* b) 
-  { 
-    return a->time<b->time; 
-  } 
+static bool cmpTime(const SOURCE_LINE* a, const SOURCE_LINE* b)
+  {
+    return a->time<b->time;
+  }
 
-std::string UserStackTraceHelper::getProfilerString() 
-  { 
-    std::list<SOURCE_LINE*> lst; 
-    std::copy(used_functions.begin(), used_functions.end(), std::back_inserter(lst)); 
-    lst.sort(cmpTime); 
-    return std::for_each(lst.begin(), lst.end(), _getProfilerString()); 
-  } 
+std::string UserStackTraceHelper::getProfilerString()
+  {
+    std::list<SOURCE_LINE*> lst;
+    std::copy(used_functions.begin(), used_functions.end(), std::back_inserter(lst));
+    lst.sort(cmpTime);
+    return std::for_each(lst.begin(), lst.end(), _getProfilerString());
+  }
 
 
 class AGProfilerWriter
@@ -146,55 +147,55 @@
       os<<UserStackTraceHelper::getProfilerString()<<std::endl;
       os<<UserStackTraceHelper::getStackTraceString()<<std::endl;
     }
-}; 
+};
 AGProfilerWriter gProfilerWriter;
 
 #ifdef RUN_PROFILER_TEST
 
-//  Test code 
-#include <stdlib.h> 
+//  Test code
+#include <stdlib.h>
 
-class A 
-{ 
-public: 
-  A(){STACKTRACE sleep(10);} 
-  ~A(){STACKTRACE} 
-  void f() 
-    { 
-      STACKTRACE 
-      for(int i=0; i<30000000; i++) 
-        { 
-          if(i % 5 > random()) 
-            i++; 
-        } 
-    } 
-  void f2() 
-    { 
-      STACKTRACE 
-      for(int i=0; i<300; i++) 
-        { 
-          if(i % 5 > random()) 
-            i++; 
-        } 
-    } 
+class A
+{
+public:
+  A(){STACKTRACE sleep(10);}
+  ~A(){STACKTRACE}
+  void f()
+    {
+      STACKTRACE
+      for(int i=0; i<30000000; i++)
+        {
+          if(i % 5 > random())
+            i++;
+        }
+    }
+  void f2()
+    {
+      STACKTRACE
+      for(int i=0; i<300; i++)
+        {
+          if(i % 5 > random())
+            i++;
+        }
+    }
 };
 
 
-int main() 
-  { 
+int main()
+  {
       {
-        STACKTRACE 
-        A* b; 
-        b = new A(); 
-        b->f(); 
-        for(int i=1;i<5;i++) 
-          b->f2(); 
+        STACKTRACE
+        A* b;
+        b = new A();
+        b->f();
+        for(int i=1;i<5;i++)
+          b->f2();
       }
 
-      printf("profile:\n\n %s\n", UserStackTraceHelper::getProfilerString().c_str()); 
-      printf("call stack:\n\n %s\n", UserStackTraceHelper::getStackTraceString().c_str()); 
-      return 0; 
-  } 
+      printf("profile:\n\n %s\n", UserStackTraceHelper::getProfilerString().c_str());
+      printf("call stack:\n\n %s\n", UserStackTraceHelper::getStackTraceString().c_str());
+      return 0;
+  }
 #endif
 
 #endif

Modified: antargis/trunk/ext/basic/ag_profiler.h
===================================================================
--- antargis/trunk/ext/basic/ag_profiler.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_profiler.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,23 +1,24 @@
-/* 
- * The "Antargis" project, including all files needed to compile it, 
- * is free software; you can redistribute it and/or use it and/or modify it 
- * under the terms of the GNU General Public License as published 
- * by the Free Software Foundation; either version 2 of the License, 
- * or (at your option) any later version. 
- * 
- * This program is distributed in the hope that it will be useful, 
- * but WITHOUT ANY WARRANTY; without even the implied warranty of 
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 
- * 
- * You should have received a copy of the GNU General Public 
- * License along with this program. 
- */ 
+/*
+ * The "Antargis" project, including all files needed to compile it,
+ * is free software; you can redistribute it and/or use it and/or modify it
+ * under the terms of the GNU General Public License as published
+ * by the Free Software Foundation; either version 2 of the License,
+ * or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ *
+ * You should have received a copy of the GNU General Public
+ * License along with this program.
+ */
 
-#ifndef AG_PROFILER_H 
-#define AG_PROFILER_H 
+#ifndef AG_PROFILER_H
+#define AG_PROFILER_H
 
-#include <ag_base.h>
-#include <string> 
+#include <rk_base.h>
+
+#include <string>
 #include <SDL.h>
 
 #if CPU_FAMILY == PPC
@@ -29,42 +30,42 @@
 
 #ifdef MPROFILE
 
-#define Uint64 long long 
-#define Sint64 signed long long 
+#define Uint64 long long
+#define Sint64 signed long long
 
-struct SOURCE_LINE 
-{ 
-  Uint64 time;       ///< Total time spent in function 
-  Uint64 count;      ///< Total function calls 
-  int line;          ///< __LINE__ 
-  const char *file;  ///< __FILE__ 
-  const char *funct; ///< __FUNCTION__ 
-  const char *name;  ///< NULL or a descriptor string 
-}; 
+struct SOURCE_LINE
+{
+  Uint64 time;       ///< Total time spent in function
+  Uint64 count;      ///< Total function calls
+  int line;          ///< __LINE__
+  const char *file;  ///< __FILE__
+  const char *funct; ///< __FUNCTION__
+  const char *name;  ///< NULL or a descriptor string
+};
 
-/// \brief Call stack tracker 
-/// 
-/// Object of this class is created on stack in STACKTRACE macro, so it's creating/destruction can 
-/// be used to manage  call stack. 
-class AGEXPORT UserStackTraceHelper 
-{ 
- public: 
-  UserStackTraceHelper( SOURCE_LINE* srcline); 
-  ~UserStackTraceHelper(); 
-  
-  ///  get stack trace string 
-    static std::string getStackTraceString(); 
-    static std::string getProfilerString(); 
-}; 
+/// \brief Call stack tracker
+///
+/// Object of this class is created on stack in STACKTRACE macro, so it's creating/destruction can
+/// be used to manage  call stack.
+class AGEXPORT UserStackTraceHelper
+{
+ public:
+  UserStackTraceHelper( SOURCE_LINE* srcline);
+  ~UserStackTraceHelper();
 
+  ///  get stack trace string
+    static std::string getStackTraceString();
+    static std::string getProfilerString();
+};
 
-#define STACKTRACE static SOURCE_LINE _srcline = { 0, 0, __LINE__, __FILE__, __FUNCTION__, 0 }; UserStackTraceHelper _stacktrace_ ( &_srcline ); 
-#define _STACKTRACE(A) static SOURCE_LINE _srcline = {0, 0, __LINE__, __FILE__, __FUNCTION__, A }; UserStackTraceHelper _stacktrace_ ( &_srcline ); 
 
+#define STACKTRACE static SOURCE_LINE _srcline = { 0, 0, __LINE__, __FILE__, __FUNCTION__, 0 }; UserStackTraceHelper _stacktrace_ ( &_srcline );
+#define _STACKTRACE(A) static SOURCE_LINE _srcline = {0, 0, __LINE__, __FILE__, __FUNCTION__, A }; UserStackTraceHelper _stacktrace_ ( &_srcline );
 
-#else // MPROFILE 
+
+#else // MPROFILE
 #define STACKTRACE
 
-#endif // MPROFILE 
+#endif // MPROFILE
 
 #endif

Modified: antargis/trunk/ext/basic/ag_rand_base.h
===================================================================
--- antargis/trunk/ext/basic/ag_rand_base.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_rand_base.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,7 +3,7 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
-#include <ag_rubyobj.h>
+#include <rk_rubyobj.h>
 
 class AGEXPORT AGRandomizerBase:public AGRubyObject
 {

Deleted: antargis/trunk/ext/basic/ag_rtools.cc
===================================================================
--- antargis/trunk/ext/basic/ag_rtools.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_rtools.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,52 +0,0 @@
-#include <ag_rtools.h>
-#include <ag_serial.h>
-
-#include <ruby.h>
-
-#include <iostream>
-#include <sstream>
-
-std::string rubyHash(const std::string &p)
-{
-  rb_eval_string("require 'digest/md5'");
-  VALUE l=rb_eval_string("Digest::MD5");
-  VALUE r=rb_funcall(l,rb_intern("digest"),1,rb_str_new(p.c_str(),p.length()));
-
-  std::string s(RSTRING_PTR(r), RSTRING_LEN(r));
-
-  return binaryToHex(s,false);
-  
-}
-
-std::string rubyHashOld(const std::string &p)
-{
-  // FIXME: TRY USING ruby's Digest::MD5::digest("xy")
-  rb_eval_string("require 'digest/md5'");
-
-  //  VALUE l=rb_gv_get("Digest::MD5");
-  //  VALUE r=rb_funcall(l,rb_intern("digest"),1,rb_str_new2(p.c_str()));
-
-  std::ostringstream os;
-  os<<"s=''; Digest::MD5::digest('"<<p<<"').each_byte{|b|s+=sprintf('%X',b)};s";
-
-  VALUE r=rb_eval_string(os.str().c_str());
-
-  std::string s;
-
-  s=STR2CSTR(r);
-
-  return s;
-}
-
-
-
-
-
-bool rubyMatchRegex(const std::string &p,const std::string &pregex)
-  {
-    VALUE rp=rb_str_new(p.c_str(),p.length());
-    VALUE rregex=rb_str_new(pregex.c_str(),pregex.length());
-    
-    VALUE ret=rb_reg_match(rp,rregex);
-    return ret==Qtrue;
-  }

Deleted: antargis/trunk/ext/basic/ag_rtools.h
===================================================================
--- antargis/trunk/ext/basic/ag_rtools.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_rtools.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,13 +0,0 @@
-#ifndef AG_RTOOLS_H
-#define AG_RTOOLS_H
-
-#include <ag_base.h>
-#include <string>
-
-AGEXPORT std::string rubyHash(const std::string &p);
-AGEXPORT bool rubyMatchRegex(const std::string &p,const std::string &pregex);
-std::string rubySub(const std::string &p,const std::string &search,const std::string &repl);
-
-
-
-#endif

Modified: antargis/trunk/ext/basic/ag_serial.cc
===================================================================
--- antargis/trunk/ext/basic/ag_serial.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_serial.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include "ag_serial.h"
 #include <iostream>
-#include <ag_debug.h>
+#include <rk_debug.h>
 
 // INTEL is little endian
 
@@ -339,94 +339,3 @@
 {
   return os.str();
 }
-
-
-unsigned char fromHexBS(unsigned char c)
-  {
-    if(c>='a' && c<='f')
-      return c-'a'+0xA;
-    if(c>='A' && c<='F')
-      return c-'A'+0xA;
-
-    if(c>='0' && c<='9')
-      return c-'0';
-    throw std::runtime_error("wrong input in fromHex()");
-  }
-
-void toHexBS(char c,std::ostream &os)
-  {
-    unsigned char c0=(c&0xF);
-    unsigned char c1=((c>>4)&0xF);
-
-    char a,b;
-    //  std::ostringstream os;
-    if(c0<10)
-      a=(c0+'0');
-    else
-      a=((c0-10)+'A');
-
-    if(c1<10)
-      b=(c1+'0');
-    else
-      b=((c1-10)+'A');
-
-    //  cdebug("a:"<<(int)a);
-    //  cdebug("b:"<<(int)b);
-    os<<b<<a;
-
-    //  return os.str();
-  }
-
-
-std::string binaryToHex(const std::string &s,bool separators)
-  {
-    std::ostringstream os;
-
-    for(size_t i=0;i<s.length();i++)
-      {
-        //      cdebug(i<<":"<<(int)s[i]);
-        toHexBS(s[i],os);
-        if(i>0 && separators)
-          {
-            if((i%32)==0)
-              os<<std::endl;
-            else if((i%4)==0)
-              os<<" ";
-          }
-      }
-    //  cdebug(os.getString());
-
-    return os.str();//getString();
-  }
-
-
-std::string hexToBinary(const std::string &s)
-  {
-    std::ostringstream os;
-    bool complete=false;
-    char current=0;
-
-    for(size_t i=0;i<s.length();i++)
-      {
-        char c=s[i];
-        if((c>='a' && c<='f') || (c>='A' && c<='F') || (c>='0' && c<='9'))
-          {
-            if(complete)
-              {
-                current<<=4;
-                current|=fromHexBS(c);
-                os<<current;
-                complete=false;
-              }
-            else
-              {
-                current=fromHexBS(c);
-                complete=true;
-              }
-          }
-
-      }
-
-
-    return os.str();
-  }

Modified: antargis/trunk/ext/basic/ag_serial.h
===================================================================
--- antargis/trunk/ext/basic/ag_serial.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_serial.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -80,7 +80,7 @@
 class AGEXPORT BinaryStringIn:public BinaryIn
 {
  public:
-  BinaryStringIn(const std::string &pText);
+  BinaryStringIn(const std::string &pText);
   virtual ~BinaryStringIn();
 
   virtual bool eof();
@@ -102,7 +102,5 @@
   std::ostringstream os;
 };
 
-AGEXPORT std::string binaryToHex(const std::string &s,bool separators=true);
-AGEXPORT std::string hexToBinary(const std::string &s);
 
 #endif

Modified: antargis/trunk/ext/basic/ag_singleton.cc
===================================================================
--- antargis/trunk/ext/basic/ag_singleton.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_singleton.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include "ag_singleton.h"
 #include "ag_main.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 
 
 AGSingleton::AGSingleton()
@@ -11,7 +11,7 @@
 
   getMain()->getCollector()->insertGlobal(this);
 }
-AGSingleton::~AGSingleton()
+AGSingleton::~AGSingleton() throw()
 {
   if(!hasMain())
     return;

Modified: antargis/trunk/ext/basic/ag_singleton.h
===================================================================
--- antargis/trunk/ext/basic/ag_singleton.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_singleton.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,13 +3,13 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
-#include <ag_rubyobj.h>
+#include <rk_rubyobj.h>
 
 class AGEXPORT AGSingleton:public AGRubyObject
 {
  public:
   AGSingleton();
-  ~AGSingleton();
+  virtual ~AGSingleton() throw ();
 };
 
 #endif

Deleted: antargis/trunk/ext/basic/ag_string.cc
===================================================================
--- antargis/trunk/ext/basic/ag_string.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_string.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,230 +0,0 @@
-#include <ag_string.h>
-#include <ag_debug.h>
-#include <ag_utf8.h>
-#include <ag_rtools.h>
-
-///////////
-// AGString
-///////////
-
-AGString::AGString(int i)
-  {
-    std::ostringstream os;
-    os<<i;
-    *this=os.str();
-  }
-AGString::AGString(long i)
-  {
-    std::ostringstream os;
-    os<<i;
-    *this=os.str();
-  }
-AGString::AGString(size_t i)
-  {
-    std::ostringstream os;
-    os<<i;
-    *this=os.str();
-  }
-AGString::AGString(float f)
-  {
-    std::ostringstream os;
-    os<<f;
-    *this=os.str();
-  }
-
-
-AGString::AGString()
-  {
-  }
-
-AGString::AGString(const char*c):
-  std::string(c)
-  {
-  }
-
-AGString::AGString(const char*c,size_t size):
-  std::string(c,size)
-  {
-  }
-
-AGString::AGString(const std::string &p):
-  std::string(p)
-  {
-  }
-AGString::AGString(const std::string &p,size_t many):
-  std::string(p,many)
-  {
-  }
-AGString::AGString(const AGString &p):
-  std::string(p)
-  {
-  }
-
-AGString::AGString(const char c,size_t many):
-  std::string(c,many)
-  {
-  }
-
-AGString &AGString::operator=(const AGString &p)
-  {
-    std::string::operator=(p);
-    return *this;
-  }
-
-AGString &AGString::operator+=(const AGString &p)
-{
-  std::string::operator+=(p);
-  return *this;
-}
-
-size_t AGString::memory() const
-{
-  return length();
-}
-
-AGString AGString::substr(size_t from,size_t len) const
-{
-  return AGString(std::string::substr(from,len));
-}
-
-
-std::vector<AGString> AGString::split(const AGString &p) const
-{
-  std::vector<AGString> a;
-  size_t oi=0;
-  size_t i=find(p);
-  for(;;)
-    {
-      i=find(p,oi);
-      a.push_back(substr(oi,i-oi));
-      if(i==std::string::npos)
-        break;
-      oi=i+1;
-    }
-  return a;
-}
-
-AGString AGString::operator+(const AGString &p) const
-{
-  AGString n(*this);
-  n+=p;
-  return n;
-}
-AGString AGString::operator+(const char* p) const
-{
-  AGString n(*this);
-  n+=p;
-  return n;
-}
-AGString AGString::operator+(const std::string &p) const
-{
-  AGString n(*this);
-  n+=p;
-  return n;
-}
-
-
-AGString AGString::replace(const AGString &what, const AGString &by) const
-{
-  size_t i=0;
-  size_t oi=0;
-  AGString n;
-
-  while(i!=npos)
-    {
-      i=find(what,oi);
-      n+=substr(oi,i-oi);
-      if(i==npos)
-        break;
-      n+=by;
-      oi=i+1;
-    }
-  return n;
-}
-
-
-int AGString::toInt() const
-{
-  return atoi(c_str());
-}
-long AGString::toLong() const
-{
-  return atol(c_str());
-}
-float AGString::toFloat() const
-{
-  return atof(c_str());
-}
-
-Uint8 AGString::toUint8() const
-{
-  return toInt();
-}
-Sint16 AGString::toSint16() const 
-{
-  return toInt();
-}
-
-
-int AGString::parseHex() const
-{
-  int i=0;
-  for(size_t j=0;j<length();j++)
-    {
-      int k=0;
-      i<<=4;
-      char c=operator[](j);
-      if(c>='A'&&c<='F')
-        k=c-'A'+10;
-      else if(c>='a' && c<='f')
-        k=c-'a'+10;
-      else if(c>='0' && c<='9')
-        k=c-'0';
-      i+=k;
-    }
-  return i;
-}
-
-AGString AGString::toHex(int i)
-  {
-    std::string s;
-    std::string c="0";
-    while(i!=0)
-      {
-        int k=i&0xF;
-
-        if(k>9)
-          c[0]='A'+k-10;
-        else
-          c[0]='0'+k;
-
-        s=c+s;
-        i>>=4;
-      }
-
-    while(s.length()<2)
-      s=std::string("0")+s;
-    return AGString(s);
-  }
-
-bool AGString::toBool() const
-{
-  if(length()==0)
-    return false;
-  if(operator[](0)=='1')
-    return true;
-  if(substr(0,4)=="true")
-    return true;
-  return false;
-}
-
-
-bool AGString::matches(const std::string &regex) const
-{
-  return rubyMatchRegex(*this,regex);
-}
-
-AGString AGString::last(size_t n) const
-{
-  
-}

Deleted: antargis/trunk/ext/basic/ag_string.h
===================================================================
--- antargis/trunk/ext/basic/ag_string.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_string.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,64 +0,0 @@
-#ifndef AG_STRING
-#define AG_STRING
-
-#include <ag_base.h>
-#include <string>
-#include <vector>
-#include <SDL.h>
-
-
-/** A string class that natively supports UTF-8 */
-class AGEXPORT AGString:public std::string
-{
-public:
-  static const size_t npos = static_cast<size_t>(-1);
-
-  AGString();
-  AGString(const std::string &p);
-  AGString(const std::string &p,size_t many);
-  AGString(const AGString &p);
-  explicit AGString(int i);
-  explicit AGString(size_t i);
-  explicit AGString(long i);
-  explicit AGString(float f);
-  AGString(const char c,size_t many=1);
-  AGString(const char*c);
-  AGString(const char*c,size_t size);
-
-#ifndef SWIiG
-  AGString &operator=(const AGString &s);
-
-  AGString &operator+=(const AGString &p);
-#endif
-
-  // size in bytes
-  size_t memory() const;
-
-  AGString substr(size_t from,size_t len) const;
-
-  std::vector<AGString> split(const AGString &p) const;
-
-  AGString replace(const AGString &what, const AGString &by) const;
-  
-  AGString last(size_t n) const;
-
-  AGString operator+(const AGString &s) const;
-  AGString operator+(const char *s) const;
-  AGString operator+(const std::string &s) const;
-
-  int toInt() const;
-  long toLong() const;
-  float toFloat() const;
-  bool toBool() const;
-
-  Uint8 toUint8() const;
-  Sint16 toSint16() const;
-
-  int parseHex() const;
-
-  static AGString toHex(int i);
-  
-  bool matches(const std::string &regex) const;
-};
-
-#endif

Modified: antargis/trunk/ext/basic/ag_string_utf8.cc
===================================================================
--- antargis/trunk/ext/basic/ag_string_utf8.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_string_utf8.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,7 @@
 #include <ag_string_utf8.h>
-#include <ag_debug.h>
-#include <ag_utf8.h>
+#include <rk_string.h>
+#include <rk_debug.h>
+#include <rk_utf8.h>
 
 ///////////////////////////////////////////////////////////////////////////
 // Classes for UTF-8 support
@@ -399,7 +400,7 @@
   is>>i;
   return i;
 }
-Sint16 AGStringUtf8::toSint16() const 
+Sint16 AGStringUtf8::toSint16() const
 {
   long i;
   std::istringstream is;

Modified: antargis/trunk/ext/basic/ag_string_utf8.h
===================================================================
--- antargis/trunk/ext/basic/ag_string_utf8.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_string_utf8.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,10 +3,11 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
+#include <rk_base.h>
+
 #include <string>
 #include <vector>
 #include <SDL.h>
-#include <ag_base.h>
 
 class AGStringUtf8;
 class AGString;
@@ -29,8 +30,8 @@
   bool operator!=(const AGCharUtf8 &c) const;
   bool operator!=(const char pChar) const;
 #endif
-  
 
+
   std::string getString() const;
 
   size_t memory() const;
@@ -43,7 +44,7 @@
 
 class AGEXPORT AGStringUtf8Iterator
 {
-  
+
 };
 
 /** A string class that natively supports UTF-8 */
@@ -73,8 +74,8 @@
 #endif
   AGStringUtf8(const char*c);
   AGStringUtf8(const char*c,size_t size);
-  
-  
+
+
 #ifdef SWIG
   %rename(set) operator=(const AGStringUtf8 &s);
   %rename(set) operator=(const AGCharUtf8 &s);
@@ -114,7 +115,7 @@
   size_t find(const AGStringUtf8 &p,size_t pos=0) const;
 
   AGStringUtf8 replace(const AGStringUtf8 &what, const AGStringUtf8 &by) const;
-  
+
   AGStringUtf8 operator+(const AGStringUtf8 &s) const;
   AGStringUtf8 operator+(const AGString &s) const;
   AGStringUtf8 operator+(const char *s) const;

Modified: antargis/trunk/ext/basic/ag_stringstream.h
===================================================================
--- antargis/trunk/ext/basic/ag_stringstream.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_stringstream.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,7 +3,8 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
-#include <ag_string.h>
+#include <rk_string.h>
+
 #include <SDL.h>
 
 

Deleted: antargis/trunk/ext/basic/ag_tools.cc
===================================================================
--- antargis/trunk/ext/basic/ag_tools.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_tools.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,106 +0,0 @@
-/*
- * Copyright (c) 2005 by David Kamphausen. All rights reserved.
- *
- * ag_tools.cc
- * by David Kamphausen (david.kamphausen at web.de)
- *
- * The "Antargis" project, including all files needed to compile it,
- * is free software; you can redistribute it and/or use it and/or modify it
- * under the terms of the GNU General Public License as published
- * by the Free Software Foundation; either version 2 of the License,
- * or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
- *
- * You should have received a copy of the GNU General Public
- * License along with this program.
- */
-
-#include "ag_tools.h"
-#include "ag_debug.h"
-
-int toInt(const std::string &s)
-  {
-    return atoi(s.c_str());
-  }
-long toLong(const std::string &s)
-  {
-    return atol(s.c_str());
-  }
-float toFloat(const std::string &s)
-  {
-    float f=atof(s.c_str());
-    return f;
-  }
-
-int fromHex(const std::string &s)
-  {
-    int i=0;
-    for(size_t j=0;j<s.length();j++)
-      {
-        int k=0;
-        i<<=4;
-        char c=s[j];
-        if(c>='A'&&c<='F')
-          k=c-'A'+10;
-        else if(c>='a' && c<='f')
-          k=c-'a'+10;
-        else if(c>='0' && c<='9')
-          k=c-'0';
-        i+=k;
-      }
-    return i;
-  }
-std::string toHex(int i)
-  {
-    std::string s;
-    std::string c="0";
-    while(i!=0)
-      {
-        int k=i&0xF;
-
-        if(k>9)
-          c[0]='A'+k-10;
-        else
-          c[0]='0'+k;
-
-        s=c+s;
-        i>>=4;
-      }
-
-
-    while(s.length()<2)
-      s=std::string("0")+s;
-    return s;
-  }
-
-
-std::vector<std::string> split(const std::string &needle,const std::string &haystack)
-{
-  std::vector<std::string> d;
-  size_t i,last=0;
-  for(i=haystack.find(needle);i!=std::string::npos;i=haystack.find(needle,i+1))
-    {
-      d.push_back(haystack.substr(last,i-last));
-      last=i+needle.length();
-    }
-  i=haystack.length();
-  d.push_back(haystack.substr(last,i-last));
-  return d;
-}
-
-
-
-std::string replace(const std::string &s,const std::string &a,const std::string &b)
-  {
-    std::string str=s;
-    size_t i=str.find(a);
-    while(i!=str.npos)
-      {
-        str=str.substr(0,i)+b+str.substr(i+a.length(),str.length()-i-a.length());
-        i=str.find(a,i+b.length());
-      }
-    return str;
-  }

Deleted: antargis/trunk/ext/basic/ag_tools.h
===================================================================
--- antargis/trunk/ext/basic/ag_tools.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_tools.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,87 +0,0 @@
-/*
- * Copyright (c) 2005 by David Kamphausen. All rights reserved.
- *
- * ag_tools.h
- * by David Kamphausen (david.kamphausen at web.de)
- *
- * The "Antargis" project, including all files needed to compile it,
- * is free software; you can redistribute it and/or use it and/or modify it
- * under the terms of the GNU General Public License as published
- * by the Free Software Foundation; either version 2 of the License,
- * or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
- *
- * You should have received a copy of the GNU General Public
- * License along with this program.
- */
-
-#ifndef AG_TOOLS_H
-#define AG_TOOLS_H
-
-#include <string>
-#include <list>
-#include <sstream>
-
-#ifdef WIN32
-#include <windows.h>
-#include <winsock.h>
-#endif
-
-#include <ag_fs.h>
-#include <ag_base.h>
-
-std::vector<std::string> AGEXPORT split(const std::string &n,const std::string &h);
-
-
-std::string AGEXPORT replace(const std::string &s,const std::string &a,const std::string &b);
-
-template<class T>
-inline std::string toString(const T&t)
-{
-  std::ostringstream os;
-  os<<t;
-  return os.str();
-}
-
-template<>
-inline std::string toString(const bool&b)
-{
-  if(b)
-    return "true";
-  else
-    return "false";
-}
-
-inline bool toBool(const std::string &s)
-{
-  return(s=="true");
-}
-
-AGEXPORT int toInt(const std::string &s);
-AGEXPORT long toLong(const std::string &s);
-AGEXPORT float toFloat(const std::string &s);
-AGEXPORT int fromHex(const std::string &s);
-AGEXPORT std::string toHex(int i);
-
-template<class T>
-void append(std::list<T> &l1,const std::list<T> &l2)
-{
-  typename std::list<T>::const_iterator i=l2.begin();
-  for(;i!=l2.end();i++)
-    l1.push_back(*i);
-}
-
-template<class T>
-void append(std::vector<T> &l1,const std::vector<T> &l2)
-{
-  typename std::vector<T>::const_iterator i=l2.begin();
-  for(;i!=l2.end();i++)
-    l1.push_back(*i);
-}
-
-#define AGsign(x) ((x)<0?-1:(x)>0?1:0)
-
-#endif

Deleted: antargis/trunk/ext/basic/ag_utf8.cc
===================================================================
--- antargis/trunk/ext/basic/ag_utf8.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_utf8.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,75 +0,0 @@
-#include "ag_utf8.h"
-#include "ag_debug.h"
-
-size_t agFirstCharSize(const std::string &s,size_t pos)
-{
-  unsigned char c=s[pos];
-  size_t l=1;
-  if((c&0xF0)==0xF0)
-    l=4;
-  else if((c&0xE0)==0xE0)
-    l=3;
-  else if((c&0xC0)==0xC0)
-    l=2;
-  assert(l+pos<=s.length());
-  return l;
-    
-}
-size_t agStringLength(const std::string &s)
-{
-  size_t c=0;
-  size_t l=0;
-  //  cdebug("in:"<<s);
-  while(c<s.length())
-    {
-      size_t cl=agFirstCharSize(s,c);
-      //      cdebug(cl<<"::"<<c<<"  "<<s.length());
-      c+=cl;
-      l++;
-    }
-  //  cdebug("len:"<<l);
-  return l;
-}
-
-std::string agSubStr(const std::string &s,size_t from,size_t len)
-{
-  size_t i=0;
-  size_t c=0;
-  while(i<from && c<s.length())
-    {
-      c+=agFirstCharSize(s,c);
-      i++;
-    }
-  if(i<from)
-    return "";
-
-  std::string r;
-  size_t d;
-  for(i=0;i<len && c<s.length();i++)
-    {
-      d=agFirstCharSize(s,c);
-      r+=s.substr(c,d);
-      c+=d;
-    }
-  return r;
-}
-
-std::string unicode2Utf8(Uint16 unicode)
-{
-  std::ostringstream os;
-
-  if(unicode < 0x80)
-    os<<char(unicode & 0x7f);
-  else if(unicode < 0x800)
-    os<<char((unicode >>6)|0xc0)<<char((unicode & 0x3f)|0x80);
-#ifdef BIGGER_UNICODE
-  else if(unicode < 0x10000)
-    os<<char((unicode >>12)|0xe0)<<char(((unicode >> 6)&0x3f)|0x80)<<char((unicode&0x3f)|0x80);
-  else if(unicode <= 0x0010 FFFF)
-    os<<char((unicode >>18)|0xF0)<<char(((unicode >>12)&0x3f)|0x80)<<char(((unicode>>6)0x3f)|0x80)<<char((unicode&0x3f)|0x80);
-#else
-  else
-    os<<char((unicode >>12)|0xe0)<<char(((unicode >> 6)&0x3f)|0x80)<<char((unicode&0x3f)|0x80);
-#endif
-  return os.str();
-}

Deleted: antargis/trunk/ext/basic/ag_utf8.h
===================================================================
--- antargis/trunk/ext/basic/ag_utf8.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_utf8.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,16 +0,0 @@
-#ifndef AG_UTF8_H
-#define AG_UTF8_H
-
-// INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
-
-#include <ag_base.h>
-#include <string>
-#include <vector>
-#include <SDL.h>
-
-AGEXPORT size_t agFirstCharSize(const std::string &s,size_t pos=0);
-AGEXPORT size_t agStringLength(const std::string &s);
-AGEXPORT std::string agSubStr(const std::string &s,size_t from,size_t len);
-AGEXPORT std::string unicode2Utf8(Uint16 unicode);
-
-#endif

Modified: antargis/trunk/ext/basic/ag_video_base.cc
===================================================================
--- antargis/trunk/ext/basic/ag_video_base.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_video_base.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include <ag_video_base.h>
 
-AGVideoBase::~AGVideoBase()
+AGVideoBase::~AGVideoBase() throw()
 {
 }
 

Modified: antargis/trunk/ext/basic/ag_video_base.h
===================================================================
--- antargis/trunk/ext/basic/ag_video_base.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_video_base.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -8,7 +8,7 @@
 class AGEXPORT AGVideoBase:public AGSingleton
 {
  public:
-  virtual ~AGVideoBase();
+  virtual ~AGVideoBase() throw();
   virtual int width() const;
   virtual int height() const;
 

Modified: antargis/trunk/ext/basic/ag_xml.cc
===================================================================
--- antargis/trunk/ext/basic/ag_xml.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_xml.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,11 +20,9 @@
 
 #include "ag_xml.h"
 #include "ag_fs.h"
-#include "ag_debug.h"
-//#ifndef __WIN32__
-//#include "ag_regex.h"
-//#endif
-#include "ag_debug.h"
+
+#include "rk_debug.h"
+
 #include "ag_profiler.h"
 
 /**

Modified: antargis/trunk/ext/basic/ag_xml.h
===================================================================
--- antargis/trunk/ext/basic/ag_xml.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_xml.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,14 +23,15 @@
 #ifndef __MY_SIMPLE_XML
 #define __MY_SIMPLE_XML
 
-#include <ag_tools.h>
-#include <ag_utf8.h>
+#include <rk_tools.h>
+#include <rk_utf8.h>
+#include "rk_debug.h"
+
 #include <vector>
 #include <map>
 #include <ag_stringstream.h>
 #include <sstream>
 
-#include "ag_debug.h"
 
 struct XMLParseError
   {
@@ -63,7 +64,7 @@
     const Node *(operator->)() const;
 #endif
     NodeVector getChildren(const AGString &pName) const;
-    
+
     const AGString &getName() const;
 
     void setAttributes(const Attributes &pAttrs);
@@ -74,9 +75,11 @@
     void removeChild(Node &n);
 
     iterator begin();
+    iterator end();
+#ifndef SWIG
     const_iterator begin() const;
-    iterator end();
     const_iterator end() const;
+#endif
 
     void setContent(const AGString &s);
     AGString getContent() const;
@@ -91,15 +94,16 @@
     // dumping functions
     void getStart(AGStringStream &s,bool complete=false) const;
     void getEnd(AGStringStream &s) const;
-      
+
     void indent(AGStringStream &s,int depth) const;
     void getContent(AGStringStream &s,int depth) const;
     AGString toString(bool indent=true) const;
-    
+
     bool isTextNode() const;
     AGString getText() const;
 
-    bool hasTextNode() const; // me or direct children is text node
+    /** me or direct children is text node */
+    bool hasTextNode() const; 
 
     size_t size() const;
 
@@ -202,6 +206,6 @@
 
   Document *parse(const AGString &pData,Document *d);
 };
-  
 
+
 #endif

Modified: antargis/trunk/ext/basic/init.cc
===================================================================
--- antargis/trunk/ext/basic/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,11 +1,13 @@
 #include <ag_main.h>
-#include <ag_debug.h>
+#include <rk_debug.h>
 
 #include <list>
 #include <string>
 #include <string>
 #include <map>
 
+#include <SDL.h>
+
 //#include "antargisexternalswig.h"
 
 typedef struct swig_type_info;

Modified: antargis/trunk/ext/external/mtwist.h
===================================================================
--- antargis/trunk/ext/external/mtwist.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/external/mtwist.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,7 +1,7 @@
 #ifndef MTWIST_H
 #define MTWIST_H
 
-#include <ag_base.h>
+#include <rk_base.h>
 
 /*
  * $Id: mtwist.h,v 1.15 2003/09/11 23:56:20 geoff Exp geoff $
@@ -198,7 +198,7 @@
   /* ..Not usually worth the cost.  */
 
 
-  // was extern                    
+  // was extern
 
   AGEXPORT void    mts_refresh(mt_state* state);
   /* Generate 624 more random values */
@@ -341,7 +341,7 @@
 
 #ifdef __cplusplus
 //extern "C" {
-extern "C" 
+extern "C"
 #ifdef WIN32
 /*
 #ifdef MT_EXTERN
@@ -368,7 +368,7 @@
 }
 #else
 #ifdef WIN32
-__declspec(dllexport) 
+__declspec(dllexport)
 #endif
 extern   double    mt_32_to_double;
 #endif*/

Modified: antargis/trunk/ext/game/ant_app.cc
===================================================================
--- antargis/trunk/ext/game/ant_app.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/ant_app.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -13,7 +13,7 @@
   hx=hy=-1;
 }
 
-GLApp::~GLApp()
+GLApp::~GLApp() throw()
   {
     CTRACE;
   }
@@ -168,7 +168,7 @@
     return scene;
   }
 
-void GLApp::mark()
+void GLApp::mark() throw()
   {
     //CTRACE;
     markObject(&scene);

Modified: antargis/trunk/ext/game/ant_app.h
===================================================================
--- antargis/trunk/ext/game/ant_app.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/ant_app.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -12,7 +12,7 @@
  *    \see AntargisGUI
  *    \see Engine3d
  *    \see GameEngine
- * 
+ *
  *    For information about the overall-architecture please refer to the ruby-documentation at: ../ruby/index.html
  *
   */
@@ -24,7 +24,7 @@
 #include <iostream>
 #include <fstream>
 #include <ag_application.h>
-#include <ag_debug.h>
+#include <rk_debug.h>
 #include <ag_main.h>
 #include <ag_geometry.h>
 
@@ -51,7 +51,7 @@
 
 public:
   GLApp(int w,int h);
-  ~GLApp();
+  ~GLApp() throw();
 
   virtual void draw();
   void drawGL();
@@ -72,7 +72,7 @@
   virtual void setCamera(const AGVector2&p);
   AGVector2 getCamera() const;
 
-  void mark();
+  void mark() throw();
 };
 
 

Modified: antargis/trunk/ext/game/entity.cc
===================================================================
--- antargis/trunk/ext/game/entity.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/entity.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include "entity.h"
 #include "map.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "jobs.h"
 #include "mesh.h"
 #include "anim_mesh.h"
@@ -79,7 +79,7 @@
   }
 
 
-AntEntity::~AntEntity()
+AntEntity::~AntEntity() throw()
   {
     CTRACE;
     //#error called several times
@@ -138,7 +138,7 @@
     Node::const_iterator i=v.begin();
     for(;i!=v.end();i++)
       mPos.loadXML(**i);
-    
+
     AGString entID=node.get("entityID");
     if(entID.length()>0)
       mID=entID.toInt();
@@ -651,7 +651,7 @@
 
 
 
-void AntEntity::mark()
+void AntEntity::mark() throw()
   {
     AGRubyObject::mark();
     for(Meshes::iterator i=mMeshes.begin();i!=mMeshes.end();i++)
@@ -674,7 +674,7 @@
   }
 
 
-void AntEntity::clear()
+void AntEntity::clear() throw()
   {
     clearMeshes();
   }

Modified: antargis/trunk/ext/game/entity.h
===================================================================
--- antargis/trunk/ext/game/entity.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/entity.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,11 +23,12 @@
 #ifndef ANT_ENTITY_H
 #define ANT_ENTITY_H
 
+#include <rk_string.h>
+
 #include "scene.h"
 #include <ag_xml.h>
 #include <ag_geometry.h>
 #include <ag_color.h>
-#include <ag_string.h>
 
 #include <set>
 #include <vector>
@@ -72,7 +73,7 @@
     /// current food in stomach
     float mFood;
     /// food needed per second
-    float mHunger; 
+    float mHunger;
     /// hunger impact on energy
     float mHungerHitEnergy;
     /// hunger impact on morale
@@ -96,7 +97,7 @@
 
     float mStrength;
     float mMoraleStrength;
-    
+
     float mDefense;
 
     bool mDefeated;
@@ -111,7 +112,7 @@
 
   public:
     AntEntity(AntMap *pMap);
-    virtual ~AntEntity();
+    virtual ~AntEntity() throw();
 
     bool defeated() const;
 
@@ -201,7 +202,7 @@
 
     void setAggression(float agg);
     float getAggression() const;
-    
+
     virtual void eventDie(); // energy too low
     virtual void eventDefeated(); // morale too low
     virtual void eventHaveDefeated(AntEntity *e);
@@ -262,9 +263,9 @@
     void eventMapChanged();
     void move(float pTime); // move entity FIXME: del move
 
-    void mark();
+    void mark() throw();
 
-    void clear();
+    void clear() throw();
     void clearMeshes();
 
     void setVisible(bool v);

Modified: antargis/trunk/ext/game/entptr.cc
===================================================================
--- antargis/trunk/ext/game/entptr.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/entptr.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,6 @@
+/*
+
 #include "entptr.h"
-// AntEntityPtr
 AntEntityPtr::AntEntityPtr():p(0)
 {
 }
@@ -16,3 +17,5 @@
   assert(p);
   return p;
 }
+
+*/

Modified: antargis/trunk/ext/game/entptr.h
===================================================================
--- antargis/trunk/ext/game/entptr.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/entptr.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,3 +1,5 @@
+/*
+
 #ifndef ENTPTR_H
 #define ENTPTR_H
 
@@ -19,3 +21,6 @@
 
 
 #endif
+
+
+*/

Modified: antargis/trunk/ext/game/height_map.cc
===================================================================
--- antargis/trunk/ext/game/height_map.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/height_map.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -4,7 +4,7 @@
 #include <ag_main.h>
 #include <ag_rand.h>
 
-#include <ag_rtools.h>
+#include <rk_rtools.h>
 
 //////////////////////////////////////////////////////////////////////////
 // HeightMap
@@ -39,11 +39,11 @@
     setTerrainScale(FOREST,23/32.0);
     setTerrainScale(ROCK,31/32.0);
     setTerrainScale(ROCK2,31/32.0);
-    
+
     checkTerrain();
   }
 
-HeightMap::~HeightMap()
+HeightMap::~HeightMap() throw()
   {
     if(mTerrain)
       saveDelete(mTerrain);
@@ -631,7 +631,7 @@
   return found;
 }
 
-void HeightMap::mark()
+void HeightMap::mark() throw()
   {
     //  std::cout<<"HeightMap::mark tihs:"<<this<<" scene:"<<mScene<<std::endl;
     if(mScene)

Modified: antargis/trunk/ext/game/height_map.h
===================================================================
--- antargis/trunk/ext/game/height_map.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/height_map.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -24,7 +24,7 @@
 {
  public:
   HeightMap(SceneBase *pScene,int w,int h);
-  virtual ~HeightMap();
+  virtual ~HeightMap() throw();
 
   // get status
 
@@ -86,7 +86,7 @@
   /// override this function to include another terrain-mesh-type (like 2d-terrain)
   virtual void initTerrainMesh();
 
-  void mark();
+  void mark() throw();
 
   /// to be used by initTerrainMesh() - not otherwise !!!
   void setTerrain(TerrainBase *pTerrain);

Modified: antargis/trunk/ext/game/heuristic.cc
===================================================================
--- antargis/trunk/ext/game/heuristic.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/heuristic.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,11 +1,11 @@
 #include "heuristic.h"
-#include <ag_debug.h>
+#include <rk_debug.h>
 #include <ag_profiler.h>
 #include "ag_serial_vec.h"
 
 #include <set>
 
-HeuristicFunction::Output HeuristicFunction::operator()(const Input &input) 
+HeuristicFunction::Output HeuristicFunction::operator()(const Input &input)
 {
   return (input.second-input.first).length()*1.5;
 }

Modified: antargis/trunk/ext/game/init.cc
===================================================================
--- antargis/trunk/ext/game/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,4 @@
-#include <ag_debug.h>
+#include <rk_debug.h>
 
 #include <minimap.h>
 

Modified: antargis/trunk/ext/game/map.cc
===================================================================
--- antargis/trunk/ext/game/map.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/map.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -24,7 +24,7 @@
 #include "entity.h"
 #include <vector>
 #include <math.h>
-#include <ag_debug.h>
+#include <rk_debug.h>
 #include "mesh.h"
 #include "terrain.h"
 #include "quadtree.h"
@@ -53,7 +53,7 @@
     myAntargisMap=this;
     maxID=0;
   }
-AntMap::~AntMap()
+AntMap::~AntMap() throw()
   {
     CTRACE;
     if(myAntargisMap==this)
@@ -117,7 +117,7 @@
     std::list<AntEntity*>::iterator k=mEntities.begin();
     for(;k!=mEntities.end();k++)
       (*k)->eventMapChanged();
-    
+
     return seemsok;
   }
 
@@ -157,7 +157,7 @@
 
 void AntMap::move(float pTime)
   {
-    STACKTRACE; 
+    STACKTRACE;
     //return;
     // first remove entities, which shall be deleted
     std::list<AntEntity*>::iterator d=mToDel.begin();
@@ -228,7 +228,7 @@
 
 
     EntityList::iterator i=mEntities.begin();
-    AGVector2 p=me->getPos2D(); 
+    AGVector2 p=me->getPos2D();
 
     for(;i!=mEntities.end();i++)
       {
@@ -370,7 +370,7 @@
     saveFile(pFilename,c);
   }
 
-void AntMap::clear()
+void AntMap::clear() throw()
   {
     //  getScene()->clear();
     CTRACE;
@@ -438,7 +438,7 @@
 
 //bool markingFinished=true;
 
-void AntMap::mark()
+void AntMap::mark() throw()
   {
     //  cout<<"AntMap::mark()"<<std::endl;
     CTRACE;

Modified: antargis/trunk/ext/game/map.h
===================================================================
--- antargis/trunk/ext/game/map.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/map.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -42,19 +42,20 @@
 {
  public:
   typedef std::list<AntEntity*> EntityList;
+  typedef AntEntity*PAntEntity;
 
   AntMap(SceneBase *pScene,int w,int h);
-  ~AntMap();
-  
+  ~AntMap() throw();
+
   virtual void insertEntity(AntEntity *e);
   virtual void removeEntity(AntEntity *p);
-  void clear();
+  void clear() throw();
 
   int getNewID();
   void useID(int id);
 
   void newMap(int w,int h);
-  
+
   EntityList getEntities(const AGRect2&r);
   std::list<AntEntity*> getAllEntities();
   std::vector<AntEntity*> getEntities(const AGString &pName);
@@ -83,9 +84,9 @@
 
   AGVector3 getPos(const AGVector2 &pPos) const;
 
-  virtual void mark();
+  virtual void mark() throw();
 
-  virtual void mapChanged();  
+  virtual void mapChanged();
 
  private:
   typedef std::map<size_t,AntEntity*> EntityMap;
@@ -95,7 +96,7 @@
   QuadTree<AntEntity> *mEntQuad;
 
   //  typedef std::map<AGString,std::set<AntEntity*> > EntityByType;
-  
+
   EntityList mToDel;
 
   //  EntityByType mByType;

Modified: antargis/trunk/ext/game/minimap.cc
===================================================================
--- antargis/trunk/ext/game/minimap.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/minimap.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,6 +3,7 @@
 #include <ag_screen.h>
 #include <ag_profiler.h>
 #include "ant_app.h"
+#include "entity.h"
 
 #define MAP_BORDER
 
@@ -18,7 +19,7 @@
       setMap(mMap);
     }
 
-MiniMap::~MiniMap()
+MiniMap::~MiniMap() throw()
   {
     saveDelete(mTexture);
   }
@@ -93,7 +94,7 @@
 
     TerrainType t;
 
-    assert(mMap);  
+    assert(mMap);
 
     if(mMap)
       {

Modified: antargis/trunk/ext/game/minimap.h
===================================================================
--- antargis/trunk/ext/game/minimap.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/minimap.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -26,7 +26,7 @@
 {
  public:
   MiniMap(AGWidget *p,const AGRect2 &r,AntMap *pMap);
-  virtual ~MiniMap();
+  virtual ~MiniMap() throw();
   
   /// changes only part of the texture - shouldn't be called if the whole texture is changed, because this is SLOW!
   bool mapChanged(AGEvent *e);

Modified: antargis/trunk/ext/game/path.cc
===================================================================
--- antargis/trunk/ext/game/path.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/path.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -2,7 +2,7 @@
 #include <math.h>
 #include <stdexcept>
 #include <ag_profiler.h>
-#include <ag_debug.h>
+#include <rk_debug.h>
 //#include <SDL.h>
 #include <ag_surface.h>
 #include <ag_painter.h>
@@ -118,7 +118,7 @@
 {
 }
 
-PathWeighter::~PathWeighter()
+PathWeighter::~PathWeighter() throw()
   {
   }
 float PathWeighter::weight(float h0,float h1)
@@ -214,7 +214,7 @@
       return (b-a)*f;
     }
   else
-    return -(b-a)*f*0.3; 
+    return -(b-a)*f*0.3;
 }
 
 bool MapPathWeighter::accessible(const AGVector2 &a)
@@ -467,7 +467,7 @@
 
 
 
-SimpleGraph::~SimpleGraph()
+SimpleGraph::~SimpleGraph() throw()
   {
     CTRACE;
     for(NodeSet::iterator i=mNodes.begin();i!=mNodes.end();i++)
@@ -566,7 +566,7 @@
   cdebug("old:"<<(&g));
 }
 
-DecimatedGraph::~DecimatedGraph()
+DecimatedGraph::~DecimatedGraph() throw()
   {
     CTRACE;
   }
@@ -1028,7 +1028,7 @@
     cdebug("Simplegraph:"<<mGraph);
   }
 
-void Pathfinder::mark()
+void Pathfinder::mark() throw()
   {
     markObject(mGraph);
   }

Modified: antargis/trunk/ext/game/path.h
===================================================================
--- antargis/trunk/ext/game/path.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/path.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -43,7 +43,7 @@
 {
  public:
   PathWeighter(bool pWaterPassable=false);
-  virtual ~PathWeighter();
+  virtual ~PathWeighter() throw();
   /// this function can be overridden - and will be
   virtual float weight(float h0,float h1);
 
@@ -175,7 +175,7 @@
   void print();
   void printInfo();
 
-  ~SimpleGraph();
+  ~SimpleGraph() throw();
 
 
   void check();
@@ -232,7 +232,7 @@
  public:
   DecimatedGraph();
   DecimatedGraph(const SimpleGraph &g);
-  ~DecimatedGraph();
+  ~DecimatedGraph() throw();
   void decimate(float amount,MapPathWeighter *pWeighter);
  private:
   void tryRemove(Edge *e,MapPathWeighter *pWeighter);
@@ -289,7 +289,7 @@
 
   Pathfinder(SimpleGraph *pGraph,HeuristicFunction *pHeuristic,PathDebugging *pDebugger=0);
 
-  virtual void mark();
+  virtual void mark() throw();
 
   std::vector<AGVector2> computePath(const AGVector2 &from, const AGVector2 &to);
 

Modified: antargis/trunk/ext/game/terrain.cc
===================================================================
--- antargis/trunk/ext/game/terrain.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/terrain.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -37,7 +37,7 @@
     setOrder(TERRAIN_Z);
   }
 
-TerrainPiece::~TerrainPiece()
+TerrainPiece::~TerrainPiece() throw()
   {
     if(sceneValid())
       getScene()->removeNode(this);
@@ -228,7 +228,7 @@
     map.sigMapChangedComplete.connect(slot(this,&TerrainBase::slotMapChangedComplete));
   }
 
-TerrainBase::~TerrainBase()
+TerrainBase::~TerrainBase() throw()
   {
   }
 
@@ -316,7 +316,7 @@
   }
 
 
-Terrain::~Terrain()
+Terrain::~Terrain() throw()
   {
     for(Nodes::iterator i=mNodes.begin();i!=mNodes.end();i++)
       saveDelete(*i);
@@ -344,7 +344,7 @@
     return &mGrass;
   }
 
-void Terrain::mark()
+void Terrain::mark() throw()
   {
     //  std::cout<<"Terrain::mark()"<<std::endl;
     for(Nodes::iterator i=mNodes.begin();i!=mNodes.end();i++)

Modified: antargis/trunk/ext/game/terrain.h
===================================================================
--- antargis/trunk/ext/game/terrain.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/terrain.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -30,7 +30,7 @@
 {
  public:
   TerrainPiece(SceneBase *pScene,Terrain *t,HeightMap &map,int x,int y,int w,int h,const AGVector4 &pPos,int scale);
-  virtual ~TerrainPiece();
+  virtual ~TerrainPiece() throw();
 
   void draw();
   void drawShadow();
@@ -62,7 +62,7 @@
 {
  public:
   TerrainBase(SceneBase *pScene,HeightMap &map);
-  virtual ~TerrainBase();
+  virtual ~TerrainBase() throw();
 
   HeightMap *getMap();
   SceneBase *getScene();
@@ -112,7 +112,7 @@
 public:
   Terrain(SceneBase *pScene,HeightMap &map);
 
-  virtual ~Terrain();
+  virtual ~Terrain() throw();
 
   AGTexture *get3dTexture();
   AGTexture *getGrassTexture();
@@ -122,7 +122,7 @@
   /// the whole map is changed - so better take care of this (texture-upload instead of repainting on GPU)
   virtual void mapChangedComplete();
 
-  void mark();
+  void mark() throw();
 
  private:
   void init();

Modified: antargis/trunk/ext/game/water.cc
===================================================================
--- antargis/trunk/ext/game/water.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/water.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -44,7 +44,7 @@
   }
 
 
-WaterPiece::~WaterPiece()
+WaterPiece::~WaterPiece() throw()
   {
     if(sceneValid())
       getScene()->removeNode(this);

Modified: antargis/trunk/ext/game/water.h
===================================================================
--- antargis/trunk/ext/game/water.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/water.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -26,7 +26,7 @@
   AGTexture tex;
  public:
   WaterPiece(SceneBase *pScene,HeightMap &map,int x,int y,int w,int h,const AGVector4 &pos);
-  virtual ~WaterPiece();
+  virtual ~WaterPiece() throw();
 
   /// draw in normal mode
   void draw();

Modified: antargis/trunk/ext/gui/ag_application.cc
===================================================================
--- antargis/trunk/ext/gui/ag_application.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_application.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,13 +23,14 @@
 #include "ag_screen.h"
 #include "ag_glscreen.h"
 #include "ag_main.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_mixer.h"
 #include "ag_texturecache.h"
 #include "ag_profiler.h"
 #include "ag_clip_painttarget.h"
 #include "ag_video.h"
 #include "ag_vdebug.h"
+#include "ag_painter.h"
 
 #include <ruby.h>
 
@@ -55,7 +56,7 @@
     mDemoTime=-1;
   }
 
-AGApplication::~AGApplication()
+AGApplication::~AGApplication() throw()
   {
     CTRACE;
     if(mainWidget)
@@ -377,7 +378,7 @@
 
         pLastDrawn=mainWidget;
 
-        saveDelete( p);
+        saveDelete(p);
       }
     else
       cdebug("no mainwidget");
@@ -389,10 +390,10 @@
         changeList=mainWidget->aquireChanges();
         mainWidget->clearChangeRects();
       }
-    
-    
+
+
     sigFrameFinished(new AGEvent(this,"sigFrameFinished"));
-    
+
     if (opengl())// || true)
       getScreen().flip();
     else
@@ -473,7 +474,7 @@
   }
 
 /// mark my mainWidget and my tooltip, as they can be ruby-objects
-void AGApplication::mark()
+void AGApplication::mark() throw()
   {
 //    CTRACE;
     if (mainWidget)

Modified: antargis/trunk/ext/gui/ag_application.h
===================================================================
--- antargis/trunk/ext/gui/ag_application.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_application.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -79,7 +79,7 @@
 {
  public:
   AGApplication();
-  virtual ~AGApplication();
+  virtual ~AGApplication() throw();
 
   bool run();
 
@@ -157,7 +157,7 @@
   float mDemoTime;
   
  public:
-  void mark();
+  void mark() throw();
 };
 
 /**

Modified: antargis/trunk/ext/gui/ag_background.cc
===================================================================
--- antargis/trunk/ext/gui/ag_background.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_background.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,7 +21,7 @@
 #include "ag_background.h"
 #include "ag_draw.h"
 #include "ag_theme.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_painter.h"
 #include "ag_texturecache.h"
 
@@ -70,7 +70,7 @@
 void AGBackground::loadFromTheme(const AGLocalTheme &pTheme,const AGString &pThemeName)
   {
     mColor=false;
-    
+
     if(pTheme.hasSurface(pThemeName+".image"))
       {
         cdebug(pThemeName+".image");
@@ -93,7 +93,7 @@
         mColors[3]=pTheme.getColor(pThemeName+"."+"color");
       }
 
-    mBorder=pTheme.getInt(pThemeName+"."+"border");    
+    mBorder=pTheme.getInt(pThemeName+"."+"border");
   }
 
 

Modified: antargis/trunk/ext/gui/ag_button.cc
===================================================================
--- antargis/trunk/ext/gui/ag_button.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_button.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,7 +22,7 @@
 #include "ag_draw.h"
 #include "ag_edit.h"
 #include "ag_theme.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_image.h"
 #include "ag_border.h"
 #include "ag_glscreen.h"
@@ -63,9 +63,13 @@
 
     if(opengl())
       setCaching(true);
-      
+
   }
+AGButton::~AGButton() throw()
+  {}
 
+
+
 void AGButton::setSurface(AGSurface pSurface,bool pChangeSize)
   {
     mSurface=pSurface;
@@ -140,9 +144,9 @@
 
     if(mState==NORMAL || mState==LIGHTED)
       p.drawBorder(mr,borderWidth,bc1,bc2);
-    else 
+    else
       p.drawBorder(mr,borderWidth,bc2,bc1);
-      
+
   }
 
 
@@ -261,7 +265,7 @@
 }
 
 /**
-   dis- or enables the button. disabled buttons are typically displayed greyed and are 
+   dis- or enables the button. disabled buttons are typically displayed greyed and are
    not hoverable or clckable
 
    \param pEnable true or false

Modified: antargis/trunk/ext/gui/ag_button.h
===================================================================
--- antargis/trunk/ext/gui/ag_button.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_button.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -57,6 +57,7 @@
    };
 
   AGButton(AGWidget *pParent,const AGRect2 &r,const AGStringUtf8&pText="",int id=-1);
+  virtual ~AGButton() throw();
 
   void setSurface(AGSurface pSurface,bool pChangeSize=false);
   void setTexture(const AGTexture &pTexture);

Modified: antargis/trunk/ext/gui/ag_caption.cc
===================================================================
--- antargis/trunk/ext/gui/ag_caption.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_caption.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include "ag_caption.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_screen.h"
 
 AGCaption::AGCaption(AGWidget *pParent,const AGRect2 &pRect,const AGStringUtf8 &pText,const AGFont &pFont,const AGBackground &pBG):

Modified: antargis/trunk/ext/gui/ag_checkbox.cc
===================================================================
--- antargis/trunk/ext/gui/ag_checkbox.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_checkbox.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,7 +22,7 @@
 #include "ag_image.h"
 #include "ag_text.h"
 #include "ag_theme.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_layoutfactory.h"
 #include "ag_local.h"
 

Modified: antargis/trunk/ext/gui/ag_colorbutton.cc
===================================================================
--- antargis/trunk/ext/gui/ag_colorbutton.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_colorbutton.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -26,6 +26,10 @@
   {
   }
 
+AGColorButton::~AGColorButton() throw()
+  {}
+
+
 void AGColorButton::draw(AGPainter &p)
   {
     AGWidget::draw(p);

Modified: antargis/trunk/ext/gui/ag_colorbutton.h
===================================================================
--- antargis/trunk/ext/gui/ag_colorbutton.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_colorbutton.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -31,6 +31,7 @@
 {
  public:
   AGColorButton(AGWidget *pParent,const AGRect2 &r,int x,int y);
+  virtual ~AGColorButton() throw();
 
   virtual void draw(AGPainter &p);
 

Modified: antargis/trunk/ext/gui/ag_combo.cc
===================================================================
--- antargis/trunk/ext/gui/ag_combo.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_combo.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,7 +21,7 @@
 #include "ag_application.h"
 #include "ag_button.h"
 #include "ag_combo.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_edit.h"
 #include "ag_listbox.h"
 #include "ag_theme.h"
@@ -44,7 +44,10 @@
     mButton->sigClick.connect(slot(this,&AGComboBox::eventButtonClicked));
   }
 
+AGComboBox::~AGComboBox() throw()
+  {}
 
+
 void AGComboBox::insertItem(const AGString &pID,const AGStringUtf8 &pContent)
   {
     ops.push_back(std::make_pair(pID,pContent));
@@ -121,7 +124,7 @@
     update();
   }
 
-void AGComboBox::clear()
+void AGComboBox::clear() throw()
   {
     ops.clear();
     mID="";

Modified: antargis/trunk/ext/gui/ag_combo.h
===================================================================
--- antargis/trunk/ext/gui/ag_combo.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_combo.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -33,6 +33,7 @@
 {
  public:
   AGComboBox(AGWidget *pParent,const AGRect2 &pRect);
+  virtual ~AGComboBox() throw();
 
   void insertItem(const AGString &pID,const AGStringUtf8 &pContent);
 
@@ -44,7 +45,7 @@
   AGString getSelected() const;
   void setSelected(const AGString &pID);
 
-  void clear();
+  void clear() throw();
   
   virtual void setWidth(float w);
   virtual void setHeight(float w);

Modified: antargis/trunk/ext/gui/ag_edit.cc
===================================================================
--- antargis/trunk/ext/gui/ag_edit.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_edit.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,13 +19,15 @@
  */
 
 #include "ag_edit.h"
+
+#include "rk_debug.h"
+#include "rk_tools.h"
+
 #include "ag_fontengine.h"
 #include "ag_theme.h"
-#include "ag_debug.h"
 #include "ag_menu.h"
 #include "ag_sgeexport.h"
 #include "ag_glscreen.h"
-#include "ag_tools.h"
 
 
 AGEditLine::AGEditLine(const AGStringUtf8 &pText,AGFont pFont,bool pHardEnd):
@@ -292,6 +294,10 @@
       setTheme("edit");
     }
 
+AGEdit::~AGEdit()  throw()
+  {}
+
+
 void AGEdit::setMaxLength(int i)
   {
     mMaxLength=i;
@@ -481,7 +487,7 @@
       {
         cdebug("RETUURN!");
         cdebug(mMultiLine);
-        if(mMultiLine) 
+        if(mMultiLine)
           {
             getActLine();
             AGEditLine l=actLine->split(mCx);
@@ -888,7 +894,7 @@
   return AGStringUtf8(os.str());
 }
 
-void AGEdit::clear()
+void AGEdit::clear() throw()
   {
     mLines.clear();
     mCx=mCy=0;

Modified: antargis/trunk/ext/gui/ag_edit.h
===================================================================
--- antargis/trunk/ext/gui/ag_edit.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_edit.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -27,7 +27,7 @@
 #include "ag_font.h"
 #include "ag_surface.h"
 #include "ag_background.h"
-#include "ag_utf8.h"
+#include "rk_utf8.h"
 #include "ag_string_utf8.h"
 
 enum AGAlign {EDIT_LEFT,EDIT_RIGHT,EDIT_JUSTIFY,EDIT_CENTER};
@@ -44,7 +44,7 @@
 
   virtual void draw(AGPainter &p,const AGVector2 &pPoint,const AGRect2 &pClip);
   virtual void drawCursor(AGPainter &p,int cx,const AGVector2 &pPoint,const AGRect2 &pClip,const AGColor &c);
-  
+
   int height() const;
   int width() const;
 
@@ -80,6 +80,7 @@
 {
  public:
   AGEdit(AGWidget *pParent,const AGRect2 &pRect);
+  virtual ~AGEdit()  throw();
 
   virtual void draw(AGPainter &p);
   virtual void drawBackground(AGPainter &p);
@@ -95,7 +96,7 @@
   void setText(const AGStringUtf8 &pText);
   void setFont(const AGFont &pFont);
 
-  void clear();
+  void clear() throw();
 
   void setMutable(bool pMutable);
 
@@ -121,7 +122,7 @@
   void setInsert(bool pInsert);
 
   void setCursor(int p);
-  
+
   AGSignal sigModified;
 
  private:
@@ -134,10 +135,10 @@
 
   std::list<AGEditLine> mLines;
   AGEditLine *actLine;
-  
+
   int mCx,mCy; // cursor position
   int mViewCy;
-  
+
   Uint32 mCursorTime;
   Uint32 mCursorLast;
   bool mShowCursor;

Modified: antargis/trunk/ext/gui/ag_frame.cc
===================================================================
--- antargis/trunk/ext/gui/ag_frame.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_frame.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,7 +1,8 @@
 #include "ag_frame.h"
 #include "ag_screen.h"
-#include "ag_debug.h"
 
+#include "rk_debug.h"
+
 AGFrame::AGFrame(AGWidget *pParent,const AGRect2 &pRect,int pWidth,int pWidthH):AGWidget(pParent,pRect),
 mWidth(pWidth),mBorder(0),mWidthH(pWidthH<0?pWidth:pWidthH),mTexture((int)width(),(int)height())
 {
@@ -17,7 +18,7 @@
   mBg=0;
 }
 
-AGFrame::~AGFrame()
+AGFrame::~AGFrame() throw()
   {
     delete mBorder;
     delete mBg;

Modified: antargis/trunk/ext/gui/ag_frame.h
===================================================================
--- antargis/trunk/ext/gui/ag_frame.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_frame.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -12,7 +12,7 @@
  public:
   AGFrame(AGWidget *pParent,const AGRect2 &pRect,int width,int widthH=-1); // transparent frame
   AGFrame(AGWidget *pParent,const AGRect2 &pRect,const AGBorder &pBorder);
-  ~AGFrame();
+  ~AGFrame() throw();
 
   void setBackground(const AGBackground &pBg);
 

Modified: antargis/trunk/ext/gui/ag_image.cc
===================================================================
--- antargis/trunk/ext/gui/ag_image.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_image.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include "ag_image.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 
 AGImage::AGImage(AGWidget *pParent,const AGRect2 &r,AGSurface pSurface,bool pTile):
   AGWidget(pParent,r),
@@ -37,7 +37,7 @@
 
 
 
-AGImage::~AGImage()
+AGImage::~AGImage() throw()
   {
   }
 

Modified: antargis/trunk/ext/gui/ag_image.h
===================================================================
--- antargis/trunk/ext/gui/ag_image.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_image.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -31,7 +31,7 @@
  public:
   AGImage(AGWidget *pParent,const AGRect2 &r,AGSurface pSurface,bool pTile);
   AGImage(AGWidget *pParent,const AGRect2 &r,AGTexture pTexture,bool pTile);
-  virtual ~AGImage();
+  virtual ~AGImage() throw();
 
   virtual void draw(AGPainter &p);
 

Modified: antargis/trunk/ext/gui/ag_layout.cc
===================================================================
--- antargis/trunk/ext/gui/ag_layout.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_layout.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include "ag_layout.h"
 #include "ag_xml.h"
-#include "ag_tools.h"
+#include "rk_tools.h"
 #include "ag_theme.h"
 #include "ag_listbox.h"
 #include "ag_combo.h"
@@ -45,13 +45,17 @@
     CTRACE;
   }
 
+AGLayout::~AGLayout() throw()
+  {}
+
+
 void AGLayout::loadXML(const std::string &pXMLData)
   {
     CTRACE;
     getLayoutFactory()->pushLayout(this);
 
     // disable GC here
-    // marking makes problems here - as the widgets are not inserted into the tree 
+    // marking makes problems here - as the widgets are not inserted into the tree
     // when _() is called, which itself is a ruby-dependent thingy
     Document p;
     p.parseMemory(pXMLData);
@@ -233,7 +237,7 @@
   }
 
 
-void AGLayout::mark()
+void AGLayout::mark() throw()
   {
     AGWidget::mark();
     for(std::set<AGWidget*>::iterator i=mTempWidgets.begin();i!=mTempWidgets.end();i++)

Modified: antargis/trunk/ext/gui/ag_layout.h
===================================================================
--- antargis/trunk/ext/gui/ag_layout.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_layout.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -32,6 +32,7 @@
 {
  public:
   AGLayout(AGWidget *pgParent);
+  virtual ~AGLayout() throw();
   
   virtual void loadXML(const std::string &pXMLData);
 
@@ -42,7 +43,7 @@
 
   static void registerLayouts();
 
-  virtual void mark();
+  virtual void mark() throw();
  private:
   void insertTempWidget(AGWidget *pWidget);
    

Modified: antargis/trunk/ext/gui/ag_layoutfactory.cc
===================================================================
--- antargis/trunk/ext/gui/ag_layoutfactory.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_layoutfactory.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include "ag_layoutfactory.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_kill.h"
 
 AGLayoutCreator::AGLayoutCreator():mWidget(0),mClient(0)
@@ -59,7 +59,7 @@
     mClient=0;
   }
 
-void AGLayoutCreator::mark()
+void AGLayoutCreator::mark() throw()
   {
     if(mWidget)
       markObject(mWidget);

Modified: antargis/trunk/ext/gui/ag_layoutfactory.h
===================================================================
--- antargis/trunk/ext/gui/ag_layoutfactory.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_layoutfactory.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -24,7 +24,7 @@
 #define AG_LAYOUTFACTORY_H
 
 #include <ag_singleton.h>
-#include <ag_utf8.h>
+#include <rk_utf8.h>
 #include <ag_widget.h>
 #include <ag_xml.h>
 #include <ag_layout.h>
@@ -42,12 +42,12 @@
 
   void clearResult();
 
-  void mark();
+  void mark() throw();
  private:
-   
+
   AGWidget *mWidget,*mClient;
-  
 
+
 };
 
 class AGEXPORT AGLayoutFactory
@@ -62,9 +62,9 @@
   void removeCreator(const AGString &pName,AGLayoutCreator *creator);
 
   std::pair<AGWidget*,AGWidget*> create(AGWidget *pParent,const AGRect2 &pRect,const Node &pNode);
-  
+
   friend AGLayoutFactory *getLayoutFactory();
-  
+
   friend void AGLayout::loadXML(const std::string &pXMLData);
 
   AGLayout *getCurrentLayout();

Modified: antargis/trunk/ext/gui/ag_listbox.cc
===================================================================
--- antargis/trunk/ext/gui/ag_listbox.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_listbox.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -18,7 +18,7 @@
  * License along with this program.
  */
 
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_edit.h"
 #include "ag_listbox.h"
 #include "ag_theme.h"
@@ -66,10 +66,14 @@
   mHeight=count;
   mY=0;
   mSelected=-1;
-  
+
   setTheme("");
 }
 
+AGListBox::~AGListBox() throw()
+  {}
+
+
 void AGListBox::setTheme(const AGString &pTheme)
   {
     AGString themeName=pTheme;
@@ -77,7 +81,7 @@
       themeName="listbox";
     else
       themeName+="listbox";
-    
+
     AGLocalTheme theme=getTheme()->getTheme(themeName);
     mBackground=AGBackground(theme,"background");
     mHilight=AGBackground(theme,"selected");
@@ -89,8 +93,8 @@
       (*i)->setFont(f);
 
     rearrange();
-    
-    
+
+
   }
 
 void AGListBox::rearrange()

Modified: antargis/trunk/ext/gui/ag_listbox.h
===================================================================
--- antargis/trunk/ext/gui/ag_listbox.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_listbox.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -45,7 +45,8 @@
 {
  public:
   AGListBox(AGWidget *pParent,const AGRect2 &pRect);
-
+  virtual ~AGListBox() throw();
+  
   void insertItem(AGString pID,AGStringUtf8 pValue);
   void selectItem(AGString pID);
 

Modified: antargis/trunk/ext/gui/ag_local.cc
===================================================================
--- antargis/trunk/ext/gui/ag_local.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_local.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,12 +19,12 @@
  */
 
 #include "ag_local.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 
 
 AGLocalizer *gLocalizer=0;
 
-AGLocalizer::~AGLocalizer()
+AGLocalizer::~AGLocalizer() throw()
   {
     if(gLocalizer==this)
       gLocalizer=0;
@@ -38,7 +38,6 @@
 
 void setLocalizer(AGLocalizer *p)
   {
-    cdebug("setLocal:"<<p);
     gLocalizer=p;
   }
 

Modified: antargis/trunk/ext/gui/ag_local.h
===================================================================
--- antargis/trunk/ext/gui/ag_local.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_local.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,17 +23,17 @@
 #ifndef AG_LOCAL_H
 #define AG_LOCAL_H
 
-#include <ag_rubyobj.h>
-#include <ag_string.h>
+#include <rk_rubyobj.h>
+#include <rk_string.h>
 #include <ag_string_utf8.h>
 
 class AGEXPORT AGLocalizer:public AGRubyObject
 {
  public:
-  virtual ~AGLocalizer();
-  
+  virtual ~AGLocalizer() throw();
+
   virtual AGStringUtf8 find(const AGString &p);
-  
+
 };
 
 AGEXPORT void setLocalizer(AGLocalizer *p);

Modified: antargis/trunk/ext/gui/ag_menu.cc
===================================================================
--- antargis/trunk/ext/gui/ag_menu.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_menu.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -25,7 +25,7 @@
 #include "ag_surface.h"
 #include "ag_theme.h"
 
-#include "ag_debug.h"
+#include "rk_debug.h"
 
 using namespace std;
 
@@ -42,6 +42,9 @@
     mH=0;
   }
 
+AGMenu::~AGMenu()  throw()
+  {}
+
 void AGMenu::show(AGVector2 pWishPos)
   {
     AGWidget::show();
@@ -49,11 +52,6 @@
     AGVector2 p=fromScreen(mWishPos);
     setTop(p[1]);
     setLeft(p[0]);
-
-    std::list<AGWidget*>::iterator i=mChildren.begin();
-    for(;i!=mChildren.end();i++)
-      cdebug((*i)->getRect().toString());
-
   }
 
 void AGMenu::addItem(const AGStringUtf8 &pString)

Modified: antargis/trunk/ext/gui/ag_menu.h
===================================================================
--- antargis/trunk/ext/gui/ag_menu.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_menu.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -30,6 +30,7 @@
 {
  public:
   AGMenu(AGWidget *pParent,AGVector2 pWishPos,const AGStringUtf8 &pName);
+  virtual ~AGMenu() throw();
 
   void show(AGVector2 pWishPos);
 

Modified: antargis/trunk/ext/gui/ag_menuitem.cc
===================================================================
--- antargis/trunk/ext/gui/ag_menuitem.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_menuitem.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,6 @@
  */
 
 #include "ag_menuitem.h"
-#include "ag_debug.h"
 #include "ag_draw.h"
 #include "ag_theme.h"
 #include "ag_image.h"
@@ -45,7 +44,7 @@
     addChild(1,0,new AGText(this,getRect().origin(),pText,font));
 
   }
-AGMenuItem::~AGMenuItem()
+AGMenuItem::~AGMenuItem() throw()
   {
   }
 
@@ -119,7 +118,6 @@
 
 bool AGMenuItem::eventMouseClick(AGEvent *m)
   {
-    cdebug("bool AGMenuItem::eventMouseClick(const AGEvent *m)");
     AGMenu *me=dynamic_cast<AGMenu*>(getParent());
     if(me)
       {
@@ -142,7 +140,7 @@
     mSubMenu->hide();
   }
 
-AGSubMenu::~AGSubMenu()
+AGSubMenu::~AGSubMenu() throw()
   {
   }
 

Modified: antargis/trunk/ext/gui/ag_menuitem.h
===================================================================
--- antargis/trunk/ext/gui/ag_menuitem.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_menuitem.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -32,7 +32,7 @@
 {
  public:
   AGMenuItem(AGWidget *pParent,const AGStringUtf8 &pText);
-  virtual ~AGMenuItem();
+  virtual ~AGMenuItem() throw();
 
   void draw(AGPainter &p);
 
@@ -59,7 +59,7 @@
 {
  public:
   AGSubMenu(AGWidget *pParent,const AGStringUtf8 &ptext);
-  virtual ~AGSubMenu();
+  virtual ~AGSubMenu() throw();
 
   AGMenu *getMenu();
 

Modified: antargis/trunk/ext/gui/ag_radio.cc
===================================================================
--- antargis/trunk/ext/gui/ag_radio.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_radio.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -46,7 +46,7 @@
       mGroup->add(this);
   }
 
-AGRadio::~AGRadio()
+AGRadio::~AGRadio() throw()
   {
     if(mGroup)
       mGroup->erase(this);

Modified: antargis/trunk/ext/gui/ag_radio.h
===================================================================
--- antargis/trunk/ext/gui/ag_radio.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_radio.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -31,7 +31,7 @@
 {
  public:
   AGRadio(AGWidget *pParent,AGRect2 pRect);
-  virtual ~AGRadio();
+  virtual ~AGRadio() throw();
 
   void setGroup(AGRadioGroup *pGroup);
   bool eventMouseClick(AGEvent *m);

Modified: antargis/trunk/ext/gui/ag_radiogroup.cc
===================================================================
--- antargis/trunk/ext/gui/ag_radiogroup.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_radiogroup.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -33,7 +33,7 @@
   sigChanged(this,"sigChanged")
   {
   }
-AGRadioGroup::~AGRadioGroup()
+AGRadioGroup::~AGRadioGroup() throw()
   {
     std::set<AGRadio*>::iterator i=mChildren.begin();
 

Modified: antargis/trunk/ext/gui/ag_radiogroup.h
===================================================================
--- antargis/trunk/ext/gui/ag_radiogroup.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_radiogroup.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -32,7 +32,7 @@
 {
  public:
   AGRadioGroup(AGWidget *pParent,const AGRect2 &pr);
-  virtual ~AGRadioGroup();
+  virtual ~AGRadioGroup() throw();
 
   virtual void eventChange(const AGString &p);
 

Modified: antargis/trunk/ext/gui/ag_screenwidget.cc
===================================================================
--- antargis/trunk/ext/gui/ag_screenwidget.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_screenwidget.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,21 +22,17 @@
 #include "ag_screenwidget.h"
 #include "ag_surface.h"
 #include "ag_theme.h"
-#include "ag_debug.h"
 
 
 AGScreenWidget::AGScreenWidget():
   AGWidget(0,getScreen().getRect())
   {
-    //  mTexture=AGTexture(getTheme()->getSurface("screen.background.image"));
   }
-AGScreenWidget::~AGScreenWidget()
+AGScreenWidget::~AGScreenWidget() throw()
   {
   }
 
 void AGScreenWidget::draw(AGPainter &p)
   {
-    //  p.clip(AGRect2(10,10,50,50));
-    //p.tile(mTexture);
     p.fillRect(p.getRect().origin(),AGColor(0,0,0));
   }

Modified: antargis/trunk/ext/gui/ag_screenwidget.h
===================================================================
--- antargis/trunk/ext/gui/ag_screenwidget.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_screenwidget.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -30,7 +30,7 @@
 {
  public:
   AGScreenWidget();
-  virtual ~AGScreenWidget();
+  virtual ~AGScreenWidget() throw();
 
   virtual void draw(AGPainter &p);
  private:

Modified: antargis/trunk/ext/gui/ag_scroller.cc
===================================================================
--- antargis/trunk/ext/gui/ag_scroller.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_scroller.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #include "ag_button.h"
 #include "ag_border.h"
 #include "ag_background.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 
 AGScroller::AGScroller(AGWidget *pParent,const AGRect2 &pRect,bool pHor):
   AGWidget(pParent,pRect),
@@ -91,7 +91,7 @@
     setCaching(true);
   }
 
-AGScroller::~AGScroller()
+AGScroller::~AGScroller() throw()
   {
     delete mBorder;
     delete mBackground;

Modified: antargis/trunk/ext/gui/ag_scroller.h
===================================================================
--- antargis/trunk/ext/gui/ag_scroller.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_scroller.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -33,7 +33,7 @@
 {
  public:
   AGScroller(AGWidget *pParent,const AGRect2 &pRect,bool pHor);
-  ~AGScroller();
+  ~AGScroller() throw();
 
   void draw(AGPainter &p);
 

Modified: antargis/trunk/ext/gui/ag_table.cc
===================================================================
--- antargis/trunk/ext/gui/ag_table.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_table.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include "ag_table.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 
 AGTable::AGTable(AGWidget *pWidget,const AGRect2 &pRect):
   AGWidget(pWidget,pRect),
@@ -27,7 +27,7 @@
   {
   }
 
-AGTable::~AGTable()
+AGTable::~AGTable() throw()
   {
   }
 
@@ -227,8 +227,8 @@
           }
         mfx=std::max(mfx,fx);
       }
-    
-    // TODO: assign width's and heights for all fixed !!! 
+
+    // TODO: assign width's and heights for all fixed !!!
     for(mx=0;mx<w;mx++)
       for(my=0;my<h;my++)
         {
@@ -273,7 +273,7 @@
         }
 
     // assign positions
-    // first x 
+    // first x
     float ax=0;
     for(mx=0;mx<w;mx++)
       {

Modified: antargis/trunk/ext/gui/ag_table.h
===================================================================
--- antargis/trunk/ext/gui/ag_table.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_table.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -39,7 +39,7 @@
 {
  public:
   AGTable(AGWidget *pWidget,const AGRect2 &pRect);
-  virtual ~AGTable();
+  virtual ~AGTable() throw();
 
   void addFixedColumn(float size);
   void addFixedRow(float size);

Modified: antargis/trunk/ext/gui/ag_text.cc
===================================================================
--- antargis/trunk/ext/gui/ag_text.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_text.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 
 #include "ag_text.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_surface.h"
 #include "ag_fontengine.h"
 #include "ag_geometry.h"
@@ -44,6 +44,10 @@
     mFixedSize=false;
   }
 
+AGText::~AGText() throw()
+  {}
+
+
 void AGText::draw(AGPainter &p)
   {
     float x=(width()-mFont.getWidth(mText))/2;

Modified: antargis/trunk/ext/gui/ag_text.h
===================================================================
--- antargis/trunk/ext/gui/ag_text.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_text.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -33,7 +33,8 @@
 #ifndef SWIG
   AGText(AGWidget *pParent,const AGVector2 &pPoint,const AGStringUtf8 &pText,const AGFont &pFont);
 #endif
-
+  virtual ~AGText() throw();
+  
   void setDeriveRect();
   virtual void draw(AGPainter &p);
 

Modified: antargis/trunk/ext/gui/ag_theme.cc
===================================================================
--- antargis/trunk/ext/gui/ag_theme.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_theme.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,9 +19,11 @@
  */
 
 #include "ag_theme.h"
-#include "ag_debug.h"
+
+#include "rk_debug.h"
+#include "rk_tools.h"
+
 #include "ag_xml.h"
-#include "ag_tools.h"
 #include "ag_config.h"
 
 #include <iostream>
@@ -33,7 +35,7 @@
   {
   }
 
-AGTheme::~AGTheme()
+AGTheme::~AGTheme() throw()
   {
   }
 
@@ -195,7 +197,7 @@
     }
   return i->second;
 }
- 
+
 AGBackground AGTheme::getBackground(const AGString &pName) const
 {
   std::map<AGString,AGBackground>::const_iterator i=mBackgrounds.find(pName);
@@ -227,6 +229,9 @@
       {
       }
 
+AGLocalTheme::~AGLocalTheme() throw()
+  {}
+
 AGFont AGLocalTheme::getFont(const AGString &pName) const
   {
     AGString t=getName(pName);
@@ -272,7 +277,7 @@
 }
 bool AGLocalTheme::hasColor(const AGString &pName) const
 {
-  return getTheme()->hasColor(getName(pName));  
+  return getTheme()->hasColor(getName(pName));
 }
 bool AGLocalTheme::hasInt(const AGString &pName) const
 {

Modified: antargis/trunk/ext/gui/ag_theme.h
===================================================================
--- antargis/trunk/ext/gui/ag_theme.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_theme.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #ifndef AG_THEME_H
 #define AG_THEME_H
 
-#include "ag_base.h"
+#include "rk_base.h"
 #include "ag_font.h"
 #include "ag_surface.h"
 
@@ -34,40 +34,41 @@
 #include <map>
 
 
-class AGEXPORT AGLocalTheme
+class AGEXPORT AGLocalTheme:public AGRubyObject
   {
   public:
     AGLocalTheme(const AGString &pTheme);
-    
+    virtual ~AGLocalTheme() throw();
+
     AGFont getFont(const AGString &pName) const;
     AGColor getColor(const AGString &pName) const;
     int getInt(const AGString &pName) const;
     AGSurface getSurface(const AGString &pName) const;
     std::string getSurfaceName(const AGString &pName) const;
-    
+
     bool hasFont(const AGString &pName) const;
     bool hasColor(const AGString &pName) const;
     bool hasInt(const AGString &pName) const;
     bool hasSurface(const AGString &pName) const;
     bool hasSurfaceName(const AGString &pName) const;
-    
+
   private:
-    
+
     AGString getName(const AGString &pName) const;
-    
+
     AGString mTheme;
   };
 
-class AGEXPORT AGTheme
+class AGEXPORT AGTheme:public AGRubyObject
 {
  public:
   AGTheme();
-  virtual ~AGTheme();
+  virtual ~AGTheme() throw();
 
   AGFont getFont(const AGString &pName) const;
   bool hasFont(const AGString &pName) const;
   void setFont(const AGString &pName,AGFont pFont);
-  
+
   void setColor(const AGString &pName,AGColor pColor);
   AGColor getColor(const AGString &pName) const;
   bool hasColor(const AGString &pName) const;
@@ -84,18 +85,18 @@
   bool hasSurfaceName(const AGString &pName) const;
   void setSurfaceName(const AGString &pName,const std::string &pSurface);
 
-  
+
   AGLocalTheme getTheme(const AGString &pTheme) const;
-  
-  
-  
+
+
+
   // advanced functions
-  
+
   AGGradient getGradient(const AGString &pName) const;
   AGBackground getBackground(const AGString &pName) const;
   AGBorder getBorder(const AGString &pName) const;
-  
 
+
  private:
 
   AGString trunc(AGString s) const;
@@ -105,12 +106,12 @@
   std::map<AGString,AGSurface> mSurfaces;
   std::map<AGString,std::string> mSurfaceNames;
   std::map<AGString,int> mInts;
-  
-  
+
+
   std::map<AGString,AGGradient> mGradients;
   std::map<AGString,AGBackground> mBackgrounds;
   std::map<AGString,AGBorder> mBorders;
-  
+
 };
 
 AGEXPORT AGTheme *getTheme();

Modified: antargis/trunk/ext/gui/ag_theme_v2.cc
===================================================================
--- antargis/trunk/ext/gui/ag_theme_v2.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_theme_v2.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,9 +19,11 @@
  */
 
 #include "ag_theme_v2.h"
-#include "ag_debug.h"
+
+#include "rk_debug.h"
+#include "rk_tools.h"
+
 #include "ag_xml.h"
-#include "ag_tools.h"
 #include "ag_config.h"
 
 #include <iostream>
@@ -285,7 +287,20 @@
 }
 
 
+bool AGThemeV2::hasSurface(const AGString &pName) const
+{
+  //FIXME
+  return true;
+}
+bool AGThemeV2::hasColor(const AGString &pName) const
+{
 
+  //FIXME
+  return true;
+}
+
+
+
 ////////////////////////////////////////////////////////
 // AGThemeItem
 ////////////////////////////////////////////////////////
@@ -302,11 +317,11 @@
 }
 AGBackground AGThemeItem::getBackground() const
 {
-   
+
 }
 AGFont AGThemeItem::getFont() const
 {
-  
+
 }
 
 

Modified: antargis/trunk/ext/gui/ag_theme_v2.h
===================================================================
--- antargis/trunk/ext/gui/ag_theme_v2.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_theme_v2.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,8 @@
 #ifndef AG_THEME_V2_H
 #define AG_THEME_V2_H
 
-#include "ag_base.h"
+#include "rk_base.h"
+
 #include "ag_font.h"
 #include "ag_surface.h"
 #include "ag_gradient.h"

Modified: antargis/trunk/ext/gui/ag_tooltip.cc
===================================================================
--- antargis/trunk/ext/gui/ag_tooltip.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_tooltip.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,9 +22,10 @@
 #include "ag_theme.h"
 #include "ag_screen.h"
 #include "ag_edit.h"
-#include "ag_debug.h"
-#include "ag_tools.h"
 
+#include "rk_debug.h"
+#include "rk_tools.h"
+
 AGTooltip::AGTooltip(const AGRect2 &pRect,const AGStringUtf8 &pText):
   AGWidget(0,pRect),
   mText(pText),
@@ -108,6 +109,11 @@
     addChild(e);
   }
 
+AGTooltip::~AGTooltip() throw()
+  {}
+
+
+
 void AGTooltip::draw(AGPainter &p)
   {
     //  p.transform(getRect());

Modified: antargis/trunk/ext/gui/ag_tooltip.h
===================================================================
--- antargis/trunk/ext/gui/ag_tooltip.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_tooltip.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -29,6 +29,7 @@
 {
  public:
   AGTooltip(const AGRect2 &pRect,const AGStringUtf8 &pText);
+  virtual ~AGTooltip() throw();
 
   virtual void draw(AGPainter &p);
  private:

Modified: antargis/trunk/ext/gui/ag_widget.cc
===================================================================
--- antargis/trunk/ext/gui/ag_widget.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_widget.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -18,8 +18,9 @@
  * License along with this program.
  */
 
+#include "rk_debug.h"
+
 #include "ag_widget.h"
-#include "ag_debug.h"
 #include "ag_screen.h"
 #include "ag_main.h"
 #include "ag_menu.h"
@@ -84,7 +85,7 @@
       getMain()->getCollector()->insertGlobal(this);
     }
 
-AGWidget::~AGWidget()
+AGWidget::~AGWidget() throw()
   {
     allWidgets.erase(this);
     CTRACE;
@@ -177,7 +178,7 @@
         std::list<AGWidget*>::iterator i=mToClear.begin();
         for(;i!=mToClear.end();i++)
           {
-            (*i)->setParent(0); // lets play it safe 
+            (*i)->setParent(0); // lets play it safe
             saveDelete(*i);
           }
         mToClear.clear();
@@ -493,7 +494,7 @@
     queryRedraw();
   }
 
-void AGWidget::clear()
+void AGWidget::clear() throw()
   {
     // delay it till be draw everything - so this doesn't kill widgets while processing events
     std::copy(mChildren.begin(),mChildren.end(),std::back_inserter(mToClear));
@@ -893,7 +894,7 @@
             std::list<AGWidget*>::iterator i;
 
             i=std::find(mChildren.begin(),mChildren.end(),mFocus);
-            // delete children and set to front 
+            // delete children and set to front
             mChildren.erase(i);
             mChildren.push_front(mFocus);
           }
@@ -997,7 +998,7 @@
     mModal=pModal;
   }
 
-void AGWidget::mark()
+void AGWidget::mark() throw()
   {
     for(std::list<AGWidget*>::iterator i=mChildren.begin();i!=mChildren.end();i++)
       {

Modified: antargis/trunk/ext/gui/ag_widget.h
===================================================================
--- antargis/trunk/ext/gui/ag_widget.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_widget.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #ifndef AG_WIDGET_H
 #define AG_WIDGET_H
 
-#include "ag_base.h"
+#include "rk_base.h"
 #include "ag_geometry.h"
 #include "ag_messageobject.h"
 #include "ag_projection.h"
@@ -37,7 +37,7 @@
 class AGClipping;
 class AGApplication;
 
-/** 
+/**
     \defgroup widgets Widgets
     \brief contains all the widgets
 
@@ -79,9 +79,9 @@
 {
 public:
   typedef std::list<AGWidget*> Children;
-  
+
   AGWidget(AGWidget *pParent,const AGRect2 &r);
-  virtual ~AGWidget();
+  virtual ~AGWidget() throw();
 
   AGApplication *getApp();
   void setApp(AGApplication *pApp);
@@ -92,7 +92,7 @@
   virtual void drawAfter(AGPainter &p);
   virtual void drawAll(AGPainter &p);
   virtual void drawChild(AGPainter &p,AGWidget *pWidget);
-  
+
   AGRect2 getRect() const;
   virtual AGRect2 getClientRect() const;
   virtual void setRect(const AGRect2 &pRect);
@@ -157,7 +157,7 @@
   void hide();
   void close();
 
-  virtual void mark();
+  virtual void mark() throw();
 
   virtual void addChild(AGWidget *w);
   virtual void addChildBack(AGWidget *w);
@@ -180,10 +180,10 @@
   // to prevent this, use this function to "use" them in each frame
   virtual void useTextures(); // when caching
   void useTexturesRecursive(); // when caching
-  
-  
-  
-  
+
+
+
+
   // geometry calculation
   AGRect2 innerToOuter(const AGRect2 &pRect) const;
   AGVector2 innerToOuter(const AGVector2 &pRect) const;
@@ -192,7 +192,7 @@
 
 
   // clear children
-  void clear();
+  void clear() throw();
 
   AGRect2 getScreenRect() const;
   AGRect2 toScreen(const AGRect2&p) const;
@@ -202,10 +202,10 @@
 
   AGProjection2D innerToOuter() const;
   AGProjection2D outerToInner() const;
-  
+
   AGVector2 getScreenPosition() const;
-  
 
+
   // focus
 
   /** should only be called by a child */
@@ -239,36 +239,36 @@
   std::list<AGRect2> aquireChanges();
   void pushChangeRect(const AGRect2 &pRect);
   void clearChangeRects();
-  
+
   std::list<AGWidget*> getChildren();
-  
+
   bool hovered() const;
-  
+
   void setClient(const AGRect2 &pWorld,const AGProjection2D &pProj);
   AGProjection2D getClientProjection() const;
   AGRect2 getClientWorld() const;
-  
-  
+
+
   virtual bool eventMouseButtonDownClipped(AGEvent *pEvent,const AGVector2 &pPosition);
   virtual bool eventMouseButtonUpClipped(AGEvent *pEvent,const AGVector2 &pPosition);
   virtual bool eventMouseMotionClipped(AGEvent *pEvent,const AGVector2 &pPosition);
 
   void addChildRef(AGWidget *pWidget);
-  
-  void initEvents(); 
-  
+
+  void initEvents();
+
   virtual void eventInitEvents();
- 
-  
+
+
 protected:
   virtual bool letChildProcess(AGWidget *pChild,AGEvent *event);
 
 private:
-  
+
   AGRect2 getChildRect(const AGRect2 &pRect) const;
   bool containsPoint(AGWidget *pWidget,const AGVector2 &pVector) const;
-  
 
+
   AGApplication *mApp;
 
   std::list<AGRect2> mMyChanges;
@@ -282,7 +282,7 @@
   void gainFocusDown(AGWidget *pWidget);
 
   void checkFocus();
-  
+
   static bool valid(AGWidget *pWidget);
 
   std::list<AGWidget*> mToClear;
@@ -290,7 +290,7 @@
   AGRect2 mRect,mClientWorld;
   AGProjection2D mClientProj;
   bool mUseClientRect;
-  
+
   AGWidget *mParent;
   bool mChildrenEventFirst;
   bool mChildrenDrawFirst;
@@ -316,12 +316,12 @@
   AGTooltip *mTooltipWidget;
 
   std::set<AGWidget*> mRefChildren;
-  
+
   bool mEventsInited;
-  
+
 protected:
   std::list<AGWidget*> mChildren;
-  
+
 private:
   static std::set<AGWidget*> allWidgets;
 

Modified: antargis/trunk/ext/gui/ag_window.cc
===================================================================
--- antargis/trunk/ext/gui/ag_window.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_window.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #include "ag_theme.h"
 #include "ag_image.h"
 #include "ag_text.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_button.h"
 #include "ag_caption.h"
 #include "ag_texturecache.h"
@@ -35,7 +35,7 @@
 
   {
     CTRACE;
-    
+
     AGLocalTheme theme=getTheme()->getTheme(pTheme);
 
     AGString borderImage="window.border.image";
@@ -67,7 +67,7 @@
         addFixedRow(bw); // upper border
         addFixedRow(titBarHeight); // titletext and button
         //      addFixedRow(bw); // lower border below titletext
-        addRow(1.0); 
+        addRow(1.0);
         addFixedRow(bw); // lower lower below window
         addFixedColumn(bw);
         addColumn(1.0);
@@ -128,6 +128,9 @@
     arrange();
   }
 
+AGWindow::~AGWindow() throw()
+  {}
+
 AGWidget *AGWindow::getClient()
   {
     return mClient;
@@ -186,7 +189,7 @@
     closeButton->setSurface(closeSurface,false);
     title->setName("title"); // FIXME: maybe name getName()+".title"
 
-    //  AGListener 
+    //  AGListener
     closeButton->sigClick.connect(slot(this,&AGWindow::tryClose));
     //  t->arrange();
     return t;

Modified: antargis/trunk/ext/gui/ag_window.h
===================================================================
--- antargis/trunk/ext/gui/ag_window.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_window.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -29,6 +29,7 @@
 {
  public:
   AGWindow(AGWidget *pWidget,const AGRect2 &pRect,const AGStringUtf8 &pTitle="",const AGString &pTheme="");
+  virtual ~AGWindow()  throw();
 
   AGWidget *getClient();
 

Modified: antargis/trunk/ext/gui/init.cc
===================================================================
--- antargis/trunk/ext/gui/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,5 @@
-#include <ag_base.h>
-#include <ag_debug.h>
+#include <rk_base.h>
+#include <rk_debug.h>
 #include <ag_layout.h>
 
 AGEXPORT void AG_Init_libantargisgui()

Modified: antargis/trunk/ext/math/ag_algebra.cc
===================================================================
--- antargis/trunk/ext/math/ag_algebra.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/ag_algebra.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,7 @@
 #include "ag_algebra.h"
-#include "ag_debug.h"
+
+#include "rk_debug.h"
+
 #include "ag_gauss.h"
 #include "ag_stringstream.h"
 
@@ -268,7 +270,7 @@
   assert(width()>1);
   assert(i<width());
   AGMatrixN n(width()-1,height());
- 
+
   for(size_t y=0;y<height();y++)
     {
       for(size_t x=0;x<i;x++)

Modified: antargis/trunk/ext/math/ag_algebra.h
===================================================================
--- antargis/trunk/ext/math/ag_algebra.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/ag_algebra.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -4,7 +4,7 @@
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
 #include <vector>
-#include <ag_string.h>
+#include <rk_string.h>
 #include <ag_geometry.h>
 
 class AGEXPORT AGMatrixN
@@ -43,15 +43,15 @@
 
   void swapRows(size_t a,size_t b);
   void swapCols(size_t a,size_t b);
-  
+
   size_t width() const;
   size_t height() const;
-  
+
   AGMatrixN skipRow(size_t i) const;
   AGMatrixN skipCol(size_t i) const;
 
  private:
-  
+
   inline size_t index(size_t x,size_t y) const { return x+y*mW; }
 
   std::vector<float> m;
@@ -64,11 +64,11 @@
 
 template<> inline float determinant<AGMatrix3>(const AGMatrix3&t)
   {
-    return determinant(AGMatrixN(t)); 
+    return determinant(AGMatrixN(t));
   }
 template<> inline float determinant<AGMatrix4>(const AGMatrix4&t)
   {
-    return determinant(AGMatrixN(t)); 
+    return determinant(AGMatrixN(t));
   }
 
 template<class T>

Modified: antargis/trunk/ext/math/ag_rand.cc
===================================================================
--- antargis/trunk/ext/math/ag_rand.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/ag_rand.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -18,7 +18,7 @@
  * License along with this program.
  */
 
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_main.h"
 #include "ag_profiler.h"
 #include "ag_rand.h"
@@ -57,7 +57,7 @@
 
   }
 
-AGRandomizer::~AGRandomizer()
+AGRandomizer::~AGRandomizer() throw()
   {
     CTRACE;
   }

Modified: antargis/trunk/ext/math/ag_rand.h
===================================================================
--- antargis/trunk/ext/math/ag_rand.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/ag_rand.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -39,7 +39,7 @@
   // restore a randomizer from a state-string (pretty long)
   // for an initial seed - call with pSeed==""
   AGRandomizer(const std::string &pSeed);
-  ~AGRandomizer();
+  ~AGRandomizer() throw();
 #ifdef SWIG
   %rename(randFloat) operator()(float f);
   %rename(randInt) operator()(int i);

Modified: antargis/trunk/ext/math/ant_frustum.cc
===================================================================
--- antargis/trunk/ext/math/ant_frustum.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/ant_frustum.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include "ant_frustum.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_profiler.h"
 
 /////////////////////////////////////////////////////////////////////

Modified: antargis/trunk/ext/math/init.cc
===================================================================
--- antargis/trunk/ext/math/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,4 @@
-#include <ag_debug.h>
+#include <rk_debug.h>
 #include <ag_main.h>
 #include <ag_rand.h>
 

Modified: antargis/trunk/ext/sound/ag_mixer.cc
===================================================================
--- antargis/trunk/ext/sound/ag_mixer.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/sound/ag_mixer.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include "ag_mixer.h"
 #include "ag_kill.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_mutex.h"
 #include "ag_fs.h"
 #include "ag_config.h"
@@ -146,8 +146,8 @@
   }
 
 
-AGSound::~AGSound()
-  { 
+AGSound::~AGSound() throw()
+  {
     if(getCollector())
       getCollector()->removeGlobal(this);
 
@@ -291,7 +291,7 @@
         Mix_HaltMusic();
         Mix_FreeMusic(mMusic);
         mMusic=0;
-      }      
+      }
   }
 AGSound::AGSound():AGMessageObject(),sigMp3Finished(this,"sigMp3Finished")
 {

Modified: antargis/trunk/ext/sound/ag_mixer.h
===================================================================
--- antargis/trunk/ext/sound/ag_mixer.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/sound/ag_mixer.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -33,7 +33,7 @@
 {
  public:
   AGSound(); // NEVER use this! - it's only provided due to swig
-  ~AGSound();
+  ~AGSound() throw();
   bool playMp3(const std::string &pFilename);
   bool playMp3DRM(const std::string &pFilename,AGDecryptor &pDec);
 

Modified: antargis/trunk/ext/sound/init.cc
===================================================================
--- antargis/trunk/ext/sound/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/sound/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include <ag_main.h>
 #include <ag_rand.h>
-#include <ag_debug.h>
+#include <rk_debug.h>
 
 extern void initSoundEngine();
 

Modified: antargis/trunk/ext/test/gl_text_3d.cc
===================================================================
--- antargis/trunk/ext/test/gl_text_3d.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/test/gl_text_3d.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,3 +1,4 @@
+#include <ag_gl.h>
 #include <SDL.h>
 #include <SDL_opengl.h>
 #include <stdexcept>
@@ -63,7 +64,6 @@
     glTexSubImage3D(GL_TEXTURE_3D,0,0,0,0,
         128,128,32,GL_RGBA,GL_UNSIGNED_BYTE,blue);
 
-
     glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
 
     glBindTexture(GL_TEXTURE_3D,tex);

Modified: antargis/trunk/ext/video/ag_clip_painttarget.cc
===================================================================
--- antargis/trunk/ext/video/ag_clip_painttarget.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_clip_painttarget.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,11 +1,15 @@
 #include "ag_clip_painttarget.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_projection.h"
 
 AGClipPaintTarget::AGClipPaintTarget(AGPaintTarget *pTarget):mTarget(pTarget)
 {
 }
 
+AGClipPaintTarget::~AGClipPaintTarget() throw()
+  {}
+
+
 void AGClipPaintTarget::blitTri(const AGTexture &pSource,const AGTriangle2 &pSrc,const AGTriangle2 &pDest)
   {
     cdebug("NOT IMPLEMENTED!");

Modified: antargis/trunk/ext/video/ag_clip_painttarget.h
===================================================================
--- antargis/trunk/ext/video/ag_clip_painttarget.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_clip_painttarget.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -29,7 +29,9 @@
 {
  public:
   AGClipPaintTarget(AGPaintTarget *pTarget);
-
+  ~AGClipPaintTarget() throw();
+  
+  
   virtual void blitTri(const AGTexture &pSource,const AGTriangle2 &pSrc,const AGTriangle2 &pDest);
 
   virtual void blit(const AGTexture &pSource,const AGRect2 &pDest,const AGRect2 &pSrc,const AGColor &pColor);

Modified: antargis/trunk/ext/video/ag_color.cc
===================================================================
--- antargis/trunk/ext/video/ag_color.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_color.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include "ag_color.h"
 #include "ag_surface.h"
-#include "ag_tools.h"
+#include "rk_tools.h"
 
 #include <sstream>
 

Modified: antargis/trunk/ext/video/ag_color.h
===================================================================
--- antargis/trunk/ext/video/ag_color.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_color.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,4 @@
-/*
+#/*
  * Copyright (c) 2005 by David Kamphausen. All rights reserved.
  *
  * ag_color.h
@@ -25,8 +25,8 @@
 
 #include <SDL.h>
 #include <iostream>
-#include <ag_base.h>
-#include <ag_string.h>
+#include <rk_base.h>
+#include <rk_string.h>
 
 class AGSurface;
 class AGVector4;
@@ -35,7 +35,7 @@
 {
  public:
   AGColor(int pr,int pg,int pb,int pa=255);
-  
+
   AGColor(const AGColor &c);
   AGColor(const AGVector4 &v);
   AGColor(Uint32 c,const AGSurface &pSurface);
@@ -64,7 +64,7 @@
   void light(Uint8 l);
 
   //  SDL_Color sdlColor() const;
-  
+
   bool operator==(const AGColor &c) const;
 
   //  Uint8 r,g,b;

Modified: antargis/trunk/ext/video/ag_fbo.h
===================================================================
--- antargis/trunk/ext/video/ag_fbo.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_fbo.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,7 +21,7 @@
 #ifndef AG_FBO_H
 #define AG_FBO_H
 
-#include <ag_base.h>
+#include <rk_base.h>
 
 class AGGLTexture;
 
@@ -41,7 +41,7 @@
   AGGLTexture *mTexture;
   GLuint mTextureID;
   size_t w,h;
-  
+
   unsigned int fb, depth_rb;
 
   bool mWithDepth;

Modified: antargis/trunk/ext/video/ag_font.h
===================================================================
--- antargis/trunk/ext/video/ag_font.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_font.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,9 +23,9 @@
 #ifndef __AG_FONT_H
 #define __AG_FONT_H
 
+#include <rk_base.h>
+#include <rk_utf8.h>
 #include <ag_color.h>
-#include <ag_base.h>
-#include <ag_utf8.h>
 
 #include <ag_string_utf8.h>
 

Modified: antargis/trunk/ext/video/ag_fontengine.cc
===================================================================
--- antargis/trunk/ext/video/ag_fontengine.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_fontengine.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,8 +19,7 @@
  */
 
 #include "ag_fontengine.h"
-#include "ag_debug.h"
-#include "ag_kill.h"
+#include "rk_debug.h"
 #include "ag_texture.h"
 #include "ag_fs.h"
 #include "ag_sgeexport.h"
@@ -100,7 +99,7 @@
     //  REGISTER_SINGLETON(this);
   }
 
-AGFontEngine::~AGFontEngine()
+AGFontEngine::~AGFontEngine() throw()
   {
     // TTF_Quit is called by atexit
     // font-deletion is ignored
@@ -376,7 +375,7 @@
     return h;
   }
 
-void AGFontEngine::mark()
+void AGFontEngine::mark() throw()
   {
     for(std::map<std::pair<AGFont,AGStringUtf8>,AGTexture*>::iterator i=fontCache.begin();i!=fontCache.end();i++)
       markObject(i->second);

Modified: antargis/trunk/ext/video/ag_fontengine.h
===================================================================
--- antargis/trunk/ext/video/ag_fontengine.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_fontengine.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -35,14 +35,14 @@
 {
  public:
   AGFontEngine();
-  ~AGFontEngine();
+  ~AGFontEngine() throw();
 
   AGTexture *renderText(int BaseLineX, int BaseLineY, const AGStringUtf8 &pText, const AGFont &ParamIn);
 
   int getWidth(const AGFont &pFont,const AGStringUtf8 &pText);
   int getHeight(const AGFont &pFont,const AGStringUtf8 &pText);
 
-  void mark();
+  void mark() throw();
 
  private:
   std::map<std::pair<AGFont,AGStringUtf8>,AGTexture*> fontCache;

Modified: antargis/trunk/ext/video/ag_glpainter.cc
===================================================================
--- antargis/trunk/ext/video/ag_glpainter.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_glpainter.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -24,7 +24,7 @@
 #include "ag_profiler.h"
 #include "ag_texture.h"
 #include "ag_rendercontext.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_vdebug.h"
 #include "ag_projection.h"
 
@@ -54,7 +54,7 @@
           }
         glEnd();
 
-      } 
+      }
 
     void drawPoly(const std::vector<AGVector2> &pVecs,const AGColor &pColor,float pWidth)
       {
@@ -377,7 +377,7 @@
         context.setDepthTest(true);
         context.setColor(AGColor(0xFF,0xFF,0xFF,0xFF));
         context.begin();
-        
+
         AGProjection2D p(const_cast<AGTexture&>(pSource).glTexture()->getRect(),AGRect2(0,0,1,1));
 
         glBegin(GL_TRIANGLES);
@@ -388,7 +388,7 @@
             glVertex3fv(pDest[i]);
           }
 
-        glEnd();       
+        glEnd();
       }
 
 

Modified: antargis/trunk/ext/video/ag_glscreen.cc
===================================================================
--- antargis/trunk/ext/video/ag_glscreen.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_glscreen.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include "ag_glscreen.h"
 #include "ag_color.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_vdebug.h"
 #include "ag_fontengine.h"
 #include "ag_surfacemanager.h"
@@ -157,8 +157,8 @@
 
 
 
-AGGLScreen::~AGGLScreen()
-  { 
+AGGLScreen::~AGGLScreen() throw()
+  {
   }
 
 AGTexture AGGLScreen::screenshot(bool frontBuffer)
@@ -178,25 +178,25 @@
 
     assertGL;
 #ifdef __APPLE__
-    glTexParameteri(glTexture->getTarget(), 
-        GL_TEXTURE_STORAGE_HINT_APPLE, 
-        GL_STORAGE_CACHED_APPLE); 
+    glTexParameteri(glTexture->getTarget(),
+        GL_TEXTURE_STORAGE_HINT_APPLE,
+        GL_STORAGE_CACHED_APPLE);
     assertGL;
-    glPixelStorei(GL_UNPACK_CLIENT_STORAGE_APPLE,GL_TRUE); 
+    glPixelStorei(GL_UNPACK_CLIENT_STORAGE_APPLE,GL_TRUE);
     assertGL;
 
-    glTexParameteri(glTexture->getTarget(),GL_TEXTURE_STORAGE_HINT_APPLE, GL_STORAGE_SHARED_APPLE); 
+    glTexParameteri(glTexture->getTarget(),GL_TEXTURE_STORAGE_HINT_APPLE, GL_STORAGE_SHARED_APPLE);
     assertGL;
-    glPixelStorei(GL_UNPACK_CLIENT_STORAGE_APPLE,GL_TRUE); 
+    glPixelStorei(GL_UNPACK_CLIENT_STORAGE_APPLE,GL_TRUE);
 #endif
     assertGL;
     glReadBuffer(GL_FRONT_LEFT);
     glFinish();
     assertGL;
-    glCopyTexSubImage2D(glTexture->getTarget(), 
-        0,0,0,0,0,getWidth(),getHeight()); 
+    glCopyTexSubImage2D(glTexture->getTarget(),
+        0,0,0,0,0,getWidth(),getHeight());
     assertGL;
-    // Dootherworkprocessinghere,usingadoubleortriplebuffer 
+    // Dootherworkprocessinghere,usingadoubleortriplebuffer
     glReadBuffer(GL_BACK);
 
 

Modified: antargis/trunk/ext/video/ag_glscreen.h
===================================================================
--- antargis/trunk/ext/video/ag_glscreen.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_glscreen.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,14 +23,16 @@
 #ifndef __GUI_GLSURFACE_H
 #define __GUI_GLSURFACE_H
 
+#include <rk_base.h>
+
+#include <ag_geometry.h>
+#include "ag_screen.h"
+#include "ag_gl.h"
+
 #include <string>
 #include <map>
 #include <list>
 #include <SDL.h>
-#include <ag_base.h>
-#include <ag_geometry.h>
-#include "ag_screen.h"
-#include "ag_gl.h"
 
 #define NEW_TEXTURES
 
@@ -54,7 +56,7 @@
  public:
   AGGLScreen(int W,int H,int VW=-1,int VH=-1);
 
-  virtual ~AGGLScreen();
+  virtual ~AGGLScreen() throw();
 
   virtual void blitTri(const AGTexture &pSource,const AGTriangle2 &pSrc,const AGTriangle2 &pDest);
 

Modified: antargis/trunk/ext/video/ag_gltexture.cc
===================================================================
--- antargis/trunk/ext/video/ag_gltexture.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_gltexture.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,7 +22,7 @@
 #include "ag_gltexture.h"
 #include "ag_surfacemanager.h"
 #include "ag_rendercontext.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_vdebug.h"
 
 
@@ -249,8 +249,8 @@
   size_t bufSize=width()*height()*4;
   unsigned char *pixels=new unsigned char[bufSize];
 
-  glGetTexImage(mTarget,0,GL_RGBA, 
-      GL_UNSIGNED_INT_8_8_8_8_REV,pixels); 
+  glGetTexImage(mTarget,0,GL_RGBA,
+      GL_UNSIGNED_INT_8_8_8_8_REV,pixels);
 
   {
     // copy
@@ -265,7 +265,7 @@
         }
   }
 
-  return s;  
+  return s;
 }
 
 void AGGLTexture::initDMABuffer()
@@ -276,7 +276,7 @@
       {
         size_t texbufsize=1024*1024*64;
         dmaBuffer=new char[texbufsize];
-        glTextureRangeAPPLE(GL_TEXTURE_2D,texbufsize,dmaBuffer); 
+        glTextureRangeAPPLE(GL_TEXTURE_2D,texbufsize,dmaBuffer);
       }
       */
   }

Modified: antargis/trunk/ext/video/ag_gradient.cc
===================================================================
--- antargis/trunk/ext/video/ag_gradient.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_gradient.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,7 +21,7 @@
 #include "GLee.h"
 #include "ag_color.h"
 #include "ag_geometry.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include <SDL.h>
 
 #include "ag_draw.h"
@@ -29,7 +29,7 @@
 
 namespace AGSDLPainter
 {
-  void drawGradient(SDL_Surface *surface, const AGRect2& prect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr) 
+  void drawGradient(SDL_Surface *surface, const AGRect2& prect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr)
     {
       AGRect2 rect=prect;
       Sint32 v00,v01,v02;
@@ -201,7 +201,7 @@
       }
     }
 
-  void drawGradientAlpha(SDL_Surface *surface, const AGRect2& prect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr) 
+  void drawGradientAlpha(SDL_Surface *surface, const AGRect2& prect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr)
     {
       AGRect2 rect=prect;
       Sint32 v00,v01,v02,v03;

Modified: antargis/trunk/ext/video/ag_painter.cc
===================================================================
--- antargis/trunk/ext/video/ag_painter.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_painter.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -18,7 +18,7 @@
  * License along with this program.
  */
 
-#include <ag_debug.h>
+#include <rk_debug.h>
 #include <ag_draw.h>
 #include <ag_fontengine.h>
 #include <ag_glscreen.h>
@@ -236,7 +236,7 @@
     }
 
 
-AGPainter::~AGPainter()
+AGPainter::~AGPainter() throw()
   {
     CTRACE;
     if(mTarget.valid())

Modified: antargis/trunk/ext/video/ag_painter.h
===================================================================
--- antargis/trunk/ext/video/ag_painter.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_painter.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,13 +23,14 @@
 #ifndef __AG_PAINTER_H
 #define __AG_PAINTER_H
 
+#include <rk_base.h>
+
 #include <ag_color.h>
 #include <ag_surface.h>
 #include <ag_geometry.h>
 #include <ag_font.h>
 #include <ag_painttarget.h>
 #include <ag_clip.h>
-#include <ag_base.h>
 
 #include <list>
 
@@ -54,7 +55,7 @@
   AGRect2 clipRect(AGRect2 target) const;
 
   AGLine2 clipLine(AGLine2 l) const;
-  
+
   void transform(const AGMatrix3 &pMatrix);
 
   void translate(const AGVector2 &v);
@@ -68,15 +69,15 @@
 #define AGEXPORT
 #endif
 
-class AGEXPORT AGPainter
+class AGEXPORT AGPainter:public AGRubyObject
 {
  public:
   AGPainter();
   AGPainter(const AGPainter &p);
   AGPainter(AGPaintTarget &pTarget);
-  
-  ~AGPainter();
 
+  virtual ~AGPainter() throw();
+
   void putPixel(const AGVector2 &p,const AGColor &c);
   AGColor getPixel(int x,int y);
 
@@ -97,7 +98,7 @@
   void tile(const AGSurface &pSource);
   void tile(const AGSurface &pSource,const AGRect2 &pDest);
   void tile(const AGSurface &pSource,const AGRect2 &pDest,const AGRect2 &pSrc);
-  
+
   void renderText(const AGStringUtf8 &pText,const AGVector2 &p,const AGFont &f);
 
   AGRect2 getRect() const;
@@ -108,12 +109,12 @@
   void fillRect(const AGRect2 &pRect,const AGColor &c);
   void drawLine(const AGVector2 &p0,const AGVector2 &p1,const AGColor &c);
   void drawPoint(const AGVector2 &p,const AGColor &c,float size);
-  
+
   void fillPoly(const std::vector<AGVector2> &pPoly,const AGColor &c);
   void drawPoly(const std::vector<AGVector2> &pPoly,const AGColor &c);
 
   void fillRects(const std::vector<std::pair<AGRect2,AGVector4> > &pRects);
-  
+
   void setLineWidth(float w);
 
   void pushMatrix();
@@ -131,7 +132,7 @@
   bool pointOk(const AGVector2 &p) const;
 
   AGPaintTarget *getTarget();
-  
+
   void debugOutput();
 
  private:

Modified: antargis/trunk/ext/video/ag_painttarget.h
===================================================================
--- antargis/trunk/ext/video/ag_painttarget.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_painttarget.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,10 +23,11 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
+#include <rk_rubyobj.h>
+
 #include <ag_geometry.h>
 #include <ag_color.h>
 #include <ag_font.h>
-#include <ag_rubyobj.h>
 
 class AGSurface;
 class AGTexture;
@@ -36,7 +37,7 @@
 class AGEXPORT AGPaintTarget:public AGRubyObject
 {
  public:
-  virtual ~AGPaintTarget()
+  virtual ~AGPaintTarget() throw()
     {
     }
   virtual void blitTri(const AGTexture &pSource,const AGTriangle2 &pSrc,const AGTriangle2 &pDest) MSTUB
@@ -49,10 +50,10 @@
   virtual void fillRect(const AGRect2 &pr,const AGColor &c) MSTUB
 
   virtual void fillRects(const std::vector<std::pair<AGRect2,AGVector4> > &pr) MSTUB
-  
+
   virtual void fillPoly(const std::vector<AGVector2>&pPoly,const AGColor &pColor) MSTUB
   virtual void drawPoly(const std::vector<AGVector2>&pPoly,const AGColor &pColor) MSTUB
-   
+
   virtual void blit(const AGTexture &pSource,const std::vector<std::pair<AGRect2,AGRect2> > &pSrcDestRects,const AGColor &pColor)
     MSTUB
 
@@ -60,15 +61,15 @@
   virtual void drawGradient(const AGRect2& rect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr) MSTUB
 
   virtual void setLineWidth(float w) MSTUB
-  
+
   virtual void tile(const AGTexture &pSource,const AGRect2 &pTarget, const AGColor &pColor) MSTUB
-   
+
   virtual AGRect2 getRect() const
   {
     return AGRect2(0,0,0,0);
   }
-  
 
+
   // modify single pixels - don't use this much!
 
   virtual void putPixel(int x,int y,const AGColor &c) MSTUB
@@ -78,7 +79,7 @@
 
   virtual void beginPaint()
   {}
-  
+
   virtual void endPaint()
   {}
 

Modified: antargis/trunk/ext/video/ag_projection.cc
===================================================================
--- antargis/trunk/ext/video/ag_projection.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_projection.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,5 @@
 #include "ag_projection.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_algebra.h"
 
 AGProjection2D::AGProjection2D() :

Modified: antargis/trunk/ext/video/ag_projection.h
===================================================================
--- antargis/trunk/ext/video/ag_projection.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_projection.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,7 +3,7 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
-#include <ag_base.h>
+#include <rk_base.h>
 #include <ag_geometry.h>
 
 
@@ -20,11 +20,11 @@
   AGVector3 project(const AGVector3 &p) const;
   AGTriangle2 project(const AGTriangle2 &t) const;
   AGTriangle3 project(const AGTriangle3 &t) const;
-  
+
   AGProjection2D inverse() const throw (GeometryException);
 
   void pushProjection(const AGProjection2D &p);
-  
+
   AGMatrix3 getMatrix() const;
 private:
   bool mInited;

Modified: antargis/trunk/ext/video/ag_rendercontext.cc
===================================================================
--- antargis/trunk/ext/video/ag_rendercontext.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_rendercontext.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include "ag_rendercontext.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_vdebug.h"
 #include "ag_texture.h"
 #include "ag_surfacemanager.h"
@@ -330,7 +330,7 @@
                     }
                 }
             }
-        }  
+        }
 
 
       ///////////////////////////////

Modified: antargis/trunk/ext/video/ag_screen.cc
===================================================================
--- antargis/trunk/ext/video/ag_screen.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_screen.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include "ag_screen.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_surface.h"
 #include "ag_texture.h"
 

Modified: antargis/trunk/ext/video/ag_screen.h
===================================================================
--- antargis/trunk/ext/video/ag_screen.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_screen.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,8 +23,9 @@
 #ifndef AG_SCREEN_H
 #define AG_SCREEN_H
 
+#include <rk_base.h>
+
 #include <ag_config.h>
-#include <ag_base.h>
 #include <ag_painttarget.h>
 
 // this is virtually a pure virtual class ;-)

Modified: antargis/trunk/ext/video/ag_sdlscreen.cc
===================================================================
--- antargis/trunk/ext/video/ag_sdlscreen.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_sdlscreen.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include "ag_sdlscreen.h"
 #include "ag_texture.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_fs.h"
 #include "ag_draw.h"
 #include "ag_fontengine.h"

Modified: antargis/trunk/ext/video/ag_surface.cc
===================================================================
--- antargis/trunk/ext/video/ag_surface.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_surface.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,17 +23,16 @@
 #include "ag_surface.h"
 #include "ag_texture.h"
 #include "ag_color.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_vdebug.h"
 #include "ag_draw.h"
 #include "ag_sgeexport.h"
-#include "ag_kill.h"
 #include "ag_png.h"
 #include "ag_glscreen.h"
 #include "ag_sdlpainter.h"
 #include "ag_surfacemanager.h"
 
-#include "SDL_image.h"
+#include <SDL_image.h>
 
 #include <sstream>
 #include <math.h>
@@ -43,7 +42,7 @@
 bool gDRM=false;
 
 
-AGDecryptor *AGSurface::mDecryptor=0;  
+AGDecryptor *AGSurface::mDecryptor=0;
 
 ///////////////////////////////////////////////////////////////////////
 // Tools
@@ -51,79 +50,79 @@
 
 bool gRendering=false;
 void beginRender()
-  {
-    gRendering=true;
-  }
+{
+  gRendering=true;
+}
 void endRender()
-  {
-    gRendering=false;
-  }
+{
+  gRendering=false;
+}
 
 bool isRendering()
-  {
-    return gRendering;
-  }
+{
+  return gRendering;
+}
 
 
 void AGFreeSurface(SDL_Surface *s)
-  {
-    cdebug(s);
-    SDL_FreeSurface(s);
-  }
+{
+  cdebug(s);
+  SDL_FreeSurface(s);
+}
 
 AGInternalSurface *AGCreate32BitSurface(size_t width,size_t height)
-  {
-    /* Create a 32-bit surface with the bytes of each pixel in R,G,B,A order,
+{
+  /* Create a 32-bit surface with the bytes of each pixel in R,G,B,A order,
      as expected by OpenGL for textures */
-    AGInternalSurface *surface=new AGInternalSurface;
-    Uint32 rmask, gmask, bmask, amask;
+  AGInternalSurface *surface=new AGInternalSurface;
+  Uint32 rmask, gmask, bmask, amask;
 
-    /* SDL interprets each pixel as a 32-bit number, so our masks must depend
+  /* SDL interprets each pixel as a 32-bit number, so our masks must depend
      on the endianness (byte order) of the machine */
 #if SDL_BYTEORDER == SDL_BIG_ENDIAN
 
-    rmask = 0xff000000;
-    gmask = 0x00ff0000;
-    bmask = 0x0000ff00;
-    amask = 0x000000ff;
+  rmask = 0xff000000;
+  gmask = 0x00ff0000;
+  bmask = 0x0000ff00;
+  amask = 0x000000ff;
 #else
 
-    rmask = 0x000000ff;
-    gmask = 0x0000ff00;
-    bmask = 0x00ff0000;
-    amask = 0xff000000;
+  rmask = 0x000000ff;
+  gmask = 0x0000ff00;
+  bmask = 0x00ff0000;
+  amask = 0xff000000;
 #endif
 
-    surface->surface = SDL_CreateRGBSurface(SDL_SWSURFACE, width, height, 32,
-        rmask, gmask, bmask, amask);
-    if(!surface->surface)
-      {
-        std::cerr<<"CreateRGBSurface failed: "<<SDL_GetError()<<std::endl;
-        //        throw UI::UIException();
-      }
-
-    return surface;
+  surface->surface = SDL_CreateRGBSurface(SDL_SWSURFACE, width, height, 32,
+      rmask, gmask, bmask, amask);
+  if(!surface->surface)
+  {
+    std::cerr<<"CreateRGBSurface failed: "<<SDL_GetError()<<std::endl;
+    //        throw UI::UIException();
   }
 
+  return surface;
+}
 
 
+
 ///////////////////////////////////////////////////////////////////////
 // AGInternalSurface
 ///////////////////////////////////////////////////////////////////////
 
 AGInternalSurface::AGInternalSurface()
-  {
-    sdlTexture=0;
-    glTexture=0;
-    surface=0;
-    getSurfaceManager()->registerMe(this);
-    version=1;
-  }
+{
+  sdlTexture=0;
+  glTexture=0;
+  surface=0;
+  getSurfaceManager()->registerMe(this);
+  version=1;
+}
 
 AGInternalSurface::~AGInternalSurface()
-  {
-    getSurfaceManager()->deregisterMe(this);
-  }
+{
+  getSurfaceManager()->deregisterMe(this);
+}
 
 
 
@@ -132,26 +131,26 @@
 ///////////////////////////////////////////////////////////////////////
 
 AGSurface::AGSurface(AGInternalSurface *i):s(i)
-      {
-        getSurfaceManager()->registerMe(this);
-      }
+{
+  getSurfaceManager()->registerMe(this);
+}
 
 
 AGSurface::AGSurface():
   s(0)
-        {
-          getSurfaceManager()->registerMe(this);
-        }
+  {
+  getSurfaceManager()->registerMe(this);
+  }
 AGSurface::AGSurface(int w,int h):
   s(AGCreate32BitSurface(w,h))
-        {
-          getSurfaceManager()->registerMe(this);
-        }
+  {
+  getSurfaceManager()->registerMe(this);
+  }
 AGSurface::AGSurface(const AGSurface &p):
   s(p.s)
-        {
-          getSurfaceManager()->registerMe(this);
-        }
+  {
+  getSurfaceManager()->registerMe(this);
+  }
 
 bool AGSurface::valid() const
 {
@@ -162,31 +161,31 @@
 {
   AGInternalSurface *is=0;
   if(valid())
-    {
-      is=AGCreate32BitSurface(s->surface->w,s->surface->h);
+  {
+    is=AGCreate32BitSurface(s->surface->w,s->surface->h);
 
-      // copy pixel for pixel - as blitting doesn't seem to work
-      for(int x=0;x<width();x++)
-        for(int y=0;y<height();y++)
-          {
-            Uint32 c;
-            Uint8 r,g,b,a;
-            c=sge_GetPixel(s->surface,x,y);
-            SDL_GetRGBA(c,s->surface->format,&r,&g,&b,&a);
+    // copy pixel for pixel - as blitting doesn't seem to work
+    for(int x=0;x<width();x++)
+      for(int y=0;y<height();y++)
+      {
+        Uint32 c;
+        Uint8 r,g,b,a;
+        c=sge_GetPixel(s->surface,x,y);
+        SDL_GetRGBA(c,s->surface->format,&r,&g,&b,&a);
 
-            sge_PutPixel(is->surface,x,y,SDL_MapRGBA(is->surface->format,r,g,b,a));
-          }
-    }
+        sge_PutPixel(is->surface,x,y,SDL_MapRGBA(is->surface->format,r,g,b,a));
+      }
+  }
   AGSurface ns;
   ns.s=is;
   return ns;
 }
 
-AGSurface::~AGSurface()
-  {
-    if(getSurfaceManager())
-      getSurfaceManager()->deregisterMe(this);
-  }
+AGSurface::~AGSurface() throw()
+{
+  if(getSurfaceManager())
+    getSurfaceManager()->deregisterMe(this);
+}
 
 void AGSurface::save(const std::string &pName) const
 {
@@ -200,41 +199,41 @@
 
 
 AGSurface &AGSurface::operator=(const AGSurface &p)
-  {
-    s=p.s;
-    return *this;
-  }
+{
+  s=p.s;
+  return *this;
+}
 
 bool AGSurface::operator==(const AGSurface &p) const
 {
   cdebug("operator==");
   if(width()!=p.width())
-    {
-      cdebug("width:"<<width()<<"!="<<p.width());
-      return false;
-    }
+  {
+    cdebug("width:"<<width()<<"!="<<p.width());
+    return false;
+  }
   if(height()!=p.height())
-    {
-      cdebug("height:"<<height()<<"!="<<p.height());
-      return false;
-    }
+  {
+    cdebug("height:"<<height()<<"!="<<p.height());
+    return false;
+  }
   for(size_t y=0;y<height();y++)
     for(size_t x=0;x<width();x++)
       if(getPixel(x,y)!=p.getPixel(x,y))
-        {
-          cdebug(x<<":"<<y<<":"<<getPixel(x,y)<<"!="<<p.getPixel(x,y));
-          return false;
-        }
+      {
+        cdebug(x<<":"<<y<<":"<<getPixel(x,y)<<"!="<<p.getPixel(x,y));
+        return false;
+      }
   return true;
 }
 
 
 
 void AGSurface::putPixel(int x,int y,const AGColor &c)
-  {
-    sge_PutPixel(s->surface,x,y,color(c));
-    s->version++;
-  }
+{
+  sge_PutPixel(s->surface,x,y,color(c));
+  s->version++;
+}
 
 AGColor AGSurface::getPixel(int x,int y) const
 {
@@ -243,9 +242,10 @@
 
 
 
-AGSurface AGSurface::getSubSurface(const AGRect2 &sr) const
+AGSurface AGSurface::getSubSurface(const AGRect2 &sr) const throw(AGSurfaceEmptyException)
 {
-  CHECK_ZERO(s);
+  if(!s)
+    throw AGSurfaceEmptyException();
 
   AGInternalSurface *ns=AGCreate32BitSurface((int)sr.w(),(int)sr.h());
 
@@ -253,160 +253,172 @@
   Uint32 c;
   Uint8 r,g,b,a;
 
-  // copy 
+  // copy
   for(int x=0;x<sr.w();x++)
     for(int y=0;y<sr.h();y++)
-      {
-        c=sge_GetPixel(s->surface,(int)(x+sr.x()),(int)(y+sr.y()));
-        SDL_GetRGBA(c,s->surface->format,&r,&g,&b,&a);
-        c=SDL_MapRGBA(ns->surface->format,r,g,b,a);
+    {
+      c=sge_GetPixel(s->surface,(int)(x+sr.x()),(int)(y+sr.y()));
+      SDL_GetRGBA(c,s->surface->format,&r,&g,&b,&a);
+      c=SDL_MapRGBA(ns->surface->format,r,g,b,a);
 
-        sge_PutPixel(ns->surface,x,y,c);
-      }
+      sge_PutPixel(ns->surface,x,y,c);
+    }
   AGSurface nas;
   nas.s=ns;
   return nas;
 }
 
 
-Uint32 AGSurface::color(const AGColor &c) const
+Uint32 AGSurface::color(const AGColor &c) const throw(AGSurfaceEmptyException)
 {
-  CHECK_ZERO(s);
+  if(!s)
+    throw AGSurfaceEmptyException();
   return c.mapRGB(s->surface->format);
 }
 
-AGRect2 AGSurface::getRect() const
+AGRect2 AGSurface::getRect() const throw(AGSurfaceEmptyException)
 {
-  CHECK_ZERO(s);
+  if(!s)
+    throw AGSurfaceEmptyException();
   if(s)
     return AGRect2(0,0,s->surface->w,s->surface->h);
   else
     return AGRect2(0,0,0,0);
 }
 
-
-int AGSurface::width() const
+/**
+ * @return width of the surface
+ */
+int AGSurface::width() const throw(AGSurfaceEmptyException)
 {
-  CHECK_ZERO(s);
+  if(!s)
+    throw AGSurfaceEmptyException();
   return s->surface->w;
 }
-int AGSurface::height() const
+int AGSurface::height() const throw(AGSurfaceEmptyException)
 {
-  CHECK_ZERO(s);
+  if(!s)
+    throw AGSurfaceEmptyException();
   return s->surface->h;
 }
 
-void AGSurface::drawGradient(const AGRect2& rect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr)
-  {
-    CHECK_ZERO(s);
-    AGSDLPainter::drawGradientAlpha(s->surface,rect,ul,ur,dl,dr);
-    s->version++;
-  }
+void AGSurface::drawGradient(const AGRect2& rect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr)  throw(AGSurfaceEmptyException)
+{
+  if(!s)
+    throw AGSurfaceEmptyException();
+  AGSDLPainter::drawGradientAlpha(s->surface,rect,ul,ur,dl,dr);
+  s->version++;
+}
 
-void AGSurface::drawGradientAlpha(const AGRect2& rect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr)
-  {
-    CHECK_ZERO(s);
-    AGSDLPainter::drawGradientAlpha(s->surface,rect,ul,ur,dl,dr);
-    s->version++;
-  }
-void AGSurface::drawBorder(const AGRect2& rect,int W, const AGColor& c1, const AGColor& c2)
-  {
-    CHECK_ZERO(s);
-    AGSDLPainter::drawBorder(s->surface,rect,W,c1,c2);
-    s->version++;
-  }
+void AGSurface::drawGradientAlpha(const AGRect2& rect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr) throw(AGSurfaceEmptyException)
+{
+  if(!s)
+    throw AGSurfaceEmptyException();
+  AGSDLPainter::drawGradientAlpha(s->surface,rect,ul,ur,dl,dr);
+  s->version++;
+}
+void AGSurface::drawBorder(const AGRect2& rect,int W, const AGColor& c1, const AGColor& c2) throw(AGSurfaceEmptyException)
+{
+  if(!s)
+    throw AGSurfaceEmptyException();
+  AGSDLPainter::drawBorder(s->surface,rect,W,c1,c2);
+  s->version++;
+}
 
-void AGSurface::blit(const AGSurface &pSource,const AGRect2 &pDest,const AGRect2 &pSrc,const AGColor &pColor)
-  {
-    int x,y,sx,sy,dx,dy;
-    Uint32 c;
-    Uint8 r,g,b,a;
-    SDL_Surface *ss=const_cast<SDL_Surface*>(pSource.s->surface);
-    SDL_Surface *ds=s->surface;
+void AGSurface::blit(const AGSurface &pSource,const AGRect2 &pDest,const AGRect2 &pSrc,const AGColor &pColor) throw(AGSurfaceEmptyException)
+{
+  if(!s)
+    throw AGSurfaceEmptyException();
 
-    Uint32 colorkey=ss->format->colorkey;
-    int usekey=(ss->flags&SDL_SRCCOLORKEY);
+  int x,y,sx,sy,dx,dy;
+  Uint32 c;
+  Uint8 r,g,b,a;
+  SDL_Surface *ss=const_cast<SDL_Surface*>(pSource.s->surface);
+  SDL_Surface *ds=s->surface;
 
-    for(y=0,sy=(int)pSrc.y(), dy=(int)pDest.y();y<pSrc.h() ; y++,sy++,dy++)
-      for(x=0,sx=(int)pSrc.x(), dx=(int)pDest.x();x<pSrc.w() ; x++,sx++,dx++)
-        {
-          c=sge_GetPixel(ss,sx,sy);
+  Uint32 colorkey=ss->format->colorkey;
+  int usekey=(ss->flags&SDL_SRCCOLORKEY);
 
-          if(usekey)
-            if(c==colorkey)
-              continue;
+  for(y=0,sy=(int)pSrc.y(), dy=(int)pDest.y();y<pSrc.h() ; y++,sy++,dy++)
+    for(x=0,sx=(int)pSrc.x(), dx=(int)pDest.x();x<pSrc.w() ; x++,sx++,dx++)
+    {
+      c=sge_GetPixel(ss,sx,sy);
 
-          SDL_GetRGBA(c,ss->format,&r,&g,&b,&a);
-          c=SDL_MapRGBA(ds->format,r,g,b,a);
+      if(usekey)
+        if(c==colorkey)
+          continue;
 
-          sge_PutPixel(ds,dx,dy,c);
+      SDL_GetRGBA(c,ss->format,&r,&g,&b,&a);
+      c=SDL_MapRGBA(ds->format,r,g,b,a);
 
-        }
-    s->version++;
-  }
+      sge_PutPixel(ds,dx,dy,c);
 
+    }
+  s->version++;
+}
+
 AGInternalSurface *AGSurface::surface() const
 {
   return s;
 }
 
 AGSurface AGSurface::load(const std::string &pFilename) throw (FileNotFound)
+{
+  AGSurface n;
+  n.s=new AGInternalSurface;
+  std::string file=loadFile(pFilename);
+  if(file.length()==0)
   {
-    AGSurface n;
-    n.s=new AGInternalSurface;
-    std::string file=loadFile(pFilename);
-    if(file.length()==0)
-      {
-        cdebug("File "<<pFilename<<" is empty!");
-        throw FileNotFound(pFilename);
-      }
+    cdebug("File "<<pFilename<<" is empty!");
+    throw FileNotFound(pFilename);
+  }
 
-    SDL_RWops* rw=SDL_RWFromMem(const_cast<char*>(file.c_str()),file.length());
+  SDL_RWops* rw=SDL_RWFromMem(const_cast<char*>(file.c_str()),file.length());
 
-    SDL_Surface *s=IMG_Load_RW(rw,0);
-    if(!s)
-      {
-        std::cerr<<"error reading file:"<<pFilename<<std::endl;
-      }
+  SDL_Surface *s=IMG_Load_RW(rw,0);
+  if(!s)
+  {
+    std::cerr<<"error reading file:"<<pFilename<<std::endl;
+  }
 
 
-    SDL_FreeRW(rw);;
+  SDL_FreeRW(rw);;
 
-    n.s->surface=s;
-    return n;
-  }
+  n.s->surface=s;
+  return n;
+}
 
 AGSurface AGSurface::loadDRM(const std::string &pName) throw(FileNotFound)
-  {
-    assert(mDecryptor);
+{
+  assert(mDecryptor);
 
-    AGSurface n;
-    if(!mDecryptor)
-      return n;
+  AGSurface n;
+  if(!mDecryptor)
+    return n;
 
-    n.s=new AGInternalSurface;
-    std::string file=loadFile(pName);
-    if(file.length()==0)
-      throw FileNotFound(pName);
+  n.s=new AGInternalSurface;
+  std::string file=loadFile(pName);
+  if(file.length()==0)
+    throw FileNotFound(pName);
 
-    file=mDecryptor->decrypt(file,pName);
-    gDRM=true;
+  file=mDecryptor->decrypt(file,pName);
+  gDRM=true;
 
-    cdebug("FIRST:"<<int(file[0])<<","<<int(file[1])<<","<<int(file[2]));
+  cdebug("FIRST:"<<int(file[0])<<","<<int(file[1])<<","<<int(file[2]));
 
-    SDL_Surface *s=IMG_Load_RW(SDL_RWFromMem(const_cast<char*>(file.c_str()),file.length()),false);
-    assertGL;
-    if(s==0)
-      {
-        cdebug("Load file failed:"<<pName);
-      }
-    assert(s);
-    n.s->surface=s;
-    return n;
-
+  SDL_Surface *s=IMG_Load_RW(SDL_RWFromMem(const_cast<char*>(file.c_str()),file.length()),false);
+  assertGL;
+  if(s==0)
+  {
+    cdebug("Load file failed:"<<pName);
   }
+  assert(s);
+  n.s->surface=s;
+  return n;
 
+}
 
+
 AGSurface AGSurface::scale(int w,int h) const
 {
   CTRACE;
@@ -419,58 +431,58 @@
 
   for(int x=0;x<w;x++)
     for(int y=0;y<h;y++)
+    {
+      if(fast)
+        n.putPixel(x,y,getPixel((int)(x*ow/w),(int)(y*oh/h)));
+      else if(w>ow)
       {
-        if(fast)
-          n.putPixel(x,y,getPixel((int)(x*ow/w),(int)(y*oh/h)));
-        else if(w>ow)
-          {
-            // interpolate
-            float tx=x*ow/w;
-            float ty=y*oh/h;
+        // interpolate
+        float tx=x*ow/w;
+        float ty=y*oh/h;
 
-            int ix=(int)tx;
-            int iy=(int)ty;
+        int ix=(int)tx;
+        int iy=(int)ty;
 
-            float dx=tx-ix;
-            float dy=ty-iy;
+        float dx=tx-ix;
+        float dy=ty-iy;
 
-            n.putPixel(x,y,
-                AGColor((getPixel(ix,iy  ).toVec()*(1-dx) + getPixel(ix+1,iy  ).toVec()*dx) * (1-dy)+
-                    (getPixel(ix,iy+1).toVec()*(1-dx) + getPixel(ix+1,iy+1).toVec()*dx) * dy     ));
+        n.putPixel(x,y,
+            AGColor((getPixel(ix,iy  ).toVec()*(1-dx) + getPixel(ix+1,iy  ).toVec()*dx) * (1-dy)+
+                (getPixel(ix,iy+1).toVec()*(1-dx) + getPixel(ix+1,iy+1).toVec()*dx) * dy     ));
 
+      }
+      else
+      {
+        // integrate
+        size_t ps=0;
+        float r,g,b,a;
+        r=g=b=a=0;
+        float tx0=x*ow/w;
+        float ty0=y*oh/h;
+        float tx1=(x+1)*ow/w;
+        float ty1=(y+1)*oh/h;
+        for(int mx=(int)tx0;mx<tx1;mx++)
+          for(int my=(int)ty0;my<ty1;my++)
+          {
+            AGColor c=getPixel(mx,my);
+            r+=c.r;
+            g+=c.g;
+            b+=c.b;
+            a+=c.a;
+            ps++;
           }
-        else
-          {
-            // integrate
-            size_t ps=0;
-            float r,g,b,a;
-            r=g=b=a=0;
-            float tx0=x*ow/w;
-            float ty0=y*oh/h;
-            float tx1=(x+1)*ow/w;
-            float ty1=(y+1)*oh/h;
-            for(int mx=(int)tx0;mx<tx1;mx++)
-              for(int my=(int)ty0;my<ty1;my++)
-                {
-                  AGColor c=getPixel(mx,my);
-                  r+=c.r;
-                  g+=c.g;
-                  b+=c.b;
-                  a+=c.a;
-                  ps++;
-                }
-            if(ps>0)
-              {
-                r/=ps;
-                g/=ps;
-                b/=ps;
-                a/=ps;
-                n.putPixel(x,y,AGColor((int)r,(int)g,(int)b,(int)a));
-              }
+        if(ps>0)
+        {
+          r/=ps;
+          g/=ps;
+          b/=ps;
+          a/=ps;
+          n.putPixel(x,y,AGColor((int)r,(int)g,(int)b,(int)a));
+        }
 
 
-          }
       }
+    }
 
   return n;
 }
@@ -481,233 +493,233 @@
 
   for(int x=0;x<width();x++)
     for(int y=0;y<height();y++)
-      {
-        AGColor c=getPixel(x,y).grey();
-        n.putPixel(x,y,c);
-      }
+    {
+      AGColor c=getPixel(x,y).grey();
+      n.putPixel(x,y,c);
+    }
 
   return n;
 }
 
 void AGSurface::fillRect(const AGRect2 &pr,const AGColor &c)
-  {
-    for(int x=(int)pr.x0();x<=pr.x1();x++)
-      for(int y=(int)pr.y0();y<=pr.y1();y++)
-        putPixel(x,y,c);
-  }
+{
+  for(int x=(int)pr.x0();x<=pr.x1();x++)
+    for(int y=(int)pr.y0();y<=pr.y1();y++)
+      putPixel(x,y,c);
+}
 
 
 void AGSurface::drawLine(const AGVector2 &pp0,const AGVector2 &pp1,const AGColor &c)
-  {
-    AGVector2 p0,p1;
+{
+  AGVector2 p0,p1;
 
-    p0=pp0;
-    p1=pp1;
+  p0=pp0;
+  p1=pp1;
 
-    float dx=p1[0]-p0[0];
-    float dy=p1[1]-p0[1];
+  float dx=p1[0]-p0[0];
+  float dy=p1[1]-p0[1];
 
-    if(fabs(dx)>fabs(dy))
-      {
-        if(dx<0)
-          {
-            p0=pp1;
-            p1=pp0;
-          }
+  if(fabs(dx)>fabs(dy))
+  {
+    if(dx<0)
+    {
+      p0=pp1;
+      p1=pp0;
+    }
 
-        dx=p1[0]-p0[0];
-        dy=p1[1]-p0[1];
+    dx=p1[0]-p0[0];
+    dy=p1[1]-p0[1];
 
-        float y=p0[1];
-        float e=0;
-        float de=((float)dy)/dx;
-        for(float x=p0[0];x<=p1[0];x++)
-          {
-            putPixel(int(x),int(y),c);
-            e+=de;
-            if(e>0.5)
-              {
-                e-=1.0;
-                y++;
-              }
-            else if(e<-0.5)
-              {
-                e+=1.0;
-                y--;
-              }
-          }
+    float y=p0[1];
+    float e=0;
+    float de=((float)dy)/dx;
+    for(float x=p0[0];x<=p1[0];x++)
+    {
+      putPixel(int(x),int(y),c);
+      e+=de;
+      if(e>0.5)
+      {
+        e-=1.0;
+        y++;
       }
-    else
+      else if(e<-0.5)
       {
-        if(dy<0)
-          {
-            p0=pp1;
-            p1=pp0;
-          }
+        e+=1.0;
+        y--;
+      }
+    }
+  }
+  else
+  {
+    if(dy<0)
+    {
+      p0=pp1;
+      p1=pp0;
+    }
 
-        dx=p1[0]-p0[0];
-        dy=p1[1]-p0[1];
+    dx=p1[0]-p0[0];
+    dy=p1[1]-p0[1];
 
-        float x=p0[0];
-        float e=0;
-        float de=((float)dx)/dy;
-        for(float y=p0[1];y<=p1[1];y++)
-          {
-            putPixel(int(x),int(y),c);
-            e+=de;
-            if(e>0.5)
-              {
-                e-=1.0;
-                x++;
-              }
-            else if(e<-0.5)
-              {
-                e+=1.0;
-                x--;
-              }
-          }
+    float x=p0[0];
+    float e=0;
+    float de=((float)dx)/dy;
+    for(float y=p0[1];y<=p1[1];y++)
+    {
+      putPixel(int(x),int(y),c);
+      e+=de;
+      if(e>0.5)
+      {
+        e-=1.0;
+        x++;
       }
+      else if(e<-0.5)
+      {
+        e+=1.0;
+        x--;
+      }
+    }
   }
+}
 
 /**
 
 @returns hot-spot int the left upper corner
 
  */
-AGVector2 AGSurface::shrink2Fit(int alphaThresh)
-  {
-    int x0,x1;
-    int y0,y1;
-    int x,y;
+ AGVector2 AGSurface::shrink2Fit(int alphaThresh)
+{
+  int x0,x1;
+  int y0,y1;
+  int x,y;
 
-    x0=width();
-    y0=height();
-    x1=0;
-    y1=0;
-    for(y=0;y<height();y++)
-      for(x=0;x<width();x++)
-        {
-          if(getPixel(x,y).a>alphaThresh)
-            {
-              x0=std::min(x0,x);
-              y0=std::min(y0,y);
-              x1=std::max(x1,x);
-              y1=std::max(y1,y);
-            }
-        }
+  x0=width();
+  y0=height();
+  x1=0;
+  y1=0;
+  for(y=0;y<height();y++)
+    for(x=0;x<width();x++)
+    {
+      if(getPixel(x,y).a>alphaThresh)
+      {
+        x0=std::min(x0,x);
+        y0=std::min(y0,y);
+        x1=std::max(x1,x);
+        y1=std::max(y1,y);
+      }
+    }
 
 
 
-    int nw=std::max(1,x1-x0+1);
-    int nh=std::max(1,y1-y0+1);
+  int nw=std::max(1,x1-x0+1);
+  int nh=std::max(1,y1-y0+1);
 
-    AGSurface n(nw,nh);
+  AGSurface n(nw,nh);
 
-    for(x=0;x<nw;x++)
-      for(y=0;y<nh;y++)
-        {
-          n.putPixel(x,y,getPixel(x+x0,y+y0));
-        }
-    (*this)=n;
-    return AGVector2(x0,x1);
-
-  }
-
-/**
- * \return if this and pSurface have the same extends, this is sum_pixel((this(pixel)-pSurface(pixel)^2)
- *         otherwise it's -1 
- *         the used norm for colors is sqrt((r0-r1)^2+(g0-g1)^2+(b0-b1)^2+(a0-a1)^2)
- * */
-float AGSurface::similarity(const AGSurface &pSurface) const
-{
-  float value=0;
-  if(pSurface.width()!=width() || pSurface.height()!=height())
+  for(x=0;x<nw;x++)
+    for(y=0;y<nh;y++)
     {
-      return -1;
+      n.putPixel(x,y,getPixel(x+x0,y+y0));
     }
-  AGColor c0,c1;
-  float r,g,b,a;
-  for(size_t x=0;x<width();x++)
-    for(size_t y=0;y<height();y++)
-      {
-        c0=getPixel(x,y);
-        c1=pSurface.getPixel(x,y);
-        r=c0.r-c1.r;
-        b=c0.b-c1.b;
-        g=c0.g-c1.g;
-        a=c0.a-c1.a;
-        value+=sqrt(r*r+b*b+g*g+a*a)/float(0xFF);
-      }
-  return value;
+  (*this)=n;
+  return AGVector2(x0,x1);
+
 }
 
+ /**
+  * \return if this and pSurface have the same extends, this is sum_pixel((this(pixel)-pSurface(pixel)^2)
+  *         otherwise it's -1
+  *         the used norm for colors is sqrt((r0-r1)^2+(g0-g1)^2+(b0-b1)^2+(a0-a1)^2)
+  * */
+ float AGSurface::similarity(const AGSurface &pSurface) const
+ {
+   float value=0;
+   if(pSurface.width()!=width() || pSurface.height()!=height())
+   {
+     return -1;
+   }
+   AGColor c0,c1;
+   float r,g,b,a;
+   for(size_t x=0;x<width();x++)
+     for(size_t y=0;y<height();y++)
+     {
+       c0=getPixel(x,y);
+       c1=pSurface.getPixel(x,y);
+       r=c0.r-c1.r;
+       b=c0.b-c1.b;
+       g=c0.g-c1.g;
+       a=c0.a-c1.a;
+       value+=sqrt(r*r+b*b+g*g+a*a)/float(0xFF);
+     }
+   return value;
+ }
 
-bool AGSurface::similarTo(const AGSurface &pSurface,float threshold) const
-{
-  float s=similarity(pSurface);
-  if(s<0)
-    return s;
-  if(width()==0 && height()==0)
-    return true;
-  return sqrt(s)/(width()*height())<threshold;
-}
 
+ bool AGSurface::similarTo(const AGSurface &pSurface,float threshold) const
+ {
+   float s=similarity(pSurface);
+   if(s<0)
+     return s;
+   if(width()==0 && height()==0)
+     return true;
+   return sqrt(s)/(width()*height())<threshold;
+ }
 
 
-void AGSurface::setDecryptor(AGDecryptor *pDecryptor)
-  {
-    mDecryptor=pDecryptor;
-  }
 
+ void AGSurface::setDecryptor(AGDecryptor *pDecryptor)
+ {
+   mDecryptor=pDecryptor;
+ }
 
-AGDecryptor *toDecryptor(AGPlugin *p)
-  {
-    return (AGDecryptor*)(p);
-  }
 
-std::ostream &operator<<(std::ostream &o,SDL_PixelFormat *f)
-  {
-    o<<"(";
-    //    SDL_Palette *palette;
-    o<<(int)f->BitsPerPixel<<";";
-    o<<(int)f->BytesPerPixel<<";";
-    o<<(int)f->Rloss<<";";
-    o<<(int)f->Gloss<<";";
-    o<<(int)f->Bloss<<";";
-    o<<(int)f->Aloss<<";";
-    o<<(int)f->Rshift<<";";
-    o<<(int)f->Gshift<<";";
-    o<<(int)f->Bshift<<";";
-    o<<(int)f->Ashift<<";";
-    o<<(int)f->Rmask<<";";
-    o<<(int)f->Gmask<<";";
-    o<<(int)f->Bmask<<";";
-    o<<(int)f->Amask<<";";
-    o<<(int)f->colorkey<<";";
-    o<<(int)f->alpha<<")";
-    o<<"\n";
+ AGDecryptor *toDecryptor(AGPlugin *p)
+ {
+   return (AGDecryptor*)(p);
+ }
 
+ std::ostream &operator<<(std::ostream &o,SDL_PixelFormat *f)
+ {
+   o<<"(";
+   //    SDL_Palette *palette;
+   o<<(int)f->BitsPerPixel<<";";
+   o<<(int)f->BytesPerPixel<<";";
+   o<<(int)f->Rloss<<";";
+   o<<(int)f->Gloss<<";";
+   o<<(int)f->Bloss<<";";
+   o<<(int)f->Aloss<<";";
+   o<<(int)f->Rshift<<";";
+   o<<(int)f->Gshift<<";";
+   o<<(int)f->Bshift<<";";
+   o<<(int)f->Ashift<<";";
+   o<<(int)f->Rmask<<";";
+   o<<(int)f->Gmask<<";";
+   o<<(int)f->Bmask<<";";
+   o<<(int)f->Amask<<";";
+   o<<(int)f->colorkey<<";";
+   o<<(int)f->alpha<<")";
+   o<<"\n";
 
-    return o;
-  }
 
-std::ostream &operator<<(std::ostream &o,SDL_Surface *f)
-  {
-    o<<"(";
-    o<<f->flags<<",";
-    o<<f->format<<",";                /* Read-only */
-    o<<f->w<<","<<f->h<<",";
-    o<<f->pitch<<";";                           /* Read-only */
-    o<<f->offset<<";";                             /* Private */
+   return o;
+ }
 
-    o<<f->clip_rect<<";";                     /* Read-only */
+ std::ostream &operator<<(std::ostream &o,SDL_Surface *f)
+ {
+   o<<"(";
+   o<<f->flags<<",";
+   o<<f->format<<",";                /* Read-only */
+   o<<f->w<<","<<f->h<<",";
+   o<<f->pitch<<";";                           /* Read-only */
+   o<<f->offset<<";";                             /* Private */
 
-    o<<f->locked<<";";                          /* Private */
+   o<<f->clip_rect<<";";                     /* Read-only */
 
-    o<<f->format_version<<";";            /* Private */
+   o<<f->locked<<";";                          /* Private */
 
-    /* Reference count -- used when freeing surface */
-    o<<f->refcount<<")\n";
+   o<<f->format_version<<";";            /* Private */
 
-    return o;
-  }
+   /* Reference count -- used when freeing surface */
+   o<<f->refcount<<")\n";
+
+   return o;
+ }

Modified: antargis/trunk/ext/video/ag_surface.h
===================================================================
--- antargis/trunk/ext/video/ag_surface.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_surface.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,6 +23,8 @@
 #ifndef __GUI_SURFACE_H
 #define __GUI_SURFACE_H
 
+#include "rk_exception.h"
+
 #include <string>
 #include <set>
 #include <list>
@@ -31,6 +33,7 @@
 #include "ag_geometry.h"
 #include "ag_painttarget.h"
 #include "ag_gltexture.h"
+#include "rk_exception.h"
 #include <ag_plugin.h>
 
 class AGColor;
@@ -74,24 +77,33 @@
     }
 };
 
+class AGSurfaceEmptyException:public AGException
+{
+public:
+  AGSurfaceEmptyException():AGException("Surface is used but empty!")
+  {
+  }
+
+};
+
 /// Generic classes - for OpenGL and "normal" SDL
 class AGEXPORT AGSurface:public AGPaintTarget
 {
- public:  
+ public:
   AGSurface();
   AGSurface(int w,int h);
   AGSurface(const AGSurface &p); // shallow copy only
 
-  virtual ~AGSurface();
+  virtual ~AGSurface() throw();
 
   AGSurface copy() const;
 
-  int width() const;
-  int height() const;
+  int width() const throw(AGSurfaceEmptyException);
+  int height() const throw(AGSurfaceEmptyException);
 
-  AGRect2 getRect() const;
+  AGRect2 getRect() const throw(AGSurfaceEmptyException);
 
-  AGSurface getSubSurface(const AGRect2 &r) const;
+  AGSurface getSubSurface(const AGRect2 &r) const throw(AGSurfaceEmptyException);
 
   bool valid() const;
 
@@ -101,11 +113,11 @@
   AGSurface &operator=(const AGSurface &p);
   bool operator==(const AGSurface &p) const;
 
-  virtual void blit(const AGSurface &pSource,const AGRect2 &pDest,const AGRect2 &pSrc,const AGColor &pColor);
+  virtual void blit(const AGSurface &pSource,const AGRect2 &pDest,const AGRect2 &pSrc,const AGColor &pColor) throw(AGSurfaceEmptyException);
 
-  void drawGradient(const AGRect2& rect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr);
-  void drawGradientAlpha(const AGRect2& rect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr);
-  void drawBorder(const AGRect2& rect,int width, const AGColor& c1, const AGColor& c2);
+  void drawGradient(const AGRect2& rect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr) throw(AGSurfaceEmptyException);
+  void drawGradientAlpha(const AGRect2& rect, const AGColor& ul, const AGColor& ur, const AGColor& dl, const AGColor& dr) throw(AGSurfaceEmptyException);
+  void drawBorder(const AGRect2& rect,int width, const AGColor& c1, const AGColor& c2) throw(AGSurfaceEmptyException);
 
   virtual void putPixel(int x,int y,const AGColor &c);
   virtual AGColor getPixel(int x,int y) const;
@@ -126,15 +138,15 @@
   AGVector2 shrink2Fit(int alphaThresh=20);
 
   AGSurface(AGInternalSurface *i);
-  
+
   float similarity(const AGSurface &pSurface) const;
   bool similarTo(const AGSurface &pSurface,float threshold=0.1) const;
-  
-  
 
+
+
  private:
 
-  Uint32 color(const AGColor &c) const;
+  Uint32 color(const AGColor &c) const throw(AGSurfaceEmptyException);;
 
   AGInternalSurface *s;
 
@@ -143,7 +155,7 @@
   friend class AntTextureData;
   size_t mVersion;
 
-  static AGDecryptor *mDecryptor;  
+  static AGDecryptor *mDecryptor;
 };
 
 AGEXPORT void AGFreeSurface(SDL_Surface *s);

Modified: antargis/trunk/ext/video/ag_surfacemanager.cc
===================================================================
--- antargis/trunk/ext/video/ag_surfacemanager.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_surfacemanager.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #include "ag_surface.h"
 #include "ag_texture.h"
 #include "ag_kill.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_config.h"
 #include "ag_glscreen.h"
 #include "ag_profiler.h"

Modified: antargis/trunk/ext/video/ag_surfacemanager.h
===================================================================
--- antargis/trunk/ext/video/ag_surfacemanager.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_surfacemanager.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,7 +21,7 @@
 #ifndef AG_SURFACEMANAGER_H
 #define AG_SURFACEMANAGER_H
 
-#include <ag_base.h>
+#include <rk_base.h>
 #include <set>
 
 class AGRenderContext;

Modified: antargis/trunk/ext/video/ag_texture.cc
===================================================================
--- antargis/trunk/ext/video/ag_texture.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_texture.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include "ag_texture.h"
 #include "ag_glscreen.h"
-#include "ag_debug.h"
+#include "rk_debug.h"
 #include "ag_rendercontext.h"
 #include "ag_sgeexport.h"
 #include "ag_surfacemanager.h"
@@ -137,7 +137,7 @@
   }
 
 
-AGTexture::~AGTexture()
+AGTexture::~AGTexture() throw()
   {
     if(getSurfaceManager())
       getSurfaceManager()->deregisterMe(this);

Modified: antargis/trunk/ext/video/ag_texture.h
===================================================================
--- antargis/trunk/ext/video/ag_texture.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_texture.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -36,7 +36,7 @@
   AGTexture(const AGSurface &pSurface,bool p3d=false);
   AGTexture(const AGTexture &t);         // shallow copy, uses same tex-id or sdl-surface
   AGTexture(int W,int H);
-  ~AGTexture();
+  ~AGTexture() throw();
 
   AGTexture &operator=(const AGTexture &t);
 

Modified: antargis/trunk/ext/video/ag_texturecache.h
===================================================================
--- antargis/trunk/ext/video/ag_texturecache.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_texturecache.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,8 +23,9 @@
 #ifndef __TEXTURE_CACHE_H__
 #define __TEXTURE_CACHE_H__
 
+#include "rk_debug.h"
+
 #include "ag_surface.h"
-#include "ag_debug.h"
 #include <ag_fs.h>
 
 #include <string>
@@ -42,7 +43,7 @@
     const AGTexture &get(const AGString &pTextureFilename,const AGRect2 &pSub) throw (FileNotFound);
   private:
     std::map<AGString,AGTexture*> mTextures;
-    
+
     friend AGTextureCache *getTextureCache();
   };
 

Modified: antargis/trunk/ext/video/ag_vdebug.cc
===================================================================
--- antargis/trunk/ext/video/ag_vdebug.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_vdebug.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -2,6 +2,7 @@
 #include <ag_video.h>
 
 #include <SDL_opengl.h>
+#include <SDL_error.h>
 
 void checkGLReal(const std::string &pString)
   {

Modified: antargis/trunk/ext/video/ag_vdebug.h
===================================================================
--- antargis/trunk/ext/video/ag_vdebug.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_vdebug.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,7 +1,7 @@
 #ifndef AG_VDEBUG
 #define AG_VDEBUG
 
-#include <ag_debug.h>
+#include <rk_debug.h>
 
 AGEXPORT void agAssertGL(std::string s);
 AGEXPORT void checkGLReal(const std::string &pString);

Modified: antargis/trunk/ext/video/ag_video.cc
===================================================================
--- antargis/trunk/ext/video/ag_video.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_video.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include <ag_video.h>
 
-#include <ag_debug.h>
+#include <rk_debug.h>
 #include <ag_vdebug.h>
 #include <ag_gltexture.h>
 #include <ag_glscreen.h>

Modified: antargis/trunk/ext/video/init.cc
===================================================================
--- antargis/trunk/ext/video/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,4 @@
-#include <ag_debug.h>
+#include <rk_debug.h>
 #include <ag_main.h>
 #include <ag_video.h>
 

Modified: antargis/trunk/main/starter.cc
===================================================================
--- antargis/trunk/main/starter.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/main/starter.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,11 +1,30 @@
 #include <SDL.h>
 
 #include <ruby.h>
+#ifdef WIN32
+#undef write
+#undef read
+#endif
 #include <iostream>
 
-#include <ag_rtools.h>
-#include <ag_string.h>
+#include <rk_tools.h>
+#include <rk_string.h>
 
+
+
+
+void plainLog(const std::string &p)
+{
+  static FILE *f=0;
+  if(f==0)
+    f=fopen("starter.log","w");
+
+  fwrite(p.c_str(),sizeof(char),p.length(),f);
+  fwrite("\n",sizeof(char),1,f);
+
+  fflush(f);
+}
+
 std::string toLower(const std::string &s)
   {
     std::string a;
@@ -39,35 +58,61 @@
 
 int main(int _argc,char*_argv[])
   {
+    plainLog("startup");
+
     ruby_init();
 
+    plainLog("ruby inited");
 
     int argc=_argc;
     char**argv=_argv;
 
     if(argc==1)
       {
+        plainLog("no args given");
         argv=new char*[2];
-        argv[0]=_argv[0];
+        argv[0]=new char[strlen(_argv[0])+10];
+        strcpy(argv[0],_argv[0]);
+        //argv[0]=_argv[0];
 
         std::string s=argv[0],sep;
 
+        plainLog("my name:"+s);
+
         if(isWindows(s))
           sep="\\";
         else
           sep="/";
+
+        plainLog("dir sep:"+sep);
+
+
         s=truncReverseUntil(s,sep);
+        plainLog("s:"+s);
 
+        if(s.length()>0)
+          s+=sep;
+        plainLog("s:"+s);
+
+
         argv[1]=new char[s.length()+100];
-        strcpy(argv[1],(s+sep+"antargisStarter.rb").c_str());
+        strcpy(argv[1],(s+"antargisStarter.rb").c_str());
+        plainLog(std::string("argv[1]:")+argv[1]);
+
         argc=2;
       }
 
+    plainLog("setting ruby ops...");
 
     ruby_options(argc,argv);
+    plainLog("rups ops set");
     rb_gv_set("antargisStarterLoaded",Qtrue);
+    plainLog("global set");
+    plainLog("running ruby...");
 
     ruby_run();
+    plainLog("ended");
+
     std::cout<<"CCC"<<std::endl;
     return 0;
   }

Modified: antargis/trunk/ruby/ant_tools.rb
===================================================================
--- antargis/trunk/ruby/ant_tools.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/ant_tools.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -31,7 +31,7 @@
   dputs "ERROR:"+error.to_s
 end
 
-class Set<Array
+class AntSet<Array
   def push(x)
     super
     sort!

Modified: antargis/trunk/ruby/antargislib.rb
===================================================================
--- antargis/trunk/ruby/antargislib.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/antargislib.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -4,6 +4,7 @@
 # - init video-mode
 # - process config-file and parameter input
 #
+require 'rookey/lib/rookey/tools.rb'
 require 'pp'
 
 
@@ -101,8 +102,10 @@
 rescue
   puts "Antargis-module not found - trying to load .so"
   begin
-    if File.exists?("ext/antargis.so")
-      require 'ext/antargis'
+    if File.exists?("antargis.so")
+      require 'antargis'
+    elsif File.exists?("antargis.dll")
+      require 'antargis.dll'
     elsif File.exists?("antargis.bundle")
       require 'antargis.bundle'
     else

Modified: antargis/trunk/ruby/editor/campaign/drag_grid.rb
===================================================================
--- antargis/trunk/ruby/editor/campaign/drag_grid.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/editor/campaign/drag_grid.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,13 +1,13 @@
 require 'ruby/antargislib.rb'
 require 'pp'
 
-require File.join(File.split(__FILE__)[0],"dialogs.rb")
-require File.join(File.split(__FILE__)[0],"toolbar.rb")
+require "./dialogs.rb"
+require "./toolbar.rb"
 
-require File.join(File.split(__FILE__)[0],'ruby_tools.rb')
-require File.join(File.split(__FILE__)[0],'story_editor.rb')
-requireRelative('ruby_signals.rb',__FILE__)
-require File.join(File.split(__FILE__)[0],"campaign_data.rb")
+require './ruby_tools.rb'
+require './story_editor.rb'
+require './ruby_signals.rb'
+require './campaign_data.rb'
 
 #setDebugLevel(0)
 

Modified: antargis/trunk/ruby/editor/campaign/ruby_layouts.rb
===================================================================
--- antargis/trunk/ruby/editor/campaign/ruby_layouts.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/editor/campaign/ruby_layouts.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -17,4 +17,4 @@
   getLayoutFactory.addCreator(name,creator)
 end
 
-requireRelative("effect.rb",__FILE__)
\ No newline at end of file
+require "./effect.rb"
\ No newline at end of file

Modified: antargis/trunk/ruby/editor/campaign/ruby_tools.rb
===================================================================
--- antargis/trunk/ruby/editor/campaign/ruby_tools.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/editor/campaign/ruby_tools.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,5 @@
-def requireRelative(file,current)
+if false
+  def requireRelative(file,current)
   require File.join(File.split(current)[0],file)
 end
 
@@ -20,5 +21,7 @@
     end
   end
 end
+end
+require "rookey/lib/tools.rb"
 
-requireRelative("ruby_layouts.rb",__FILE__)
\ No newline at end of file
+require "./ruby_layouts.rb"
\ No newline at end of file

Modified: antargis/trunk/ruby/entities/ant_house.rb
===================================================================
--- antargis/trunk/ruby/entities/ant_house.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/entities/ant_house.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -64,7 +64,7 @@
     @type=3
     setProvide("house",true)
     @defeated=[]
-    @atHome=Set.new
+    @atHome=AntSet.new
     setMinimapColor(AGColor.new(0x55,0x55,0x55))
     setMinimapSize(5)
 



From davidkamphausen at mail.berlios.de  Mon Feb 16 21:14:15 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Mon, 16 Feb 2009 21:14:15 +0100
Subject: [Antargis-svn] r1287 - antargis/trunk/ruby/editor
Message-ID: <200902162014.n1GKEFm3007168@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-16 21:14:15 +0100 (Mon, 16 Feb 2009)
New Revision: 1287

Added:
   antargis/trunk/ruby/editor/graphviewer/
Log:
graphviewer



From davidkamphausen at mail.berlios.de  Mon Feb 16 21:16:03 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Mon, 16 Feb 2009 21:16:03 +0100
Subject: [Antargis-svn] r1288 - antargis/trunk/rookey/lib/rookey/cpp
Message-ID: <200902162016.n1GKG3CF007564@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-16 21:16:03 +0100 (Mon, 16 Feb 2009)
New Revision: 1288

Added:
   antargis/trunk/rookey/lib/rookey/cpp/rk_logging.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.h
Log:
added new rookey-classes

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_logging.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_logging.cc	2009-02-16 20:14:15 UTC (rev 1287)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_logging.cc	2009-02-16 20:16:03 UTC (rev 1288)
@@ -0,0 +1 @@
+

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h	2009-02-16 20:14:15 UTC (rev 1287)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h	2009-02-16 20:16:03 UTC (rev 1288)
@@ -0,0 +1,18 @@
+/* 
+ * File:   rk_logging.h
+ * Author: davidkamphausen
+ *
+ * Created on 16. Februar 2009, 17:47
+ */
+
+#ifndef _RK_LOGGING_H
+#define	_RK_LOGGING_H
+
+class RKLogging:public RKSingleton
+{
+    
+};
+
+
+#endif	/* _RK_LOGGING_H */
+

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.cc	2009-02-16 20:14:15 UTC (rev 1287)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.cc	2009-02-16 20:16:03 UTC (rev 1288)
@@ -0,0 +1,18 @@
+/* 
+ * File:   rksingleton.cc
+ * Author: davidkamphausen
+ * 
+ * Created on 16. Februar 2009, 17:47
+ */
+
+#include "rksingleton.h"
+
+RKSingleton::RKSingleton() {
+}
+
+RKSingleton::RKSingleton(const RKSingleton& orig) {
+}
+
+RKSingleton::~RKSingleton() {
+}
+

Added: antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.h	2009-02-16 20:14:15 UTC (rev 1287)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.h	2009-02-16 20:16:03 UTC (rev 1288)
@@ -0,0 +1,23 @@
+/* 
+ * File:   rksingleton.h
+ * Author: davidkamphausen
+ *
+ * Created on 16. Februar 2009, 17:47
+ */
+
+#ifndef _RKSINGLETON_H
+#define	_RKSINGLETON_H
+
+template<class Base>
+class RKSingleton {
+public:
+    virtual ~RKSingleton();
+
+    RKSingleton *getInstance
+protected:
+    RKSingleton();
+
+};
+
+#endif	/* _RKSINGLETON_H */
+



From davidkamphausen at mail.berlios.de  Tue Feb 17 20:14:57 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Tue, 17 Feb 2009 20:14:57 +0100
Subject: [Antargis-svn] r1289 - in antargis/trunk/rookey:
	examples/simplistic lib/rookey lib/rookey/cpp lib/rookey/cpp/spec
Message-ID: <200902171914.n1HJEvGN022688@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-17 20:14:57 +0100 (Tue, 17 Feb 2009)
New Revision: 1289

Added:
   antargis/trunk/rookey/lib/rookey/cpp/spec/
   antargis/trunk/rookey/lib/rookey/cpp/spec/Rakefile
   antargis/trunk/rookey/lib/rookey/cpp/spec/singleton_spec.cc
Modified:
   antargis/trunk/rookey/examples/simplistic/
   antargis/trunk/rookey/examples/simplistic/rookey.log
   antargis/trunk/rookey/examples/simplistic/test
   antargis/trunk/rookey/examples/simplistic/test.bundle
   antargis/trunk/rookey/lib/rookey/cpp/rk_debug.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.h
   antargis/trunk/rookey/lib/rookey/tasks.rb
Log:
 rookey fixes


Property changes on: antargis/trunk/rookey/examples/simplistic
___________________________________________________________________
Name: svn:ignore
   + .build_darwin9.0
.deps


Modified: antargis/trunk/rookey/examples/simplistic/rookey.log
===================================================================
--- antargis/trunk/rookey/examples/simplistic/rookey.log	2009-02-16 20:16:03 UTC (rev 1288)
+++ antargis/trunk/rookey/examples/simplistic/rookey.log	2009-02-17 19:14:57 UTC (rev 1289)
@@ -13,24 +13,24 @@
 /usr/bin/rake:19:in `load'
 /usr/bin/rake:19
 Running configurator Rookey::SwigConfig
-#<Rookey::Config:0x5455d8 @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
+#<Rookey::Config:0x52213c @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
 Running configurator Rookey::MinGWConfig
-#<Rookey::Config:0x5455d8 @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
+#<Rookey::Config:0x52213c @hash={"SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig"}>
 Running configurator Rookey::RubyConfig
-#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+#<Rookey::Config:0x52213c @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
 Running configurator Rookey::GLConfig
-#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+#<Rookey::Config:0x52213c @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
 Running configurator Rookey::DebugConfig
-#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+#<Rookey::Config:0x52213c @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
 Running configurator Rookey::CompilerConfig
-#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+#<Rookey::Config:0x52213c @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
 Running configurator Rookey::CcacheConfig
-#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+#<Rookey::Config:0x52213c @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
 Running configurator Rookey::Configurator
-#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+#<Rookey::Config:0x52213c @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
 Running configurator Rookey::ZConfig
-#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+#<Rookey::Config:0x52213c @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
 Running configurator Rookey::SDLConfig
-#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+#<Rookey::Config:0x52213c @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
 Running configurator Rookey::PNGConfig
-#<Rookey::Config:0x5455d8 @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer -lpng", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>
+#<Rookey::Config:0x52213c @hash={"CC"=>"/usr/bin/gcc", "SWIG_OPTIONS"=>" -Wall -DAGEXPORT", "CCACHE"=>"/opt/local/bin/ccache", "SWIG"=>" /opt/local/bin/swig", "CPP"=>"/usr/bin/g++", "CFLAGS"=>" -arch ppc -arch i386 -Os -pipe -fno-common -D_GNU_SOURCE=1 -D_THREAD_SAFE", "host_os"=>"darwin9.0", "DLEXT"=>"bundle", "INCLUDEDIRS"=>" /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/universal-darwin9.0 /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/include /usr/X11/include /Library/Ruby/Gems/1.8/gems/rookey-0.1/lib/rookey/./cpp /opt/local/include/SDL", "LDFLAGS"=>" -lpthread -ldl -lm  -lruby -Wl,-framework,OpenGL -lz -L/opt/local/lib -lSDLmain -lSDL -Wl,-framework,Cocoa -lSDL_image -lSDL_ttf -lSDL_mixer -lpng", "GCC_BASE"=>"gcc", "GPP_BASE"=>"g++", "LDSHAREDFLAGS"=>" -arch ppc -arch i386 -pipe -bundle -undefined dynamic_lookup"}>

Modified: antargis/trunk/rookey/examples/simplistic/test
===================================================================
(Binary files differ)

Modified: antargis/trunk/rookey/examples/simplistic/test.bundle
===================================================================
(Binary files differ)

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_debug.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_debug.cc	2009-02-16 20:16:03 UTC (rev 1288)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_debug.cc	2009-02-17 19:14:57 UTC (rev 1289)
@@ -19,7 +19,6 @@
  */
 
 #include "rk_debug.h"
-#include "ag_main.h"
 
 #include <fstream>
 #include <iostream>

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h	2009-02-16 20:16:03 UTC (rev 1288)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h	2009-02-17 19:14:57 UTC (rev 1289)
@@ -8,9 +8,18 @@
 #ifndef _RK_LOGGING_H
 #define	_RK_LOGGING_H
 
-class RKLogging:public RKSingleton
+#include "rk_singleton.h"
+
+class RKLogging:public RKSingleton<RKLogging>
 {
-    
+public:
+    virtual ~RKLogging();
+
+    void log(const std::string &s);
+protected:
+    RKLogging();
+
+private:
 };
 
 

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.cc	2009-02-16 20:16:03 UTC (rev 1288)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.cc	2009-02-17 19:14:57 UTC (rev 1289)
@@ -5,14 +5,43 @@
  * Created on 16. Februar 2009, 17:47
  */
 
-#include "rksingleton.h"
+#include "rk_singleton.h"
+#include <set>
+#include <typeinfo>
 
-RKSingleton::RKSingleton() {
+std::map<std::string,RKSingletonBase*> RKSingletonBase::mSingletons;
+
+RKSingletonBase::RKSingletonBase()
+{
+    std::string name(typeid(this).name());
+    mSingletons.insert(std::make_pair(name,this));
 }
 
-RKSingleton::RKSingleton(const RKSingleton& orig) {
+RKSingletonBase* RKSingletonBase::getInstance(const std::string &pName)
+{
+    std::map<std::string,RKSingletonBase*>::iterator i=mSingletons.find(pName);
+    if(i==mSingletons.end())
+        return NULL;
+    return i->second;
+
 }
 
-RKSingleton::~RKSingleton() {
+
+/*
+template<class Base>
+RKSingleton<Base>::RKSingleton() {
 }
 
+template<class Base>
+RKSingleton<Base>::~RKSingleton() {
+}
+
+template<class Base>
+static Base *RKSingleton<Base>::getInstance() {
+    std::string name=typeid(Base).name();
+    Base *b=dynamic_cast<Base*>(getInstance(name));
+    if(b==0)
+        b=new Base();
+    return b;
+}
+*/
\ No newline at end of file

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.h	2009-02-16 20:16:03 UTC (rev 1288)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_singleton.h	2009-02-17 19:14:57 UTC (rev 1289)
@@ -8,14 +8,47 @@
 #ifndef _RKSINGLETON_H
 #define	_RKSINGLETON_H
 
+#include <string>
+#include <map>
+#include <typeinfo>
+
 template<class Base>
-class RKSingleton {
+class RKSingleton;
+
+class RKSingletonBase
+{
 public:
-    virtual ~RKSingleton();
+protected:
+    RKSingletonBase();
+    virtual ~RKSingletonBase()
+    {}
 
-    RKSingleton *getInstance
+    static std::map<std::string,RKSingletonBase*> mSingletons;
+
+private:
+    static RKSingletonBase* getInstance(const std::string &pName);
+
+    template<class Base>
+    friend class RKSingleton;
+};
+
+template<class Base>
+class RKSingleton:public RKSingletonBase {
+public:
+    virtual ~RKSingleton()
+    {}
+
+    static Base *getInstance()
+    {
+        std::string name=typeid(Base).name();
+        Base *b=dynamic_cast<Base*>(RKSingletonBase::getInstance(name));
+        if(b==0)
+            b=new Base();
+        return b;
+    }
 protected:
-    RKSingleton();
+    RKSingleton()
+            {}
 
 };
 

Added: antargis/trunk/rookey/lib/rookey/cpp/spec/Rakefile
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/spec/Rakefile	2009-02-16 20:16:03 UTC (rev 1288)
+++ antargis/trunk/rookey/lib/rookey/cpp/spec/Rakefile	2009-02-17 19:14:57 UTC (rev 1289)
@@ -0,0 +1,22 @@
+require 'rookey.rb'
+
+tests=Dir["*_spec.cc"]
+
+baseFiles=["../rk_singleton.cc"]
+
+test_exes=tests.map{|test|
+  name=test.sub(/_spec.cc/,"")
+  files=[test]+baseFiles
+  objs=Rookey::compile(files)
+  Rookey::link_exe(name, objs)
+}
+
+task :runTests=>test_exes do
+  pp test_exes
+
+end
+
+
+task :default=>:runTests do
+
+end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/cpp/spec/singleton_spec.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/spec/singleton_spec.cc	2009-02-16 20:16:03 UTC (rev 1288)
+++ antargis/trunk/rookey/lib/rookey/cpp/spec/singleton_spec.cc	2009-02-17 19:14:57 UTC (rev 1289)
@@ -0,0 +1,29 @@
+#include "rk_singleton.h"
+
+#include <iostream>
+
+
+class Single:public RKSingleton<Single>
+{
+public:
+    int bla()
+    {
+        return 1;
+    }
+protected:
+    Single()
+            {}
+
+    friend class RKSingleton<Single>;
+};
+
+template //<Single>
+class RKSingleton<Single>;
+
+int main(int argc,char *argv[])
+{
+    assert(Single::getInstance()->bla()==1);
+    std::cout<<Single::getInstance()->bla()<<std::endl;
+
+    return 0;
+}
\ No newline at end of file

Modified: antargis/trunk/rookey/lib/rookey/tasks.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/tasks.rb	2009-02-16 20:16:03 UTC (rev 1288)
+++ antargis/trunk/rookey/lib/rookey/tasks.rb	2009-02-17 19:14:57 UTC (rev 1289)
@@ -95,6 +95,13 @@
 	def Rookey.compile(files,config=nil)
 	  files=[files].flatten
 	  config||=Rookey::getConfig
+
+    files=files.select{|f|f=~/(c|cc|cpp)$/}
+
+    sourceDirs=files.map{|file|File.split(file)[0]}.sort.uniq
+
+    config.add("INCLUDEDIRS",sourceDirs.join(" "))
+
 	  compiler=Rookey::Compiler.new(config)
 	  files.each{|file|
 	    t=compiler.makeObject(file)
@@ -132,7 +139,7 @@
   def Rookey.link_exe(name,files,config=nil)
     files.flatten!
     if files.select{|file|file=~/swig_.*/}.length>0
-      ["rk_rubyobj.cc","rk_string.cc"].each{|f|
+      ["rk_rubyobj.cc","rk_string.cc","rk_rtools.cc"].each{|f|
         files << compile(File.join(File.split(__FILE__)[0],"cpp",f),config)
       }
       files << compile(File.join(File.split(__FILE__)[0],"cpp","swig_dummy.cc"),config) if files.select{|f|f=~/swig/}.length==0



From davidkamphausen at mail.berlios.de  Mon Feb 23 16:26:47 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Mon, 23 Feb 2009 16:26:47 +0100
Subject: [Antargis-svn] r1290 - in antargis/trunk: . rookey/lib
	rookey/lib/rookey rookey/lib/rookey/cpp
	rookey/lib/rookey/cpp/spec ruby/editor/campaign
Message-ID: <200902231526.n1NFQlO9010472@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-23 16:26:47 +0100 (Mon, 23 Feb 2009)
New Revision: 1290

Added:
   antargis/trunk/rookey/lib/rookey/cpp/spec/logging_spec.cc
Modified:
   antargis/trunk/
   antargis/trunk/configure
   antargis/trunk/rookey/lib/rookey.rb
   antargis/trunk/rookey/lib/rookey/compile.rb
   antargis/trunk/rookey/lib/rookey/config_generator.rb
   antargis/trunk/rookey/lib/rookey/cpp/rk_logging.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h
   antargis/trunk/rookey/lib/rookey/cpp/spec/Rakefile
   antargis/trunk/rookey/lib/rookey/cpp/spec/singleton_spec.cc
   antargis/trunk/rookey/lib/rookey/tasks.rb
   antargis/trunk/rookey/lib/rookey/tools.rb
   antargis/trunk/ruby/editor/campaign/ruby_tools.rb
Log:
some small fixes for rookey


Property changes on: antargis/trunk
___________________________________________________________________
Name: svn:ignore
   - coverage
*.bundle
.build*
starter.dSYM
spec_output.html
starter
.deps
.settings
antconfig.rb
events.txt
rookey_configuration.rb
test
test.c
antargis_interface.i
savegames
config_cache.rb

   + coverage
*.bundle
.build*
starter.dSYM
spec_output.html
starter
.deps
.settings
antconfig.rb
events.txt
rookey_configuration.rb
test
test.c
antargis_interface.i
savegames
config_cache.rb
.rookey
.configure.swp
.git


Modified: antargis/trunk/configure
===================================================================
--- antargis/trunk/configure	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/configure	2009-02-23 15:26:47 UTC (rev 1290)
@@ -1,6 +1,6 @@
 #!/usr/bin/env ruby
 
-require File.join(File.split(__FILE__)[0],"rookey","rookey_config.rb")
+require File.join(File.split(__FILE__)[0],"rookey","lib","rookey","rookey_config.rb")
 
 config=Rookey::Configure.new
 config.run do |opts|

Modified: antargis/trunk/rookey/lib/rookey/compile.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/compile.rb	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/rookey/lib/rookey/compile.rb	2009-02-23 15:26:47 UTC (rev 1290)
@@ -10,11 +10,16 @@
 	    parseDepsFiles
       
       return t unless @@deps
-      p=File.join(Compiler.getDepsDir,t)
+      #t=File.expand_path(t) if t=~/^../
+      p=makeDepsName(t)
 	    return @@deps[p] if @@deps[p]
       t
 	  end
-  
+
+    def Compiler.makeDepsName(inFile)
+      depfile=File.join(Compiler.getDepsDir,makePlainName(inFile))
+    end
+    
 	  def compile(target,sources)
 	    source=makeSource(target)
 	    
@@ -41,7 +46,7 @@
 	    options << "-o "+target
       
       
-      depfile=File.join(Compiler.getDepsDir,source)
+      depfile=Compiler.makeDepsName(source) #File.join(Compiler.getDepsDir,source)
       depdir=File.split(depfile)[0]
       Rookey.mkdir(depdir)
       
@@ -53,7 +58,6 @@
 	    call=program+" "+options.join(" ")
 	    sh call
       puts
-	  
 	  end
     
     def linkEXE(name,objects)
@@ -113,20 +117,35 @@
       end
       file
 	  end
+
+    def self.makePlainName(inName)
+      inName.gsub("/","=")
+    end
+    def self.makeRelName(inName)
+      inName.gsub("=","/")
+    end
 	  
 	  def makeSource(objectName)
 	    objectName.sub(/\.o$/,"").sub(/^#{getBuildDir}[\/\\]/,"")
 	  end
-	  
+
     def getPlainBuildDir
-      ".build_"+ at config["host_os"]
+      "build_"+ at config["host_os"]
     end
+
+    def self.rookeyWorkingDir
+      File.join(Dir.pwd,".rookey")
+    end
+
+    def self.rookeyTestDir
+      File.join(rookeyWorkingDir,"test")
+    end
     
 	  def getBuildDir
-	    File.join(Dir.pwd,getPlainBuildDir)
+	    File.join(Compiler::rookeyWorkingDir,getPlainBuildDir)
 	  end
-    def Compiler.getDepsDir
-      File.join(Dir.pwd,".deps")
+    def self.getDepsDir
+      File.join(rookeyWorkingDir,"deps")
     end
         
     private

Modified: antargis/trunk/rookey/lib/rookey/config_generator.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/config_generator.rb	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/rookey/lib/rookey/config_generator.rb	2009-02-23 15:26:47 UTC (rev 1290)
@@ -17,12 +17,13 @@
 module Rookey
   
   
-  CONFIG_FILENAME="config_cache.rb"
+  CONFIG_FILENAME=File.join(Compiler.rookeyWorkingDir,"config_cache.rb")
   @@configured=[]
   
   # stores a dumpable ruby-object *what* into a file named *filename*
   def Rookey.hibe(what,filename)
     content=Marshal.dump(what).gsub("\"","\\\"")
+    mkdir(File.split(filename)[0])
     File.open(filename,"w") do |f|
       f.puts <<EOT
 module Rookey
@@ -71,7 +72,8 @@
       includes=includes.map{|i|"#include <#{i}>"}.join("\n")
       source="#{includes}\nextern \"C\" void #{funcname}();int main(int argc,char*argv[]){return 0;}"
       pp source
-      testSource="test.c"
+      Rookey::mkdir(Compiler.rookeyTestDir)
+      testSource=File.join(Compiler.rookeyTestDir,"test.c")
       fd=File.open(testSource,"w")
       fd.puts source
       fd.close
@@ -79,7 +81,7 @@
       target=compiler.makeObject(testSource)
       compiler.compile(target,testSource)
       libadd="-l#{lib}"
-      exeName=compiler.exeName("test")
+      exeName=File.join(Compiler.rookeyTestDir,compiler.exeName("test"))
       begin
         compiler.linkEXE(exeName,[target,libadd])
         `#{exeName}`
@@ -87,10 +89,13 @@
           config.add("LDFLAGS",libadd)
         end
       rescue RuntimeError => e
+        log e,e.backtrace
         return false
       end
       true
     end
+
+
     private
     def getPath
       # add paths in externals/build/*/bin
@@ -116,10 +121,15 @@
   }
   
   def Rookey.log(*s)
-    @@logFile||=File.open("rookey.log","w")
+    Rookey.mkdir(Compiler::rookeyWorkingDir)
+    @@logFile||=File.open(File.join(Compiler::rookeyWorkingDir,"rookey.log"),"w")
     @@logFile.puts(*s)
   end
-  
+
+  CLEAN << File.join(Compiler::rookeyWorkingDir,"rookey.log")
+  CLEAN += ["test.c","test.o","test","test.exe"].map{|f|File.join(Compiler.rookeyWorkingDir,"test",f)}
+  pp CLEAN
+
  
   def Rookey.getDescendantsOfClass(p)
     c=[]
@@ -148,8 +158,9 @@
 		          c.new.run(config)
 		          log config.inspect
               @@configured << c
-            rescue
+            rescue Object=>e
               log "Configuration of #{c} failed !"
+              log e,e.backtrace
             end
 		        ok+=c.provides
 		        ok.uniq!

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_logging.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_logging.cc	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_logging.cc	2009-02-23 15:26:47 UTC (rev 1290)
@@ -1 +1,45 @@
 
+#include "rk_logging.h"
+
+#include <sstream>
+#include <iostream>
+
+
+template
+class RKSingleton<RKLogging>;
+
+RKLogging::RKLogging() : output("rk_log.txt",std::ios_base::app) {
+}
+
+RKLogging::~RKLogging() {
+    output.flush();
+    output.close();
+}
+
+void RKLogging::log(const std::string &s) {
+    output << s;
+    output.flush();
+}
+
+void RKLogging::clear()
+{
+    output.close();
+    output.open("rk_log.txt");
+}
+
+
+std::string RKLogging::getLog()  {
+    output.flush();
+
+    std::ifstream ifs("rk_log.txt");
+    std::ostringstream os;
+    std::string buf;
+
+    while (!ifs.eof()) {
+        ifs>>buf;
+        os << buf;
+    }
+    std::cout<<"OS:"<<os.str()<<std::endl;
+    return os.str();
+
+}

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_logging.h	2009-02-23 15:26:47 UTC (rev 1290)
@@ -10,16 +10,24 @@
 
 #include "rk_singleton.h"
 
+#include <fstream>
+
 class RKLogging:public RKSingleton<RKLogging>
 {
 public:
     virtual ~RKLogging();
 
     void log(const std::string &s);
+
+    std::string getLog();
+    void clear();
 protected:
     RKLogging();
 
 private:
+    std::ofstream output;
+    friend class RKSingleton<RKLogging>;
+
 };
 
 

Modified: antargis/trunk/rookey/lib/rookey/cpp/spec/Rakefile
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/spec/Rakefile	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/rookey/lib/rookey/cpp/spec/Rakefile	2009-02-23 15:26:47 UTC (rev 1290)
@@ -2,7 +2,7 @@
 
 tests=Dir["*_spec.cc"]
 
-baseFiles=["../rk_singleton.cc"]
+baseFiles=["../rk_singleton.cc","../rk_logging.cc"]
 
 test_exes=tests.map{|test|
   name=test.sub(/_spec.cc/,"")
@@ -12,11 +12,14 @@
 }
 
 task :runTests=>test_exes do
-  pp test_exes
-
+  test_exes.each{|exe|
+    sh "./"+exe
+  }
 end
 
+CLEAN << "rk_log.txt"
 
+
 task :default=>:runTests do
 
 end
\ No newline at end of file

Added: antargis/trunk/rookey/lib/rookey/cpp/spec/logging_spec.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/spec/logging_spec.cc	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/rookey/lib/rookey/cpp/spec/logging_spec.cc	2009-02-23 15:26:47 UTC (rev 1290)
@@ -0,0 +1,9 @@
+#include "rk_logging.h"
+
+int main(int argc, char *argv[]) {
+    RKLogging::getInstance()->clear();
+    RKLogging::getInstance()->log("muh");
+
+    assert(RKLogging::getInstance()->getLog() == "muh");
+    return 0;
+}
\ No newline at end of file

Modified: antargis/trunk/rookey/lib/rookey/cpp/spec/singleton_spec.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/spec/singleton_spec.cc	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/rookey/lib/rookey/cpp/spec/singleton_spec.cc	2009-02-23 15:26:47 UTC (rev 1290)
@@ -23,7 +23,6 @@
 int main(int argc,char *argv[])
 {
     assert(Single::getInstance()->bla()==1);
-    std::cout<<Single::getInstance()->bla()<<std::endl;
 
     return 0;
 }
\ No newline at end of file

Modified: antargis/trunk/rookey/lib/rookey/tasks.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/tasks.rb	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/rookey/lib/rookey/tasks.rb	2009-02-23 15:26:47 UTC (rev 1290)
@@ -185,7 +185,7 @@
     swigInterfaces=libs.map{|f|f.sub(/\.[a-zA-Z]+$/,".i")}
     swigInterfaces=files.select{|f|f=~/i$/}
     swigInterface = Rookey::swig_interface(name=>headerFiles+swigInterfaces,:initializers=>inits)
-    swigTarget = Rookey::swig({File.join(compiler.getPlainBuildDir,name+"_swig.cc")=>swigInterface},config)
+    swigTarget = Rookey::swig({File.join(compiler.getBuildDir,name+"_swig.cc")=>swigInterface},config)
     
     
     targets = Rookey::compile(cppFiles+[swigTarget],config)

Modified: antargis/trunk/rookey/lib/rookey/tools.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/tools.rb	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/rookey/lib/rookey/tools.rb	2009-02-23 15:26:47 UTC (rev 1290)
@@ -38,18 +38,18 @@
 	end
 end
 
-
-alias :requireRookeyOld :require
-
-def require(file)
-  if file[0..0]=="."
-    rel=caller[0].gsub(/:[0-9]+/,"")
-    rel=File.expand_path(rel)
-    dir=File.split(rel)[0]
-    file=File.join(dir,file)
-    #pp file
+unless methods.member?("requireRookeyOld")
+  alias :requireRookeyOld :require
+  def require(file)
+    if file[0..0]=="."
+      rel=caller[0].gsub(/:[0-9]+/,"")
+      rel=File.expand_path(rel)
+      dir=File.split(rel)[0]
+      file=File.join(dir,file)
+      #pp file
+    end
+    requireRookeyOld(file)
   end
-  requireRookeyOld(file)
 end
 def requireRelative(f)
   require f

Modified: antargis/trunk/rookey/lib/rookey.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey.rb	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/rookey/lib/rookey.rb	2009-02-23 15:26:47 UTC (rev 1290)
@@ -3,6 +3,7 @@
 require File.join(File.split(File.expand_path(__FILE__))[0],'rookey','tools.rb')
 require './rookey/tasks.rb'
 
+
 task :allclean=>:clean do
   ALLCLEAN.each{|f|
     begin

Modified: antargis/trunk/ruby/editor/campaign/ruby_tools.rb
===================================================================
--- antargis/trunk/ruby/editor/campaign/ruby_tools.rb	2009-02-17 19:14:57 UTC (rev 1289)
+++ antargis/trunk/ruby/editor/campaign/ruby_tools.rb	2009-02-23 15:26:47 UTC (rev 1290)
@@ -22,6 +22,6 @@
   end
 end
 end
-require "rookey/lib/tools.rb"
+require "rookey/tools.rb"
 
 require "./ruby_layouts.rb"
\ No newline at end of file



From davidkamphausen at mail.berlios.de  Tue Feb 24 21:50:56 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Tue, 24 Feb 2009 21:50:56 +0100
Subject: [Antargis-svn] r1291 - in antargis/trunk/ext: basic sound video
Message-ID: <200902242050.n1OKouh4009823@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-24 21:50:56 +0100 (Tue, 24 Feb 2009)
New Revision: 1291

Added:
   antargis/trunk/ext/basic/ag_decryptor.cc
   antargis/trunk/ext/basic/ag_decryptor.h
Modified:
   antargis/trunk/ext/sound/ag_mixer.h
   antargis/trunk/ext/video/ag_surface.h
Log:
moved decryptor in its own file

Added: antargis/trunk/ext/basic/ag_decryptor.cc
===================================================================
--- antargis/trunk/ext/basic/ag_decryptor.cc	2009-02-23 15:26:47 UTC (rev 1290)
+++ antargis/trunk/ext/basic/ag_decryptor.cc	2009-02-24 20:50:56 UTC (rev 1291)
@@ -0,0 +1,24 @@
+/* 
+ * File:   agdecryptor.cpp
+ * Author: davidkamphausen
+ * 
+ * Created on 24. Februar 2009, 05:47
+ */
+
+#include "ag_decryptor.h"
+
+#include <string>
+
+AGDecryptor::AGDecryptor() {
+}
+
+AGDecryptor::AGDecryptor(const AGDecryptor& orig) {
+}
+
+AGDecryptor::~AGDecryptor() {
+}
+
+std::string AGDecryptor::decrypt(const std::string &s, const std::string &n)
+{
+    return s;
+}

Added: antargis/trunk/ext/basic/ag_decryptor.h
===================================================================
--- antargis/trunk/ext/basic/ag_decryptor.h	2009-02-23 15:26:47 UTC (rev 1290)
+++ antargis/trunk/ext/basic/ag_decryptor.h	2009-02-24 20:50:56 UTC (rev 1291)
@@ -0,0 +1,33 @@
+/* 
+ * File:   agdecryptor.h
+ * Author: davidkamphausen
+ *
+ * Created on 24. Februar 2009, 05:47
+ */
+
+#ifndef _AGDECRYPTOR_H
+#define	_AGDECRYPTOR_H
+
+#include "rk_base.h"
+
+#include <string>
+
+/**
+   AGDecryptor provides functionaliy for DRM-plugged images and music-files.
+   You have to derive from this class and give an instance when loading a surface.
+   When you have done so saving is disabled afterwards.
+ */
+class AGEXPORT AGDecryptor {
+public:
+    AGDecryptor();
+    AGDecryptor(const AGDecryptor& orig);
+    virtual ~AGDecryptor();
+
+    virtual std::string decrypt(const std::string &s, const std::string &n);
+
+private:
+
+};
+
+#endif	/* _AGDECRYPTOR_H */
+

Modified: antargis/trunk/ext/sound/ag_mixer.h
===================================================================
--- antargis/trunk/ext/sound/ag_mixer.h	2009-02-23 15:26:47 UTC (rev 1290)
+++ antargis/trunk/ext/sound/ag_mixer.h	2009-02-24 20:50:56 UTC (rev 1291)
@@ -24,12 +24,10 @@
 #define AG_SOUND_H
 
 #include <string>
-#include <ag_widget.h>
-#include <ag_surface.h> // for decryptor
+#include "ag_messageobject.h"
+#include "ag_decryptor.h" // for decryptor
 
-// use widget, though this isn't one, because it provides useable functions
 class AGEXPORT AGSound:public AGMessageObject
-// #Widget
 {
  public:
   AGSound(); // NEVER use this! - it's only provided due to swig

Modified: antargis/trunk/ext/video/ag_surface.h
===================================================================
--- antargis/trunk/ext/video/ag_surface.h	2009-02-23 15:26:47 UTC (rev 1290)
+++ antargis/trunk/ext/video/ag_surface.h	2009-02-24 20:50:56 UTC (rev 1291)
@@ -35,6 +35,7 @@
 #include "ag_gltexture.h"
 #include "rk_exception.h"
 #include <ag_plugin.h>
+#include "ag_decryptor.h"
 
 class AGColor;
 class AGSurface;
@@ -60,22 +61,6 @@
 };
 
 
-/**
-   AGDecryptor provides functionaliy for DRM-plugged images and music-files.
-   You have to derive from this class and give an instance when loading a surface.
-   When you have done so saving is disabled afterwards.
- */
-class AGEXPORT AGDecryptor
-{
- public:
-  virtual ~AGDecryptor()
-    {
-    }
-  virtual std::string decrypt(const std::string &s,const std::string &n)
-    {
-      return s;
-    }
-};
 
 class AGSurfaceEmptyException:public AGException
 {



From davidkamphausen at mail.berlios.de  Thu Feb 26 06:16:36 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Thu, 26 Feb 2009 06:16:36 +0100
Subject: [Antargis-svn] r1292 - in antargis/trunk: ext/3dengine ext/basic
	ext/game ext/gui ext/sound ext/video rookey/lib/rookey/cpp
	ruby ruby/spec
Message-ID: <200902260516.n1Q5Ga0E022143@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-26 06:16:34 +0100 (Thu, 26 Feb 2009)
New Revision: 1292

Added:
   antargis/trunk/ext/video/ag_surface_internal.cc
   antargis/trunk/ext/video/ag_surface_internal.h
Modified:
   antargis/trunk/ext/3dengine/ag_glsl.cc
   antargis/trunk/ext/3dengine/anim_mesh_data.cc
   antargis/trunk/ext/3dengine/ant_particle.cc
   antargis/trunk/ext/3dengine/ant_renderer.cc
   antargis/trunk/ext/3dengine/glsl.cc
   antargis/trunk/ext/3dengine/mesh_data.cc
   antargis/trunk/ext/basic/ag_decryptor.h
   antargis/trunk/ext/basic/ag_kill.cc
   antargis/trunk/ext/basic/ag_serial.cc
   antargis/trunk/ext/game/entity.cc
   antargis/trunk/ext/game/minimap.cc
   antargis/trunk/ext/gui/ag_widget.cc
   antargis/trunk/ext/sound/ag_sound.h
   antargis/trunk/ext/sound/init.cc
   antargis/trunk/ext/video/ag_color.cc
   antargis/trunk/ext/video/ag_fontengine.cc
   antargis/trunk/ext/video/ag_glscreen.cc
   antargis/trunk/ext/video/ag_gltexture.cc
   antargis/trunk/ext/video/ag_sdlscreen.cc
   antargis/trunk/ext/video/ag_surface.cc
   antargis/trunk/ext/video/ag_surface.h
   antargis/trunk/ext/video/ag_surfacemanager.cc
   antargis/trunk/ext/video/ag_texture.cc
   antargis/trunk/ext/video/ag_video.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h
   antargis/trunk/ruby/ant_tools.rb
   antargis/trunk/ruby/spec/spec_coding_style.rb
Log:
code review concerning deletes

Modified: antargis/trunk/ext/3dengine/ag_glsl.cc
===================================================================
--- antargis/trunk/ext/3dengine/ag_glsl.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/3dengine/ag_glsl.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -164,7 +164,7 @@
     if(glslOk() && !hasQuit())
       glDeleteObjectARB(p);
     cdebug("name:"<<name);
-    delete [] matrixBuf;
+    checkedDeletArray(matrixBuf); // checked - no agrubyobject
     cdebug("name:"<<name);
     assertGL;
 

Modified: antargis/trunk/ext/3dengine/anim_mesh_data.cc
===================================================================
--- antargis/trunk/ext/3dengine/anim_mesh_data.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/3dengine/anim_mesh_data.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -125,7 +125,7 @@
 
     // delete bones
     for(std::vector<Bone*>::iterator i=bones.begin();i!=bones.end();++i)
-      delete *i;
+      checkedDelete(*i); // checked - no agrubyobject
 
 
   }

Modified: antargis/trunk/ext/3dengine/ant_particle.cc
===================================================================
--- antargis/trunk/ext/3dengine/ant_particle.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/3dengine/ant_particle.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -48,7 +48,8 @@
 AntParticle::~AntParticle() throw()
   {
     for(std::list<Piece*>::iterator i=mPieces.begin();i!=mPieces.end();i++)
-      delete *i;
+      checkedDelete(*i);    // checked - no agrubyobject
+
     mPieces.clear();
 
   }
@@ -81,7 +82,7 @@
       {
         if(mPieces.back()->lived>maxtime)
           {
-            delete mPieces.back();
+            checkedDelete(mPieces.back()); // checked - no agrubyobject
             mPieces.pop_back();
           }
         else

Modified: antargis/trunk/ext/3dengine/ant_renderer.cc
===================================================================
--- antargis/trunk/ext/3dengine/ant_renderer.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/3dengine/ant_renderer.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -51,7 +51,7 @@
     cdebug("gRenderer:"<<gRenderer);
     assert(gRenderer==this);
     gRenderer=0;
-    delete mFBO;
+    checkedDelete(mFBO); // checked - no agrubyobject
   }
 
 bool Renderer::canMultitexture()

Modified: antargis/trunk/ext/3dengine/glsl.cc
===================================================================
--- antargis/trunk/ext/3dengine/glsl.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/3dengine/glsl.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -117,7 +117,7 @@
   {
     takeDown();
 
-    delete [] matrixBuf;
+    delete [] matrixBuf; // checked - no agrubyobject
   }
 
 void AntShaderProgram::onScreenUp()
@@ -161,8 +161,8 @@
     if(glslOk() && !hasQuit())
       glDeleteObjectARB(p);
     //  cdebug("name:"<<name);
-    delete vertex;
-    delete frag;
+    checkedDelete(vertex);
+    checkedDelete(frag); // checked - no agrubyobject
     locations.clear();
   }
 

Modified: antargis/trunk/ext/3dengine/mesh_data.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh_data.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/3dengine/mesh_data.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -374,5 +374,5 @@
   {
     VertexArray *va=::makeInstances(mArray,ts);
     mArray=*va;
-    delete va;
+    delete va; // checked - no agrubyobject
   }

Modified: antargis/trunk/ext/basic/ag_decryptor.h
===================================================================
--- antargis/trunk/ext/basic/ag_decryptor.h	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/basic/ag_decryptor.h	2009-02-26 05:16:34 UTC (rev 1292)
@@ -6,7 +6,7 @@
  */
 
 #ifndef _AGDECRYPTOR_H
-#define	_AGDECRYPTOR_H
+#define _AGDECRYPTOR_H
 
 #include "rk_base.h"
 
@@ -19,15 +19,15 @@
  */
 class AGEXPORT AGDecryptor {
 public:
-    AGDecryptor();
-    AGDecryptor(const AGDecryptor& orig);
-    virtual ~AGDecryptor();
+  AGDecryptor();
+  AGDecryptor(const AGDecryptor& orig);
+  virtual ~AGDecryptor();
 
-    virtual std::string decrypt(const std::string &s, const std::string &n);
+  virtual std::string decrypt(const std::string &s, const std::string &n);
 
 private:
 
 };
 
-#endif	/* _AGDECRYPTOR_H */
+#endif /* _AGDECRYPTOR_H */
 

Modified: antargis/trunk/ext/basic/ag_kill.cc
===================================================================
--- antargis/trunk/ext/basic/ag_kill.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/basic/ag_kill.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -23,6 +23,7 @@
 
 #include "ag_kill.h"
 #include "rk_debug.h"
+#include "rk_rubyobj.h"
 
 AGInstanceKiller *mInstanceKiller=0;
 bool mIndirectInstance=false;
@@ -35,7 +36,7 @@
 void deleteInstanceKiller()
   {
     assert(mInstanceKiller);
-    delete mInstanceKiller;
+    delete mInstanceKiller; // checked - no agrubyobject
   }
 
 AGInstanceKiller *getInstanceKiller()
@@ -60,7 +61,12 @@
     for(;i!=bs.end();i++)
       {
         (*i)->kill();
-        delete *i;
+        AGRubyObject *rubyObject=dynamic_cast<AGRubyObject*>(*i);
+
+        if(rubyObject)
+          saveDelete(rubyObject);
+        else
+          delete *i; // checked - no agrubyobject
       }
 
   }

Modified: antargis/trunk/ext/basic/ag_serial.cc
===================================================================
--- antargis/trunk/ext/basic/ag_serial.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/basic/ag_serial.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -111,7 +111,7 @@
 
 
     f=std::string(s,l);
-    delete s;
+    delete s; // checked - no agrubyobject
 
     return *this;
   }

Modified: antargis/trunk/ext/game/entity.cc
===================================================================
--- antargis/trunk/ext/game/entity.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/game/entity.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -86,7 +86,7 @@
     for(Meshes::iterator i=mMeshes.begin();i!=mMeshes.end();i++)
       saveDelete(*i);
     mMeshes.clear();
-    delete mJob;
+    delete mJob; // checked - no agrubyobject
     removeOldJobs();
   }
 
@@ -251,15 +251,12 @@
             if((*mJob)<=(*pJob))
               {
                 mJobFinished.push_back(mJob);
-                //delete mJob;
               }
             else
               {
                 // FIXME: Priorities are ignored for now
                 //        throw int(); // FIXME: delete this, it's a test if priorities get handled correctly
                 mJobFinished.push_back(mJob);
-                //        delete pJob;
-                //    return;
               }
           }
         else
@@ -295,7 +292,7 @@
   {
     std::list<Job*>::iterator i=mJobFinished.begin();
     for(;i!=mJobFinished.end();i++)
-      delete *i;
+      delete *i; // checked - no agrubyobject
     mJobFinished.clear();
   }
 

Modified: antargis/trunk/ext/game/minimap.cc
===================================================================
--- antargis/trunk/ext/game/minimap.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/game/minimap.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -153,12 +153,12 @@
             }
       }
 
-    delete p;
+    saveDelete(p);
     if(inmem)
       {
         //      mSurface.save("sicke.png");
         cdebug(mTexture);
-        delete mTexture;
+        saveDelete(mTexture);
         mTexture=new AGTexture(mSurface);
         cdebug(mTexture);
         CTRACE;

Modified: antargis/trunk/ext/gui/ag_widget.cc
===================================================================
--- antargis/trunk/ext/gui/ag_widget.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/gui/ag_widget.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -1108,7 +1108,7 @@
     getConfig()->set("widgetTextureCache","true");
 
     mCaching=pEnable;
-    delete mCache;
+    saveDelete(mCache);
 
     mCache=0;
     mCacheTouched=false;

Modified: antargis/trunk/ext/sound/ag_sound.h
===================================================================
--- antargis/trunk/ext/sound/ag_sound.h	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/sound/ag_sound.h	2009-02-26 05:16:34 UTC (rev 1292)
@@ -1,7 +1,7 @@
 #ifndef AG_SOUND_H
 #define AG_SOUND_H
-
-#include <ag_base.h>
+
+#include "rk_base.h"
 AGEXPORT void initSoundEngine();
 
 #endif

Modified: antargis/trunk/ext/sound/init.cc
===================================================================
--- antargis/trunk/ext/sound/init.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/sound/init.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -1,6 +1,6 @@
-#include <ag_main.h>
-#include <ag_rand.h>
-#include <rk_debug.h>
+#include "ag_main.h"
+#include "ag_rand.h"
+#include "rk_debug.h"
 
 extern void initSoundEngine();
 

Modified: antargis/trunk/ext/video/ag_color.cc
===================================================================
--- antargis/trunk/ext/video/ag_color.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_color.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -21,6 +21,7 @@
 #include "ag_color.h"
 #include "ag_surface.h"
 #include "rk_tools.h"
+#include "ag_surface_internal.h"
 
 #include <sstream>
 

Modified: antargis/trunk/ext/video/ag_fontengine.cc
===================================================================
--- antargis/trunk/ext/video/ag_fontengine.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_fontengine.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -25,6 +25,8 @@
 #include "ag_sgeexport.h"
 #include "ag_profiler.h"
 
+#include "ag_surface_internal.h"
+
 #include <SDL_ttf.h>
 
 #include <math.h>
@@ -171,8 +173,8 @@
 
         }
 
-    delete [] a;
-    delete [] b;
+    delete [] a; // checked - no agrubyobject
+    delete [] b; // checked - no agrubyobject
   }
 
 void embossSurface(AGSurface &s,float depth=1.0f)
@@ -276,6 +278,7 @@
      */
   }
 
+
 AGTexture *AGFontEngine::renderText(int BaseLineX, int BaseLineY, const AGStringUtf8 &pText, const AGFont &pFont)
   {
     if(pText.length()==0)

Modified: antargis/trunk/ext/video/ag_glscreen.cc
===================================================================
--- antargis/trunk/ext/video/ag_glscreen.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_glscreen.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -34,6 +34,8 @@
 #include "ag_sgeexport.h"
 #include "SDL_image.h"
 
+#include "ag_surface_internal.h"
+
 #include <ag_rendercontext.h>
 #include <SDL.h>
 

Modified: antargis/trunk/ext/video/ag_gltexture.cc
===================================================================
--- antargis/trunk/ext/video/ag_gltexture.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_gltexture.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -25,7 +25,9 @@
 #include "rk_debug.h"
 #include "ag_vdebug.h"
 
+#include "ag_surface_internal.h"
 
+
 //FIXME: this should be static
 size_t gUsedTexMemory=0;
 

Modified: antargis/trunk/ext/video/ag_sdlscreen.cc
===================================================================
--- antargis/trunk/ext/video/ag_sdlscreen.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_sdlscreen.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -31,6 +31,8 @@
 
 #include "ag_sdlpainter.h"
 
+#include "ag_surface_internal.h"
+
 static bool gUseSDLclipping=true;
 
 SDL_Surface *AGCreate32BitSurface(size_t width,size_t height);
@@ -64,7 +66,7 @@
 
     SDL_UpdateRects(s,rs.size(),nrs);
 
-    delete [] nrs;
+    delete [] nrs; // checked - no agrubyobject
   }
 
 

Modified: antargis/trunk/ext/video/ag_surface.cc
===================================================================
--- antargis/trunk/ext/video/ag_surface.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_surface.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -31,6 +31,7 @@
 #include "ag_glscreen.h"
 #include "ag_sdlpainter.h"
 #include "ag_surfacemanager.h"
+#include "ag_surface_internal.h"
 
 #include <SDL_image.h>
 
@@ -106,26 +107,8 @@
 
 
 
-///////////////////////////////////////////////////////////////////////
-// AGInternalSurface
-///////////////////////////////////////////////////////////////////////
 
-AGInternalSurface::AGInternalSurface()
-{
-  sdlTexture=0;
-  glTexture=0;
-  surface=0;
-  getSurfaceManager()->registerMe(this);
-  version=1;
-}
 
-AGInternalSurface::~AGInternalSurface()
-{
-  getSurfaceManager()->deregisterMe(this);
-}
-
-
-
 ///////////////////////////////////////////////////////////////////////
 // AGSurface
 ///////////////////////////////////////////////////////////////////////

Modified: antargis/trunk/ext/video/ag_surface.h
===================================================================
--- antargis/trunk/ext/video/ag_surface.h	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_surface.h	2009-02-26 05:16:34 UTC (rev 1292)
@@ -40,28 +40,12 @@
 class AGColor;
 class AGSurface;
 class AGGLTexture;
+struct AGInternalSurface;
 
 AGEXPORT void beginRender();
 AGEXPORT void endRender();
 AGEXPORT bool isRendering();
 
-/**
-   AGInternalSurface links plain sdl-surfaces (in main-memory) and textures (both gl-textures and
-   sdl-screenlike-surfaces)
-*/
-struct AGEXPORT AGInternalSurface
-{
-  AGInternalSurface  *sdlTexture;
-  AGGLTexture *glTexture;
-  SDL_Surface *surface;
-  size_t version;
-
-  AGInternalSurface();
-  ~AGInternalSurface();
-};
-
-
-
 class AGSurfaceEmptyException:public AGException
 {
 public:

Added: antargis/trunk/ext/video/ag_surface_internal.cc
===================================================================
--- antargis/trunk/ext/video/ag_surface_internal.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_surface_internal.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -0,0 +1,36 @@
+/*
+ * Copyright (c) 2009 by David Kamphausen. All rights reserved.
+ *
+ * ag_surface_internal.cc
+ * by David Kamphausen (david.kamphausen at web.de)
+ *
+ * The "Antargis" project, including all files needed to compile it,
+ * is free software; you can redistribute it and/or use it and/or modify it
+ * under the terms of the GNU General Public License as published
+ * by the Free Software Foundation; either version 2 of the License,
+ * or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ *
+ * You should have received a copy of the GNU General Public
+ * License along with this program.
+ */
+
+#include "ag_surface_internal.h"
+#include "ag_surfacemanager.h"
+
+AGInternalSurface::AGInternalSurface()
+{
+  sdlTexture=0;
+  glTexture=0;
+  surface=0;
+  getSurfaceManager()->registerMe(this);
+  version=1;
+}
+
+AGInternalSurface::~AGInternalSurface()
+{
+  getSurfaceManager()->deregisterMe(this);
+}

Added: antargis/trunk/ext/video/ag_surface_internal.h
===================================================================
--- antargis/trunk/ext/video/ag_surface_internal.h	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_surface_internal.h	2009-02-26 05:16:34 UTC (rev 1292)
@@ -0,0 +1,46 @@
+/*
+ * Copyright (c) 2009 by David Kamphausen. All rights reserved.
+ *
+ * ag_surface_internal.h
+ * by David Kamphausen (david.kamphausen at web.de)
+ *
+ * The "Antargis" project, including all files needed to compile it,
+ * is free software; you can redistribute it and/or use it and/or modify it
+ * under the terms of the GNU General Public License as published
+ * by the Free Software Foundation; either version 2 of the License,
+ * or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ *
+ * You should have received a copy of the GNU General Public
+ * License along with this program.
+ */
+
+#ifndef AG_SURFACE_INTERNAL
+#define AG_SURFACE_INTERNAL
+
+#include "rk_base.h"
+
+#include "ag_gltexture.h"
+
+class AGGLTexture;
+
+/**
+   AGInternalSurface links plain sdl-surfaces (in main-memory) and textures (both gl-textures and
+   sdl-screenlike-surfaces)
+*/
+struct AGEXPORT AGInternalSurface
+{
+  AGInternalSurface  *sdlTexture;
+  AGGLTexture *glTexture;
+  SDL_Surface *surface;
+  size_t version;
+
+  AGInternalSurface();
+  ~AGInternalSurface();
+};
+
+
+#endif

Modified: antargis/trunk/ext/video/ag_surfacemanager.cc
===================================================================
--- antargis/trunk/ext/video/ag_surfacemanager.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_surfacemanager.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -28,6 +28,8 @@
 #include "ag_glscreen.h"
 #include "ag_profiler.h"
 
+#include "ag_surface_internal.h"
+
 #include <map>
 
 ////////////////////////////////////////////////////////////////////////
@@ -45,11 +47,11 @@
     for(std::set<AGInternalSurface*>::iterator i=mSDLSurfaces.begin();i!=mSDLSurfaces.end();++i)
       {
         AGFreeSurface((*i)->surface);
-        delete *i;
+        delete *i; // checked - no agrubyobject
       }
     for(std::set<AGGLTexture*>::iterator i=mGLTextures.begin();i!=mGLTextures.end();++i)
       {
-        delete *i;
+        delete *i; // checked - no agrubyobject
       }
 
     mSurfaceManagerDeleted=true;

Modified: antargis/trunk/ext/video/ag_texture.cc
===================================================================
--- antargis/trunk/ext/video/ag_texture.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_texture.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -31,6 +31,8 @@
 #include "ag_sdlpainter.h"
 #include "ag_video.h"
 
+#include "ag_surface_internal.h"
+
 #include <stdexcept>
 
 size_t nextpow2(size_t i)
@@ -141,7 +143,7 @@
   {
     if(getSurfaceManager())
       getSurfaceManager()->deregisterMe(this);
-    delete mFBO;
+    delete mFBO; // checked - no agrubyobject
   }
 
 int AGTexture::width() const
@@ -174,7 +176,7 @@
 void AGTexture::clearTexture()
   {
     mTexture=0;
-    delete mFBO;
+    delete mFBO; // checked - no agrubyobject
     mFBO=0;
   }
 void AGTexture::clearTextureUsed()

Modified: antargis/trunk/ext/video/ag_video.cc
===================================================================
--- antargis/trunk/ext/video/ag_video.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ext/video/ag_video.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -107,7 +107,7 @@
 
     if(mScreen)
       {
-        delete mScreen;
+        saveDelete(mScreen);
       }
 
     if(vw<w)

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc	2009-02-26 05:16:34 UTC (rev 1292)
@@ -134,7 +134,41 @@
     o->mark();
   }
 
+/** checkedDelete deletes o, but checks before if o is a AGRubyObject
+ **/
 
+bool checkedDelete(void *o)
+{
+  AGRubyObject *ro=(AGRubyObject*)o;
+  if(mRubyObjects.find(ro)==mRubyObjects.end())
+    {
+    // not found - it's safe to delete it
+    delete o;
+    return true;
+  }
+  std::cerr<<"Possible error in checkedDelete(.)"<<std::endl;
+
+  return false;
+}
+
+/** checkedDelete deletes o, but checks before if o is a AGRubyObject
+ **/
+
+bool checkedDeleteArray(void *o)
+{
+  AGRubyObject *ro=(AGRubyObject*)o;
+  if(mRubyObjects.find(ro)==mRubyObjects.end())
+    {
+    // not found - it's safe to delete it
+    delete [] o;
+    return true;
+  }
+  std::cerr<<"Possible error in checkedDeleteArray(.)"<<std::endl;
+
+  return false;
+}
+
+
 /**
    saveDelete is used to delete AGRubyObjects savely.
  */

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h	2009-02-26 05:16:34 UTC (rev 1292)
@@ -125,6 +125,8 @@
 
 AGEXPORT void general_markfunc(void *ptr);
 AGEXPORT bool saveDelete(AGRubyObject *o);
+AGEXPORT bool checkedDelete(void *o);
+AGEXPORT bool checkedDeleteArray(void *o);
 
 AGEXPORT void *getAddressOfRubyObject(AGRubyObject *object);
 AGEXPORT bool rubyObjectExists(void *o);

Modified: antargis/trunk/ruby/ant_tools.rb
===================================================================
--- antargis/trunk/ruby/ant_tools.rb	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ruby/ant_tools.rb	2009-02-26 05:16:34 UTC (rev 1292)
@@ -85,3 +85,13 @@
     end
   end
 end
+
+
+class File
+  def self.load(filename)
+    f=File.open(filename,"r")
+    c=f.read
+    f.close
+    c
+  end
+end

Modified: antargis/trunk/ruby/spec/spec_coding_style.rb
===================================================================
--- antargis/trunk/ruby/spec/spec_coding_style.rb	2009-02-24 20:50:56 UTC (rev 1291)
+++ antargis/trunk/ruby/spec/spec_coding_style.rb	2009-02-26 05:16:34 UTC (rev 1292)
@@ -1,3 +1,5 @@
+require File.expand_path('../../ant_tools.rb',__FILE__)
+
 def checkTabs(filename)
   file=File.open(filename)
   c=file.read
@@ -8,11 +10,29 @@
   
   linenr=0
   numbers=c.split("\n").map{|line|[line=~/\t/,linenr+=1]}.select{|l|l[0]}.map{|l|l[1]}
-  puts "failed line-numbers (#{filename}): #{numbers.join(",")}"
+  puts "failed line-numbers (#{filename}): #{numbers.join(",")}" if result!=okfilename
   
   result.should == okfilename
 end
 
+def checkDeletes(filename)
+  c=File.load(filename)
+  linenr=0
+  ok="#{filename} contains no unreviewed deletes"
+  result=ok
+  c.split("\n").each{|line|
+    linenr+=1
+    #unless line=~/checked - no agrubyobject/
+      line.gsub!(/\/\/.*/,"")
+      if line=~/delete /
+        puts "failed line-number (#{filename}) #{linenr}"
+        result="#{filename} contains unreviewed deletes"
+      end
+    #end
+  }
+  result.should == ok
+end
+
 describe "Coding style C/++" do
   it "shouldn't include any TABs anymore" do
     (Dir["ext/**/*.cc"]+Dir["ext/**/*.h"]).select{|filename|not filename=~/swig/}.each {|filename|
@@ -24,6 +44,12 @@
   it "should include author/modification date"
   it "should include GPL in all files"
   it "should not have any TODOs left"
+
+  it "should not include any unreviewed delete-statements" do
+    (Dir["ext/**/*.cc"]+Dir["ext/**/*.h"]).select{|filename|not filename=~/swig/}.each {|filename|
+      checkDeletes(filename)
+    }
+  end
 end
 
 describe "Coding style Ruby" do



From davidkamphausen at mail.berlios.de  Thu Feb 26 21:03:57 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Thu, 26 Feb 2009 21:03:57 +0100
Subject: [Antargis-svn] r1293 - in antargis/trunk: ext/3dengine ext/basic
	ext/game ext/gui ext/math ext/sound ext/video
	rookey/lib/rookey rookey/lib/rookey/cpp
Message-ID: <200902262003.n1QK3vaC030632@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-26 21:03:54 +0100 (Thu, 26 Feb 2009)
New Revision: 1293

Modified:
   antargis/trunk/ext/3dengine/ag_glsl.cc
   antargis/trunk/ext/3dengine/glsl.cc
   antargis/trunk/ext/3dengine/mesh_data.cc
   antargis/trunk/ext/3dengine/quadtree.h
   antargis/trunk/ext/3dengine/scene_base.cc
   antargis/trunk/ext/3dengine/vertex_array.cc
   antargis/trunk/ext/basic/ag_config.cc
   antargis/trunk/ext/basic/ag_fs.cc
   antargis/trunk/ext/basic/ag_geometry.h
   antargis/trunk/ext/basic/ag_kill.cc
   antargis/trunk/ext/basic/ag_kill.h
   antargis/trunk/ext/basic/ag_message.cc
   antargis/trunk/ext/basic/ag_messageobject.cc
   antargis/trunk/ext/basic/ag_messageobject.h
   antargis/trunk/ext/basic/ag_serial.cc
   antargis/trunk/ext/basic/ag_xml.cc
   antargis/trunk/ext/basic/templates.i
   antargis/trunk/ext/game/entity.cc
   antargis/trunk/ext/game/path.cc
   antargis/trunk/ext/game/path.h
   antargis/trunk/ext/gui/ag_button.cc
   antargis/trunk/ext/gui/ag_frame.cc
   antargis/trunk/ext/gui/ag_layoutcreators.cc
   antargis/trunk/ext/gui/ag_scroller.cc
   antargis/trunk/ext/gui/ag_widget.h
   antargis/trunk/ext/math/ag_algebra.h
   antargis/trunk/ext/sound/ag_mixer.cc
   antargis/trunk/ext/video/ag_color.h
   antargis/trunk/ext/video/ag_font.h
   antargis/trunk/ext/video/ag_fontengine.cc
   antargis/trunk/ext/video/ag_glscreen.cc
   antargis/trunk/ext/video/ag_glscreen.h
   antargis/trunk/ext/video/ag_gltexture.cc
   antargis/trunk/ext/video/ag_painter.cc
   antargis/trunk/ext/video/ag_png.cc
   antargis/trunk/ext/video/ag_rendercontext.cc
   antargis/trunk/ext/video/ag_sdlscreen.cc
   antargis/trunk/ext/video/ag_surface.h
   antargis/trunk/ext/video/ag_surfacemanager.cc
   antargis/trunk/ext/video/ag_texture.cc
   antargis/trunk/ext/video/ag_texture.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_base.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_exception.h
   antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc
   antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h
   antargis/trunk/rookey/lib/rookey/tools.rb
Log:
#6 Cleanup

Modified: antargis/trunk/ext/3dengine/ag_glsl.cc
===================================================================
--- antargis/trunk/ext/3dengine/ag_glsl.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/3dengine/ag_glsl.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -2,6 +2,7 @@
 #include "ag_glsl.h"
 #include "ag_vdebug.h"
 #include "ag_main.h"
+#include "rk_rubyobj.h"
 
 std::map<std::string,AGVertexProgram*> mVertexPrograms;
 std::map<std::string,AGFragProgram*> mFragPrograms;
@@ -164,7 +165,7 @@
     if(glslOk() && !hasQuit())
       glDeleteObjectARB(p);
     cdebug("name:"<<name);
-    checkedDeletArray(matrixBuf); // checked - no agrubyobject
+    checkedDeleteArray(matrixBuf); // checked - no agrubyobject
     cdebug("name:"<<name);
     assertGL;
 

Modified: antargis/trunk/ext/3dengine/glsl.cc
===================================================================
--- antargis/trunk/ext/3dengine/glsl.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/3dengine/glsl.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -117,7 +117,7 @@
   {
     takeDown();
 
-    delete [] matrixBuf; // checked - no agrubyobject
+    checkedDeleteArray(matrixBuf);
   }
 
 void AntShaderProgram::onScreenUp()

Modified: antargis/trunk/ext/3dengine/mesh_data.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh_data.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/3dengine/mesh_data.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -374,5 +374,5 @@
   {
     VertexArray *va=::makeInstances(mArray,ts);
     mArray=*va;
-    delete va; // checked - no agrubyobject
+    checkedDelete(va);
   }

Modified: antargis/trunk/ext/3dengine/quadtree.h
===================================================================
--- antargis/trunk/ext/3dengine/quadtree.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/3dengine/quadtree.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -35,7 +35,7 @@
  * any more ???
    The Rectangles are defined with AGRect2.
 
-   QuadTree doesn't own objects - you have to delete them yourself
+   QuadTree doesn't own objects - you have to deleete them yourself
 
  */
 template<class T>
@@ -55,7 +55,7 @@
     ~Node()
       {
         for(typename std::list<Node*>::iterator i=children.begin();i!=children.end();++i)
-          delete *i;
+          checkedDelete(*i);
       }
 
     size_t size() const
@@ -107,7 +107,7 @@
         for(;i!=children.end();i++)
           {
             (*i)->clear();
-            delete *i;
+            checkedDelete(*i);
           }
         children.clear();
 
@@ -171,7 +171,7 @@
     }
   ~QuadTree()
     {
-      delete root;
+      checkedDelete(root);
     }
 
   /**

Modified: antargis/trunk/ext/3dengine/scene_base.cc
===================================================================
--- antargis/trunk/ext/3dengine/scene_base.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/3dengine/scene_base.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -17,7 +17,7 @@
     for(Nodes::iterator i=mNodes.begin();i!=mNodes.end();i++)
       (*i)->resetScene(); 
 
-    delete mTree;
+    checkedDelete(mTree);
   }
 
 

Modified: antargis/trunk/ext/3dengine/vertex_array.cc
===================================================================
--- antargis/trunk/ext/3dengine/vertex_array.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/3dengine/vertex_array.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -548,13 +548,13 @@
     for(std::map<std::string,std::vector<float>*>::iterator i=as.begin();i!=as.end();++i)
       {
         if(i->second)
-          delete i->second;
+          checkedDelete(i->second);
       }
 
     for(std::map<std::string,std::vector<Uint16>*>::iterator i=elementAs.begin();i!=elementAs.end();++i)
       {
         if(i->second)
-          delete i->second;
+          checkedDelete(i->second);
       }
 
   }

Modified: antargis/trunk/ext/basic/ag_config.cc
===================================================================
--- antargis/trunk/ext/basic/ag_config.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/basic/ag_config.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -1,6 +1,7 @@
 #include "ag_config.h"
 #include "ag_xml.h"
 #include "ag_fs.h"
+#include "rk_rubyobj.h"
 
 // TODO: AGConfig should switch to a ruby-based configuration (maybe YAML)
 // TODO: commenting should be possible !! (no overwriting)
@@ -97,7 +98,7 @@
 
 void updateConfig()
   {
-    delete gConfig;
+    checkedDelete(gConfig);
     gConfig=0;
     //  getConfig();
   }

Modified: antargis/trunk/ext/basic/ag_fs.cc
===================================================================
--- antargis/trunk/ext/basic/ag_fs.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/basic/ag_fs.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -212,7 +212,7 @@
     fclose(f);
 
     std::string r(buffer,len);
-    delete [] buffer;
+    checkedDeleteArray(buffer);
     return r;
   }
 
@@ -361,7 +361,7 @@
                       {
                         if (!GetUserProfileDirectory(accessToken, userDir, &psize))
                           {
-                            delete [] userDir;
+                            checkedDeleteArray(userDir);
                             userDir = NULL;
                           } /* if */
                       } /* else */
@@ -578,7 +578,7 @@
     compress((Bytef*)buf,&destlen,(Bytef*)pString.c_str(),pString.length());
 
     std::string r=o.getString()+std::string(buf,destlen);
-    delete [] buf;
+    checkedDeleteArray(buf);
     return r;
   }
 AGString uncompress(const AGString &pString)
@@ -593,7 +593,7 @@
     char *buf=new char[orig+10];
     uncompress((Bytef*)buf,&orig,(Bytef*)pString.c_str()+4,pString.length()-4);
     std::string r(buf,orig);
-    delete [] buf;
+    checkedDeleteArray(buf);
 
     return r;
   }

Modified: antargis/trunk/ext/basic/ag_geometry.h
===================================================================
--- antargis/trunk/ext/basic/ag_geometry.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/basic/ag_geometry.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -109,9 +109,11 @@
     AGVector2 operator-() const;
     AGVector2 operator-(const AGVector2 &p) const;
     AGVector2 operator+(const AGVector2 &p) const;
+#ifndef SWIG
     AGVector2 & operator+=(const AGVector2 &p);
     AGVector2 & operator-=(const AGVector2 &p);
-
+#endif
+    
     float operator*(const AGVector2 &p) const;
     AGVector2 & operator*=(float f);
     AGVector2 & operator/=(float f);
@@ -133,7 +135,9 @@
     %rename(__getitem__) operator[](int index) const;
 #endif
     float operator[](int index) const;
+#ifndef SWIG
     float &operator[](int index);
+#endif
 
     bool nonZero() const;
 
@@ -208,8 +212,13 @@
 
     AGVector3 normal() const;
 
+#ifdef SWIG
+    %rename(__getitem__) operator[](int index) const;
+#endif
     float operator[](int index) const;
+#ifndef SWIG
     float &operator[](int index);
+#endif
 
     bool nonZero() const;
 
@@ -232,6 +241,7 @@
     float a[3][3];
 public:
 
+#ifndef SWIG
     struct Row {
         AGMatrix3 *matrix;
         int y;
@@ -244,7 +254,7 @@
             return matrix->get(x, y);
         }
     };
-
+#endif
     AGMatrix3();
     AGMatrix3(const AGAngle &a); // rotate
     AGMatrix3(const AGVector3 &a); // transpose
@@ -265,6 +275,7 @@
     AGMatrix3 inverted() const throw (GeometryException);
     AGMatrix3 transposed() const;
 
+
     Row operator[](size_t y);
     const Row operator[](size_t y) const;
 

Modified: antargis/trunk/ext/basic/ag_kill.cc
===================================================================
--- antargis/trunk/ext/basic/ag_kill.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/basic/ag_kill.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -36,7 +36,7 @@
 void deleteInstanceKiller()
   {
     assert(mInstanceKiller);
-    delete mInstanceKiller; // checked - no agrubyobject
+    checkedDelete(mInstanceKiller);
   }
 
 AGInstanceKiller *getInstanceKiller()
@@ -66,7 +66,7 @@
         if(rubyObject)
           saveDelete(rubyObject);
         else
-          delete *i; // checked - no agrubyobject
+          checkedDelete(*i);
       }
 
   }

Modified: antargis/trunk/ext/basic/ag_kill.h
===================================================================
--- antargis/trunk/ext/basic/ag_kill.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/basic/ag_kill.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -48,7 +48,7 @@
     }
   virtual void kill()
   {
-    delete instance;
+    checkedDelete(instance);
   }
 
   virtual void*ptr() const

Modified: antargis/trunk/ext/basic/ag_message.cc
===================================================================
--- antargis/trunk/ext/basic/ag_message.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/basic/ag_message.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -107,7 +107,7 @@
 
 AGMessage::~AGMessage()
   {
-    delete mData;
+    checkedDelete(mData);
   }
 
 const AGMessageSource &AGMessage::getSource() const
@@ -143,7 +143,7 @@
 
 /**
  * pMessage must be created outside of send, but its ownage
- * is transfered to AGMessageQueue. AGMessageQueue will delete it,
+ * is transfered to AGMessageQueue. AGMessageQueue will remove it,
  * when it's ok.
  */
 void AGMessageQueue::send(AGMessage *pMessage)

Modified: antargis/trunk/ext/basic/ag_messageobject.cc
===================================================================
--- antargis/trunk/ext/basic/ag_messageobject.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/basic/ag_messageobject.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -37,9 +37,9 @@
 AGEvent::~AGEvent() throw()
   {
     if(mMousePosition)
-      delete mMousePosition;
+      checkedDelete(mMousePosition);
     if(mRelMousePosition)
-      delete mRelMousePosition;
+      checkedDelete(mRelMousePosition);
   }
 
 bool AGEvent::isMouseEvent() const

Modified: antargis/trunk/ext/basic/ag_messageobject.h
===================================================================
--- antargis/trunk/ext/basic/ag_messageobject.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/basic/ag_messageobject.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -55,7 +55,7 @@
 
 /** AGEvent is the typical event which is passed when the user does anything.
     You can however derive from it and pass it through a signal.
-    But you shouldn't delete it for yourself.
+    But you shouldn't delet it for yourself.
  */
 class AGEXPORT AGEvent:public AGRubyObject
 {

Modified: antargis/trunk/ext/basic/ag_serial.cc
===================================================================
--- antargis/trunk/ext/basic/ag_serial.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/basic/ag_serial.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -1,6 +1,7 @@
 #include "ag_serial.h"
 #include <iostream>
 #include <rk_debug.h>
+#include "rk_rubyobj.h"
 
 // INTEL is little endian
 
@@ -111,7 +112,7 @@
 
 
     f=std::string(s,l);
-    delete s; // checked - no agrubyobject
+    checkedDelete(s); // checked - no agrubyobject
 
     return *this;
   }

Modified: antargis/trunk/ext/basic/ag_xml.cc
===================================================================
--- antargis/trunk/ext/basic/ag_xml.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/basic/ag_xml.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -22,6 +22,7 @@
 #include "ag_fs.h"
 
 #include "rk_debug.h"
+#include "rk_rubyobj.h"
 
 #include "ag_profiler.h"
 
@@ -58,7 +59,7 @@
   {
     NodeVector::iterator i=mNodes.begin();
     for(;i!=mNodes.end();i++)
-      delete *i;
+      checkedDelete(*i);
     mNodes.clear();
   }
 
@@ -354,7 +355,7 @@
 
 Document::~Document()
   {
-    delete mRoot;
+    checkedDelete(mRoot);
   }
 
 bool Document::parseFile(const AGString &filename)

Modified: antargis/trunk/ext/basic/templates.i
===================================================================
--- antargis/trunk/ext/basic/templates.i	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/basic/templates.i	2009-02-26 20:03:54 UTC (rev 1293)
@@ -3,8 +3,7 @@
 %template(StdVectorPNode) std::vector<Node*>;
 %template(AGNodeList) std::vector<Node>;
 
-
-%template(StringVector) std::vector<std::string>;
+//%template(StringVector) std::vector<std::string>;
 %template(AGStringVector) std::vector<AGString>;
 %template(AGStringUtf8Vector) std::vector<AGStringUtf8>;
 %template(AGVector2List) std::list<AGVector2>;

Modified: antargis/trunk/ext/game/entity.cc
===================================================================
--- antargis/trunk/ext/game/entity.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/game/entity.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -86,7 +86,7 @@
     for(Meshes::iterator i=mMeshes.begin();i!=mMeshes.end();i++)
       saveDelete(*i);
     mMeshes.clear();
-    delete mJob; // checked - no agrubyobject
+    checkedDelete(mJob);
     removeOldJobs();
   }
 
@@ -254,8 +254,6 @@
               }
             else
               {
-                // FIXME: Priorities are ignored for now
-                //        throw int(); // FIXME: delete this, it's a test if priorities get handled correctly
                 mJobFinished.push_back(mJob);
               }
           }
@@ -292,7 +290,7 @@
   {
     std::list<Job*>::iterator i=mJobFinished.begin();
     for(;i!=mJobFinished.end();i++)
-      delete *i; // checked - no agrubyobject
+      checkedDelete(*i);
     mJobFinished.clear();
   }
 

Modified: antargis/trunk/ext/game/path.cc
===================================================================
--- antargis/trunk/ext/game/path.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/game/path.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -456,7 +456,6 @@
     e->b->edges.remove(e);
     //  cdebug("3");
 
-    //  delete e;
   }
 
 void SimpleGraph::removeNode(Node *n)
@@ -471,9 +470,9 @@
   {
     CTRACE;
     for(NodeSet::iterator i=mNodes.begin();i!=mNodes.end();i++)
-      delete *i;
+      checkedDelete(*i);
     for(EdgeSet::iterator i=mEdges.begin();i!=mEdges.end();i++)
-      delete *i;
+      checkedDelete(*i);
   }
 
 SimpleGraph::Node *SimpleGraph::findNearest(const AGVector2 &p)
@@ -809,7 +808,7 @@
 
 
 
-    //??????????????????
+    //????????????????????
 
     for(SimpleGraph::NodeSet::iterator i=g->mNodes.begin();i!=g->mNodes.end();i++)
       //for(SimpleGraph::NodeSet::iterator i=testSet.begin();i!=testSet.end();i++)

Modified: antargis/trunk/ext/game/path.h
===================================================================
--- antargis/trunk/ext/game/path.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/game/path.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -91,6 +91,7 @@
   typedef std::list<Edge*> Edges;
   typedef std::list<Node*> Nodes;
 
+#ifndef SWIG
   class NodePtrCompare
   {
   public:
@@ -156,7 +157,7 @@
       return a->w0+a->w1;
     }
   };
-
+#endif
   SimpleGraph();
   SimpleGraph(const SimpleGraph &g);
   SimpleGraph(BinaryIn &pIn);
@@ -256,6 +257,8 @@
   float distance(const AGVector2&from);
 };
 
+#ifndef  SWIG
+
 struct AGEXPORT Path:public std::list<SimpleGraph::Node*>
 {
   float weight;
@@ -269,8 +272,8 @@
   void paint(const AGRect2 &r,AGPaintTarget &t,float scale);
   
 };
+#endif
 
-
 class AGEXPORT PathDebugging
 {
  public:

Modified: antargis/trunk/ext/gui/ag_button.cc
===================================================================
--- antargis/trunk/ext/gui/ag_button.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/gui/ag_button.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -26,6 +26,7 @@
 #include "ag_image.h"
 #include "ag_border.h"
 #include "ag_glscreen.h"
+#include "ag_video.h"
 
 using namespace std;
 

Modified: antargis/trunk/ext/gui/ag_frame.cc
===================================================================
--- antargis/trunk/ext/gui/ag_frame.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/gui/ag_frame.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -20,8 +20,8 @@
 
 AGFrame::~AGFrame() throw()
   {
-    delete mBorder;
-    delete mBg;
+    checkedDelete(mBorder);
+    checkedDelete(mBg);
   }
 
 AGRect2 AGFrame::getClientRect() const

Modified: antargis/trunk/ext/gui/ag_layoutcreators.cc
===================================================================
--- antargis/trunk/ext/gui/ag_layoutcreators.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/gui/ag_layoutcreators.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -343,9 +343,10 @@
       if(pNode.get("y").length())
         r.setY(pNode.get("y").toFloat());
 
-#warning "add subsurfaces"
 
+      // FIXME: add subsurfaces
 
+
       AGImage *w;
       
 

Modified: antargis/trunk/ext/gui/ag_scroller.cc
===================================================================
--- antargis/trunk/ext/gui/ag_scroller.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/gui/ag_scroller.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -93,8 +93,8 @@
 
 AGScroller::~AGScroller() throw()
   {
-    delete mBorder;
-    delete mBackground;
+    checkedDelete(mBorder);
+    checkedDelete(mBackground);
   }
 
 void AGScroller::draw(AGPainter &p)

Modified: antargis/trunk/ext/gui/ag_widget.h
===================================================================
--- antargis/trunk/ext/gui/ag_widget.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/gui/ag_widget.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -71,7 +71,7 @@
    \ingroup widgets
 
    AGWidget is the base class for all widgets. It manages the hierarchy and memory of the widgets.
-   You should never delete an AGWidget for yourself if you don't know exactly what you're doing.
+   You should never deletee an AGWidget for yourself if you don't know exactly what you're doing.
    The widgets get deleted by their parents
  */
 

Modified: antargis/trunk/ext/math/ag_algebra.h
===================================================================
--- antargis/trunk/ext/math/ag_algebra.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/math/ag_algebra.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -18,8 +18,10 @@
   void set(size_t x,size_t y,float v);
   float get(size_t x,size_t y) const;
 
+#ifndef SWIG
   AGMatrixN &operator+=(const AGMatrixN &p);
   AGMatrixN &operator*=(const AGMatrixN &p);
+#endif
   AGMatrixN operator*(const AGMatrixN &p) const;
   AGMatrixN operator*(float f) const;
 

Modified: antargis/trunk/ext/sound/ag_mixer.cc
===================================================================
--- antargis/trunk/ext/sound/ag_mixer.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/sound/ag_mixer.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -141,7 +141,7 @@
           }
         //FIXME: readd this
         Mix_CloseAudio();
-        delete mSoundMutex;
+        checkedDelete(mSoundMutex);
       }
   }
 

Modified: antargis/trunk/ext/video/ag_color.h
===================================================================
--- antargis/trunk/ext/video/ag_color.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_color.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -45,8 +45,8 @@
 
 #ifndef SWIG
   AGColor &operator=(const AGColor&c);
+  AGColor &operator*=(float f);
 #endif
-  AGColor &operator*=(float f);
 
   AGColor operator*(float f) const;
   AGColor operator+(const AGColor &c) const;

Modified: antargis/trunk/ext/video/ag_font.h
===================================================================
--- antargis/trunk/ext/video/ag_font.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_font.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -83,7 +83,9 @@
   bool embossed;
   bool inset;
 
+#ifndef SWIG
   friend bool operator<(const AGFont&f1,const AGFont &f2);
+#endif
 };
 
 AGEXPORT bool operator<(const AGFont&f1,const AGFont &f2);

Modified: antargis/trunk/ext/video/ag_fontengine.cc
===================================================================
--- antargis/trunk/ext/video/ag_fontengine.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_fontengine.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -173,8 +173,8 @@
 
         }
 
-    delete [] a; // checked - no agrubyobject
-    delete [] b; // checked - no agrubyobject
+    checkedDeleteArray(a);
+    checkedDeleteArray(b);
   }
 
 void embossSurface(AGSurface &s,float depth=1.0f)
@@ -266,8 +266,8 @@
               s.putPixel(x,y,c);
             }
         }
-    delete [] a;
-    delete [] b;
+    checkedDeleteArray(a);
+    checkedDeleteArray(b);
 
     /*
   static int i=0;

Modified: antargis/trunk/ext/video/ag_glscreen.cc
===================================================================
--- antargis/trunk/ext/video/ag_glscreen.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_glscreen.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -272,7 +272,7 @@
     }
 
     assertGL;
-    delete [] buffer;
+    checkedDeleteArray(buffer);
 
 
 

Modified: antargis/trunk/ext/video/ag_glscreen.h
===================================================================
--- antargis/trunk/ext/video/ag_glscreen.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_glscreen.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -125,6 +125,4 @@
   static std::set<AGGLObject*> msObjects;
 };
 
-AGEXPORT bool opengl();
-
 #endif

Modified: antargis/trunk/ext/video/ag_gltexture.cc
===================================================================
--- antargis/trunk/ext/video/ag_gltexture.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_gltexture.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -110,7 +110,7 @@
     assertGL;
 
     if(buffer)
-      delete [] buffer;
+        checkedDeleteArray(buffer);
 
     assertGL;
     gUsedTexMemory+=w*h*4;

Modified: antargis/trunk/ext/video/ag_painter.cc
===================================================================
--- antargis/trunk/ext/video/ag_painter.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_painter.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -28,6 +28,7 @@
 #include <ag_texture.h>
 #include <math.h>
 #include <ag_geometry.h>
+#include "ag_video.h"
 
 #include <stdexcept>
 

Modified: antargis/trunk/ext/video/ag_png.cc
===================================================================
--- antargis/trunk/ext/video/ag_png.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_png.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -183,10 +183,10 @@
           }
       }
     if (row_pointers)
-      delete [] row_pointers;
+      checkedDeleteArray( row_pointers);
 
     if (info_ptr->palette)
-      delete [] info_ptr->palette;
+      checkedDeleteArray( info_ptr->palette);
 
     png_destroy_write_struct(&png_ptr, (png_infopp)NULL);
 

Modified: antargis/trunk/ext/video/ag_rendercontext.cc
===================================================================
--- antargis/trunk/ext/video/ag_rendercontext.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_rendercontext.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -77,7 +77,7 @@
 
 AGRenderContext::~AGRenderContext()
   {
-    delete mColor;
+    checkedDelete(mColor);
     getSurfaceManager()->deregisterMe(this);
   }
 
@@ -359,12 +359,12 @@
 
 void AGRenderContext::setColor(const AGVector4 &pColor)
   {
-    delete mColor;
+    checkedDelete(mColor);
     mColor=new AGVector4(pColor);
   }
 void AGRenderContext::setColor(const AGColor &pColor)
   {
-    delete mColor;
+    checkedDelete(mColor);
     float f=1.0/255.0f;
     mColor=new AGVector4(pColor.r*f,
         pColor.g*f,

Modified: antargis/trunk/ext/video/ag_sdlscreen.cc
===================================================================
--- antargis/trunk/ext/video/ag_sdlscreen.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_sdlscreen.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -66,7 +66,7 @@
 
     SDL_UpdateRects(s,rs.size(),nrs);
 
-    delete [] nrs; // checked - no agrubyobject
+    checkedDeleteArray(nrs);
   }
 
 

Modified: antargis/trunk/ext/video/ag_surface.h
===================================================================
--- antargis/trunk/ext/video/ag_surface.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_surface.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -78,8 +78,9 @@
 
   AGSurface scale(int w,int h) const;
   AGSurface grayed() const;
-
+#ifndef SWIG
   AGSurface &operator=(const AGSurface &p);
+  #endif
   bool operator==(const AGSurface &p) const;
 
   virtual void blit(const AGSurface &pSource,const AGRect2 &pDest,const AGRect2 &pSrc,const AGColor &pColor) throw(AGSurfaceEmptyException);

Modified: antargis/trunk/ext/video/ag_surfacemanager.cc
===================================================================
--- antargis/trunk/ext/video/ag_surfacemanager.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_surfacemanager.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -47,11 +47,11 @@
     for(std::set<AGInternalSurface*>::iterator i=mSDLSurfaces.begin();i!=mSDLSurfaces.end();++i)
       {
         AGFreeSurface((*i)->surface);
-        delete *i; // checked - no agrubyobject
+        checkedDelete(*i);
       }
     for(std::set<AGGLTexture*>::iterator i=mGLTextures.begin();i!=mGLTextures.end();++i)
       {
-        delete *i; // checked - no agrubyobject
+        checkedDelete(*i);
       }
 
     mSurfaceManagerDeleted=true;
@@ -216,7 +216,7 @@
             std::map<AGGLTexture*,AGInternalSurface*>::iterator l=smap.find(*i);
             if(l!=smap.end())
               l->second->glTexture=0;
-            delete *i;
+            checkedDelete(*i);
             i=gls.erase(i);
             texFreed++;
           }

Modified: antargis/trunk/ext/video/ag_texture.cc
===================================================================
--- antargis/trunk/ext/video/ag_texture.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_texture.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -143,7 +143,7 @@
   {
     if(getSurfaceManager())
       getSurfaceManager()->deregisterMe(this);
-    delete mFBO; // checked - no agrubyobject
+    checkedDelete(mFBO);
   }
 
 int AGTexture::width() const
@@ -176,7 +176,7 @@
 void AGTexture::clearTexture()
   {
     mTexture=0;
-    delete mFBO; // checked - no agrubyobject
+    checkedDelete(mFBO);
     mFBO=0;
   }
 void AGTexture::clearTextureUsed()

Modified: antargis/trunk/ext/video/ag_texture.h
===================================================================
--- antargis/trunk/ext/video/ag_texture.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/ext/video/ag_texture.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -38,7 +38,9 @@
   AGTexture(int W,int H);
   ~AGTexture() throw();
 
+#ifndef SWIG
   AGTexture &operator=(const AGTexture &t);
+#endif
 
   AGTexture copy() const; // returns a real copy
 

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_base.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_base.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_base.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -35,5 +35,50 @@
 #define AGEXPORT
 #endif
 
+#include <iostream>
 
+class AGRubyObject;
+
+enum IsRubyObject {
+  RUBY_OBJECT_YES, RUBY_OBJECT_NO, RUBY_OBJECT_UNKNOWN
+};
+
+AGEXPORT IsRubyObject isRubyObject(void *o);
+AGEXPORT bool saveDelete(AGRubyObject *o);
+
+
+/** checkedDelete deletes o, but checks before if o is a AGRubyObject
+ **/
+template<class T>
+bool checkedDelete(T *o) {
+  IsRubyObject iro = isRubyObject((void*) o);
+  if (iro == RUBY_OBJECT_YES) {
+    std::cerr << "Possible error in checkedDelete(.)" << std::endl;
+    return false;
+  } else if (iro == RUBY_OBJECT_NO) {
+    delete o;
+    return true;
+  } else {
+    std::cerr << "Could not check, because rubyObjects was discarded" << std::endl;
+    return false;
+  }
+}
+
+/** checkedDelete deletes o, but checks before if o is a AGRubyObject
+ **/
+template<class T>
+bool checkedDeleteArray(T *o) {
+  IsRubyObject iro = isRubyObject((void*) o);
+  if (iro == RUBY_OBJECT_YES) {
+    std::cerr << "Possible error in checkedDelete(.)" << std::endl;
+    return false;
+  } else if (iro == RUBY_OBJECT_NO) {
+    delete[] o;
+    return true;
+  } else {
+    std::cerr << "Could not check, because rubyObjects was discarded" << std::endl;
+    return false;
+  }
+}
+
 #endif

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_exception.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_exception.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_exception.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -20,10 +20,12 @@
 
 #ifndef __ANTARGISGUI_EXCEPTION_H__
 #define __ANTARGISGUI_EXCEPTION_H__
-
+
 #include <rk_base.h>
-#include <stdexcept>
+#include <stdexcept>
 
+// INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
+
 class AGEXPORT AGException:public std::exception
 {
 public:

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.cc	2009-02-26 20:03:54 UTC (rev 1293)
@@ -12,211 +12,188 @@
 #endif
 #include <ruby.h>
 
-bool mRubyQuitting=false;
+bool mRubyQuitting = false;
+bool mRubyObjectsExistant = false;
 
+class RubyObjects : public std::set<AGRubyObject*> {
+public:
+
+  RubyObjects() {
+    mRubyObjectsExistant = true;
+  }
+
+  virtual ~RubyObjects() {
+    mRubyObjectsExistant = false;
+  }
+};
+
 // this set keeps track of all valid instances of AGRubyObject
-std::set<AGRubyObject*> mRubyObjects;
+RubyObjects mRubyObjects;
 std::set<AGRubyObject*> mRemovedRubyObjects;
 
-void setQuitting()
-  {
-    mRubyQuitting=true;
-  }
+void setQuitting() {
+  mRubyQuitting = true;
+}
 
 // swig-function for handling "tracked" objects
 // BEWARE: this does not support multiple libraries yet (FIXME)
 VALUE convertCpp2Ruby(AGRubyObject *cObject);
 
-AGEXPORT void *getAddressOfRubyObject(AGRubyObject *o)
-  {
-    return o;
-  }
+AGEXPORT void *getAddressOfRubyObject(AGRubyObject *o) {
+  return o;
+}
 
-AGEXPORT bool rubyObjectExists(void *po)
-  {
-    VALUE v=convertCpp2Ruby((AGRubyObject*)po);
-    return(v!=Qnil);
-  }
+AGEXPORT bool rubyObjectExists(void *po) {
+  VALUE v = convertCpp2Ruby((AGRubyObject*) po);
+  return (v != Qnil);
+}
 
-AGRubyObject::AGRubyObject() throw()
-  {
-    //std::cerr<<"AGRubyObject::new:"<<this<<std::endl;
-    assert(mRubyObjects.find(this)==mRubyObjects.end());
-    mRubyObjects.insert(this);
-    size_t oSize=mRemovedRubyObjects.size();
+AGRubyObject::AGRubyObject() throw () {
+  //std::cerr<<"AGRubyObject::new:"<<this<<std::endl;
+  assert(mRubyObjects.find(this) == mRubyObjects.end());
+  mRubyObjects.insert(this);
+  size_t oSize = mRemovedRubyObjects.size();
 
-    mRemovedRubyObjects.erase(this);
-    if(oSize!=mRemovedRubyObjects.size())
-      std::cerr<<"Collision - removed rubyobject's address is overwritten!"<<std::endl;
+  mRemovedRubyObjects.erase(this);
+  if (oSize != mRemovedRubyObjects.size())
+    std::cerr << "Collision - removed rubyobject's address is overwritten!" << std::endl;
 
-    std::cerr<<"current ruby#:"<<mRubyObjects.size()<<" removed:"<<mRemovedRubyObjects.size()<<std::endl;
-  }
-AGRubyObject::~AGRubyObject() throw()
-  {
-    assert(mRubyObjects.find(this)!=mRubyObjects.end());
-    assert(mRemovedRubyObjects.find(this)==mRemovedRubyObjects.end());
-    //std::cerr<<"AGRubyObject::Removed:"<<this<<std::endl;
-    for(std::set<AGBaseObject*>::iterator i=mReferences.begin();i!=mReferences.end();i++)
-      (*i)->baseClear();
-    mRubyObjects.erase(this);
-    mRemovedRubyObjects.insert(this);
-  }
+  std::cerr << "current ruby#:" << mRubyObjects.size() << " removed:" << mRemovedRubyObjects.size() << std::endl;
+}
 
+AGRubyObject::~AGRubyObject() throw () {
+  assert(mRubyObjects.find(this) != mRubyObjects.end());
+  assert(mRemovedRubyObjects.find(this) == mRemovedRubyObjects.end());
+  //std::cerr<<"AGRubyObject::Removed:"<<this<<std::endl;
+  for (std::set<AGBaseObject*>::iterator i = mReferences.begin(); i != mReferences.end(); i++)
+    (*i)->baseClear();
+  mRubyObjects.erase(this);
+  mRemovedRubyObjects.insert(this);
+}
 
+
 /// override this function to mark your children
-void AGRubyObject::mark() throw()
-  {
-  }
 
+void AGRubyObject::mark() throw () {
+}
 
+
 // call this function with any object you want to mark.
 // recursive should be set true only in one direction, otherwise you'll generate endless-loops (!!)
-void AGRubyObject::markObject(AGRubyObject *o, bool recursive) throw()
-  {
-    //std::cerr<<"markObject:"<<o<<std::endl;
-    // o must be a valid ruby-object
-    assert(mRubyObjects.find(o)!=mRubyObjects.end());
 
-    // look up, if it's registered within ruby
-    VALUE v=convertCpp2Ruby(o);
-    if(v!=Qnil)
-      {
-        assert(DATA_PTR(v)==o);
-        //std::cout<<"V:"<<v<<std::endl;
-        // then mark it
-        rb_gc_mark(v);
+void AGRubyObject::markObject(AGRubyObject *o, bool recursive) throw () {
+  //std::cerr<<"markObject:"<<o<<std::endl;
+  // o must be a valid ruby-object
+  assert(mRubyObjects.find(o) != mRubyObjects.end());
 
-      }
+  // look up, if it's registered within ruby
+  VALUE v = convertCpp2Ruby(o);
+  if (v != Qnil) {
+    assert(DATA_PTR(v) == o);
+    //std::cout<<"V:"<<v<<std::endl;
+    // then mark it
+    rb_gc_mark(v);
 
-    assert(o);
-    // recurse through hierarchy
-    if(recursive)
-      o->mark(); // call this directly
   }
 
-void AGRubyObject::clear() throw()
-  {
-  }
+  assert(o);
+  // recurse through hierarchy
+  if (recursive)
+    o->mark(); // call this directly
+}
 
-void AGRubyObject::addRef(AGBaseObject *o)
-  {
-    mReferences.insert(o);
-  }
+void AGRubyObject::clear() throw () {
+}
 
-void AGRubyObject::deleteRef(AGBaseObject *o)
-  {
-    mReferences.erase(o);
-  }
+void AGRubyObject::addRef(AGBaseObject *o) {
+  mReferences.insert(o);
+}
 
+void AGRubyObject::deleteRef(AGBaseObject *o) {
+  mReferences.erase(o);
+}
 
 
+
 /// this is the marking function, that gets called by ruby
 /// it handles all the AGRubyObjects
-void general_markfunc(void *ptr)
-  {
-    if(!ptr)
-      {
-        std::cerr<<("WARNING: a ptr==0 was given in general_markfunc!")<<std::endl;
-        return; // ignore this !
-      }
-    assert(ptr);
-    // the given object must be a AGRubyObject and it must be valid (it's in mRubyObjects)
-    AGRubyObject *o=static_cast<AGRubyObject*>(ptr);
-    if(mRubyObjects.find(o)==mRubyObjects.end())
-      std::cerr<<"OLD RUBYOBJ:"<<(mRemovedRubyObjects.find(o)!=mRemovedRubyObjects.end())<<":"<<o<<std::endl;
-    assert(mRubyObjects.find(o)!=mRubyObjects.end());
 
+void general_markfunc(void *ptr) {
+  if (!ptr) {
+    std::cerr << ("WARNING: a ptr==0 was given in general_markfunc!") << std::endl;
+    return; // ignore this !
+  }
+  assert(ptr);
+  // the given object must be a AGRubyObject and it must be valid (it's in mRubyObjects)
+  AGRubyObject *o = static_cast<AGRubyObject*> (ptr);
+  if (mRubyObjects.find(o) == mRubyObjects.end())
+    std::cerr << "OLD RUBYOBJ:" << (mRemovedRubyObjects.find(o) != mRemovedRubyObjects.end()) << ":" << o << std::endl;
+  assert(mRubyObjects.find(o) != mRubyObjects.end());
+
 #ifdef GCDEBUG
-    printf("mark: 0x%lx\n",o->mRUBY);
+  printf("mark: 0x%lx\n", o->mRUBY);
 #endif
 
-    assert(o);
-    o->mark();
-  }
-
-/** checkedDelete deletes o, but checks before if o is a AGRubyObject
- **/
-
-bool checkedDelete(void *o)
-{
-  AGRubyObject *ro=(AGRubyObject*)o;
-  if(mRubyObjects.find(ro)==mRubyObjects.end())
-    {
-    // not found - it's safe to delete it
-    delete o;
-    return true;
-  }
-  std::cerr<<"Possible error in checkedDelete(.)"<<std::endl;
-
-  return false;
+  assert(o);
+  o->mark();
 }
 
-/** checkedDelete deletes o, but checks before if o is a AGRubyObject
- **/
+IsRubyObject isRubyObject(void *o) {
+  AGRubyObject *ro = (AGRubyObject*) o;
 
-bool checkedDeleteArray(void *o)
-{
-  AGRubyObject *ro=(AGRubyObject*)o;
-  if(mRubyObjects.find(ro)==mRubyObjects.end())
-    {
-    // not found - it's safe to delete it
-    delete [] o;
-    return true;
+  if (!mRubyObjectsExistant) {
+    std::cerr << "Could not check, because rubyObjects was discarded" << std::endl;
+    return RUBY_OBJECT_UNKNOWN;
   }
-  std::cerr<<"Possible error in checkedDeleteArray(.)"<<std::endl;
 
-  return false;
+  if (mRubyObjects.find(ro) == mRubyObjects.end())
+    return RUBY_OBJECT_NO;
+  else
+    return RUBY_OBJECT_YES;
+
 }
 
-
 /**
    saveDelete is used to delete AGRubyObjects savely.
  */
-bool saveDelete(AGRubyObject *o)
-  {
-    if(mRubyQuitting)
-      return false; // we are quitting - so memory is discarded anyway - hopefully ;-)
+bool saveDelete(AGRubyObject *o) {
+  if (mRubyQuitting)
+    return false; // we are quitting - so memory is discarded anyway - hopefully ;-)
 
-    // check, if this object is existant any longer
-    // in case we're quitting this the deletion order is not defined for ruby-objects !!
-    if(mRubyObjects.find(o)==mRubyObjects.end())
-      {
+  // check, if this object is existant any longer
+  // in case we're quitting this the deletion order is not defined for ruby-objects !!
+  if (mRubyObjects.find(o) == mRubyObjects.end()) {
 #ifdef GC_DEBUG
-        std::cerr<<"RubyObject "<<o<<" no longer existant - maybe we're quitting ?!"<<std::endl;
+    std::cerr << "RubyObject " << o << " no longer existant - maybe we're quitting ?!" << std::endl;
 #endif
-        return false;
-      }
+    return false;
+  }
 
-    assert(o);
-    // send object a message, that it will be deleted. This can help with detachin connections
-    // between objects.
-    o->clear();
+  assert(o);
+  // send object a message, that it will be deleted. This can help with detachin connections
+  // between objects.
+  o->clear();
 
-    VALUE v=convertCpp2Ruby(o);
-    if(v!=Qnil)
-      return false; // do not delete - it's under ruby's control!
+  VALUE v = convertCpp2Ruby(o);
+  if (v != Qnil)
+    return false; // do not delete - it's under ruby's control!
 
 
-    delete o;
-    return true;
-  }
+  delete o;
+  return true;
+}
 
+AGBaseObject::AGBaseObject(AGRubyObject *p) throw ()
+: mp(p) {
+  if (p)
+    p->addRef(this);
+}
 
+AGBaseObject::~AGBaseObject() throw () {
+  if (mp)
+    mp->deleteRef(this);
+}
 
-AGBaseObject::AGBaseObject(AGRubyObject *p) throw()
-:mp(p)
-    {
-      if(p)
-        p->addRef(this);
-    }
-
-AGBaseObject::~AGBaseObject() throw()
-  {
-    if(mp)
-      mp->deleteRef(this);
-  }
-
-void AGBaseObject::baseClear() throw()
-  {
-    mp=0;
-  }
+void AGBaseObject::baseClear() throw () {
+  mp = 0;
+}

Modified: antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h
===================================================================
--- antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/rookey/lib/rookey/cpp/rk_rubyobj.h	2009-02-26 20:03:54 UTC (rev 1293)
@@ -124,9 +124,6 @@
 };
 
 AGEXPORT void general_markfunc(void *ptr);
-AGEXPORT bool saveDelete(AGRubyObject *o);
-AGEXPORT bool checkedDelete(void *o);
-AGEXPORT bool checkedDeleteArray(void *o);
 
 AGEXPORT void *getAddressOfRubyObject(AGRubyObject *object);
 AGEXPORT bool rubyObjectExists(void *o);

Modified: antargis/trunk/rookey/lib/rookey/tools.rb
===================================================================
--- antargis/trunk/rookey/lib/rookey/tools.rb	2009-02-26 05:16:34 UTC (rev 1292)
+++ antargis/trunk/rookey/lib/rookey/tools.rb	2009-02-26 20:03:54 UTC (rev 1293)
@@ -1,4 +1,6 @@
 require 'pp'
+$:<<File.split(File.split(__FILE__)[0])[0]
+pp $:
 
 class Array
   
@@ -38,7 +40,8 @@
 	end
 end
 
-unless methods.member?("requireRookeyOld")
+unless eval("$require_exchanged")
+  $require_exchanged=true
   alias :requireRookeyOld :require
   def require(file)
     if file[0..0]=="."



From davidkamphausen at mail.berlios.de  Fri Feb 27 05:59:54 2009
From: davidkamphausen at mail.berlios.de (davidkamphausen at BerliOS)
Date: Fri, 27 Feb 2009 05:59:54 +0100
Subject: [Antargis-svn] r1294 - antargis/trunk/ext/video
Message-ID: <200902270459.n1R4xsaI018126@sheep.berlios.de>

Author: davidkamphausen
Date: 2009-02-27 05:59:53 +0100 (Fri, 27 Feb 2009)
New Revision: 1294

Modified:
   antargis/trunk/ext/video/ag_surfacemanager.cc
Log:
fixed error after code cleanup

Modified: antargis/trunk/ext/video/ag_surfacemanager.cc
===================================================================
--- antargis/trunk/ext/video/ag_surfacemanager.cc	2009-02-26 20:03:54 UTC (rev 1293)
+++ antargis/trunk/ext/video/ag_surfacemanager.cc	2009-02-27 04:59:53 UTC (rev 1294)
@@ -27,6 +27,7 @@
 #include "ag_config.h"
 #include "ag_glscreen.h"
 #include "ag_profiler.h"
+#include "ag_video.h"
 
 #include "ag_surface_internal.h"
 



