<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Antargis-svn] r1286 - in antargis/trunk: . ext/3dengine ext/basic	ext/external ext/game ext/gui ext/math ext/sound ext/test	ext/video main ruby ruby/editor/campaign ruby/entities
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/antargis-svn/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:antargis-svn%40lists.berlios.de?Subject=Re%3A%20%5BAntargis-svn%5D%20r1286%20-%20in%20antargis/trunk%3A%20.%20ext/3dengine%20ext/basic%0A%09ext/external%20ext/game%20ext/gui%20ext/math%20ext/sound%20ext/test%0A%09ext/video%20main%20ruby%20ruby/editor/campaign%20ruby/entities&In-Reply-To=%3C200902162013.n1GKDYNf007029%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000241.html">
   <LINK REL="Next"  HREF="000243.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Antargis-svn] r1286 - in antargis/trunk: . ext/3dengine ext/basic	ext/external ext/game ext/gui ext/math ext/sound ext/test	ext/video main ruby ruby/editor/campaign ruby/entities</H1>
    <B>davidkamphausen at BerliOS</B> 
    <A HREF="mailto:antargis-svn%40lists.berlios.de?Subject=Re%3A%20%5BAntargis-svn%5D%20r1286%20-%20in%20antargis/trunk%3A%20.%20ext/3dengine%20ext/basic%0A%09ext/external%20ext/game%20ext/gui%20ext/math%20ext/sound%20ext/test%0A%09ext/video%20main%20ruby%20ruby/editor/campaign%20ruby/entities&In-Reply-To=%3C200902162013.n1GKDYNf007029%40sheep.berlios.de%3E"
       TITLE="[Antargis-svn] r1286 - in antargis/trunk: . ext/3dengine ext/basic	ext/external ext/game ext/gui ext/math ext/sound ext/test	ext/video main ruby ruby/editor/campaign ruby/entities">davidkamphausen at mail.berlios.de
       </A><BR>
    <I>Mon Feb 16 21:13:34 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000241.html">[Antargis-svn] r1285 - in antargis/trunk/rookey: . configs cpp lib	lib/rookey lib/rookey/configs lib/rookey/cpp lib/rookey/swig	maintainenance nbproject nbproject/private swig
</A></li>
        <LI>Next message: <A HREF="000243.html">[Antargis-svn] r1287 - antargis/trunk/ruby/editor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#242">[ date ]</a>
              <a href="thread.html#242">[ thread ]</a>
              <a href="subject.html#242">[ subject ]</a>
              <a href="author.html#242">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: davidkamphausen
Date: 2009-02-16 21:13:26 +0100 (Mon, 16 Feb 2009)
New Revision: 1286

Removed:
   antargis/trunk/ext/basic/ag_debug.cc
   antargis/trunk/ext/basic/ag_debug.h
   antargis/trunk/ext/basic/ag_exception.h
   antargis/trunk/ext/basic/ag_rtools.cc
   antargis/trunk/ext/basic/ag_rtools.h
   antargis/trunk/ext/basic/ag_string.cc
   antargis/trunk/ext/basic/ag_string.h
   antargis/trunk/ext/basic/ag_tools.cc
   antargis/trunk/ext/basic/ag_tools.h
   antargis/trunk/ext/basic/ag_utf8.cc
   antargis/trunk/ext/basic/ag_utf8.h
Modified:
   antargis/trunk/.project
   antargis/trunk/Rakefile
   antargis/trunk/TODO
   antargis/trunk/antargisStarter.rb
   antargis/trunk/ext/3dengine/ag_glsl.cc
   antargis/trunk/ext/3dengine/ag_glsl.h
   antargis/trunk/ext/3dengine/ag_glwidget.cc
   antargis/trunk/ext/3dengine/anim_mesh.cc
   antargis/trunk/ext/3dengine/anim_mesh.h
   antargis/trunk/ext/3dengine/anim_mesh_data.cc
   antargis/trunk/ext/3dengine/anim_mesh_data.h
   antargis/trunk/ext/3dengine/ant_camera.cc
   antargis/trunk/ext/3dengine/ant_camera.h
   antargis/trunk/ext/3dengine/ant_particle.cc
   antargis/trunk/ext/3dengine/ant_particle.h
   antargis/trunk/ext/3dengine/ant_projection.cc
   antargis/trunk/ext/3dengine/ant_renderer.cc
   antargis/trunk/ext/3dengine/boa_3d_wireframe.cc
   antargis/trunk/ext/3dengine/boa_3d_wireframe.h
   antargis/trunk/ext/3dengine/glsl.h
   antargis/trunk/ext/3dengine/init.cc
   antargis/trunk/ext/3dengine/mesh.cc
   antargis/trunk/ext/3dengine/mesh.h
   antargis/trunk/ext/3dengine/mesh_2d.cc
   antargis/trunk/ext/3dengine/mesh_2d.h
   antargis/trunk/ext/3dengine/mesh_2d_data.cc
   antargis/trunk/ext/3dengine/mesh_2d_data.h
   antargis/trunk/ext/3dengine/mesh_data.cc
   antargis/trunk/ext/3dengine/mesh_data.h
   antargis/trunk/ext/3dengine/mesh_optimizer.cc
   antargis/trunk/ext/3dengine/quadtree.h
   antargis/trunk/ext/3dengine/scene.cc
   antargis/trunk/ext/3dengine/scene.h
   antargis/trunk/ext/3dengine/scene_2d.cc
   antargis/trunk/ext/3dengine/scene_2d.h
   antargis/trunk/ext/3dengine/scene_base.cc
   antargis/trunk/ext/3dengine/scene_base.h
   antargis/trunk/ext/3dengine/scenenode.cc
   antargis/trunk/ext/3dengine/scenenode.h
   antargis/trunk/ext/basic/ag_collector.cc
   antargis/trunk/ext/basic/ag_collector.h
   antargis/trunk/ext/basic/ag_config.cc
   antargis/trunk/ext/basic/ag_config.h
   antargis/trunk/ext/basic/ag_fs.cc
   antargis/trunk/ext/basic/ag_fs.h
   antargis/trunk/ext/basic/ag_geometry.cc
   antargis/trunk/ext/basic/ag_geometry.h
   antargis/trunk/ext/basic/ag_kill.cc
   antargis/trunk/ext/basic/ag_kill.h
   antargis/trunk/ext/basic/ag_main.cc
   antargis/trunk/ext/basic/ag_main.h
   antargis/trunk/ext/basic/ag_message.cc
   antargis/trunk/ext/basic/ag_message.h
   antargis/trunk/ext/basic/ag_messageobject.cc
   antargis/trunk/ext/basic/ag_messageobject.h
   antargis/trunk/ext/basic/ag_mutex.h
   antargis/trunk/ext/basic/ag_plugin.cc
   antargis/trunk/ext/basic/ag_plugin.h
   antargis/trunk/ext/basic/ag_profiler.cc
   antargis/trunk/ext/basic/ag_profiler.h
   antargis/trunk/ext/basic/ag_rand_base.h
   antargis/trunk/ext/basic/ag_serial.cc
   antargis/trunk/ext/basic/ag_serial.h
   antargis/trunk/ext/basic/ag_singleton.cc
   antargis/trunk/ext/basic/ag_singleton.h
   antargis/trunk/ext/basic/ag_string_utf8.cc
   antargis/trunk/ext/basic/ag_string_utf8.h
   antargis/trunk/ext/basic/ag_stringstream.h
   antargis/trunk/ext/basic/ag_video_base.cc
   antargis/trunk/ext/basic/ag_video_base.h
   antargis/trunk/ext/basic/ag_xml.cc
   antargis/trunk/ext/basic/ag_xml.h
   antargis/trunk/ext/basic/init.cc
   antargis/trunk/ext/external/mtwist.h
   antargis/trunk/ext/game/ant_app.cc
   antargis/trunk/ext/game/ant_app.h
   antargis/trunk/ext/game/entity.cc
   antargis/trunk/ext/game/entity.h
   antargis/trunk/ext/game/entptr.cc
   antargis/trunk/ext/game/entptr.h
   antargis/trunk/ext/game/height_map.cc
   antargis/trunk/ext/game/height_map.h
   antargis/trunk/ext/game/heuristic.cc
   antargis/trunk/ext/game/init.cc
   antargis/trunk/ext/game/map.cc
   antargis/trunk/ext/game/map.h
   antargis/trunk/ext/game/minimap.cc
   antargis/trunk/ext/game/minimap.h
   antargis/trunk/ext/game/path.cc
   antargis/trunk/ext/game/path.h
   antargis/trunk/ext/game/terrain.cc
   antargis/trunk/ext/game/terrain.h
   antargis/trunk/ext/game/water.cc
   antargis/trunk/ext/game/water.h
   antargis/trunk/ext/gui/ag_application.cc
   antargis/trunk/ext/gui/ag_application.h
   antargis/trunk/ext/gui/ag_background.cc
   antargis/trunk/ext/gui/ag_button.cc
   antargis/trunk/ext/gui/ag_button.h
   antargis/trunk/ext/gui/ag_caption.cc
   antargis/trunk/ext/gui/ag_checkbox.cc
   antargis/trunk/ext/gui/ag_colorbutton.cc
   antargis/trunk/ext/gui/ag_colorbutton.h
   antargis/trunk/ext/gui/ag_combo.cc
   antargis/trunk/ext/gui/ag_combo.h
   antargis/trunk/ext/gui/ag_edit.cc
   antargis/trunk/ext/gui/ag_edit.h
   antargis/trunk/ext/gui/ag_frame.cc
   antargis/trunk/ext/gui/ag_frame.h
   antargis/trunk/ext/gui/ag_image.cc
   antargis/trunk/ext/gui/ag_image.h
   antargis/trunk/ext/gui/ag_layout.cc
   antargis/trunk/ext/gui/ag_layout.h
   antargis/trunk/ext/gui/ag_layoutfactory.cc
   antargis/trunk/ext/gui/ag_layoutfactory.h
   antargis/trunk/ext/gui/ag_listbox.cc
   antargis/trunk/ext/gui/ag_listbox.h
   antargis/trunk/ext/gui/ag_local.cc
   antargis/trunk/ext/gui/ag_local.h
   antargis/trunk/ext/gui/ag_menu.cc
   antargis/trunk/ext/gui/ag_menu.h
   antargis/trunk/ext/gui/ag_menuitem.cc
   antargis/trunk/ext/gui/ag_menuitem.h
   antargis/trunk/ext/gui/ag_radio.cc
   antargis/trunk/ext/gui/ag_radio.h
   antargis/trunk/ext/gui/ag_radiogroup.cc
   antargis/trunk/ext/gui/ag_radiogroup.h
   antargis/trunk/ext/gui/ag_screenwidget.cc
   antargis/trunk/ext/gui/ag_screenwidget.h
   antargis/trunk/ext/gui/ag_scroller.cc
   antargis/trunk/ext/gui/ag_scroller.h
   antargis/trunk/ext/gui/ag_table.cc
   antargis/trunk/ext/gui/ag_table.h
   antargis/trunk/ext/gui/ag_text.cc
   antargis/trunk/ext/gui/ag_text.h
   antargis/trunk/ext/gui/ag_theme.cc
   antargis/trunk/ext/gui/ag_theme.h
   antargis/trunk/ext/gui/ag_theme_v2.cc
   antargis/trunk/ext/gui/ag_theme_v2.h
   antargis/trunk/ext/gui/ag_tooltip.cc
   antargis/trunk/ext/gui/ag_tooltip.h
   antargis/trunk/ext/gui/ag_widget.cc
   antargis/trunk/ext/gui/ag_widget.h
   antargis/trunk/ext/gui/ag_window.cc
   antargis/trunk/ext/gui/ag_window.h
   antargis/trunk/ext/gui/init.cc
   antargis/trunk/ext/math/ag_algebra.cc
   antargis/trunk/ext/math/ag_algebra.h
   antargis/trunk/ext/math/ag_rand.cc
   antargis/trunk/ext/math/ag_rand.h
   antargis/trunk/ext/math/ant_frustum.cc
   antargis/trunk/ext/math/init.cc
   antargis/trunk/ext/sound/ag_mixer.cc
   antargis/trunk/ext/sound/ag_mixer.h
   antargis/trunk/ext/sound/init.cc
   antargis/trunk/ext/test/gl_text_3d.cc
   antargis/trunk/ext/video/ag_clip_painttarget.cc
   antargis/trunk/ext/video/ag_clip_painttarget.h
   antargis/trunk/ext/video/ag_color.cc
   antargis/trunk/ext/video/ag_color.h
   antargis/trunk/ext/video/ag_fbo.h
   antargis/trunk/ext/video/ag_font.h
   antargis/trunk/ext/video/ag_fontengine.cc
   antargis/trunk/ext/video/ag_fontengine.h
   antargis/trunk/ext/video/ag_glpainter.cc
   antargis/trunk/ext/video/ag_glscreen.cc
   antargis/trunk/ext/video/ag_glscreen.h
   antargis/trunk/ext/video/ag_gltexture.cc
   antargis/trunk/ext/video/ag_gradient.cc
   antargis/trunk/ext/video/ag_painter.cc
   antargis/trunk/ext/video/ag_painter.h
   antargis/trunk/ext/video/ag_painttarget.h
   antargis/trunk/ext/video/ag_projection.cc
   antargis/trunk/ext/video/ag_projection.h
   antargis/trunk/ext/video/ag_rendercontext.cc
   antargis/trunk/ext/video/ag_screen.cc
   antargis/trunk/ext/video/ag_screen.h
   antargis/trunk/ext/video/ag_sdlscreen.cc
   antargis/trunk/ext/video/ag_surface.cc
   antargis/trunk/ext/video/ag_surface.h
   antargis/trunk/ext/video/ag_surfacemanager.cc
   antargis/trunk/ext/video/ag_surfacemanager.h
   antargis/trunk/ext/video/ag_texture.cc
   antargis/trunk/ext/video/ag_texture.h
   antargis/trunk/ext/video/ag_texturecache.h
   antargis/trunk/ext/video/ag_vdebug.cc
   antargis/trunk/ext/video/ag_vdebug.h
   antargis/trunk/ext/video/ag_video.cc
   antargis/trunk/ext/video/init.cc
   antargis/trunk/main/starter.cc
   antargis/trunk/ruby/ant_tools.rb
   antargis/trunk/ruby/antargislib.rb
   antargis/trunk/ruby/editor/campaign/drag_grid.rb
   antargis/trunk/ruby/editor/campaign/ruby_layouts.rb
   antargis/trunk/ruby/editor/campaign/ruby_tools.rb
   antargis/trunk/ruby/entities/ant_house.rb
Log:
big cleanup

Modified: antargis/trunk/.project
===================================================================
--- antargis/trunk/.project	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/.project	2009-02-16 20:13:26 UTC (rev 1286)
@@ -10,38 +10,34 @@
 			&lt;triggers&gt;clean,full,incremental,&lt;/triggers&gt;
 			&lt;arguments&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;org.eclipse.cdt.make.core.fullBuildTarget&lt;/key&gt;
-					&lt;value&gt;all&lt;/value&gt;
+					&lt;key&gt;?children?&lt;/key&gt;
+					&lt;value&gt;?name?=outputEntries\|?children?=?name?=entry\\\\\\\\\\\\\\\|\\\\\\\|\||&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;org.eclipse.cdt.make.core.buildLocation&lt;/key&gt;
-					&lt;value&gt;${workspace_loc:/antargis}&lt;/value&gt;
+					&lt;key&gt;?name?&lt;/key&gt;
+					&lt;value&gt;&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;org.eclipse.cdt.make.core.enableAutoBuild&lt;/key&gt;
-					&lt;value&gt;false&lt;/value&gt;
+					&lt;key&gt;org.eclipse.cdt.make.core.append_environment&lt;/key&gt;
+					&lt;value&gt;true&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;?name?&lt;/key&gt;
-					&lt;value&gt;&lt;/value&gt;
+					&lt;key&gt;org.eclipse.cdt.make.core.autoBuildTarget&lt;/key&gt;
+					&lt;value&gt;all&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;?children?&lt;/key&gt;
-					&lt;value&gt;?name?=outputEntries\|?children?=?name?=entry\\\\\\\\\\\\\\\|\\\\\\\|\||&lt;/value&gt;
+					&lt;key&gt;org.eclipse.cdt.make.core.buildArguments&lt;/key&gt;
+					&lt;value&gt;&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;org.eclipse.cdt.make.core.enableFullBuild&lt;/key&gt;
-					&lt;value&gt;true&lt;/value&gt;
+					&lt;key&gt;org.eclipse.cdt.make.core.buildCommand&lt;/key&gt;
+					&lt;value&gt;make&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;org.eclipse.cdt.make.core.enableCleanBuild&lt;/key&gt;
-					&lt;value&gt;true&lt;/value&gt;
+					&lt;key&gt;org.eclipse.cdt.make.core.buildLocation&lt;/key&gt;
+					&lt;value&gt;${workspace_loc:/antargis}&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;org.eclipse.cdt.make.core.append_environment&lt;/key&gt;
-					&lt;value&gt;true&lt;/value&gt;
-				&lt;/dictionary&gt;
-				&lt;dictionary&gt;
 					&lt;key&gt;org.eclipse.cdt.make.core.cleanBuildTarget&lt;/key&gt;
 					&lt;value&gt;clean&lt;/value&gt;
 				&lt;/dictionary&gt;
@@ -50,25 +46,29 @@
 					&lt;value&gt;org.eclipse.cdt.make.core.activeConfigSettings&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;org.eclipse.cdt.make.core.useDefaultBuildCmd&lt;/key&gt;
-					&lt;value&gt;true&lt;/value&gt;
+					&lt;key&gt;org.eclipse.cdt.make.core.enableAutoBuild&lt;/key&gt;
+					&lt;value&gt;false&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;org.eclipse.cdt.make.core.buildArguments&lt;/key&gt;
-					&lt;value&gt;&lt;/value&gt;
+					&lt;key&gt;org.eclipse.cdt.make.core.enableCleanBuild&lt;/key&gt;
+					&lt;value&gt;true&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;org.eclipse.cdt.make.core.buildCommand&lt;/key&gt;
-					&lt;value&gt;make&lt;/value&gt;
+					&lt;key&gt;org.eclipse.cdt.make.core.enableFullBuild&lt;/key&gt;
+					&lt;value&gt;true&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
-					&lt;key&gt;org.eclipse.cdt.make.core.autoBuildTarget&lt;/key&gt;
+					&lt;key&gt;org.eclipse.cdt.make.core.fullBuildTarget&lt;/key&gt;
 					&lt;value&gt;all&lt;/value&gt;
 				&lt;/dictionary&gt;
 				&lt;dictionary&gt;
 					&lt;key&gt;org.eclipse.cdt.make.core.stopOnError&lt;/key&gt;
 					&lt;value&gt;true&lt;/value&gt;
 				&lt;/dictionary&gt;
+				&lt;dictionary&gt;
+					&lt;key&gt;org.eclipse.cdt.make.core.useDefaultBuildCmd&lt;/key&gt;
+					&lt;value&gt;true&lt;/value&gt;
+				&lt;/dictionary&gt;
 			&lt;/arguments&gt;
 		&lt;/buildCommand&gt;
 		&lt;buildCommand&gt;

Modified: antargis/trunk/Rakefile
===================================================================
--- antargis/trunk/Rakefile	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/Rakefile	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,5 @@
-require File.join(File.split(__FILE__)[0],'rookey','tasks.rb')
+$: &lt;&lt; &quot;rookey/lib&quot;
+require 'rookey.rb'
 
 $rspec=Rookey.checkedRequire('spec/rake/spectask')
 

Modified: antargis/trunk/TODO
===================================================================
--- antargis/trunk/TODO	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/TODO	2009-02-16 20:13:26 UTC (rev 1286)
@@ -62,16 +62,7 @@
 [[Development]]
 ==========================================================
 
-[Segfaults]
-------------------------------------------------------
-None known.
 
-[AI]
-------------------------------------------------------
-[H] heuristic compression for path-finding
-[H] map-weighting based on min/max of surrounding
-
-
 [Gui/View - GUI-library]
 ------------------------------------------------------
 [H] fix texture-painting on GeForce - backgrounds are always black, but they should be transparent (like FPS-display)
@@ -157,10 +148,6 @@
 [VL] story-telling:
 	- browsing facility (scene=&gt;number(person)=&gt;text)
 
-[Artificial Intelligence]
-------------------------------------------------------
-[L] computer-player only attacks when stock is used up
-
 [Multiplayer]
 ------------------------------------------------------
 [M] choosing/making player for multiplayer

Modified: antargis/trunk/antargisStarter.rb
===================================================================
--- antargis/trunk/antargisStarter.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/antargisStarter.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -2,10 +2,23 @@
 
 # run intro - mainmenu will be called automatically
 
+def puts(*s)
+  $debugFile||=File.open(&quot;antargisSt.log&quot;,&quot;w&quot;)
+  $debugFile.puts(*s)
+  $debugFile.flush
+end
+puts &quot;MY LOG&quot;
+puts &quot;MY LOG2&quot;
+
 Dir.chdir(File.split(__FILE__)[0])
-
-require 'ruby/intro.rb'
+puts &quot;MY LOG2&quot;
+puts Dir.pwd
+puts $:
+puts &quot;--&quot;
+require File.join('ruby','intro.rb')
+puts &quot;MY LOG2&quot;
 require 'ruby/mainmenu.rb'
+puts &quot;MY LOG2&quot;
 
 
 

Modified: antargis/trunk/ext/3dengine/ag_glsl.cc
===================================================================
--- antargis/trunk/ext/3dengine/ag_glsl.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ag_glsl.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -2,7 +2,6 @@
 #include &quot;ag_glsl.h&quot;
 #include &quot;ag_vdebug.h&quot;
 #include &quot;ag_main.h&quot;
-//#include &quot;scene.h&quot;
 
 std::map&lt;std::string,AGVertexProgram*&gt; mVertexPrograms;
 std::map&lt;std::string,AGFragProgram*&gt; mFragPrograms;

Modified: antargis/trunk/ext/3dengine/ag_glsl.h
===================================================================
--- antargis/trunk/ext/3dengine/ag_glsl.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ag_glsl.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,8 +22,7 @@
 #define AG_GLSL_H
 
 #include &quot;ag_gl.h&quot;
-//#include &quot;renderer.h&quot;
-#include &quot;ag_tools.h&quot;
+#include &quot;rk_tools.h&quot;
 #include &quot;ag_geometry.h&quot;
 
 #include &lt;map&gt;
@@ -62,7 +61,7 @@
 class AGEXPORT AGShaderParameter
 {
  public:
-  
+
 };
 
 class AGEXPORT AGShaderProgram
@@ -74,7 +73,7 @@
   float *matrixBuf;
   bool on;
   std::string name;
- protected:  
+ protected:
   GLhandleARB p;
 
  public:

Modified: antargis/trunk/ext/3dengine/ag_glwidget.cc
===================================================================
--- antargis/trunk/ext/3dengine/ag_glwidget.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ag_glwidget.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,6 @@
+#include &quot;rk_debug.h&quot;
+
 #include &quot;ag_glwidget.h&quot;
-#include &quot;ag_debug.h&quot;
 #include &quot;ag_screen.h&quot;
 #include &lt;GL/glu.h&gt;
 
@@ -10,9 +11,9 @@
 
 void AGGLWidget::drawGL()
 {
-  
+
 }
-  
+
 void AGGLWidget::drawAll(AGPainter &amp;p)
 {
   beginGL();
@@ -48,9 +49,9 @@
   glDepthMask(true);
   glEnable(GL_DEPTH_TEST);
   glEnable(GL_LIGHTING);
-  
-  
-  
+
+
+
 }
 
 float AGGLWidget::getRatio() const

Modified: antargis/trunk/ext/3dengine/anim_mesh.cc
===================================================================
--- antargis/trunk/ext/3dengine/anim_mesh.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/anim_mesh.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -88,7 +88,7 @@
 
   }
 
-AnimMesh::~AnimMesh()
+AnimMesh::~AnimMesh() throw()
   {
     //  CTRACE;
   }
@@ -383,7 +383,7 @@
     return true;
   }
 
-void AnimMesh::mark()
+void AnimMesh::mark() throw()
   {
     markObject(mData);
   }

Modified: antargis/trunk/ext/3dengine/anim_mesh.h
===================================================================
--- antargis/trunk/ext/3dengine/anim_mesh.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/anim_mesh.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -37,7 +37,7 @@
 
 public:
   AnimMesh(Scene *pScene,AnimMeshData *data);
-  virtual ~AnimMesh();
+  virtual ~AnimMesh() throw();
 
   void setTransform(const AGMatrix4 &amp;m);
 
@@ -55,7 +55,7 @@
   virtual void drawPick();
   virtual void advance(float time);
 
-  virtual void mark();
+  virtual void mark() throw();
 
   void setEntity(AntEntity *e);
 

Modified: antargis/trunk/ext/3dengine/anim_mesh_data.cc
===================================================================
--- antargis/trunk/ext/3dengine/anim_mesh_data.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/anim_mesh_data.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -118,7 +118,7 @@
     mName=AGString(xmlFilename);
   }
 
-AnimMeshData::~AnimMeshData()
+AnimMeshData::~AnimMeshData() throw()
   {
     CTRACE;
     cdebug(mName);

Modified: antargis/trunk/ext/3dengine/anim_mesh_data.h
===================================================================
--- antargis/trunk/ext/3dengine/anim_mesh_data.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/anim_mesh_data.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -92,7 +92,7 @@
 
  public:
   AnimMeshData(const AGString &amp;xmlFilename);
-  ~AnimMeshData();
+  ~AnimMeshData() throw();
 
   AGBox3 bbox() const;
 

Modified: antargis/trunk/ext/3dengine/ant_camera.cc
===================================================================
--- antargis/trunk/ext/3dengine/ant_camera.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_camera.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #include &lt;SDL_opengl.h&gt;
 #include &lt;math.h&gt;
 
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 
 AntCamera::AntCamera(int w,int h)
   {
@@ -100,7 +100,7 @@
 
 
 
-        lp=AGVector4(-0.5,1.5,-0.5,1); // should be something like this 
+        lp=AGVector4(-0.5,1.5,-0.5,1); // should be something like this
         lp*=100;
 
 

Modified: antargis/trunk/ext/3dengine/ant_camera.h
===================================================================
--- antargis/trunk/ext/3dengine/ant_camera.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_camera.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,10 +23,11 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
+#include &lt;rk_rubyobj.h&gt;
+
 #include &quot;ag_gl.h&quot;
 #include &lt;ant_frustum.h&gt;
 #include &lt;ant_projection.h&gt;
-#include &lt;ag_rubyobj.h&gt;
 
 /**
    \brief a camera object for moving over a height map
@@ -77,7 +78,7 @@
 
 
   /// this position is changed when moving around
-  AGVector4 scenePosition; 
+  AGVector4 scenePosition;
   /// camera and light position are fixed - to be understand as relative positions to scenePosition
   AGVector4 cameraPosition;
   AGVector4 lightPosition;
@@ -88,7 +89,7 @@
   AGMatrix4 cameraPick;
 
   /// use perspective shadow maps ?
-  bool mPSM; 
+  bool mPSM;
 
   int mWidth,mHeight;
 };

Modified: antargis/trunk/ext/3dengine/ant_particle.cc
===================================================================
--- antargis/trunk/ext/3dengine/ant_particle.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_particle.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -45,7 +45,7 @@
     enabled=true;
   }
 
-AntParticle::~AntParticle()
+AntParticle::~AntParticle() throw()
   {
     for(std::list&lt;Piece*&gt;::iterator i=mPieces.begin();i!=mPieces.end();i++)
       delete *i;

Modified: antargis/trunk/ext/3dengine/ant_particle.h
===================================================================
--- antargis/trunk/ext/3dengine/ant_particle.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_particle.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -38,7 +38,7 @@
   /// make some smoke (or fire) in Scene pScene with output frequency f
   AntParticle(Scene *pScene,float f);
   
-  virtual ~AntParticle();
+  virtual ~AntParticle() throw();
 
   /// if f is true this object will display a fire - otherwise it's smoke
   /// default is smoke

Modified: antargis/trunk/ext/3dengine/ant_projection.cc
===================================================================
--- antargis/trunk/ext/3dengine/ant_projection.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_projection.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,7 @@
 #include &quot;ant_projection.h&quot;
-#include &lt;ag_debug.h&gt;
 
+#include &lt;rk_debug.h&gt;
+
 #include &lt;GL/glu.h&gt;
 
 
@@ -20,7 +21,7 @@
 
   GLdouble mv[16],pr[16];
   for(int i=0;i&lt;16;i++)
-    { 
+    {
       mv[i]=((const float*)modelview)[i];
       pr[i]=((const float*)projection)[i];
     }
@@ -35,7 +36,7 @@
 
   GLdouble mv[16],pr[16];
   for(int i=0;i&lt;16;i++)
-    { 
+    {
       mv[i]=((const float*)modelview)[i];
       pr[i]=((const float*)projection)[i];
     }

Modified: antargis/trunk/ext/3dengine/ant_renderer.cc
===================================================================
--- antargis/trunk/ext/3dengine/ant_renderer.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/ant_renderer.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,9 +1,9 @@
 #include &quot;ant_renderer.h&quot;
 #include &quot;scene.h&quot;
 #include &quot;ag_vdebug.h&quot;
-#include &quot;ag_kill.h&quot;
 #include &quot;ag_config.h&quot;
 #include &quot;ag_fbo.h&quot;
+#include &quot;ag_kill.h&quot;
 
 Renderer *gRenderer=0;
 

Modified: antargis/trunk/ext/3dengine/boa_3d_wireframe.cc
===================================================================
--- antargis/trunk/ext/3dengine/boa_3d_wireframe.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/boa_3d_wireframe.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include &quot;boa_3d_wireframe.h&quot;
 #include &lt;ag_rendercontext.h&gt;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 
 Boa3dWireframe::Boa3dWireframe(Scene *pScene,const AGVector4 &amp;pColor,float pWidth):
   SceneNode(pScene,AGVector4(0,0,0,0),AGBox3(AGVector3(0,0,0),AGVector3(100,100,100))),
@@ -10,6 +10,9 @@
   mChanged=true;
 }
 
+Boa3dWireframe::~Boa3dWireframe() throw()
+  {}
+
 void Boa3dWireframe::draw()
 {
   //  std::cout&lt;&lt;&quot;Mcdebug(&quot;&lt;&lt;std::endl;
@@ -20,7 +23,7 @@
       // update vertex array
     }
 
-  
+
   AGRenderContext c;
   glLineWidth(mWidth);
 
@@ -32,7 +35,7 @@
   c.setColor(mColor);
   c.begin();
   glBegin(GL_LINES);
- 
+
   for(std::vector&lt;Line&gt;::iterator i=mLines.begin();i!=mLines.end();i++)
     {
       glVertex3fv((float*)a);
@@ -41,10 +44,10 @@
       glVertex3fv((float*)i-&gt;b);
     }
   glEnd();
-  
 
-  
 
+
+
 }
 
 void Boa3dWireframe::addLine(const AGVector3 &amp;a,const AGVector3 &amp;b)

Modified: antargis/trunk/ext/3dengine/boa_3d_wireframe.h
===================================================================
--- antargis/trunk/ext/3dengine/boa_3d_wireframe.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/boa_3d_wireframe.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -15,6 +15,7 @@
 
  public:
   Boa3dWireframe(Scene *pScene,const AGVector4 &amp;pColor,float pWidth);
+  virtual ~Boa3dWireframe() throw();
 
   void draw();
 

Modified: antargis/trunk/ext/3dengine/glsl.h
===================================================================
--- antargis/trunk/ext/3dengine/glsl.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/glsl.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,8 +1,9 @@
 #ifndef ANT_GLSL_H
 #define ANT_GLSL_H
 
+#include &quot;rk_tools.h&quot;
+
 #include &quot;ant_renderer.h&quot;
-#include &quot;ag_tools.h&quot;
 #include &quot;ag_geometry.h&quot;
 #include &quot;ag_glscreen.h&quot;
 
@@ -42,7 +43,7 @@
 class AGEXPORT AntShaderParameter
 {
  public:
-  
+
 };
 
 class AGEXPORT AntShaderProgram:public AGGLObject
@@ -56,7 +57,7 @@
   bool on;
   std::string name;
 
- protected:  
+ protected:
   GLhandleARB p;
 
  public:

Modified: antargis/trunk/ext/3dengine/init.cc
===================================================================
--- antargis/trunk/ext/3dengine/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,4 @@
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 
 AGEXPORT void AG_Init_libantargis3dengine()
 {

Modified: antargis/trunk/ext/3dengine/mesh.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -34,7 +34,7 @@
     mVisible=true;
   }
 
-Mesh::~Mesh()
+Mesh::~Mesh() throw()
   {
   }
 
@@ -142,7 +142,7 @@
   }
 
 
-void Mesh::mark()
+void Mesh::mark() throw()
   {
     markObject(getData());
   }

Modified: antargis/trunk/ext/3dengine/mesh.h
===================================================================
--- antargis/trunk/ext/3dengine/mesh.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -27,7 +27,7 @@
  public:
   Mesh(Scene *pScene);
   Mesh(Scene *pScene,MeshData &amp;data,const AGVector4 &amp;pPos,float pRot);
-  virtual ~Mesh();
+  virtual ~Mesh()  throw();
 
   void draw();
   void drawDepth();
@@ -46,7 +46,7 @@
 
   MeshData *getData();
 
-  void mark();
+  void mark() throw();
 
   virtual bool transparent();
 

Modified: antargis/trunk/ext/3dengine/mesh_2d.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh_2d.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_2d.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,5 @@
 #include &quot;mesh_2d.h&quot;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &lt;ag_painter.h&gt;
 
 Mesh2D::Mesh2D(Scene2D *pScene):
@@ -11,7 +11,7 @@
   mData(&amp;data)
 {
 }
-Mesh2D::~Mesh2D()
+Mesh2D::~Mesh2D() throw()
 {
 }
 
@@ -74,7 +74,7 @@
   return mData;
 }
 
-void Mesh2D::mark()
+void Mesh2D::mark() throw()
 {
   markObject(mData);
 }
@@ -87,7 +87,7 @@
       // check if texture is !=transparent there
       AGVector2 p=screenPos-dRect.getV0();
       return mData-&gt;getTexture()-&gt;getPixel(p[0],p[1]).a&gt;10; // some threshold here
-      
+
     }
   return false;
 }

Modified: antargis/trunk/ext/3dengine/mesh_2d.h
===================================================================
--- antargis/trunk/ext/3dengine/mesh_2d.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_2d.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -13,7 +13,7 @@
  public:
   Mesh2D(Scene2D *pScene);
   Mesh2D(Scene2D *pScene,Mesh2DData &amp;data,const AGVector4 &amp;pPos,float pRot);
-  virtual ~Mesh2D();
+  virtual ~Mesh2D() throw();
 
   void draw();
 
@@ -27,7 +27,7 @@
 
   Mesh2DData *getData();
 
-  void mark();
+  void mark() throw();
 
   bool hit(const AGVector2 &amp;screenPos);
 

Modified: antargis/trunk/ext/3dengine/mesh_2d_data.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh_2d_data.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_2d_data.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -5,7 +5,7 @@
 {
 }
   
-void Mesh2DData::mark()
+void Mesh2DData::mark() throw()
 {
   markObject(mTexture);
 }

Modified: antargis/trunk/ext/3dengine/mesh_2d_data.h
===================================================================
--- antargis/trunk/ext/3dengine/mesh_2d_data.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_2d_data.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -10,7 +10,7 @@
  public:
   Mesh2DData(AGTexture *pTexture);
   
-  void mark();
+  void mark() throw();
 
   AGTexture *getTexture();
 

Modified: antargis/trunk/ext/3dengine/mesh_data.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh_data.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_data.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -124,7 +124,7 @@
   mPickable=true;
 }
 
-MeshData::~MeshData()
+MeshData::~MeshData() throw()
   {
     //  TRACE;
   }

Modified: antargis/trunk/ext/3dengine/mesh_data.h
===================================================================
--- antargis/trunk/ext/3dengine/mesh_data.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_data.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -30,7 +30,7 @@
  public:
   MeshData(const std::string &amp;filename,float zoom,const std::string &amp;pTexture=&quot;&quot;,bool pShadow=true);
   MeshData(const VertexArray &amp;va,const std::string &amp;pTexture,bool pShadow=true);
-  ~MeshData();
+  ~MeshData() throw();
 
   void draw(const AGVector4 &amp;pColor);
   void drawShadow();

Modified: antargis/trunk/ext/3dengine/mesh_optimizer.cc
===================================================================
--- antargis/trunk/ext/3dengine/mesh_optimizer.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/mesh_optimizer.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,5 @@
 #include &quot;mesh_optimizer.h&quot;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &lt;ag_serial.h&gt;
 
 //////////////////////////////////////////////////////////////////////
@@ -18,12 +18,12 @@
     if(c[i]&lt;p.c[i])
       return true;
 
-  for(i=0;i&lt;3;i++) 
-    if(n[i]&lt;p.n[i]) 
-      return true; 
+  for(i=0;i&lt;3;i++)
+    if(n[i]&lt;p.n[i])
+      return true;
 
   for(i=0;i&lt;2;i++)
-    if(t[i]&lt;p.t[i]) 
+    if(t[i]&lt;p.t[i])
       return true;
 
   return false;
@@ -99,7 +99,7 @@
     for(size_t i=0;i&lt;mIndices.size();i+=3)
       {
         tris.push_back(MeshTriangle(mIndices[i],mIndices[i+1],mIndices[i+2]));
-      }  
+      }
     sort(tris.begin(),tris.end(),TriCompare(this,AGVector3(0,-10,10)));
 
     for(std::vector&lt;MeshTriangle&gt;::iterator i=tris.begin();i!=tris.end();i++)

Modified: antargis/trunk/ext/3dengine/quadtree.h
===================================================================
--- antargis/trunk/ext/3dengine/quadtree.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/quadtree.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,7 +22,7 @@
 #define QUADTREE_H
 
 #include &lt;ag_geometry.h&gt;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 
 #include &lt;set&gt;
 

Modified: antargis/trunk/ext/3dengine/scene.cc
===================================================================
--- antargis/trunk/ext/3dengine/scene.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -2,10 +2,8 @@
 #include &quot;scene.h&quot;
 
 #include &lt;SDL_opengl.h&gt;
-//#include &lt;GL/gl.h&gt;
-//#include &lt;GL/glu.h&gt;
 
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &lt;ag_vdebug.h&gt;
 #include &lt;ag_video.h&gt;
 #include &lt;ag_rendercontext.h&gt;
@@ -45,7 +43,7 @@
   }
 
 
-Scene::~Scene()
+Scene::~Scene() throw()
   {
   }
 
@@ -254,7 +252,7 @@
         glNewList(displayList,GL_COMPILE);
 #endif
 
-        STACKTRACE; 
+        STACKTRACE;
 
         // this is used for frustum cullin
         AntFrustum cFrustum=mCamera.getCameraProjection().getFrustum();
@@ -441,7 +439,7 @@
 
     ptr = (GLuint *) buffer;
     minZ = 0xffffffff;
-    for (i = 0; i &lt; (unsigned int)hits; i++) { 
+    for (i = 0; i &lt; (unsigned int)hits; i++) {
       names = *ptr;
       ptr++;
       if (*ptr &lt; minZ) {

Modified: antargis/trunk/ext/3dengine/scene.h
===================================================================
--- antargis/trunk/ext/3dengine/scene.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -45,7 +45,7 @@
   ////  typedef std::list&lt;SceneNode*&gt; NodeList;
 
   Scene(int w,int h);
-  virtual ~Scene();
+  virtual ~Scene() throw();
 
   void draw();
 

Modified: antargis/trunk/ext/3dengine/scene_2d.cc
===================================================================
--- antargis/trunk/ext/3dengine/scene_2d.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene_2d.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,14 +3,14 @@
 #include &quot;scene_2d.h&quot;
 #include &quot;mesh_2d.h&quot;
 #include &quot;mesh_sort.h&quot;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 
 Scene2D::Scene2D(int w,int h):
   SceneBase(w,h),mPainter(0)
   {
   }
 
-Scene2D::~Scene2D()
+Scene2D::~Scene2D() throw()
   {
   }
 

Modified: antargis/trunk/ext/3dengine/scene_2d.h
===================================================================
--- antargis/trunk/ext/3dengine/scene_2d.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene_2d.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -12,7 +12,7 @@
   typedef std::list&lt;SceneNode*&gt; NodeList;
 
   Scene2D(int w,int h);
-  virtual ~Scene2D();
+  virtual ~Scene2D() throw();
 
   void draw();
 

Modified: antargis/trunk/ext/3dengine/scene_base.cc
===================================================================
--- antargis/trunk/ext/3dengine/scene_base.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene_base.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -11,7 +11,7 @@
   }
 
 
-SceneBase::~SceneBase()
+SceneBase::~SceneBase() throw()
   {
     // tell nodes, that I'm no longer there :-)
     for(Nodes::iterator i=mNodes.begin();i!=mNodes.end();i++)
@@ -74,7 +74,7 @@
       }
   }
 
-void SceneBase::clear()
+void SceneBase::clear() throw()
   {
     for(std::vector&lt;SceneNode*&gt;::iterator i=mNodes.begin();i!=mNodes.end();i++)
       {
@@ -121,7 +121,7 @@
   return mCamera.getHeight();
 }
 
-void SceneBase::mark()
+void SceneBase::mark() throw()
   {
     //  std::cout&lt;&lt;&quot;SceneBase::mark()&quot;&lt;&lt;std::endl;
     SceneBase::Nodes::iterator i=mNodes.begin();

Modified: antargis/trunk/ext/3dengine/scene_base.h
===================================================================
--- antargis/trunk/ext/3dengine/scene_base.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scene_base.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -35,7 +35,7 @@
   //
 
   SceneBase(int w,int h);
-  virtual ~SceneBase();
+  virtual ~SceneBase() throw();
 
 //  void draw();
 
@@ -46,7 +46,7 @@
   void prepareUpdate(SceneNode *node);
   void updatePos(SceneNode *node);
 
-  void clear();
+  void clear() throw();
 
   // (mx,my,0)
   void setCamera(AGVector4 v);
@@ -69,7 +69,7 @@
   float width() const;
   float height() const;
 
-  void mark();
+  void mark() throw();
 
 
   /** get currently visible nodes */

Modified: antargis/trunk/ext/3dengine/scenenode.cc
===================================================================
--- antargis/trunk/ext/3dengine/scenenode.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scenenode.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include &quot;scenenode.h&quot;
 #include &quot;scene.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 
 SceneNode::SceneNode(SceneBase *s,const AGVector4 &amp;pPos,const AGBox3 &amp;b):
   mPos(pPos),mBBox(b)
@@ -14,7 +14,7 @@
     mScene-&gt;addNode(this);
 }
 
-SceneNode::~SceneNode()
+SceneNode::~SceneNode() throw()
 {
   if(mScene)
     mScene-&gt;removeNode(this);
@@ -35,7 +35,7 @@
   mScene=0;
 }
 
-/// this function is deprecated. It was once used for drawing 
+/// this function is deprecated. It was once used for drawing
 /// shadow in a 3rd render-pass.
 void SceneNode::drawShadow()
 {
@@ -120,7 +120,7 @@
 }
 
 
-void SceneNode::clear()
+void SceneNode::clear() throw()
 {
   //  cdebug(typeid(*this).name());
   if(mScene)

Modified: antargis/trunk/ext/3dengine/scenenode.h
===================================================================
--- antargis/trunk/ext/3dengine/scenenode.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/3dengine/scenenode.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,8 +3,9 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
+#include &lt;rk_rubyobj.h&gt;
+
 #include &lt;ag_geometry.h&gt;
-#include &lt;ag_rubyobj.h&gt;
 
 class SceneBase;
 
@@ -25,7 +26,7 @@
    A scenenode is created for exactly one scene and it can't be
    assigned to any other scene, which shouldn't be necessary.
 
-   Scene and SceneNode give each other information about their 
+   Scene and SceneNode give each other information about their
    &quot;destroy-state&quot;. That means the destructor notifies the other object.
 
 */
@@ -33,7 +34,7 @@
 {
  public:
   SceneNode(SceneBase *s,const AGVector4 &amp;pPos,const AGBox3 &amp;pBox);
-  virtual ~SceneNode();
+  virtual ~SceneNode() throw();
 
   /// reset my scene pointer - should not be called in &quot;normal&quot; code - only by the Scene-object
   virtual void resetScene();
@@ -68,7 +69,7 @@
   AGBox3 bbox() const;
   AGRect2 getRect() const;
 
-  virtual void clear();
+  virtual void clear() throw();
 
   SceneBase *getScene();
   /// this checks, if the current object is inserted into a scene
@@ -80,7 +81,7 @@
   /// there is a drawing order, used by the scene-manager, which priorized. look at Scene::drawScene for more info.
   void setOrder(int o);
   int getOrder() const;
-  
+
  private:
   void setScene(SceneBase *pScene);
 

Modified: antargis/trunk/ext/basic/ag_collector.cc
===================================================================
--- antargis/trunk/ext/basic/ag_collector.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_collector.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,7 +1,12 @@
 #include &lt;ag_collector.h&gt;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &lt;ag_main.h&gt;
 
+AGCollector::~AGCollector() throw()
+  {
+
+  }
+
 void AGCollector::insertGlobal(AGRubyObject *pObject)
   {
     // cdebug(pObject&lt;&lt;&quot;:&quot;&lt;&lt;typeid(*pObject).name());
@@ -14,7 +19,7 @@
     mGlobals.erase(pObject);
   }
 
-void AGCollector::mark()
+void AGCollector::mark() throw()
   {
     for(std::set&lt;AGRubyObject*&gt;::iterator i=mGlobals.begin();i!=mGlobals.end();i++)
       {

Modified: antargis/trunk/ext/basic/ag_collector.h
===================================================================
--- antargis/trunk/ext/basic/ag_collector.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_collector.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,21 +1,22 @@
 #ifndef AG_COLLECTOR_H
 #define AG_COLLECTOR_H
 
-#include &lt;ag_base.h&gt;
-#include &lt;ag_rubyobj.h&gt;
+#include &lt;rk_base.h&gt;
+#include &lt;rk_rubyobj.h&gt;
 
 #include &lt;set&gt;
 
 class AGEXPORT AGCollector:public AGRubyObject
 {
  public:
+   ~AGCollector() throw();
   void insertGlobal(AGRubyObject *pObject);
   void removeGlobal(AGRubyObject *pObject);
 
-  virtual void mark();
+  virtual void mark() throw ();
  private:
   std::set&lt;AGRubyObject*&gt; mGlobals;
-  
+
 };
 
 AGEXPORT AGCollector *getCollector();

Modified: antargis/trunk/ext/basic/ag_config.cc
===================================================================
--- antargis/trunk/ext/basic/ag_config.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_config.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,6 @@
 #include &quot;ag_config.h&quot;
 #include &quot;ag_xml.h&quot;
+#include &quot;ag_fs.h&quot;
 
 // TODO: AGConfig should switch to a ruby-based configuration (maybe YAML)
 // TODO: commenting should be possible !! (no overwriting)

Modified: antargis/trunk/ext/basic/ag_config.h
===================================================================
--- antargis/trunk/ext/basic/ag_config.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_config.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,8 +23,9 @@
 #ifndef AG_CONFIG_H
 #define AG_CONFIG_H
 
+#include &lt;rk_string.h&gt;
+
 #include &lt;map&gt;
-#include &lt;ag_string.h&gt;
 
 class AGEXPORT AGConfig
 {

Deleted: antargis/trunk/ext/basic/ag_debug.cc
===================================================================
--- antargis/trunk/ext/basic/ag_debug.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_debug.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,141 +0,0 @@
-/*
- * Copyright (c) 2005 by David Kamphausen. All rights reserved.
- *
- * ag_debug.cc
- * by David Kamphausen (<A HREF="https://lists.berlios.de/mailman/listinfo/antargis-svn">david.kamphausen at web.de</A>)
- *
- * The &quot;Antargis&quot; project, including all files needed to compile it,
- * is free software; you can redistribute it and/or use it and/or modify it
- * under the terms of the GNU General Public License as published
- * by the Free Software Foundation; either version 2 of the License,
- * or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
- *
- * You should have received a copy of the GNU General Public
- * License along with this program.
- */
-
-#include &quot;ag_debug.h&quot;
-#include &quot;ag_main.h&quot;
-
-#include &lt;fstream&gt;
-#include &lt;iostream&gt;
-
-#ifdef __WIN32__
-#include &lt;winsock2.h&gt;
-#endif
-#include &lt;ruby.h&gt;
-#include &lt;SDL.h&gt;
-
-bool quietLog=false;
-void setQuiet()
-  {
-    quietLog=true;
-  }
-
-static bool gRubyRaising=false;
-void agRaise(const std::string &amp;s)
-  {
-    cdebug(&quot;assertion failed:&quot;&lt;&lt;s);
-    if(gRubyRaising)
-      rb_raise(rb_eRuntimeError,s.c_str(),&quot;&quot;);
-    else
-      throw std::runtime_error(s);
-  }
-
-void setRubyRaising(bool flag)
-  {
-    gRubyRaising=flag;
-  }
-
-size_t gDebugLevel=0;
-
-size_t getDebugLevel()
-  {
-    return gDebugLevel;
-  }
-void setDebugLevel(size_t t)
-  {
-    gDebugLevel=t;
-  }
-
-
-#ifndef MNDEBUG
-int D::d=0;
-
-std::ofstream debugOFS(&quot;debug.txt&quot;);
-
-std::ostream &amp;getDebug()
-  {
-    if(quietLog)
-      return debugOFS;
-    else
-      return std::cout;
-  }
-
-size_t gDebugIndex=0;
-
-size_t getDebugIndex()
-  {
-    return gDebugIndex;
-  }
-
-
-
-D::D(std::string c):
-  m(c)
-  {
-    indent();
-    gDebugIndex++;
-
-    debugout_checked(2,&quot;start of:&quot;&lt;&lt;c&lt;&lt;&quot;(&quot;&lt;&lt;gDebugIndex&lt;&lt;&quot;)&quot;&lt;&lt;std::endl);
-    d++;
-  }
-AGEXPORT D::~D()
-  {
-    d--;
-    indent();
-    debugout_checked(2,&quot;end   of:&quot;&lt;&lt;m&lt;&lt;std::endl);
-  }
-void D::indent()
-  {
-    for(int i=0;i&lt;d;i++)
-      debugout_checked(2,&quot;  &quot;);
-  }
-
-
-#endif
-
-#ifdef __APPLE__
-
-//#include &lt;mach-o/nlist.h&gt;
-
-#include &quot;execinfo.h&quot;
-void printStacktrace()
-  {
-    void* callstack[128];
-    int i, frames = backtrace(callstack, 128);
-    char** strs = backtrace_symbols(callstack, frames);
-    printf(&quot;FRAMES:%d\n&quot;,frames);
-    for (i = 0; i &lt; frames; ++i) {
-      printf(&quot;%s\n&quot;, strs[i]);
-    }
-    free(strs);
-    /*
-    struct nlist *nl;
-    int result=nlist(&quot;antargis.bundle&quot;,nl);
-    std::cout&lt;&lt;&quot;RESULT:&quot;&lt;&lt;result&lt;&lt;std::endl;
-*/
-  }
-
-#else
-
-void printStacktrace()
-  {
-  }
-
-#endif
-

Deleted: antargis/trunk/ext/basic/ag_debug.h
===================================================================
--- antargis/trunk/ext/basic/ag_debug.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_debug.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,121 +0,0 @@
-/*
- * Copyright (c) 2005 by David Kamphausen. All rights reserved.
- *
- * ag_debug.h
- * by David Kamphausen (<A HREF="https://lists.berlios.de/mailman/listinfo/antargis-svn">david.kamphausen at web.de</A>)
- *
- * The &quot;Antargis&quot; project, including all files needed to compile it,
- * is free software; you can redistribute it and/or use it and/or modify it
- * under the terms of the GNU General Public License as published
- * by the Free Software Foundation; either version 2 of the License,
- * or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
- *
- * You should have received a copy of the GNU General Public
- * License along with this program.
- */
-
-#ifndef AG_DEBUG_h
-#define AG_DEBUG_h
-#include &lt;stdexcept&gt;
-#include &lt;iostream&gt;
-#include &lt;fstream&gt;
-#include &lt;assert.h&gt;
-#include &lt;sstream&gt;
-#include &lt;string&gt;
-#include &lt;vector&gt;
-//#include &quot;ag_gl.h&quot;
-
-#include &quot;ag_exception.h&quot;
-#include &quot;ag_tools.h&quot;
-#include &quot;ag_base.h&quot;
-
-
-AGEXPORT void setQuiet();
-
-#ifdef MNDEBUG
-#define dbout(x,l)
-#define cdebug(x)
-#define ccdebug(x)
-#define debug(x)
-#define TRACE
-#define CTRACE
-#define CHECK_ZERO(x)
-#define STUB
-//#define assertGL
-
-#else
-
-std::ostream &amp; AGEXPORT getDebug();
-
-#define debug(c) mydebug(::toString(__FILE__),::toString(__LINE__),c)
-
-template&lt;class T&gt;
-inline void mydebug(std::string f,std::string l,const T&amp;t)
-{
-  getDebug()&lt;&lt;&quot;File &quot;&lt;&lt;f&lt;&lt;&quot; Line &quot;&lt;&lt;l&lt;&lt;&quot; : &quot;&lt;&lt;t&lt;&lt;std::endl;
-}
-
-
-using std::endl;
-
-#define debugout(x) getDebug()&lt;&lt;x
-
-#define cdebug(x) debugout(&quot;(&quot;&lt;&lt;__FILE__&lt;&lt;&quot;:&quot;&lt;&lt;__LINE__&lt;&lt;&quot;:&quot;&lt;&lt;__PRETTY_FUNCTION__&lt;&lt;&quot;):&quot;&lt;&lt;x&lt;&lt;endl)
-#define ccdebug(x) debugout(&quot;(&quot;&lt;&lt;__FILE__&lt;&lt;&quot;:&quot;&lt;&lt;__LINE__&lt;&lt;&quot;:&quot;&lt;&lt;__PRETTY_FUNCTION__&lt;&lt;&quot;:&quot;&lt;&lt;((void*)this)&lt;&lt;&quot;):&quot;&lt;&lt;x&lt;&lt;endl)
-
-AGEXPORT size_t getDebugIndex();
-AGEXPORT size_t getDebugLevel();
-AGEXPORT void setDebugLevel(size_t t);
-
-#define debugout_checked(level,x) { if(level&gt;getDebugLevel()) { getDebug()&lt;&lt;x; }}
-#define dbout(level,x) {if(level&gt;getDebugLevel()) { cdebug(x); }}
-
-/** A helper class for tracing the program's flow
-    Use it by instantiating it with a proper name, or simply use TRACE; (or CTRACE for classes) in your functions */
-class AGEXPORT D
-{
-  std::string m;
-  static int d;
-
- public:
-  /// the given text will be output on creation and deletion of this object
-  D(std::string text);
-  ~D();
-private:
-  void indent();
-};
-
-#define LINEINFO(x) (::toString(__FILE__)+::toString(&quot; &quot;)+::toString(__LINE__)+::toString(&quot; &quot;)+::toString( __PRETTY_FUNCTION__)+::toString(&quot; &quot;)+::toString(x)).c_str()
-
-#define TRACE D test__LINE__(::toString(__FILE__)+::toString(&quot; &quot;)+::toString(__LINE__)+::toString(&quot; &quot;)+::toString( __PRETTY_FUNCTION__))
-#define CTRACE D test__LINE__(::toString(__FILE__)+::toString(&quot; &quot;)+::toString(__LINE__)+::toString(&quot; &quot;)+::toString( __PRETTY_FUNCTION__)+::toString(&quot; &quot;)+::toString(((void*)this))+::toString(&quot; &quot;)+typeid(*this).name())
-
-AGEXPORT void agRaise(const std::string &amp;s);
-
-#ifndef __WIN32__
-#undef assert
-#define assert(x) {if(!(x)) agRaise((::toString(&quot;assert failed &quot;)+LINEINFO(__STRING(x))).c_str()); }
-#endif
-
-#define Assert(x) assert(x)
-
-#define STUB cdebug(&quot;STUB in File &quot;&lt;&lt;__FILE__&lt;&lt;&quot; line:&quot;&lt;&lt;__LINE__&lt;&lt;&quot; function:&quot;&lt;&lt;__PRETTY_FUNCTION__)
-
-#ifdef __WIN32__
-#define CHECK_ZERO(x) assert(x);
-#else
-#define CHECK_ZERO(x) if(!x) throw AGException(std::string(__STRING(x))+&quot; is zero in &quot;+__FILE__+&quot; line:&quot;+toString(__LINE__)+&quot; functin:&quot;+__PRETTY_FUNCTION__);
-#endif
-
-
-#endif
-
-void setRubyRaising(bool flag);
-void printStacktrace();
-
-
-#endif

Deleted: antargis/trunk/ext/basic/ag_exception.h
===================================================================
--- antargis/trunk/ext/basic/ag_exception.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_exception.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,47 +0,0 @@
-/*
- * Copyright (c) 2005 by David Kamphausen. All rights reserved.
- *
- * ag_exception.h
- * by David Kamphausen (<A HREF="https://lists.berlios.de/mailman/listinfo/antargis-svn">david.kamphausen at web.de</A>)
- *
- * The &quot;Antargis&quot; project, including all files needed to compile it,
- * is free software; you can redistribute it and/or use it and/or modify it
- * under the terms of the GNU General Public License as published
- * by the Free Software Foundation; either version 2 of the License,
- * or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
- *
- * You should have received a copy of the GNU General Public
- * License along with this program.
- */
-
-#ifndef __ANTARGISGUI_EXCEPTION_H__
-#define __ANTARGISGUI_EXCEPTION_H__
-
-#include &lt;ag_base.h&gt;
-#include &lt;stdexcept&gt;
-
-class AGEXPORT AGException:public std::exception
-{
-public:
-  AGException(const std::string &amp;e):s(e)
-  {
-  }
-
-  virtual ~AGException() throw ()
-  {
-  }
-
-  const char*what() const throw()
-  {
-    return s.c_str();
-  }
-
-private:
-  std::string s;
-};
-
-#endif

Modified: antargis/trunk/ext/basic/ag_fs.cc
===================================================================
--- antargis/trunk/ext/basic/ag_fs.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_fs.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -29,16 +29,16 @@
 #include &lt;dirent.h&gt;
 #include &lt;errno.h&gt;
 #include &lt;sys/stat.h&gt;
+
 #ifdef WIN32
 #include &lt;windows.h&gt;
 #include &lt;shlobj.h&gt;
-//#include &lt;strsafe.h&gt;
-
 #endif
 
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
+#include &quot;rk_tools.h&quot;
+
 #include &quot;ag_main.h&quot;
-#include &quot;ag_tools.h&quot;
 #include &quot;ag_serial.h&quot;
 #include &lt;zlib.h&gt;
 
@@ -149,7 +149,7 @@
         {
         case EEXIST:
           return; // everything's fine - directory exists already;
-        case EACCES: 
+        case EACCES:
           return; // probably exists - we don't have access
         default:
           dbout(0,&quot;could not create dir:&quot;&lt;&lt;s);
@@ -611,6 +611,6 @@
   {
     std::vector&lt;AGString&gt; a;
     std::copy(gFilesystemPathes.begin(),gFilesystemPathes.end(),std::back_inserter(a));
-    
+
     return a;
   }

Modified: antargis/trunk/ext/basic/ag_fs.h
===================================================================
--- antargis/trunk/ext/basic/ag_fs.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_fs.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,11 +23,11 @@
 #ifndef __FS_H
 #define __FS_H
 
-#include &lt;ag_string.h&gt;
+#include &lt;rk_string.h&gt;
+#include &lt;rk_base.h&gt;
+
 #include &lt;vector&gt;
 
-#include &lt;ag_base.h&gt;
-
 struct FileNotFound
   {
     FileNotFound(const std::string &amp;f):filename(f){}

Modified: antargis/trunk/ext/basic/ag_geometry.cc
===================================================================
--- antargis/trunk/ext/basic/ag_geometry.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_geometry.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,15 +19,14 @@
  */
 
 #include &lt;ag_geometry.h&gt;
-#include &lt;ag_tools.h&gt;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_tools.h&gt;
+#include &lt;rk_debug.h&gt;
+
 #include &lt;assert.h&gt;
 #include &lt;cmath&gt;
 #include &lt;map&gt;
 #include &lt;list&gt;
-#include &lt;ag_tools.h&gt;
 #include &lt;ag_xml.h&gt;
-#include &lt;ag_debug.h&gt;
 #include &lt;ag_stringstream.h&gt;
 #include &lt;ag_gauss.h&gt;
 
@@ -1460,19 +1459,19 @@
 std::vector&lt;AGRect2&gt; AGRect2::tile(size_t x,size_t y) const
 {
   std::vector&lt;AGRect2&gt; l;
-  
+
   if(x==0 || y==0)
   return l;
-  
+
   float w=width()/x;
   float h=height()/y;
-  
+
   for(size_t i=0;i&lt;x;i++)
     for(size_t j=0;j&lt;y;j++)
       {
         l.push_back(AGRect2(x0()+w*i,y0()+h*j,w,h));
       }
-  
+
   return l;
 }
 
@@ -1770,7 +1769,7 @@
 
       if(m == lm)
         return AGVector2(0,0); // parallel
-      float x=(lb-b)/(m-lm); 
+      float x=(lb-b)/(m-lm);
       p=AGVector2(x,m*x+b);
     }
   return p;

Modified: antargis/trunk/ext/basic/ag_geometry.h
===================================================================
--- antargis/trunk/ext/basic/ag_geometry.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_geometry.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -27,8 +27,8 @@
 #include &lt;iostream&gt;
 #include &lt;list&gt;
 #include &lt;vector&gt;
-#include &lt;ag_base.h&gt;
-#include &lt;ag_string.h&gt;
+#include &lt;rk_base.h&gt;
+#include &lt;rk_string.h&gt;
 #include &lt;stdexcept&gt;
 
 /* There are following classes:
@@ -54,38 +54,36 @@
 
 /** \brief Simple structure holding an angle in degrees
  */
-struct AGEXPORT AGAngle
-  {
+struct AGEXPORT AGAngle {
     float angle;
 
     /// @param an angle in degrees
     explicit AGAngle(float a);
-  };
+};
 
-class GeometryException
-  {
-    public:
-      GeometryException(const std::string &amp;p):s(p)
-    {}
+class GeometryException {
+public:
+
+    GeometryException(const std::string &amp;p) : s(p) {
+    }
 #ifdef SWIG
-      %rename(to_s) what() const;
+    %rename(to_s) what() const;
 #endif
-      std::string what() const
-      {
+
+    std::string what() const {
         return s;
-      }
-      
-    private:
-      std::string s;
-  };
+    }
 
-class AGEXPORT AGVector2
-  {
-  public:
+private:
+    std::string s;
+};
+
+class AGEXPORT AGVector2 {
+public:
     float v[2];
 
     AGVector2(const AGString &amp;s);
-    AGVector2(float pX,float pY);
+    AGVector2(float pX, float pY);
     AGVector2(const AGAngle &amp;a);
     AGVector2(const AGVector2 &amp;a);
     AGVector2();
@@ -111,12 +109,12 @@
     AGVector2 operator-() const;
     AGVector2 operator-(const AGVector2 &amp;p) const;
     AGVector2 operator+(const AGVector2 &amp;p) const;
-    AGVector2 &amp;operator+=(const AGVector2 &amp;p);
-    AGVector2 &amp;operator-=(const AGVector2 &amp;p);
+    AGVector2 &amp; operator+=(const AGVector2 &amp;p);
+    AGVector2 &amp; operator-=(const AGVector2 &amp;p);
 
     float operator*(const AGVector2 &amp;p) const;
-    AGVector2 &amp;operator*=(float f);
-    AGVector2 &amp;operator/=(float f);
+    AGVector2 &amp; operator*=(float f);
+    AGVector2 &amp; operator/=(float f);
     AGVector2 operator*(float f) const;
     AGVector2 operator/(float f) const;
 
@@ -148,19 +146,19 @@
     AGString toString() const;
 
 #ifndef SWIG
-    (operator float*)();
-    (operator const float*)() const;
+    (operator float*) ();
+    (operator const float*) () const;
 #endif
-  };
+};
 
 // 2-dim homogenous vector
-class AGEXPORT AGVector3
-  {
-  public:
+
+class AGEXPORT AGVector3 {
+public:
     float v[3];
 
-    AGVector3(const AGVector2 &amp;p,float h=1.0f);
-    AGVector3(float pX,float pY,float pZ=0.0f);
+    AGVector3(const AGVector2 &amp;p, float h = 1.0f);
+    AGVector3(float pX, float pY, float pZ = 0.0f);
     AGVector3(const AGAngle &amp;a);
     AGVector3(const AGVector3 &amp;a);
     AGVector3();
@@ -189,12 +187,12 @@
     %rename(add) operator+=(const AGVector3 &amp;p);
     %rename(sub) operator-=(const AGVector3 &amp;p);
 #endif
-    AGVector3 &amp;operator+=(const AGVector3 &amp;p);
-    AGVector3 &amp;operator-=(const AGVector3 &amp;p);
+    AGVector3 &amp; operator+=(const AGVector3 &amp;p);
+    AGVector3 &amp; operator-=(const AGVector3 &amp;p);
 
     float operator*(const AGVector3 &amp;p) const;
-    AGVector3 &amp;operator*=(float f);
-    AGVector3 &amp;operator/=(float f);
+    AGVector3 &amp; operator*=(float f);
+    AGVector3 &amp; operator/=(float f);
     AGVector3 operator*(float f) const;
     AGVector3 operator/(float f) const;
     AGVector3 operator%(const AGVector3 &amp;a) const;
@@ -226,41 +224,38 @@
     AGString toString() const;
 
 #ifndef SWIG
-    (operator float*)();
+    (operator float*) ();
 #endif
-  };
+};
 
-
-class AGEXPORT AGMatrix3
-  {
+class AGEXPORT AGMatrix3 {
     float a[3][3];
-  public:
-    struct Row
-      {
+public:
+
+    struct Row {
         AGMatrix3 *matrix;
         int y;
 
-        float &amp;operator[](size_t x)
-        {
-          return matrix-&gt;get(x,y);
+        float &amp;operator[](size_t x) {
+            return matrix-&gt;get(x, y);
         }
-        float operator[](size_t x) const
-        {
-          return matrix-&gt;get(x,y);
+
+        float operator[](size_t x) const {
+            return matrix-&gt;get(x, y);
         }
-      };
+    };
 
     AGMatrix3();
     AGMatrix3(const AGAngle &amp;a); // rotate
     AGMatrix3(const AGVector3 &amp;a); // transpose
-    AGMatrix3(float x,float y); // scale
+    AGMatrix3(float x, float y); // scale
     AGMatrix3(const AGMatrix3 &amp;m);
-    void set(size_t x,size_t y,float f);
-    float get(size_t x,size_t y) const;
-    float &amp;get(size_t x,size_t y);
+    void set(size_t x, size_t y, float f);
+    float get(size_t x, size_t y) const;
+    float &amp;get(size_t x, size_t y);
 
     AGMatrix3 operator*(const AGMatrix3 &amp;m) const;
-    AGMatrix3 &amp;operator*=(const AGMatrix3 &amp;m);
+    AGMatrix3 &amp; operator*=(const AGMatrix3 &amp;m);
 
     AGVector3 operator*(const AGVector3 &amp;v) const;
     //  AGVector2 operator*(const AGVector2 &amp;v) const;
@@ -273,8 +268,8 @@
     Row operator[](size_t y);
     const Row operator[](size_t y) const;
 
-    void swapRows(size_t a,size_t b);
-    void swapCols(size_t a,size_t b);
+    void swapRows(size_t a, size_t b);
+    void swapCols(size_t a, size_t b);
 
     bool operator==(const AGMatrix3&amp;p) const;
 
@@ -283,14 +278,13 @@
     %rename(to_s) toString() const;
 #endif
     AGString toString() const;
-  };
+};
 
-class AGEXPORT AGLine2
-  {
-    AGVector2 v0,v1;
-  public:
+class AGEXPORT AGLine2 {
+    AGVector2 v0, v1;
+public:
     AGLine2();
-    AGLine2(const AGVector2 &amp;pv0,const AGVector2 &amp;pv1);
+    AGLine2(const AGVector2 &amp;pv0, const AGVector2 &amp;pv1);
 
     AGVector2 getV0() const;
     AGVector2 getV1() const;
@@ -309,21 +303,20 @@
 
     float distance(const AGVector2 &amp;v) const;
 
-    AGVector2 &amp;operator[](size_t i);
+    AGVector2 &amp; operator[](size_t i);
     AGVector2 operator[](size_t i) const;
 
 #ifdef SWIG
     %rename(to_s) toString() const;
 #endif
     AGString toString() const;
-  };
+};
 
-class AGEXPORT AGLine3
-  {
-    AGVector3 v0,v1;
-  public:
+class AGEXPORT AGLine3 {
+    AGVector3 v0, v1;
+public:
     AGLine3();
-    AGLine3(const AGVector3 &amp;pv0,const AGVector3 &amp;pv1);
+    AGLine3(const AGVector3 &amp;pv0, const AGVector3 &amp;pv1);
 
     AGVector3 getV0() const;
     AGVector3 getV1() const;
@@ -348,20 +341,18 @@
     %rename(to_s) toString() const;
 #endif
     AGString toString() const;
-  };
+};
 
-class AGEXPORT AGCollisionData
-  {
-  };
+class AGEXPORT AGCollisionData {
+};
 
 class AGRect2;
 
-class AGEXPORT AGTriangle2
-  {
+class AGEXPORT AGTriangle2 {
     AGVector2 p[3];
-  public:
+public:
     AGTriangle2();
-    AGTriangle2(const AGVector2 &amp;v0,const AGVector2 &amp;v1,const AGVector2 &amp;v2);
+    AGTriangle2(const AGVector2 &amp;v0, const AGVector2 &amp;v1, const AGVector2 &amp;v2);
 
     AGVector2 operator[](int index) const;
 
@@ -390,20 +381,19 @@
     AGLine2 nearestLine(const AGVector2 &amp;v) const;
 
     std::vector&lt;AGLine2&gt; getLines() const;
-    
+
     void flip();
 #ifdef SWIG
     %rename(to_s) toString() const;
 #endif
     AGString toString() const;
-  };
+};
 
-class AGEXPORT AGCircle2
-  {
+class AGEXPORT AGCircle2 {
     AGVector2 p;
     float radius;
-  public:
-    AGCircle2(const AGVector2 &amp;v,float rad);
+public:
+    AGCircle2(const AGVector2 &amp;v, float rad);
 
     bool inCircle(const AGTriangle2 &amp;t) const;
     bool outCircle(const AGTriangle2 &amp;t) const;
@@ -414,16 +404,16 @@
     float getRadius() const;
 
     std::list&lt;AGVector2&gt; collide(const AGLine2 &amp;pLine) const;
-  };
+};
 
 class AGVector4;
-class AGEXPORT AGTriangle3
-  {
+
+class AGEXPORT AGTriangle3 {
     AGVector3 p[3];
-  public:
-    AGTriangle3(const AGVector3 &amp;v0,const AGVector3 &amp;v1,const AGVector3 &amp;v2);
+public:
+    AGTriangle3(const AGVector3 &amp;v0, const AGVector3 &amp;v1, const AGVector3 &amp;v2);
 
-    // (x,y,z,0) for no collision 
+    // (x,y,z,0) for no collision
     // (x,y,z,1) for collision in point (x,y,z)
     AGVector4 collide(const AGLine3 &amp;pLine) const;
 #ifdef SWIG
@@ -433,17 +423,16 @@
     AGString toString() const;
 
     AGVector3 operator[](int index) const;
-    
+
     void flip();
-  };
+};
 
-class AGEXPORT AGRect2
-  {
-    AGVector2 v0,v1;
-  public:
+class AGEXPORT AGRect2 {
+    AGVector2 v0, v1;
+public:
     AGRect2();
-    AGRect2(const AGVector2 &amp;pv0,const AGVector2 &amp;pv1);
-    AGRect2(float x,float y,float w,float h);
+    AGRect2(const AGVector2 &amp;pv0, const AGVector2 &amp;pv1);
+    AGRect2(float x, float y, float w, float h);
     AGRect2(const AGString &amp;ps);
     AGRect2(const SDL_Rect &amp;r);
 
@@ -453,10 +442,10 @@
 
     AGRect2 operator+(const AGVector2 &amp;v) const;
     AGRect2 operator-(const AGVector2 &amp;v) const;
-    AGRect2 &amp;operator+=(const AGVector2 &amp;v);
-    AGRect2 &amp;operator-=(const AGVector2 &amp;v);
+    AGRect2 &amp; operator+=(const AGVector2 &amp;v);
+    AGRect2 &amp; operator-=(const AGVector2 &amp;v);
 
-    AGRect2&amp; operator+=(const AGRect2 &amp;r);
+    AGRect2 &amp; operator+=(const AGRect2 &amp;r);
 
     bool contains(const AGVector2 &amp;v) const;
     bool contains(const AGRect2 &amp;v) const;
@@ -464,7 +453,7 @@
     std::list&lt;AGRect2&gt; split() const;
 
     AGVector2 operator[](size_t i) const;
-    AGVector2 &amp;operator[](size_t i);
+    AGVector2 &amp; operator[](size_t i);
 
     AGVector2 getV0() const;
     AGVector2 getV1() const;
@@ -474,15 +463,15 @@
     AGVector2 getMiddle() const;
 
     AGRect2 shrink(float f) const;
-    AGRect2 shrink(float w,float h) const;
-    AGRect2 shrinkToTopLeft(float w,float h) const;
+    AGRect2 shrink(float w, float h) const;
+    AGRect2 shrinkToTopLeft(float w, float h) const;
     AGRect2 grow(float f) const;
 
     void setX(float p);
     void setY(float p);
 
     void setLeft(float p); // attention - modifies right, too
-    void setTop(float p);  // attention - modifies bottom, too
+    void setTop(float p); // attention - modifies bottom, too
 
     void setRight(float p);
     void setBottom(float p);
@@ -511,12 +500,14 @@
 
     //result=this-r
     std::vector&lt;AGRect2&gt; difference(const AGRect2 &amp;r) const;
-    std::vector&lt;AGRect2&gt; tile(size_t x,size_t y) const;
+    std::vector&lt;AGRect2&gt; tile(size_t x, size_t y) const;
 
     SDL_Rect sdl() const;
 
     bool operator==(const AGRect2 &amp;r) const;
+#ifndef SWIG
     bool operator!=(const AGRect2 &amp;r) const;
+#endif
 
     void check() const;
 
@@ -528,17 +519,15 @@
     %rename(to_s) toString() const;
 #endif
     AGString toString() const;
-  };
+};
 
-
-class AGEXPORT AGVector4
-  {
-  public:
+class AGEXPORT AGVector4 {
+public:
     float v[4];
 
-    AGVector4(float pX,float pY,float pZ,float pW=1.0f);
+    AGVector4(float pX, float pY, float pZ, float pW = 1.0f);
     AGVector4(const AGVector4 &amp;a);
-    AGVector4(const AGVector3 &amp;a,float h);
+    AGVector4(const AGVector3 &amp;a, float h);
     AGVector4();
 
     void setX(float pX);
@@ -564,12 +553,12 @@
     %rename(add) operator+=(const AGVector4 &amp;p);
     %rename(sub) operator-=(const AGVector4 &amp;p);
 #endif
-    AGVector4 &amp;operator+=(const AGVector4 &amp;p);
-    AGVector4 &amp;operator-=(const AGVector4 &amp;p);
+    AGVector4 &amp; operator+=(const AGVector4 &amp;p);
+    AGVector4 &amp; operator-=(const AGVector4 &amp;p);
 
     float operator*(const AGVector4 &amp;p) const;
-    AGVector4 &amp;operator*=(float f);
-    AGVector4 &amp;operator/=(float f);
+    AGVector4 &amp; operator*=(float f);
+    AGVector4 &amp; operator/=(float f);
     AGVector4 operator*(float f) const;
     AGVector4 operator/(float f) const;
     AGVector4 operator-() const;
@@ -601,9 +590,9 @@
     // vector-cross-product
     // ignores 4th coordinate
     AGVector4 operator%(const AGVector4 &amp;a) const;
-    AGVector4 cross(const AGVector4 &amp;a) const
-    {
-      return operator%(a);
+
+    AGVector4 cross(const AGVector4 &amp;a) const {
+        return operator%(a);
     }
 
 
@@ -616,48 +605,46 @@
     AGString toString() const;
 
 #ifndef SWIG
-    (operator float*)();
-    (operator const float*)() const;
+    (operator float*) ();
+    (operator const float*) () const;
 #endif
-  };
+};
 
-class AGEXPORT AGMatrix4
-  {
+class AGEXPORT AGMatrix4 {
     float a[16];
-  public:
-    struct MRow
-      {
+public:
+
+    struct MRow {
         AGMatrix4 *matrix;
         int y;
 
-        float &amp;operator[](size_t x)
-        {
-          return matrix-&gt;get(x,y);
+        float &amp;operator[](size_t x) {
+            return matrix-&gt;get(x, y);
         }
-        float operator[](size_t x) const
-        {
-          return matrix-&gt;get(x,y);
+
+        float operator[](size_t x) const {
+            return matrix-&gt;get(x, y);
         }
-      };
+    };
 
     AGMatrix4();
     AGMatrix4(float v[16]);
-    AGMatrix4(float angle,const AGVector3 &amp;d);
+    AGMatrix4(float angle, const AGVector3 &amp;d);
     AGMatrix4(const AGVector4 &amp;a);
-    void set(size_t x,size_t y,float f);
-    float get(size_t x,size_t y) const;
-    float &amp;get(size_t x,size_t y);
+    void set(size_t x, size_t y, float f);
+    float get(size_t x, size_t y) const;
+    float &amp;get(size_t x, size_t y);
 
     AGMatrix4 operator*(const AGMatrix4 &amp;m) const;
-    AGMatrix4 &amp;operator*=(const AGMatrix4 &amp;m);
-    AGMatrix4 &amp;operator+=(const AGMatrix4 &amp;m);
+    AGMatrix4 &amp; operator*=(const AGMatrix4 &amp;m);
+    AGMatrix4 &amp; operator+=(const AGMatrix4 &amp;m);
 
-    AGMatrix3 get3x3(size_t x,size_t y) const;
+    AGMatrix3 get3x3(size_t x, size_t y) const;
 
     AGVector4 operator*(const AGVector4 &amp;v) const;
 
-    float operator()(size_t x,size_t y) const;
-    float &amp;operator()(size_t x,size_t y);
+    float operator()(size_t x, size_t y) const;
+    float &amp;operator()(size_t x, size_t y);
 
     AGMatrix4 inverted() const;
     AGMatrix4 transposed() const;
@@ -665,8 +652,8 @@
     MRow operator[](size_t y);
     //  const Row operator[](size_t y) const;
 
-    void swapRows(size_t a,size_t b);
-    void swapCols(size_t a,size_t b);
+    void swapRows(size_t a, size_t b);
+    void swapCols(size_t a, size_t b);
 
 #ifdef SWIG
     %rename(to_s) toString() const;
@@ -674,34 +661,34 @@
     AGString toString() const;
 
 #ifndef SWIG
-    (operator float*)();
-    (operator const float*)() const;
+    (operator float*) ();
+    (operator const float*) () const;
     //  (operator const double*)() const;
 #endif
 
     AGVector4 getRow(size_t i) const;
-  };
+};
 
 // axis-aligned
-class AGEXPORT AGRect3
-  {
-    AGVector3 base,dir;
-  public:
-    AGRect3(const AGVector3 &amp;pBase,const AGVector3 &amp;pDir);
 
+class AGEXPORT AGRect3 {
+    AGVector3 base, dir;
+public:
+    AGRect3(const AGVector3 &amp;pBase, const AGVector3 &amp;pDir);
+
     bool collides(const AGLine3&amp;pLine) const;
 
     AGString toString() const;
-  };
+};
 
 // axis-aligned
-class AGEXPORT AGBox3
-  {
-  public:
-    AGVector3 base,dir;
 
+class AGEXPORT AGBox3 {
+public:
+    AGVector3 base, dir;
+
     AGBox3();
-    AGBox3(const AGVector3 &amp;pBase,const AGVector3 &amp;pDir);
+    AGBox3(const AGVector3 &amp;pBase, const AGVector3 &amp;pDir);
 
     void include(const AGVector3&amp;p);
     bool includes(const AGBox3 &amp;b);
@@ -728,19 +715,19 @@
 
     bool valid() const;
 
-  private:
+private:
     bool mValid;
-  };
+};
 
 #ifndef SWIG
-AGEXPORT std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,const AGVector2&amp;v);
-AGEXPORT std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,const AGVector3&amp;v);
-AGEXPORT std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,const AGVector4&amp;v);
-AGEXPORT std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,const AGRect2&amp;v);
-AGEXPORT std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,const AGBox3&amp;v);
+AGEXPORT std::ostream &amp; operator&lt;&lt;(std::ostream &amp;o, const AGVector2&amp;v);
+AGEXPORT std::ostream &amp; operator&lt;&lt;(std::ostream &amp;o, const AGVector3&amp;v);
+AGEXPORT std::ostream &amp; operator&lt;&lt;(std::ostream &amp;o, const AGVector4&amp;v);
+AGEXPORT std::ostream &amp; operator&lt;&lt;(std::ostream &amp;o, const AGRect2&amp;v);
+AGEXPORT std::ostream &amp; operator&lt;&lt;(std::ostream &amp;o, const AGBox3&amp;v);
 
-AGEXPORT std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,const AGMatrix3&amp;v);
-AGEXPORT std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,const AGMatrix4&amp;v);
+AGEXPORT std::ostream &amp; operator&lt;&lt;(std::ostream &amp;o, const AGMatrix3&amp;v);
+AGEXPORT std::ostream &amp; operator&lt;&lt;(std::ostream &amp;o, const AGMatrix4&amp;v);
 #endif
 
 #include &quot;ag_geometry_inline.cc&quot;

Modified: antargis/trunk/ext/basic/ag_kill.cc
===================================================================
--- antargis/trunk/ext/basic/ag_kill.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_kill.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,10 +19,10 @@
  */
 
 
-// TODO: Is this still used ? 
+// TODO: Is this still used ?
 
 #include &quot;ag_kill.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 
 AGInstanceKiller *mInstanceKiller=0;
 bool mIndirectInstance=false;

Modified: antargis/trunk/ext/basic/ag_kill.h
===================================================================
--- antargis/trunk/ext/basic/ag_kill.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_kill.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,8 +21,9 @@
 #ifndef __ANT_KILL_H__
 #define __ANT_KILL_H__
 
+#include &lt;rk_base.h&gt;
+
 #include &lt;set&gt;
-#include &lt;ag_base.h&gt;
 
 class AGEXPORT AGInstanceBase
 {

Modified: antargis/trunk/ext/basic/ag_main.cc
===================================================================
--- antargis/trunk/ext/basic/ag_main.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_main.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,12 +20,12 @@
 
 #include &lt;iostream&gt;
 
-#include &quot;ag_base.h&quot;
-#include &quot;ag_debug.h&quot;
-#include &quot;ag_tools.h&quot;
+#include &quot;rk_base.h&quot;
+#include &quot;rk_debug.h&quot;
+#include &quot;rk_tools.h&quot;
+
 #include &quot;ag_main.h&quot;
 #include &quot;ag_fs.h&quot;
-#include &quot;ag_debug.h&quot;
 
 #include &lt;ruby.h&gt;
 
@@ -90,7 +90,7 @@
     mVideo=0;
   }
 
-AGMain::~AGMain()
+AGMain::~AGMain() throw()
   {
     CTRACE;
     saveDelete(mVideo);
@@ -157,7 +157,7 @@
 }
 
 
-void AGMain::mark()
+void AGMain::mark() throw()
   {
     markObject(getCollector());
     markObject(mRand);

Modified: antargis/trunk/ext/basic/ag_main.h
===================================================================
--- antargis/trunk/ext/basic/ag_main.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_main.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -24,7 +24,7 @@
 #define __AG_MAIN
 
 #include &lt;string&gt;
-#include &lt;ag_rubyobj.h&gt;
+#include &lt;rk_rubyobj.h&gt;
 #include &lt;ag_collector.h&gt;
 #include &lt;ag_rand_base.h&gt;
 #include &lt;ag_video_base.h&gt;
@@ -33,7 +33,7 @@
 /**
  * \defgroup AntargisGUI AntargisGUI
  * \brief the GUI-library of the game Battles of Antargis
- * 
+ *
  * This library consists of different mechanisms to make your life easier
  * with graphical user interfaces:
  * \see widgets
@@ -59,7 +59,7 @@
 {
  public:
   AGMain();
-  ~AGMain();
+  ~AGMain() throw ();
 
   long getTicks() const;
 
@@ -76,7 +76,7 @@
   void delay(int ms);
 
  protected:
-  virtual void mark();
+  virtual void mark() throw();
 
  private:
   AGVideoBase *mVideo;

Modified: antargis/trunk/ext/basic/ag_message.cc
===================================================================
--- antargis/trunk/ext/basic/ag_message.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_message.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,5 @@
 #include &quot;ag_message.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 
 AGMessageData::AGMessageData(size_t pID):
   mID(pID)
@@ -24,11 +24,12 @@
     assert(mMessageQueue);
     mMessageQueue-&gt;insertTransceiver(this);
   }
-AGMessageTransceiver::~AGMessageTransceiver()
+AGMessageTransceiver::~AGMessageTransceiver() throw()
   {
     if(mMessageQueue)
       mMessageQueue-&gt;eraseTransceiver(this);
   }
+
 void AGMessageTransceiver::sendMessage(const AGString &amp;pName,AGMessageData *pData)
   {
     assert(mMessageQueue);
@@ -72,7 +73,7 @@
 
 AGMessageSource::AGMessageSource(AGMessageTransceiver *pSender,const AGString &amp;pName):
   mSender(pSender),mName(pName)
-  {   
+  {
   }
 
 bool AGMessageSource::operator&lt;(const AGMessageSource &amp;pSource) const
@@ -125,7 +126,7 @@
 AGMessageQueue::AGMessageQueue():
   mMessageID(0)
   {
-    
+
   }
 
 

Modified: antargis/trunk/ext/basic/ag_message.h
===================================================================
--- antargis/trunk/ext/basic/ag_message.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_message.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,8 +3,9 @@
 #ifndef AG_MESSAGE_H_
 #define AG_MESSAGE_H_
 
-#include &lt;ag_string.h&gt;
-#include &lt;ag_rubyobj.h&gt;
+#include &lt;rk_string.h&gt;
+#include &lt;rk_rubyobj.h&gt;
+
 #include &lt;map&gt;
 #include &lt;set&gt;
 #include &lt;list&gt;
@@ -22,7 +23,7 @@
 public:
   AGMessageData(size_t pID);
   virtual ~AGMessageData() {}
-  
+
   size_t getMessageID() const;
 private:
   size_t mID;
@@ -45,7 +46,7 @@
 {
 public:
   AGMessageDataReceipt(size_t pID,size_t pSentID);
-  
+
   size_t getSentMessageID() const;
 private:
   size_t mSentID;
@@ -61,7 +62,7 @@
 class AGMessageTransceiver : public AGRubyObject
 {
   AGMessageTransceiver(AGMessageQueue *pQueue);
-  virtual ~AGMessageTransceiver();
+  virtual ~AGMessageTransceiver() throw();
   void sendMessage(const AGString &amp;pName,AGMessageData *pData=0);
 
   // generate an empty message data object
@@ -117,7 +118,7 @@
   const AGMessageSource &amp;getSource() const;
   AGMessageTransceiver *getSender();
 private:
-  AGMessage(const AGMessage&amp;):mData(0) 
+  AGMessage(const AGMessage&amp;):mData(0)
   {}
 };
 

Modified: antargis/trunk/ext/basic/ag_messageobject.cc
===================================================================
--- antargis/trunk/ext/basic/ag_messageobject.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_messageobject.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,9 @@
  */
 
 #include &quot;ag_messageobject.h&quot;
-#include &quot;ag_debug.h&quot;
+
+#include &quot;rk_debug.h&quot;
+
 #include &quot;ag_main.h&quot;
 #include &quot;ag_stringstream.h&quot;
 #include &quot;ag_widget.h&quot;
@@ -32,7 +34,7 @@
       {
         mClipped=false;
       }
-AGEvent::~AGEvent()
+AGEvent::~AGEvent() throw()
   {
     if(mMousePosition)
       delete mMousePosition;
@@ -48,7 +50,7 @@
 
 bool AGEvent::isClipped() const
 {
-  return mClipped; 
+  return mClipped;
 }
 void AGEvent::setClipped(bool f)
   {
@@ -199,7 +201,7 @@
   {
   }
 
-AGListener::~AGListener()
+AGListener::~AGListener() throw()
   {
   }
 
@@ -343,7 +345,7 @@
         {
         }
 
-AGMessageObject::~AGMessageObject()
+AGMessageObject::~AGMessageObject() throw()
   {
     std::set&lt;AGSignal*&gt; sigs=mSignals;
     std::set&lt;AGSignal*&gt;::iterator i=sigs.begin();
@@ -362,10 +364,10 @@
   }
 
 
-// 
+//
 // exchange with a processEvent(const AGEvent &amp;event)
 
-bool AGMessageObject::processEvent(AGEvent* agEvent) 
+bool AGMessageObject::processEvent(AGEvent* agEvent)
   {
     bool rc=false;
 

Modified: antargis/trunk/ext/basic/ag_messageobject.h
===================================================================
--- antargis/trunk/ext/basic/ag_messageobject.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_messageobject.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -28,8 +28,8 @@
 #include &lt;set&gt;
 
 #include &quot;ag_geometry.h&quot;
-#include &quot;ag_rubyobj.h&quot;
-#include &lt;ag_string.h&gt;
+#include &quot;rk_rubyobj.h&quot;
+#include &quot;rk_string.h&quot;
 
 #if SDL_COMPILEDVERSION&gt;1300
 #define MSDLMod Uint16
@@ -45,7 +45,7 @@
 
     AntargisGUI contains a small event handling mechanism for both ruby and C++.
     However they do work a little different.
-    
+
     Each object that wants to send or receive a message (or event) must be derived from
     AGMessageObject.
 
@@ -57,20 +57,20 @@
     You can however derive from it and pass it through a signal.
     But you shouldn't delete it for yourself.
  */
-class AGEXPORT AGEvent
+class AGEXPORT AGEvent:public AGRubyObject
 {
  public:
   AGEvent(AGListener *pCaller,const AGString &amp;pName,const SDL_Event &amp;pEvent=NullEvent);
-  virtual ~AGEvent();
+  virtual ~AGEvent() throw();
 
   AGListener *getCaller() const;
-  
+
   void setCaller(AGListener *pCaller);
   AGString getName() const;
 
   void setRelMousePosition(const AGVector2 &amp;p);
   AGVector2 getRelMousePosition() const;
-  
+
   AGVector2 getMousePosition() const;
   SDLKey getKey() const;
   MSDLMod getMod() const;
@@ -85,12 +85,12 @@
 
   void setVector(const AGVector2 &amp;v);
   AGVector2 getVector() const;
-  
+
   bool isClipped() const;
   void setClipped(bool f);
 
   bool isMouseEvent() const;
-  
+
  private:
   AGListener *mCaller;
   AGString mName;
@@ -100,7 +100,7 @@
   AGVector2 mVector;
   AGVector2 *mMousePosition;
   AGVector2 *mRelMousePosition;
-  
+
   bool mClipped;
 
  protected:
@@ -118,9 +118,9 @@
 {
  public:
   AGListener();
-  virtual ~AGListener();
+  virtual ~AGListener() throw();
   virtual bool signal(AGEvent *m);
-  
+
 };
 
 /**
@@ -147,7 +147,7 @@
   typedef bool (T::*FKT)(AGEvent *m);
   T *base;
   FKT f;
-  
+
   AGSlot0(T *pBase,FKT pF):
     base(pBase),f(pF)
     {
@@ -164,7 +164,7 @@
 
 class AGMessageObject;
 
-/** AGSignal is a placeholder-class for a function which calls all the Slots, which 
+/** AGSignal is a placeholder-class for a function which calls all the Slots, which
     are connected to this signal.
     For instance a button named &quot;close&quot; holds a sigClick signal and a dialog box has a slotClose.
     You call sigClick(event) in the button and the connected slot is automatically called.
@@ -202,7 +202,7 @@
 {
  public:
   AGMessageObject();
-  virtual ~AGMessageObject();
+  virtual ~AGMessageObject() throw();
 
   bool processEvent(AGEvent *pEvent);
 
@@ -250,7 +250,7 @@
 AGEXPORT AGEvent *newEvent(AGListener *pCaller,const AGString &amp;pName,const SDL_Event &amp;s);
 
 /**
- */   
+ */
 
 template&lt;class T&gt;
 AGCPPListener *slot(T *base,bool (T::*f)(AGEvent *))

Modified: antargis/trunk/ext/basic/ag_mutex.h
===================================================================
--- antargis/trunk/ext/basic/ag_mutex.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_mutex.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,7 +1,7 @@
 #ifndef AG_MUTEX
 #define AG_MUTEX
 
-#include &lt;ag_base.h&gt;
+#include &lt;rk_base.h&gt;
 #include &lt;SDL.h&gt;
 #include &lt;SDL_thread.h&gt;
 

Modified: antargis/trunk/ext/basic/ag_plugin.cc
===================================================================
--- antargis/trunk/ext/basic/ag_plugin.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_plugin.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -5,7 +5,7 @@
 #   include &lt;windows.h&gt;
 #include &lt;ag_debug.h&gt;
 
-AGPlugin::~AGPlugin()
+AGPlugin::~AGPlugin() throw()
 {
   FreeLibrary((HINSTANCE__*)myptr);
 }
@@ -46,7 +46,7 @@
 
 #include &lt;dlfcn.h&gt;
 
-AGPlugin::~AGPlugin()
+AGPlugin::~AGPlugin() throw()
 {
   dlclose(myptr);
 }

Modified: antargis/trunk/ext/basic/ag_plugin.h
===================================================================
--- antargis/trunk/ext/basic/ag_plugin.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_plugin.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,13 +1,14 @@
 #ifndef AG_PLUGIN_H
 #define AG_PLUGIN_H
 
+#include &lt;rk_rubyobj.h&gt;
+
 #include &lt;string&gt;
-#include &lt;ag_rubyobj.h&gt;
 
 class AGEXPORT AGPlugin:public AGRubyObject
 {
  public:
-  virtual ~AGPlugin();
+  virtual ~AGPlugin() throw();
 
  private:
   void *myptr;

Modified: antargis/trunk/ext/basic/ag_profiler.cc
===================================================================
--- antargis/trunk/ext/basic/ag_profiler.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_profiler.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,139 +1,140 @@
-#include &lt;time.h&gt; 
-#include &lt;algorithm&gt; 
-#include &lt;sstream&gt; 
-#include &lt;fstream&gt; 
-#include &lt;stack&gt; 
-#include &lt;list&gt; 
-#include &lt;set&gt; 
+#include &lt;time.h&gt;
+#include &lt;algorithm&gt;
+#include &lt;sstream&gt;
+#include &lt;fstream&gt;
+#include &lt;stack&gt;
+#include &lt;list&gt;
+#include &lt;set&gt;
 
-#include &quot;ag_profiler.h&quot; 
-#include &quot;ag_debug.h&quot; 
+#include &quot;ag_profiler.h&quot;
 
+#include &quot;rk_debug.h&quot;
+
 #include &lt;SDL.h&gt;
 
 #ifdef MPROFILE
 
-#define RDTSC_TIMER 
+#define RDTSC_TIMER
 
-double 
-volatile Uint64 get_time_unit() 
-  { 
-    unsigned int a = 0, b = 0; 
-#ifdef RDTSC_TIMER 
-#  if defined(__GNUC__) 
-    asm (&quot;RDTSC&quot;: &quot;=a&quot; (a), &quot;=d&quot; (b) : ); 
-#  elif defined(_MSC_VER) 
-    __asm RDTSC 
-    __asm mov a, eax 
-    __asm mov b, edx 
-#  endif 
-#endif 
-    return ( (Uint64)a + ((Uint64)b&lt;&lt;32)); 
-  } 
+double
+volatile Uint64 get_time_unit()
+  {
+    unsigned int a = 0, b = 0;
+#ifdef RDTSC_TIMER
+#  if defined(__GNUC__)
+    asm (&quot;RDTSC&quot;: &quot;=a&quot; (a), &quot;=d&quot; (b) : );
+#  elif defined(_MSC_VER)
+    __asm RDTSC
+    __asm mov a, eax
+    __asm mov b, edx
+#  endif
+#endif
+    return ( (Uint64)a + ((Uint64)b&lt;&lt;32));
+  }
 
-Uint64 convert_time(Uint64 t) 
-  { 
-    static double period = 0; 
-    if(period) 
-      return (Uint64)(t*period); 
-    Uint64 b = get_time_unit(); 
+Uint64 convert_time(Uint64 t)
+  {
+    static double period = 0;
+    if(period)
+      return (Uint64)(t*period);
+    Uint64 b = get_time_unit();
 #ifdef WIN32
     SDL_Delay(50);
-    period = 50000.0/((get_time_unit()-b)); 
+    period = 50000.0/((get_time_unit()-b));
 #else
-    usleep(1000000); 
-#ifdef RDTSC_TIMER 
-    period = 1000.0/((get_time_unit()-b)); 
-#else 
-    period = 1; 
-#endif 
+    usleep(1000000);
+#ifdef RDTSC_TIMER
+    period = 1000.0/((get_time_unit()-b));
+#else
+    period = 1;
 #endif
-    return convert_time(t); 
-  } 
+#endif
+    return convert_time(t);
+  }
 
-struct StackTraceEnter 
-{ 
-  SOURCE_LINE* mSrcline; 
-  Uint64 mStartTime; 
-}; 
+struct StackTraceEnter
+{
+  SOURCE_LINE* mSrcline;
+  Uint64 mStartTime;
+};
 
-static std::stack&lt;StackTraceEnter&gt; call_stack; 
-static std::set&lt;SOURCE_LINE*&gt; used_functions; 
+static std::stack&lt;StackTraceEnter&gt; call_stack;
+static std::set&lt;SOURCE_LINE*&gt; used_functions;
 
-static std::string getStackNodeString(const SOURCE_LINE* stNode) 
-  {      
-    std::string strName; 
-    if(stNode-&gt;name!=NULL) 
-      strName = std::string(&quot; &quot;) + stNode-&gt;name; 
-    std::stringstream s; 
+static std::string getStackNodeString(const SOURCE_LINE* stNode)
+  {
+    std::string strName;
+    if(stNode-&gt;name!=NULL)
+      strName = std::string(&quot; &quot;) + stNode-&gt;name;
+    std::stringstream s;
     s&lt;&lt;stNode-&gt;file&lt;&lt;&quot;, line &quot;&lt;&lt;stNode-&gt;line&lt;&lt;&quot; fn: &quot;&lt;&lt;stNode-&gt;funct+strName&lt;&lt;&quot; time: &quot;&lt;&lt;convert_time(stNode-&gt;time)&lt;&lt;&quot; count: &quot;&lt;&lt;stNode-&gt;count;
     if(stNode-&gt;count&gt;0)
       s&lt;&lt;&quot; per call:&quot;&lt;&lt;convert_time(stNode-&gt;time)/double(stNode-&gt;count);
-    s&lt;&lt;std::endl; 
-    return s.str(); 
-  } 
+    s&lt;&lt;std::endl;
+    return s.str();
+  }
 
-UserStackTraceHelper::UserStackTraceHelper( SOURCE_LINE* srcline) 
-  { 
-    StackTraceEnter st; 
-    st.mStartTime = get_time_unit(); 
-    st.mSrcline = srcline; 
-    srcline-&gt;count++; 
-    call_stack.push(st); 
-    used_functions.insert(srcline); 
-  } 
+UserStackTraceHelper::UserStackTraceHelper( SOURCE_LINE* srcline)
+  {
+    StackTraceEnter st;
+    st.mStartTime = get_time_unit();
+    st.mSrcline = srcline;
+    srcline-&gt;count++;
+    call_stack.push(st);
+    used_functions.insert(srcline);
+  }
 
-UserStackTraceHelper::~UserStackTraceHelper() 
-  { 
-    StackTraceEnter st=call_stack.top(); 
-    call_stack.pop(); 
-    st.mSrcline-&gt;time += get_time_unit() - st.mStartTime; 
-  } 
+UserStackTraceHelper::~UserStackTraceHelper()
+  {
+    StackTraceEnter st=call_stack.top();
+    call_stack.pop();
+    st.mSrcline-&gt;time += get_time_unit() - st.mStartTime;
+  }
 
 
-std::string UserStackTraceHelper::getStackTraceString() 
-  { 
-    std::string stack_string = &quot;&quot;; 
+std::string UserStackTraceHelper::getStackTraceString()
+  {
+    std::string stack_string = &quot;&quot;;
 
-    std::stack&lt;StackTraceEnter&gt; tmp; 
-    tmp = call_stack; 
-    while(!tmp.empty()) 
-      { 
-        StackTraceEnter stNode = tmp.top(); 
-        stack_string += getStackNodeString(stNode.mSrcline); 
-        tmp.pop(); 
-      } 
-    return stack_string; 
-  } 
+    std::stack&lt;StackTraceEnter&gt; tmp;
+    tmp = call_stack;
+    while(!tmp.empty())
+      {
+        StackTraceEnter stNode = tmp.top();
+        stack_string += getStackNodeString(stNode.mSrcline);
+        tmp.pop();
+      }
+    return stack_string;
+  }
 
-class _getProfilerString 
-{ 
-  std::string mAll; 
-public: 
-  _getProfilerString(){mAll = &quot;&quot;;}; 
+class _getProfilerString
+{
+  std::string mAll;
+public:
+  _getProfilerString(){mAll = &quot;&quot;;};
 
-  void operator()(const SOURCE_LINE* l) 
-  { 
-    mAll+= getStackNodeString(l); 
-  } 
-  operator std::string() 
-    { 
-      return mAll; 
-    } 
-}; 
+  void operator()(const SOURCE_LINE* l)
+  {
+    mAll+= getStackNodeString(l);
+  }
+  operator std::string()
+    {
+      return mAll;
+    }
+};
 
-static bool cmpTime(const SOURCE_LINE* a, const SOURCE_LINE* b) 
-  { 
-    return a-&gt;time&lt;b-&gt;time; 
-  } 
+static bool cmpTime(const SOURCE_LINE* a, const SOURCE_LINE* b)
+  {
+    return a-&gt;time&lt;b-&gt;time;
+  }
 
-std::string UserStackTraceHelper::getProfilerString() 
-  { 
-    std::list&lt;SOURCE_LINE*&gt; lst; 
-    std::copy(used_functions.begin(), used_functions.end(), std::back_inserter(lst)); 
-    lst.sort(cmpTime); 
-    return std::for_each(lst.begin(), lst.end(), _getProfilerString()); 
-  } 
+std::string UserStackTraceHelper::getProfilerString()
+  {
+    std::list&lt;SOURCE_LINE*&gt; lst;
+    std::copy(used_functions.begin(), used_functions.end(), std::back_inserter(lst));
+    lst.sort(cmpTime);
+    return std::for_each(lst.begin(), lst.end(), _getProfilerString());
+  }
 
 
 class AGProfilerWriter
@@ -146,55 +147,55 @@
       os&lt;&lt;UserStackTraceHelper::getProfilerString()&lt;&lt;std::endl;
       os&lt;&lt;UserStackTraceHelper::getStackTraceString()&lt;&lt;std::endl;
     }
-}; 
+};
 AGProfilerWriter gProfilerWriter;
 
 #ifdef RUN_PROFILER_TEST
 
-//  Test code 
-#include &lt;stdlib.h&gt; 
+//  Test code
+#include &lt;stdlib.h&gt;
 
-class A 
-{ 
-public: 
-  A(){STACKTRACE sleep(10);} 
-  ~A(){STACKTRACE} 
-  void f() 
-    { 
-      STACKTRACE 
-      for(int i=0; i&lt;30000000; i++) 
-        { 
-          if(i % 5 &gt; random()) 
-            i++; 
-        } 
-    } 
-  void f2() 
-    { 
-      STACKTRACE 
-      for(int i=0; i&lt;300; i++) 
-        { 
-          if(i % 5 &gt; random()) 
-            i++; 
-        } 
-    } 
+class A
+{
+public:
+  A(){STACKTRACE sleep(10);}
+  ~A(){STACKTRACE}
+  void f()
+    {
+      STACKTRACE
+      for(int i=0; i&lt;30000000; i++)
+        {
+          if(i % 5 &gt; random())
+            i++;
+        }
+    }
+  void f2()
+    {
+      STACKTRACE
+      for(int i=0; i&lt;300; i++)
+        {
+          if(i % 5 &gt; random())
+            i++;
+        }
+    }
 };
 
 
-int main() 
-  { 
+int main()
+  {
       {
-        STACKTRACE 
-        A* b; 
-        b = new A(); 
-        b-&gt;f(); 
-        for(int i=1;i&lt;5;i++) 
-          b-&gt;f2(); 
+        STACKTRACE
+        A* b;
+        b = new A();
+        b-&gt;f();
+        for(int i=1;i&lt;5;i++)
+          b-&gt;f2();
       }
 
-      printf(&quot;profile:\n\n %s\n&quot;, UserStackTraceHelper::getProfilerString().c_str()); 
-      printf(&quot;call stack:\n\n %s\n&quot;, UserStackTraceHelper::getStackTraceString().c_str()); 
-      return 0; 
-  } 
+      printf(&quot;profile:\n\n %s\n&quot;, UserStackTraceHelper::getProfilerString().c_str());
+      printf(&quot;call stack:\n\n %s\n&quot;, UserStackTraceHelper::getStackTraceString().c_str());
+      return 0;
+  }
 #endif
 
 #endif

Modified: antargis/trunk/ext/basic/ag_profiler.h
===================================================================
--- antargis/trunk/ext/basic/ag_profiler.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_profiler.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,23 +1,24 @@
-/* 
- * The &quot;Antargis&quot; project, including all files needed to compile it, 
- * is free software; you can redistribute it and/or use it and/or modify it 
- * under the terms of the GNU General Public License as published 
- * by the Free Software Foundation; either version 2 of the License, 
- * or (at your option) any later version. 
- * 
- * This program is distributed in the hope that it will be useful, 
- * but WITHOUT ANY WARRANTY; without even the implied warranty of 
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 
- * 
- * You should have received a copy of the GNU General Public 
- * License along with this program. 
- */ 
+/*
+ * The &quot;Antargis&quot; project, including all files needed to compile it,
+ * is free software; you can redistribute it and/or use it and/or modify it
+ * under the terms of the GNU General Public License as published
+ * by the Free Software Foundation; either version 2 of the License,
+ * or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+ *
+ * You should have received a copy of the GNU General Public
+ * License along with this program.
+ */
 
-#ifndef AG_PROFILER_H 
-#define AG_PROFILER_H 
+#ifndef AG_PROFILER_H
+#define AG_PROFILER_H
 
-#include &lt;ag_base.h&gt;
-#include &lt;string&gt; 
+#include &lt;rk_base.h&gt;
+
+#include &lt;string&gt;
 #include &lt;SDL.h&gt;
 
 #if CPU_FAMILY == PPC
@@ -29,42 +30,42 @@
 
 #ifdef MPROFILE
 
-#define Uint64 long long 
-#define Sint64 signed long long 
+#define Uint64 long long
+#define Sint64 signed long long
 
-struct SOURCE_LINE 
-{ 
-  Uint64 time;       ///&lt; Total time spent in function 
-  Uint64 count;      ///&lt; Total function calls 
-  int line;          ///&lt; __LINE__ 
-  const char *file;  ///&lt; __FILE__ 
-  const char *funct; ///&lt; __FUNCTION__ 
-  const char *name;  ///&lt; NULL or a descriptor string 
-}; 
+struct SOURCE_LINE
+{
+  Uint64 time;       ///&lt; Total time spent in function
+  Uint64 count;      ///&lt; Total function calls
+  int line;          ///&lt; __LINE__
+  const char *file;  ///&lt; __FILE__
+  const char *funct; ///&lt; __FUNCTION__
+  const char *name;  ///&lt; NULL or a descriptor string
+};
 
-/// \brief Call stack tracker 
-/// 
-/// Object of this class is created on stack in STACKTRACE macro, so it's creating/destruction can 
-/// be used to manage  call stack. 
-class AGEXPORT UserStackTraceHelper 
-{ 
- public: 
-  UserStackTraceHelper( SOURCE_LINE* srcline); 
-  ~UserStackTraceHelper(); 
-  
-  ///  get stack trace string 
-    static std::string getStackTraceString(); 
-    static std::string getProfilerString(); 
-}; 
+/// \brief Call stack tracker
+///
+/// Object of this class is created on stack in STACKTRACE macro, so it's creating/destruction can
+/// be used to manage  call stack.
+class AGEXPORT UserStackTraceHelper
+{
+ public:
+  UserStackTraceHelper( SOURCE_LINE* srcline);
+  ~UserStackTraceHelper();
 
+  ///  get stack trace string
+    static std::string getStackTraceString();
+    static std::string getProfilerString();
+};
 
-#define STACKTRACE static SOURCE_LINE _srcline = { 0, 0, __LINE__, __FILE__, __FUNCTION__, 0 }; UserStackTraceHelper _stacktrace_ ( &amp;_srcline ); 
-#define _STACKTRACE(A) static SOURCE_LINE _srcline = {0, 0, __LINE__, __FILE__, __FUNCTION__, A }; UserStackTraceHelper _stacktrace_ ( &amp;_srcline ); 
 
+#define STACKTRACE static SOURCE_LINE _srcline = { 0, 0, __LINE__, __FILE__, __FUNCTION__, 0 }; UserStackTraceHelper _stacktrace_ ( &amp;_srcline );
+#define _STACKTRACE(A) static SOURCE_LINE _srcline = {0, 0, __LINE__, __FILE__, __FUNCTION__, A }; UserStackTraceHelper _stacktrace_ ( &amp;_srcline );
 
-#else // MPROFILE 
+
+#else // MPROFILE
 #define STACKTRACE
 
-#endif // MPROFILE 
+#endif // MPROFILE
 
 #endif

Modified: antargis/trunk/ext/basic/ag_rand_base.h
===================================================================
--- antargis/trunk/ext/basic/ag_rand_base.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_rand_base.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,7 +3,7 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
-#include &lt;ag_rubyobj.h&gt;
+#include &lt;rk_rubyobj.h&gt;
 
 class AGEXPORT AGRandomizerBase:public AGRubyObject
 {

Deleted: antargis/trunk/ext/basic/ag_rtools.cc
===================================================================
--- antargis/trunk/ext/basic/ag_rtools.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_rtools.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,52 +0,0 @@
-#include &lt;ag_rtools.h&gt;
-#include &lt;ag_serial.h&gt;
-
-#include &lt;ruby.h&gt;
-
-#include &lt;iostream&gt;
-#include &lt;sstream&gt;
-
-std::string rubyHash(const std::string &amp;p)
-{
-  rb_eval_string(&quot;require 'digest/md5'&quot;);
-  VALUE l=rb_eval_string(&quot;Digest::MD5&quot;);
-  VALUE r=rb_funcall(l,rb_intern(&quot;digest&quot;),1,rb_str_new(p.c_str(),p.length()));
-
-  std::string s(RSTRING_PTR(r), RSTRING_LEN(r));
-
-  return binaryToHex(s,false);
-  
-}
-
-std::string rubyHashOld(const std::string &amp;p)
-{
-  // FIXME: TRY USING ruby's Digest::MD5::digest(&quot;xy&quot;)
-  rb_eval_string(&quot;require 'digest/md5'&quot;);
-
-  //  VALUE l=rb_gv_get(&quot;Digest::MD5&quot;);
-  //  VALUE r=rb_funcall(l,rb_intern(&quot;digest&quot;),1,rb_str_new2(p.c_str()));
-
-  std::ostringstream os;
-  os&lt;&lt;&quot;s=''; Digest::MD5::digest('&quot;&lt;&lt;p&lt;&lt;&quot;').each_byte{|b|s+=sprintf('%X',b)};s&quot;;
-
-  VALUE r=rb_eval_string(os.str().c_str());
-
-  std::string s;
-
-  s=STR2CSTR(r);
-
-  return s;
-}
-
-
-
-
-
-bool rubyMatchRegex(const std::string &amp;p,const std::string &amp;pregex)
-  {
-    VALUE rp=rb_str_new(p.c_str(),p.length());
-    VALUE rregex=rb_str_new(pregex.c_str(),pregex.length());
-    
-    VALUE ret=rb_reg_match(rp,rregex);
-    return ret==Qtrue;
-  }

Deleted: antargis/trunk/ext/basic/ag_rtools.h
===================================================================
--- antargis/trunk/ext/basic/ag_rtools.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_rtools.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,13 +0,0 @@
-#ifndef AG_RTOOLS_H
-#define AG_RTOOLS_H
-
-#include &lt;ag_base.h&gt;
-#include &lt;string&gt;
-
-AGEXPORT std::string rubyHash(const std::string &amp;p);
-AGEXPORT bool rubyMatchRegex(const std::string &amp;p,const std::string &amp;pregex);
-std::string rubySub(const std::string &amp;p,const std::string &amp;search,const std::string &amp;repl);
-
-
-
-#endif

Modified: antargis/trunk/ext/basic/ag_serial.cc
===================================================================
--- antargis/trunk/ext/basic/ag_serial.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_serial.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include &quot;ag_serial.h&quot;
 #include &lt;iostream&gt;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 
 // INTEL is little endian
 
@@ -339,94 +339,3 @@
 {
   return os.str();
 }
-
-
-unsigned char fromHexBS(unsigned char c)
-  {
-    if(c&gt;='a' &amp;&amp; c&lt;='f')
-      return c-'a'+0xA;
-    if(c&gt;='A' &amp;&amp; c&lt;='F')
-      return c-'A'+0xA;
-
-    if(c&gt;='0' &amp;&amp; c&lt;='9')
-      return c-'0';
-    throw std::runtime_error(&quot;wrong input in fromHex()&quot;);
-  }
-
-void toHexBS(char c,std::ostream &amp;os)
-  {
-    unsigned char c0=(c&amp;0xF);
-    unsigned char c1=((c&gt;&gt;4)&amp;0xF);
-
-    char a,b;
-    //  std::ostringstream os;
-    if(c0&lt;10)
-      a=(c0+'0');
-    else
-      a=((c0-10)+'A');
-
-    if(c1&lt;10)
-      b=(c1+'0');
-    else
-      b=((c1-10)+'A');
-
-    //  cdebug(&quot;a:&quot;&lt;&lt;(int)a);
-    //  cdebug(&quot;b:&quot;&lt;&lt;(int)b);
-    os&lt;&lt;b&lt;&lt;a;
-
-    //  return os.str();
-  }
-
-
-std::string binaryToHex(const std::string &amp;s,bool separators)
-  {
-    std::ostringstream os;
-
-    for(size_t i=0;i&lt;s.length();i++)
-      {
-        //      cdebug(i&lt;&lt;&quot;:&quot;&lt;&lt;(int)s[i]);
-        toHexBS(s[i],os);
-        if(i&gt;0 &amp;&amp; separators)
-          {
-            if((i%32)==0)
-              os&lt;&lt;std::endl;
-            else if((i%4)==0)
-              os&lt;&lt;&quot; &quot;;
-          }
-      }
-    //  cdebug(os.getString());
-
-    return os.str();//getString();
-  }
-
-
-std::string hexToBinary(const std::string &amp;s)
-  {
-    std::ostringstream os;
-    bool complete=false;
-    char current=0;
-
-    for(size_t i=0;i&lt;s.length();i++)
-      {
-        char c=s[i];
-        if((c&gt;='a' &amp;&amp; c&lt;='f') || (c&gt;='A' &amp;&amp; c&lt;='F') || (c&gt;='0' &amp;&amp; c&lt;='9'))
-          {
-            if(complete)
-              {
-                current&lt;&lt;=4;
-                current|=fromHexBS(c);
-                os&lt;&lt;current;
-                complete=false;
-              }
-            else
-              {
-                current=fromHexBS(c);
-                complete=true;
-              }
-          }
-
-      }
-
-
-    return os.str();
-  }

Modified: antargis/trunk/ext/basic/ag_serial.h
===================================================================
--- antargis/trunk/ext/basic/ag_serial.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_serial.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -80,7 +80,7 @@
 class AGEXPORT BinaryStringIn:public BinaryIn
 {
  public:
-  BinaryStringIn(const std::string &amp;pText);
+  BinaryStringIn(const std::string &amp;pText);
   virtual ~BinaryStringIn();
 
   virtual bool eof();
@@ -102,7 +102,5 @@
   std::ostringstream os;
 };
 
-AGEXPORT std::string binaryToHex(const std::string &amp;s,bool separators=true);
-AGEXPORT std::string hexToBinary(const std::string &amp;s);
 
 #endif

Modified: antargis/trunk/ext/basic/ag_singleton.cc
===================================================================
--- antargis/trunk/ext/basic/ag_singleton.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_singleton.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include &quot;ag_singleton.h&quot;
 #include &quot;ag_main.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 
 
 AGSingleton::AGSingleton()
@@ -11,7 +11,7 @@
 
   getMain()-&gt;getCollector()-&gt;insertGlobal(this);
 }
-AGSingleton::~AGSingleton()
+AGSingleton::~AGSingleton() throw()
 {
   if(!hasMain())
     return;

Modified: antargis/trunk/ext/basic/ag_singleton.h
===================================================================
--- antargis/trunk/ext/basic/ag_singleton.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_singleton.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,13 +3,13 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
-#include &lt;ag_rubyobj.h&gt;
+#include &lt;rk_rubyobj.h&gt;
 
 class AGEXPORT AGSingleton:public AGRubyObject
 {
  public:
   AGSingleton();
-  ~AGSingleton();
+  virtual ~AGSingleton() throw ();
 };
 
 #endif

Deleted: antargis/trunk/ext/basic/ag_string.cc
===================================================================
--- antargis/trunk/ext/basic/ag_string.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_string.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,230 +0,0 @@
-#include &lt;ag_string.h&gt;
-#include &lt;ag_debug.h&gt;
-#include &lt;ag_utf8.h&gt;
-#include &lt;ag_rtools.h&gt;
-
-///////////
-// AGString
-///////////
-
-AGString::AGString(int i)
-  {
-    std::ostringstream os;
-    os&lt;&lt;i;
-    *this=os.str();
-  }
-AGString::AGString(long i)
-  {
-    std::ostringstream os;
-    os&lt;&lt;i;
-    *this=os.str();
-  }
-AGString::AGString(size_t i)
-  {
-    std::ostringstream os;
-    os&lt;&lt;i;
-    *this=os.str();
-  }
-AGString::AGString(float f)
-  {
-    std::ostringstream os;
-    os&lt;&lt;f;
-    *this=os.str();
-  }
-
-
-AGString::AGString()
-  {
-  }
-
-AGString::AGString(const char*c):
-  std::string(c)
-  {
-  }
-
-AGString::AGString(const char*c,size_t size):
-  std::string(c,size)
-  {
-  }
-
-AGString::AGString(const std::string &amp;p):
-  std::string(p)
-  {
-  }
-AGString::AGString(const std::string &amp;p,size_t many):
-  std::string(p,many)
-  {
-  }
-AGString::AGString(const AGString &amp;p):
-  std::string(p)
-  {
-  }
-
-AGString::AGString(const char c,size_t many):
-  std::string(c,many)
-  {
-  }
-
-AGString &amp;AGString::operator=(const AGString &amp;p)
-  {
-    std::string::operator=(p);
-    return *this;
-  }
-
-AGString &amp;AGString::operator+=(const AGString &amp;p)
-{
-  std::string::operator+=(p);
-  return *this;
-}
-
-size_t AGString::memory() const
-{
-  return length();
-}
-
-AGString AGString::substr(size_t from,size_t len) const
-{
-  return AGString(std::string::substr(from,len));
-}
-
-
-std::vector&lt;AGString&gt; AGString::split(const AGString &amp;p) const
-{
-  std::vector&lt;AGString&gt; a;
-  size_t oi=0;
-  size_t i=find(p);
-  for(;;)
-    {
-      i=find(p,oi);
-      a.push_back(substr(oi,i-oi));
-      if(i==std::string::npos)
-        break;
-      oi=i+1;
-    }
-  return a;
-}
-
-AGString AGString::operator+(const AGString &amp;p) const
-{
-  AGString n(*this);
-  n+=p;
-  return n;
-}
-AGString AGString::operator+(const char* p) const
-{
-  AGString n(*this);
-  n+=p;
-  return n;
-}
-AGString AGString::operator+(const std::string &amp;p) const
-{
-  AGString n(*this);
-  n+=p;
-  return n;
-}
-
-
-AGString AGString::replace(const AGString &amp;what, const AGString &amp;by) const
-{
-  size_t i=0;
-  size_t oi=0;
-  AGString n;
-
-  while(i!=npos)
-    {
-      i=find(what,oi);
-      n+=substr(oi,i-oi);
-      if(i==npos)
-        break;
-      n+=by;
-      oi=i+1;
-    }
-  return n;
-}
-
-
-int AGString::toInt() const
-{
-  return atoi(c_str());
-}
-long AGString::toLong() const
-{
-  return atol(c_str());
-}
-float AGString::toFloat() const
-{
-  return atof(c_str());
-}
-
-Uint8 AGString::toUint8() const
-{
-  return toInt();
-}
-Sint16 AGString::toSint16() const 
-{
-  return toInt();
-}
-
-
-int AGString::parseHex() const
-{
-  int i=0;
-  for(size_t j=0;j&lt;length();j++)
-    {
-      int k=0;
-      i&lt;&lt;=4;
-      char c=operator[](j);
-      if(c&gt;='A'&amp;&amp;c&lt;='F')
-        k=c-'A'+10;
-      else if(c&gt;='a' &amp;&amp; c&lt;='f')
-        k=c-'a'+10;
-      else if(c&gt;='0' &amp;&amp; c&lt;='9')
-        k=c-'0';
-      i+=k;
-    }
-  return i;
-}
-
-AGString AGString::toHex(int i)
-  {
-    std::string s;
-    std::string c=&quot;0&quot;;
-    while(i!=0)
-      {
-        int k=i&amp;0xF;
-
-        if(k&gt;9)
-          c[0]='A'+k-10;
-        else
-          c[0]='0'+k;
-
-        s=c+s;
-        i&gt;&gt;=4;
-      }
-
-    while(s.length()&lt;2)
-      s=std::string(&quot;0&quot;)+s;
-    return AGString(s);
-  }
-
-bool AGString::toBool() const
-{
-  if(length()==0)
-    return false;
-  if(operator[](0)=='1')
-    return true;
-  if(substr(0,4)==&quot;true&quot;)
-    return true;
-  return false;
-}
-
-
-bool AGString::matches(const std::string &amp;regex) const
-{
-  return rubyMatchRegex(*this,regex);
-}
-
-AGString AGString::last(size_t n) const
-{
-  
-}

Deleted: antargis/trunk/ext/basic/ag_string.h
===================================================================
--- antargis/trunk/ext/basic/ag_string.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_string.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,64 +0,0 @@
-#ifndef AG_STRING
-#define AG_STRING
-
-#include &lt;ag_base.h&gt;
-#include &lt;string&gt;
-#include &lt;vector&gt;
-#include &lt;SDL.h&gt;
-
-
-/** A string class that natively supports UTF-8 */
-class AGEXPORT AGString:public std::string
-{
-public:
-  static const size_t npos = static_cast&lt;size_t&gt;(-1);
-
-  AGString();
-  AGString(const std::string &amp;p);
-  AGString(const std::string &amp;p,size_t many);
-  AGString(const AGString &amp;p);
-  explicit AGString(int i);
-  explicit AGString(size_t i);
-  explicit AGString(long i);
-  explicit AGString(float f);
-  AGString(const char c,size_t many=1);
-  AGString(const char*c);
-  AGString(const char*c,size_t size);
-
-#ifndef SWIiG
-  AGString &amp;operator=(const AGString &amp;s);
-
-  AGString &amp;operator+=(const AGString &amp;p);
-#endif
-
-  // size in bytes
-  size_t memory() const;
-
-  AGString substr(size_t from,size_t len) const;
-
-  std::vector&lt;AGString&gt; split(const AGString &amp;p) const;
-
-  AGString replace(const AGString &amp;what, const AGString &amp;by) const;
-  
-  AGString last(size_t n) const;
-
-  AGString operator+(const AGString &amp;s) const;
-  AGString operator+(const char *s) const;
-  AGString operator+(const std::string &amp;s) const;
-
-  int toInt() const;
-  long toLong() const;
-  float toFloat() const;
-  bool toBool() const;
-
-  Uint8 toUint8() const;
-  Sint16 toSint16() const;
-
-  int parseHex() const;
-
-  static AGString toHex(int i);
-  
-  bool matches(const std::string &amp;regex) const;
-};
-
-#endif

Modified: antargis/trunk/ext/basic/ag_string_utf8.cc
===================================================================
--- antargis/trunk/ext/basic/ag_string_utf8.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_string_utf8.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,7 @@
 #include &lt;ag_string_utf8.h&gt;
-#include &lt;ag_debug.h&gt;
-#include &lt;ag_utf8.h&gt;
+#include &lt;rk_string.h&gt;
+#include &lt;rk_debug.h&gt;
+#include &lt;rk_utf8.h&gt;
 
 ///////////////////////////////////////////////////////////////////////////
 // Classes for UTF-8 support
@@ -399,7 +400,7 @@
   is&gt;&gt;i;
   return i;
 }
-Sint16 AGStringUtf8::toSint16() const 
+Sint16 AGStringUtf8::toSint16() const
 {
   long i;
   std::istringstream is;

Modified: antargis/trunk/ext/basic/ag_string_utf8.h
===================================================================
--- antargis/trunk/ext/basic/ag_string_utf8.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_string_utf8.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,10 +3,11 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
+#include &lt;rk_base.h&gt;
+
 #include &lt;string&gt;
 #include &lt;vector&gt;
 #include &lt;SDL.h&gt;
-#include &lt;ag_base.h&gt;
 
 class AGStringUtf8;
 class AGString;
@@ -29,8 +30,8 @@
   bool operator!=(const AGCharUtf8 &amp;c) const;
   bool operator!=(const char pChar) const;
 #endif
-  
 
+
   std::string getString() const;
 
   size_t memory() const;
@@ -43,7 +44,7 @@
 
 class AGEXPORT AGStringUtf8Iterator
 {
-  
+
 };
 
 /** A string class that natively supports UTF-8 */
@@ -73,8 +74,8 @@
 #endif
   AGStringUtf8(const char*c);
   AGStringUtf8(const char*c,size_t size);
-  
-  
+
+
 #ifdef SWIG
   %rename(set) operator=(const AGStringUtf8 &amp;s);
   %rename(set) operator=(const AGCharUtf8 &amp;s);
@@ -114,7 +115,7 @@
   size_t find(const AGStringUtf8 &amp;p,size_t pos=0) const;
 
   AGStringUtf8 replace(const AGStringUtf8 &amp;what, const AGStringUtf8 &amp;by) const;
-  
+
   AGStringUtf8 operator+(const AGStringUtf8 &amp;s) const;
   AGStringUtf8 operator+(const AGString &amp;s) const;
   AGStringUtf8 operator+(const char *s) const;

Modified: antargis/trunk/ext/basic/ag_stringstream.h
===================================================================
--- antargis/trunk/ext/basic/ag_stringstream.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_stringstream.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,7 +3,8 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
-#include &lt;ag_string.h&gt;
+#include &lt;rk_string.h&gt;
+
 #include &lt;SDL.h&gt;
 
 

Deleted: antargis/trunk/ext/basic/ag_tools.cc
===================================================================
--- antargis/trunk/ext/basic/ag_tools.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_tools.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,106 +0,0 @@
-/*
- * Copyright (c) 2005 by David Kamphausen. All rights reserved.
- *
- * ag_tools.cc
- * by David Kamphausen (<A HREF="https://lists.berlios.de/mailman/listinfo/antargis-svn">david.kamphausen at web.de</A>)
- *
- * The &quot;Antargis&quot; project, including all files needed to compile it,
- * is free software; you can redistribute it and/or use it and/or modify it
- * under the terms of the GNU General Public License as published
- * by the Free Software Foundation; either version 2 of the License,
- * or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
- *
- * You should have received a copy of the GNU General Public
- * License along with this program.
- */
-
-#include &quot;ag_tools.h&quot;
-#include &quot;ag_debug.h&quot;
-
-int toInt(const std::string &amp;s)
-  {
-    return atoi(s.c_str());
-  }
-long toLong(const std::string &amp;s)
-  {
-    return atol(s.c_str());
-  }
-float toFloat(const std::string &amp;s)
-  {
-    float f=atof(s.c_str());
-    return f;
-  }
-
-int fromHex(const std::string &amp;s)
-  {
-    int i=0;
-    for(size_t j=0;j&lt;s.length();j++)
-      {
-        int k=0;
-        i&lt;&lt;=4;
-        char c=s[j];
-        if(c&gt;='A'&amp;&amp;c&lt;='F')
-          k=c-'A'+10;
-        else if(c&gt;='a' &amp;&amp; c&lt;='f')
-          k=c-'a'+10;
-        else if(c&gt;='0' &amp;&amp; c&lt;='9')
-          k=c-'0';
-        i+=k;
-      }
-    return i;
-  }
-std::string toHex(int i)
-  {
-    std::string s;
-    std::string c=&quot;0&quot;;
-    while(i!=0)
-      {
-        int k=i&amp;0xF;
-
-        if(k&gt;9)
-          c[0]='A'+k-10;
-        else
-          c[0]='0'+k;
-
-        s=c+s;
-        i&gt;&gt;=4;
-      }
-
-
-    while(s.length()&lt;2)
-      s=std::string(&quot;0&quot;)+s;
-    return s;
-  }
-
-
-std::vector&lt;std::string&gt; split(const std::string &amp;needle,const std::string &amp;haystack)
-{
-  std::vector&lt;std::string&gt; d;
-  size_t i,last=0;
-  for(i=haystack.find(needle);i!=std::string::npos;i=haystack.find(needle,i+1))
-    {
-      d.push_back(haystack.substr(last,i-last));
-      last=i+needle.length();
-    }
-  i=haystack.length();
-  d.push_back(haystack.substr(last,i-last));
-  return d;
-}
-
-
-
-std::string replace(const std::string &amp;s,const std::string &amp;a,const std::string &amp;b)
-  {
-    std::string str=s;
-    size_t i=str.find(a);
-    while(i!=str.npos)
-      {
-        str=str.substr(0,i)+b+str.substr(i+a.length(),str.length()-i-a.length());
-        i=str.find(a,i+b.length());
-      }
-    return str;
-  }

Deleted: antargis/trunk/ext/basic/ag_tools.h
===================================================================
--- antargis/trunk/ext/basic/ag_tools.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_tools.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,87 +0,0 @@
-/*
- * Copyright (c) 2005 by David Kamphausen. All rights reserved.
- *
- * ag_tools.h
- * by David Kamphausen (<A HREF="https://lists.berlios.de/mailman/listinfo/antargis-svn">david.kamphausen at web.de</A>)
- *
- * The &quot;Antargis&quot; project, including all files needed to compile it,
- * is free software; you can redistribute it and/or use it and/or modify it
- * under the terms of the GNU General Public License as published
- * by the Free Software Foundation; either version 2 of the License,
- * or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
- *
- * You should have received a copy of the GNU General Public
- * License along with this program.
- */
-
-#ifndef AG_TOOLS_H
-#define AG_TOOLS_H
-
-#include &lt;string&gt;
-#include &lt;list&gt;
-#include &lt;sstream&gt;
-
-#ifdef WIN32
-#include &lt;windows.h&gt;
-#include &lt;winsock.h&gt;
-#endif
-
-#include &lt;ag_fs.h&gt;
-#include &lt;ag_base.h&gt;
-
-std::vector&lt;std::string&gt; AGEXPORT split(const std::string &amp;n,const std::string &amp;h);
-
-
-std::string AGEXPORT replace(const std::string &amp;s,const std::string &amp;a,const std::string &amp;b);
-
-template&lt;class T&gt;
-inline std::string toString(const T&amp;t)
-{
-  std::ostringstream os;
-  os&lt;&lt;t;
-  return os.str();
-}
-
-template&lt;&gt;
-inline std::string toString(const bool&amp;b)
-{
-  if(b)
-    return &quot;true&quot;;
-  else
-    return &quot;false&quot;;
-}
-
-inline bool toBool(const std::string &amp;s)
-{
-  return(s==&quot;true&quot;);
-}
-
-AGEXPORT int toInt(const std::string &amp;s);
-AGEXPORT long toLong(const std::string &amp;s);
-AGEXPORT float toFloat(const std::string &amp;s);
-AGEXPORT int fromHex(const std::string &amp;s);
-AGEXPORT std::string toHex(int i);
-
-template&lt;class T&gt;
-void append(std::list&lt;T&gt; &amp;l1,const std::list&lt;T&gt; &amp;l2)
-{
-  typename std::list&lt;T&gt;::const_iterator i=l2.begin();
-  for(;i!=l2.end();i++)
-    l1.push_back(*i);
-}
-
-template&lt;class T&gt;
-void append(std::vector&lt;T&gt; &amp;l1,const std::vector&lt;T&gt; &amp;l2)
-{
-  typename std::vector&lt;T&gt;::const_iterator i=l2.begin();
-  for(;i!=l2.end();i++)
-    l1.push_back(*i);
-}
-
-#define AGsign(x) ((x)&lt;0?-1:(x)&gt;0?1:0)
-
-#endif

Deleted: antargis/trunk/ext/basic/ag_utf8.cc
===================================================================
--- antargis/trunk/ext/basic/ag_utf8.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_utf8.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,75 +0,0 @@
-#include &quot;ag_utf8.h&quot;
-#include &quot;ag_debug.h&quot;
-
-size_t agFirstCharSize(const std::string &amp;s,size_t pos)
-{
-  unsigned char c=s[pos];
-  size_t l=1;
-  if((c&amp;0xF0)==0xF0)
-    l=4;
-  else if((c&amp;0xE0)==0xE0)
-    l=3;
-  else if((c&amp;0xC0)==0xC0)
-    l=2;
-  assert(l+pos&lt;=s.length());
-  return l;
-    
-}
-size_t agStringLength(const std::string &amp;s)
-{
-  size_t c=0;
-  size_t l=0;
-  //  cdebug(&quot;in:&quot;&lt;&lt;s);
-  while(c&lt;s.length())
-    {
-      size_t cl=agFirstCharSize(s,c);
-      //      cdebug(cl&lt;&lt;&quot;::&quot;&lt;&lt;c&lt;&lt;&quot;  &quot;&lt;&lt;s.length());
-      c+=cl;
-      l++;
-    }
-  //  cdebug(&quot;len:&quot;&lt;&lt;l);
-  return l;
-}
-
-std::string agSubStr(const std::string &amp;s,size_t from,size_t len)
-{
-  size_t i=0;
-  size_t c=0;
-  while(i&lt;from &amp;&amp; c&lt;s.length())
-    {
-      c+=agFirstCharSize(s,c);
-      i++;
-    }
-  if(i&lt;from)
-    return &quot;&quot;;
-
-  std::string r;
-  size_t d;
-  for(i=0;i&lt;len &amp;&amp; c&lt;s.length();i++)
-    {
-      d=agFirstCharSize(s,c);
-      r+=s.substr(c,d);
-      c+=d;
-    }
-  return r;
-}
-
-std::string unicode2Utf8(Uint16 unicode)
-{
-  std::ostringstream os;
-
-  if(unicode &lt; 0x80)
-    os&lt;&lt;char(unicode &amp; 0x7f);
-  else if(unicode &lt; 0x800)
-    os&lt;&lt;char((unicode &gt;&gt;6)|0xc0)&lt;&lt;char((unicode &amp; 0x3f)|0x80);
-#ifdef BIGGER_UNICODE
-  else if(unicode &lt; 0x10000)
-    os&lt;&lt;char((unicode &gt;&gt;12)|0xe0)&lt;&lt;char(((unicode &gt;&gt; 6)&amp;0x3f)|0x80)&lt;&lt;char((unicode&amp;0x3f)|0x80);
-  else if(unicode &lt;= 0x0010 FFFF)
-    os&lt;&lt;char((unicode &gt;&gt;18)|0xF0)&lt;&lt;char(((unicode &gt;&gt;12)&amp;0x3f)|0x80)&lt;&lt;char(((unicode&gt;&gt;6)0x3f)|0x80)&lt;&lt;char((unicode&amp;0x3f)|0x80);
-#else
-  else
-    os&lt;&lt;char((unicode &gt;&gt;12)|0xe0)&lt;&lt;char(((unicode &gt;&gt; 6)&amp;0x3f)|0x80)&lt;&lt;char((unicode&amp;0x3f)|0x80);
-#endif
-  return os.str();
-}

Deleted: antargis/trunk/ext/basic/ag_utf8.h
===================================================================
--- antargis/trunk/ext/basic/ag_utf8.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_utf8.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,16 +0,0 @@
-#ifndef AG_UTF8_H
-#define AG_UTF8_H
-
-// INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
-
-#include &lt;ag_base.h&gt;
-#include &lt;string&gt;
-#include &lt;vector&gt;
-#include &lt;SDL.h&gt;
-
-AGEXPORT size_t agFirstCharSize(const std::string &amp;s,size_t pos=0);
-AGEXPORT size_t agStringLength(const std::string &amp;s);
-AGEXPORT std::string agSubStr(const std::string &amp;s,size_t from,size_t len);
-AGEXPORT std::string unicode2Utf8(Uint16 unicode);
-
-#endif

Modified: antargis/trunk/ext/basic/ag_video_base.cc
===================================================================
--- antargis/trunk/ext/basic/ag_video_base.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_video_base.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include &lt;ag_video_base.h&gt;
 
-AGVideoBase::~AGVideoBase()
+AGVideoBase::~AGVideoBase() throw()
 {
 }
 

Modified: antargis/trunk/ext/basic/ag_video_base.h
===================================================================
--- antargis/trunk/ext/basic/ag_video_base.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_video_base.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -8,7 +8,7 @@
 class AGEXPORT AGVideoBase:public AGSingleton
 {
  public:
-  virtual ~AGVideoBase();
+  virtual ~AGVideoBase() throw();
   virtual int width() const;
   virtual int height() const;
 

Modified: antargis/trunk/ext/basic/ag_xml.cc
===================================================================
--- antargis/trunk/ext/basic/ag_xml.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_xml.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,11 +20,9 @@
 
 #include &quot;ag_xml.h&quot;
 #include &quot;ag_fs.h&quot;
-#include &quot;ag_debug.h&quot;
-//#ifndef __WIN32__
-//#include &quot;ag_regex.h&quot;
-//#endif
-#include &quot;ag_debug.h&quot;
+
+#include &quot;rk_debug.h&quot;
+
 #include &quot;ag_profiler.h&quot;
 
 /**

Modified: antargis/trunk/ext/basic/ag_xml.h
===================================================================
--- antargis/trunk/ext/basic/ag_xml.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/ag_xml.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,14 +23,15 @@
 #ifndef __MY_SIMPLE_XML
 #define __MY_SIMPLE_XML
 
-#include &lt;ag_tools.h&gt;
-#include &lt;ag_utf8.h&gt;
+#include &lt;rk_tools.h&gt;
+#include &lt;rk_utf8.h&gt;
+#include &quot;rk_debug.h&quot;
+
 #include &lt;vector&gt;
 #include &lt;map&gt;
 #include &lt;ag_stringstream.h&gt;
 #include &lt;sstream&gt;
 
-#include &quot;ag_debug.h&quot;
 
 struct XMLParseError
   {
@@ -63,7 +64,7 @@
     const Node *(operator-&gt;)() const;
 #endif
     NodeVector getChildren(const AGString &amp;pName) const;
-    
+
     const AGString &amp;getName() const;
 
     void setAttributes(const Attributes &amp;pAttrs);
@@ -74,9 +75,11 @@
     void removeChild(Node &amp;n);
 
     iterator begin();
+    iterator end();
+#ifndef SWIG
     const_iterator begin() const;
-    iterator end();
     const_iterator end() const;
+#endif
 
     void setContent(const AGString &amp;s);
     AGString getContent() const;
@@ -91,15 +94,16 @@
     // dumping functions
     void getStart(AGStringStream &amp;s,bool complete=false) const;
     void getEnd(AGStringStream &amp;s) const;
-      
+
     void indent(AGStringStream &amp;s,int depth) const;
     void getContent(AGStringStream &amp;s,int depth) const;
     AGString toString(bool indent=true) const;
-    
+
     bool isTextNode() const;
     AGString getText() const;
 
-    bool hasTextNode() const; // me or direct children is text node
+    /** me or direct children is text node */
+    bool hasTextNode() const; 
 
     size_t size() const;
 
@@ -202,6 +206,6 @@
 
   Document *parse(const AGString &amp;pData,Document *d);
 };
-  
 
+
 #endif

Modified: antargis/trunk/ext/basic/init.cc
===================================================================
--- antargis/trunk/ext/basic/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/basic/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,11 +1,13 @@
 #include &lt;ag_main.h&gt;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 
 #include &lt;list&gt;
 #include &lt;string&gt;
 #include &lt;string&gt;
 #include &lt;map&gt;
 
+#include &lt;SDL.h&gt;
+
 //#include &quot;antargisexternalswig.h&quot;
 
 typedef struct swig_type_info;

Modified: antargis/trunk/ext/external/mtwist.h
===================================================================
--- antargis/trunk/ext/external/mtwist.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/external/mtwist.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,7 +1,7 @@
 #ifndef MTWIST_H
 #define MTWIST_H
 
-#include &lt;ag_base.h&gt;
+#include &lt;rk_base.h&gt;
 
 /*
  * $Id: mtwist.h,v 1.15 2003/09/11 23:56:20 geoff Exp geoff $
@@ -198,7 +198,7 @@
   /* ..Not usually worth the cost.  */
 
 
-  // was extern                    
+  // was extern
 
   AGEXPORT void    mts_refresh(mt_state* state);
   /* Generate 624 more random values */
@@ -341,7 +341,7 @@
 
 #ifdef __cplusplus
 //extern &quot;C&quot; {
-extern &quot;C&quot; 
+extern &quot;C&quot;
 #ifdef WIN32
 /*
 #ifdef MT_EXTERN
@@ -368,7 +368,7 @@
 }
 #else
 #ifdef WIN32
-__declspec(dllexport) 
+__declspec(dllexport)
 #endif
 extern   double    mt_32_to_double;
 #endif*/

Modified: antargis/trunk/ext/game/ant_app.cc
===================================================================
--- antargis/trunk/ext/game/ant_app.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/ant_app.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -13,7 +13,7 @@
   hx=hy=-1;
 }
 
-GLApp::~GLApp()
+GLApp::~GLApp() throw()
   {
     CTRACE;
   }
@@ -168,7 +168,7 @@
     return scene;
   }
 
-void GLApp::mark()
+void GLApp::mark() throw()
   {
     //CTRACE;
     markObject(&amp;scene);

Modified: antargis/trunk/ext/game/ant_app.h
===================================================================
--- antargis/trunk/ext/game/ant_app.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/ant_app.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -12,7 +12,7 @@
  *    \see AntargisGUI
  *    \see Engine3d
  *    \see GameEngine
- * 
+ *
  *    For information about the overall-architecture please refer to the ruby-documentation at: ../ruby/index.html
  *
   */
@@ -24,7 +24,7 @@
 #include &lt;iostream&gt;
 #include &lt;fstream&gt;
 #include &lt;ag_application.h&gt;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &lt;ag_main.h&gt;
 #include &lt;ag_geometry.h&gt;
 
@@ -51,7 +51,7 @@
 
 public:
   GLApp(int w,int h);
-  ~GLApp();
+  ~GLApp() throw();
 
   virtual void draw();
   void drawGL();
@@ -72,7 +72,7 @@
   virtual void setCamera(const AGVector2&amp;p);
   AGVector2 getCamera() const;
 
-  void mark();
+  void mark() throw();
 };
 
 

Modified: antargis/trunk/ext/game/entity.cc
===================================================================
--- antargis/trunk/ext/game/entity.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/entity.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include &quot;entity.h&quot;
 #include &quot;map.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;jobs.h&quot;
 #include &quot;mesh.h&quot;
 #include &quot;anim_mesh.h&quot;
@@ -79,7 +79,7 @@
   }
 
 
-AntEntity::~AntEntity()
+AntEntity::~AntEntity() throw()
   {
     CTRACE;
     //#error called several times
@@ -138,7 +138,7 @@
     Node::const_iterator i=v.begin();
     for(;i!=v.end();i++)
       mPos.loadXML(**i);
-    
+
     AGString entID=node.get(&quot;entityID&quot;);
     if(entID.length()&gt;0)
       mID=entID.toInt();
@@ -651,7 +651,7 @@
 
 
 
-void AntEntity::mark()
+void AntEntity::mark() throw()
   {
     AGRubyObject::mark();
     for(Meshes::iterator i=mMeshes.begin();i!=mMeshes.end();i++)
@@ -674,7 +674,7 @@
   }
 
 
-void AntEntity::clear()
+void AntEntity::clear() throw()
   {
     clearMeshes();
   }

Modified: antargis/trunk/ext/game/entity.h
===================================================================
--- antargis/trunk/ext/game/entity.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/entity.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,11 +23,12 @@
 #ifndef ANT_ENTITY_H
 #define ANT_ENTITY_H
 
+#include &lt;rk_string.h&gt;
+
 #include &quot;scene.h&quot;
 #include &lt;ag_xml.h&gt;
 #include &lt;ag_geometry.h&gt;
 #include &lt;ag_color.h&gt;
-#include &lt;ag_string.h&gt;
 
 #include &lt;set&gt;
 #include &lt;vector&gt;
@@ -72,7 +73,7 @@
     /// current food in stomach
     float mFood;
     /// food needed per second
-    float mHunger; 
+    float mHunger;
     /// hunger impact on energy
     float mHungerHitEnergy;
     /// hunger impact on morale
@@ -96,7 +97,7 @@
 
     float mStrength;
     float mMoraleStrength;
-    
+
     float mDefense;
 
     bool mDefeated;
@@ -111,7 +112,7 @@
 
   public:
     AntEntity(AntMap *pMap);
-    virtual ~AntEntity();
+    virtual ~AntEntity() throw();
 
     bool defeated() const;
 
@@ -201,7 +202,7 @@
 
     void setAggression(float agg);
     float getAggression() const;
-    
+
     virtual void eventDie(); // energy too low
     virtual void eventDefeated(); // morale too low
     virtual void eventHaveDefeated(AntEntity *e);
@@ -262,9 +263,9 @@
     void eventMapChanged();
     void move(float pTime); // move entity FIXME: del move
 
-    void mark();
+    void mark() throw();
 
-    void clear();
+    void clear() throw();
     void clearMeshes();
 
     void setVisible(bool v);

Modified: antargis/trunk/ext/game/entptr.cc
===================================================================
--- antargis/trunk/ext/game/entptr.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/entptr.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,6 @@
+/*
+
 #include &quot;entptr.h&quot;
-// AntEntityPtr
 AntEntityPtr::AntEntityPtr():p(0)
 {
 }
@@ -16,3 +17,5 @@
   assert(p);
   return p;
 }
+
+*/

Modified: antargis/trunk/ext/game/entptr.h
===================================================================
--- antargis/trunk/ext/game/entptr.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/entptr.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,3 +1,5 @@
+/*
+
 #ifndef ENTPTR_H
 #define ENTPTR_H
 
@@ -19,3 +21,6 @@
 
 
 #endif
+
+
+*/

Modified: antargis/trunk/ext/game/height_map.cc
===================================================================
--- antargis/trunk/ext/game/height_map.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/height_map.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -4,7 +4,7 @@
 #include &lt;ag_main.h&gt;
 #include &lt;ag_rand.h&gt;
 
-#include &lt;ag_rtools.h&gt;
+#include &lt;rk_rtools.h&gt;
 
 //////////////////////////////////////////////////////////////////////////
 // HeightMap
@@ -39,11 +39,11 @@
     setTerrainScale(FOREST,23/32.0);
     setTerrainScale(ROCK,31/32.0);
     setTerrainScale(ROCK2,31/32.0);
-    
+
     checkTerrain();
   }
 
-HeightMap::~HeightMap()
+HeightMap::~HeightMap() throw()
   {
     if(mTerrain)
       saveDelete(mTerrain);
@@ -631,7 +631,7 @@
   return found;
 }
 
-void HeightMap::mark()
+void HeightMap::mark() throw()
   {
     //  std::cout&lt;&lt;&quot;HeightMap::mark tihs:&quot;&lt;&lt;this&lt;&lt;&quot; scene:&quot;&lt;&lt;mScene&lt;&lt;std::endl;
     if(mScene)

Modified: antargis/trunk/ext/game/height_map.h
===================================================================
--- antargis/trunk/ext/game/height_map.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/height_map.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -24,7 +24,7 @@
 {
  public:
   HeightMap(SceneBase *pScene,int w,int h);
-  virtual ~HeightMap();
+  virtual ~HeightMap() throw();
 
   // get status
 
@@ -86,7 +86,7 @@
   /// override this function to include another terrain-mesh-type (like 2d-terrain)
   virtual void initTerrainMesh();
 
-  void mark();
+  void mark() throw();
 
   /// to be used by initTerrainMesh() - not otherwise !!!
   void setTerrain(TerrainBase *pTerrain);

Modified: antargis/trunk/ext/game/heuristic.cc
===================================================================
--- antargis/trunk/ext/game/heuristic.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/heuristic.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,11 +1,11 @@
 #include &quot;heuristic.h&quot;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &lt;ag_profiler.h&gt;
 #include &quot;ag_serial_vec.h&quot;
 
 #include &lt;set&gt;
 
-HeuristicFunction::Output HeuristicFunction::operator()(const Input &amp;input) 
+HeuristicFunction::Output HeuristicFunction::operator()(const Input &amp;input)
 {
   return (input.second-input.first).length()*1.5;
 }

Modified: antargis/trunk/ext/game/init.cc
===================================================================
--- antargis/trunk/ext/game/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,4 @@
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 
 #include &lt;minimap.h&gt;
 

Modified: antargis/trunk/ext/game/map.cc
===================================================================
--- antargis/trunk/ext/game/map.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/map.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -24,7 +24,7 @@
 #include &quot;entity.h&quot;
 #include &lt;vector&gt;
 #include &lt;math.h&gt;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &quot;mesh.h&quot;
 #include &quot;terrain.h&quot;
 #include &quot;quadtree.h&quot;
@@ -53,7 +53,7 @@
     myAntargisMap=this;
     maxID=0;
   }
-AntMap::~AntMap()
+AntMap::~AntMap() throw()
   {
     CTRACE;
     if(myAntargisMap==this)
@@ -117,7 +117,7 @@
     std::list&lt;AntEntity*&gt;::iterator k=mEntities.begin();
     for(;k!=mEntities.end();k++)
       (*k)-&gt;eventMapChanged();
-    
+
     return seemsok;
   }
 
@@ -157,7 +157,7 @@
 
 void AntMap::move(float pTime)
   {
-    STACKTRACE; 
+    STACKTRACE;
     //return;
     // first remove entities, which shall be deleted
     std::list&lt;AntEntity*&gt;::iterator d=mToDel.begin();
@@ -228,7 +228,7 @@
 
 
     EntityList::iterator i=mEntities.begin();
-    AGVector2 p=me-&gt;getPos2D(); 
+    AGVector2 p=me-&gt;getPos2D();
 
     for(;i!=mEntities.end();i++)
       {
@@ -370,7 +370,7 @@
     saveFile(pFilename,c);
   }
 
-void AntMap::clear()
+void AntMap::clear() throw()
   {
     //  getScene()-&gt;clear();
     CTRACE;
@@ -438,7 +438,7 @@
 
 //bool markingFinished=true;
 
-void AntMap::mark()
+void AntMap::mark() throw()
   {
     //  cout&lt;&lt;&quot;AntMap::mark()&quot;&lt;&lt;std::endl;
     CTRACE;

Modified: antargis/trunk/ext/game/map.h
===================================================================
--- antargis/trunk/ext/game/map.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/map.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -42,19 +42,20 @@
 {
  public:
   typedef std::list&lt;AntEntity*&gt; EntityList;
+  typedef AntEntity*PAntEntity;
 
   AntMap(SceneBase *pScene,int w,int h);
-  ~AntMap();
-  
+  ~AntMap() throw();
+
   virtual void insertEntity(AntEntity *e);
   virtual void removeEntity(AntEntity *p);
-  void clear();
+  void clear() throw();
 
   int getNewID();
   void useID(int id);
 
   void newMap(int w,int h);
-  
+
   EntityList getEntities(const AGRect2&amp;r);
   std::list&lt;AntEntity*&gt; getAllEntities();
   std::vector&lt;AntEntity*&gt; getEntities(const AGString &amp;pName);
@@ -83,9 +84,9 @@
 
   AGVector3 getPos(const AGVector2 &amp;pPos) const;
 
-  virtual void mark();
+  virtual void mark() throw();
 
-  virtual void mapChanged();  
+  virtual void mapChanged();
 
  private:
   typedef std::map&lt;size_t,AntEntity*&gt; EntityMap;
@@ -95,7 +96,7 @@
   QuadTree&lt;AntEntity&gt; *mEntQuad;
 
   //  typedef std::map&lt;AGString,std::set&lt;AntEntity*&gt; &gt; EntityByType;
-  
+
   EntityList mToDel;
 
   //  EntityByType mByType;

Modified: antargis/trunk/ext/game/minimap.cc
===================================================================
--- antargis/trunk/ext/game/minimap.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/minimap.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,6 +3,7 @@
 #include &lt;ag_screen.h&gt;
 #include &lt;ag_profiler.h&gt;
 #include &quot;ant_app.h&quot;
+#include &quot;entity.h&quot;
 
 #define MAP_BORDER
 
@@ -18,7 +19,7 @@
       setMap(mMap);
     }
 
-MiniMap::~MiniMap()
+MiniMap::~MiniMap() throw()
   {
     saveDelete(mTexture);
   }
@@ -93,7 +94,7 @@
 
     TerrainType t;
 
-    assert(mMap);  
+    assert(mMap);
 
     if(mMap)
       {

Modified: antargis/trunk/ext/game/minimap.h
===================================================================
--- antargis/trunk/ext/game/minimap.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/minimap.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -26,7 +26,7 @@
 {
  public:
   MiniMap(AGWidget *p,const AGRect2 &amp;r,AntMap *pMap);
-  virtual ~MiniMap();
+  virtual ~MiniMap() throw();
   
   /// changes only part of the texture - shouldn't be called if the whole texture is changed, because this is SLOW!
   bool mapChanged(AGEvent *e);

Modified: antargis/trunk/ext/game/path.cc
===================================================================
--- antargis/trunk/ext/game/path.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/path.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -2,7 +2,7 @@
 #include &lt;math.h&gt;
 #include &lt;stdexcept&gt;
 #include &lt;ag_profiler.h&gt;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 //#include &lt;SDL.h&gt;
 #include &lt;ag_surface.h&gt;
 #include &lt;ag_painter.h&gt;
@@ -118,7 +118,7 @@
 {
 }
 
-PathWeighter::~PathWeighter()
+PathWeighter::~PathWeighter() throw()
   {
   }
 float PathWeighter::weight(float h0,float h1)
@@ -214,7 +214,7 @@
       return (b-a)*f;
     }
   else
-    return -(b-a)*f*0.3; 
+    return -(b-a)*f*0.3;
 }
 
 bool MapPathWeighter::accessible(const AGVector2 &amp;a)
@@ -467,7 +467,7 @@
 
 
 
-SimpleGraph::~SimpleGraph()
+SimpleGraph::~SimpleGraph() throw()
   {
     CTRACE;
     for(NodeSet::iterator i=mNodes.begin();i!=mNodes.end();i++)
@@ -566,7 +566,7 @@
   cdebug(&quot;old:&quot;&lt;&lt;(&amp;g));
 }
 
-DecimatedGraph::~DecimatedGraph()
+DecimatedGraph::~DecimatedGraph() throw()
   {
     CTRACE;
   }
@@ -1028,7 +1028,7 @@
     cdebug(&quot;Simplegraph:&quot;&lt;&lt;mGraph);
   }
 
-void Pathfinder::mark()
+void Pathfinder::mark() throw()
   {
     markObject(mGraph);
   }

Modified: antargis/trunk/ext/game/path.h
===================================================================
--- antargis/trunk/ext/game/path.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/path.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -43,7 +43,7 @@
 {
  public:
   PathWeighter(bool pWaterPassable=false);
-  virtual ~PathWeighter();
+  virtual ~PathWeighter() throw();
   /// this function can be overridden - and will be
   virtual float weight(float h0,float h1);
 
@@ -175,7 +175,7 @@
   void print();
   void printInfo();
 
-  ~SimpleGraph();
+  ~SimpleGraph() throw();
 
 
   void check();
@@ -232,7 +232,7 @@
  public:
   DecimatedGraph();
   DecimatedGraph(const SimpleGraph &amp;g);
-  ~DecimatedGraph();
+  ~DecimatedGraph() throw();
   void decimate(float amount,MapPathWeighter *pWeighter);
  private:
   void tryRemove(Edge *e,MapPathWeighter *pWeighter);
@@ -289,7 +289,7 @@
 
   Pathfinder(SimpleGraph *pGraph,HeuristicFunction *pHeuristic,PathDebugging *pDebugger=0);
 
-  virtual void mark();
+  virtual void mark() throw();
 
   std::vector&lt;AGVector2&gt; computePath(const AGVector2 &amp;from, const AGVector2 &amp;to);
 

Modified: antargis/trunk/ext/game/terrain.cc
===================================================================
--- antargis/trunk/ext/game/terrain.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/terrain.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -37,7 +37,7 @@
     setOrder(TERRAIN_Z);
   }
 
-TerrainPiece::~TerrainPiece()
+TerrainPiece::~TerrainPiece() throw()
   {
     if(sceneValid())
       getScene()-&gt;removeNode(this);
@@ -228,7 +228,7 @@
     map.sigMapChangedComplete.connect(slot(this,&amp;TerrainBase::slotMapChangedComplete));
   }
 
-TerrainBase::~TerrainBase()
+TerrainBase::~TerrainBase() throw()
   {
   }
 
@@ -316,7 +316,7 @@
   }
 
 
-Terrain::~Terrain()
+Terrain::~Terrain() throw()
   {
     for(Nodes::iterator i=mNodes.begin();i!=mNodes.end();i++)
       saveDelete(*i);
@@ -344,7 +344,7 @@
     return &mGrass;
   }
 
-void Terrain::mark()
+void Terrain::mark() throw()
   {
     //  std::cout&lt;&lt;&quot;Terrain::mark()&quot;&lt;&lt;std::endl;
     for(Nodes::iterator i=mNodes.begin();i!=mNodes.end();i++)

Modified: antargis/trunk/ext/game/terrain.h
===================================================================
--- antargis/trunk/ext/game/terrain.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/terrain.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -30,7 +30,7 @@
 {
  public:
   TerrainPiece(SceneBase *pScene,Terrain *t,HeightMap &amp;map,int x,int y,int w,int h,const AGVector4 &amp;pPos,int scale);
-  virtual ~TerrainPiece();
+  virtual ~TerrainPiece() throw();
 
   void draw();
   void drawShadow();
@@ -62,7 +62,7 @@
 {
  public:
   TerrainBase(SceneBase *pScene,HeightMap &amp;map);
-  virtual ~TerrainBase();
+  virtual ~TerrainBase() throw();
 
   HeightMap *getMap();
   SceneBase *getScene();
@@ -112,7 +112,7 @@
 public:
   Terrain(SceneBase *pScene,HeightMap &amp;map);
 
-  virtual ~Terrain();
+  virtual ~Terrain() throw();
 
   AGTexture *get3dTexture();
   AGTexture *getGrassTexture();
@@ -122,7 +122,7 @@
   /// the whole map is changed - so better take care of this (texture-upload instead of repainting on GPU)
   virtual void mapChangedComplete();
 
-  void mark();
+  void mark() throw();
 
  private:
   void init();

Modified: antargis/trunk/ext/game/water.cc
===================================================================
--- antargis/trunk/ext/game/water.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/water.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -44,7 +44,7 @@
   }
 
 
-WaterPiece::~WaterPiece()
+WaterPiece::~WaterPiece() throw()
   {
     if(sceneValid())
       getScene()-&gt;removeNode(this);

Modified: antargis/trunk/ext/game/water.h
===================================================================
--- antargis/trunk/ext/game/water.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/game/water.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -26,7 +26,7 @@
   AGTexture tex;
  public:
   WaterPiece(SceneBase *pScene,HeightMap &amp;map,int x,int y,int w,int h,const AGVector4 &amp;pos);
-  virtual ~WaterPiece();
+  virtual ~WaterPiece() throw();
 
   /// draw in normal mode
   void draw();

Modified: antargis/trunk/ext/gui/ag_application.cc
===================================================================
--- antargis/trunk/ext/gui/ag_application.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_application.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,13 +23,14 @@
 #include &quot;ag_screen.h&quot;
 #include &quot;ag_glscreen.h&quot;
 #include &quot;ag_main.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_mixer.h&quot;
 #include &quot;ag_texturecache.h&quot;
 #include &quot;ag_profiler.h&quot;
 #include &quot;ag_clip_painttarget.h&quot;
 #include &quot;ag_video.h&quot;
 #include &quot;ag_vdebug.h&quot;
+#include &quot;ag_painter.h&quot;
 
 #include &lt;ruby.h&gt;
 
@@ -55,7 +56,7 @@
     mDemoTime=-1;
   }
 
-AGApplication::~AGApplication()
+AGApplication::~AGApplication() throw()
   {
     CTRACE;
     if(mainWidget)
@@ -377,7 +378,7 @@
 
         pLastDrawn=mainWidget;
 
-        saveDelete( p);
+        saveDelete(p);
       }
     else
       cdebug(&quot;no mainwidget&quot;);
@@ -389,10 +390,10 @@
         changeList=mainWidget-&gt;aquireChanges();
         mainWidget-&gt;clearChangeRects();
       }
-    
-    
+
+
     sigFrameFinished(new AGEvent(this,&quot;sigFrameFinished&quot;));
-    
+
     if (opengl())// || true)
       getScreen().flip();
     else
@@ -473,7 +474,7 @@
   }
 
 /// mark my mainWidget and my tooltip, as they can be ruby-objects
-void AGApplication::mark()
+void AGApplication::mark() throw()
   {
 //    CTRACE;
     if (mainWidget)

Modified: antargis/trunk/ext/gui/ag_application.h
===================================================================
--- antargis/trunk/ext/gui/ag_application.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_application.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -79,7 +79,7 @@
 {
  public:
   AGApplication();
-  virtual ~AGApplication();
+  virtual ~AGApplication() throw();
 
   bool run();
 
@@ -157,7 +157,7 @@
   float mDemoTime;
   
  public:
-  void mark();
+  void mark() throw();
 };
 
 /**

Modified: antargis/trunk/ext/gui/ag_background.cc
===================================================================
--- antargis/trunk/ext/gui/ag_background.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_background.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,7 +21,7 @@
 #include &quot;ag_background.h&quot;
 #include &quot;ag_draw.h&quot;
 #include &quot;ag_theme.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_painter.h&quot;
 #include &quot;ag_texturecache.h&quot;
 
@@ -70,7 +70,7 @@
 void AGBackground::loadFromTheme(const AGLocalTheme &amp;pTheme,const AGString &amp;pThemeName)
   {
     mColor=false;
-    
+
     if(pTheme.hasSurface(pThemeName+&quot;.image&quot;))
       {
         cdebug(pThemeName+&quot;.image&quot;);
@@ -93,7 +93,7 @@
         mColors[3]=pTheme.getColor(pThemeName+&quot;.&quot;+&quot;color&quot;);
       }
 
-    mBorder=pTheme.getInt(pThemeName+&quot;.&quot;+&quot;border&quot;);    
+    mBorder=pTheme.getInt(pThemeName+&quot;.&quot;+&quot;border&quot;);
   }
 
 

Modified: antargis/trunk/ext/gui/ag_button.cc
===================================================================
--- antargis/trunk/ext/gui/ag_button.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_button.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,7 +22,7 @@
 #include &quot;ag_draw.h&quot;
 #include &quot;ag_edit.h&quot;
 #include &quot;ag_theme.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_image.h&quot;
 #include &quot;ag_border.h&quot;
 #include &quot;ag_glscreen.h&quot;
@@ -63,9 +63,13 @@
 
     if(opengl())
       setCaching(true);
-      
+
   }
+AGButton::~AGButton() throw()
+  {}
 
+
+
 void AGButton::setSurface(AGSurface pSurface,bool pChangeSize)
   {
     mSurface=pSurface;
@@ -140,9 +144,9 @@
 
     if(mState==NORMAL || mState==LIGHTED)
       p.drawBorder(mr,borderWidth,bc1,bc2);
-    else 
+    else
       p.drawBorder(mr,borderWidth,bc2,bc1);
-      
+
   }
 
 
@@ -261,7 +265,7 @@
 }
 
 /**
-   dis- or enables the button. disabled buttons are typically displayed greyed and are 
+   dis- or enables the button. disabled buttons are typically displayed greyed and are
    not hoverable or clckable
 
    \param pEnable true or false

Modified: antargis/trunk/ext/gui/ag_button.h
===================================================================
--- antargis/trunk/ext/gui/ag_button.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_button.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -57,6 +57,7 @@
    };
 
   AGButton(AGWidget *pParent,const AGRect2 &amp;r,const AGStringUtf8&amp;pText=&quot;&quot;,int id=-1);
+  virtual ~AGButton() throw();
 
   void setSurface(AGSurface pSurface,bool pChangeSize=false);
   void setTexture(const AGTexture &amp;pTexture);

Modified: antargis/trunk/ext/gui/ag_caption.cc
===================================================================
--- antargis/trunk/ext/gui/ag_caption.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_caption.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include &quot;ag_caption.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_screen.h&quot;
 
 AGCaption::AGCaption(AGWidget *pParent,const AGRect2 &amp;pRect,const AGStringUtf8 &amp;pText,const AGFont &amp;pFont,const AGBackground &amp;pBG):

Modified: antargis/trunk/ext/gui/ag_checkbox.cc
===================================================================
--- antargis/trunk/ext/gui/ag_checkbox.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_checkbox.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,7 +22,7 @@
 #include &quot;ag_image.h&quot;
 #include &quot;ag_text.h&quot;
 #include &quot;ag_theme.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_layoutfactory.h&quot;
 #include &quot;ag_local.h&quot;
 

Modified: antargis/trunk/ext/gui/ag_colorbutton.cc
===================================================================
--- antargis/trunk/ext/gui/ag_colorbutton.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_colorbutton.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -26,6 +26,10 @@
   {
   }
 
+AGColorButton::~AGColorButton() throw()
+  {}
+
+
 void AGColorButton::draw(AGPainter &amp;p)
   {
     AGWidget::draw(p);

Modified: antargis/trunk/ext/gui/ag_colorbutton.h
===================================================================
--- antargis/trunk/ext/gui/ag_colorbutton.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_colorbutton.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -31,6 +31,7 @@
 {
  public:
   AGColorButton(AGWidget *pParent,const AGRect2 &amp;r,int x,int y);
+  virtual ~AGColorButton() throw();
 
   virtual void draw(AGPainter &amp;p);
 

Modified: antargis/trunk/ext/gui/ag_combo.cc
===================================================================
--- antargis/trunk/ext/gui/ag_combo.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_combo.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,7 +21,7 @@
 #include &quot;ag_application.h&quot;
 #include &quot;ag_button.h&quot;
 #include &quot;ag_combo.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_edit.h&quot;
 #include &quot;ag_listbox.h&quot;
 #include &quot;ag_theme.h&quot;
@@ -44,7 +44,10 @@
     mButton-&gt;sigClick.connect(slot(this,&amp;AGComboBox::eventButtonClicked));
   }
 
+AGComboBox::~AGComboBox() throw()
+  {}
 
+
 void AGComboBox::insertItem(const AGString &amp;pID,const AGStringUtf8 &amp;pContent)
   {
     ops.push_back(std::make_pair(pID,pContent));
@@ -121,7 +124,7 @@
     update();
   }
 
-void AGComboBox::clear()
+void AGComboBox::clear() throw()
   {
     ops.clear();
     mID=&quot;&quot;;

Modified: antargis/trunk/ext/gui/ag_combo.h
===================================================================
--- antargis/trunk/ext/gui/ag_combo.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_combo.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -33,6 +33,7 @@
 {
  public:
   AGComboBox(AGWidget *pParent,const AGRect2 &amp;pRect);
+  virtual ~AGComboBox() throw();
 
   void insertItem(const AGString &amp;pID,const AGStringUtf8 &amp;pContent);
 
@@ -44,7 +45,7 @@
   AGString getSelected() const;
   void setSelected(const AGString &amp;pID);
 
-  void clear();
+  void clear() throw();
   
   virtual void setWidth(float w);
   virtual void setHeight(float w);

Modified: antargis/trunk/ext/gui/ag_edit.cc
===================================================================
--- antargis/trunk/ext/gui/ag_edit.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_edit.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,13 +19,15 @@
  */
 
 #include &quot;ag_edit.h&quot;
+
+#include &quot;rk_debug.h&quot;
+#include &quot;rk_tools.h&quot;
+
 #include &quot;ag_fontengine.h&quot;
 #include &quot;ag_theme.h&quot;
-#include &quot;ag_debug.h&quot;
 #include &quot;ag_menu.h&quot;
 #include &quot;ag_sgeexport.h&quot;
 #include &quot;ag_glscreen.h&quot;
-#include &quot;ag_tools.h&quot;
 
 
 AGEditLine::AGEditLine(const AGStringUtf8 &amp;pText,AGFont pFont,bool pHardEnd):
@@ -292,6 +294,10 @@
       setTheme(&quot;edit&quot;);
     }
 
+AGEdit::~AGEdit()  throw()
+  {}
+
+
 void AGEdit::setMaxLength(int i)
   {
     mMaxLength=i;
@@ -481,7 +487,7 @@
       {
         cdebug(&quot;RETUURN!&quot;);
         cdebug(mMultiLine);
-        if(mMultiLine) 
+        if(mMultiLine)
           {
             getActLine();
             AGEditLine l=actLine-&gt;split(mCx);
@@ -888,7 +894,7 @@
   return AGStringUtf8(os.str());
 }
 
-void AGEdit::clear()
+void AGEdit::clear() throw()
   {
     mLines.clear();
     mCx=mCy=0;

Modified: antargis/trunk/ext/gui/ag_edit.h
===================================================================
--- antargis/trunk/ext/gui/ag_edit.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_edit.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -27,7 +27,7 @@
 #include &quot;ag_font.h&quot;
 #include &quot;ag_surface.h&quot;
 #include &quot;ag_background.h&quot;
-#include &quot;ag_utf8.h&quot;
+#include &quot;rk_utf8.h&quot;
 #include &quot;ag_string_utf8.h&quot;
 
 enum AGAlign {EDIT_LEFT,EDIT_RIGHT,EDIT_JUSTIFY,EDIT_CENTER};
@@ -44,7 +44,7 @@
 
   virtual void draw(AGPainter &amp;p,const AGVector2 &amp;pPoint,const AGRect2 &amp;pClip);
   virtual void drawCursor(AGPainter &amp;p,int cx,const AGVector2 &amp;pPoint,const AGRect2 &amp;pClip,const AGColor &amp;c);
-  
+
   int height() const;
   int width() const;
 
@@ -80,6 +80,7 @@
 {
  public:
   AGEdit(AGWidget *pParent,const AGRect2 &amp;pRect);
+  virtual ~AGEdit()  throw();
 
   virtual void draw(AGPainter &amp;p);
   virtual void drawBackground(AGPainter &amp;p);
@@ -95,7 +96,7 @@
   void setText(const AGStringUtf8 &amp;pText);
   void setFont(const AGFont &amp;pFont);
 
-  void clear();
+  void clear() throw();
 
   void setMutable(bool pMutable);
 
@@ -121,7 +122,7 @@
   void setInsert(bool pInsert);
 
   void setCursor(int p);
-  
+
   AGSignal sigModified;
 
  private:
@@ -134,10 +135,10 @@
 
   std::list&lt;AGEditLine&gt; mLines;
   AGEditLine *actLine;
-  
+
   int mCx,mCy; // cursor position
   int mViewCy;
-  
+
   Uint32 mCursorTime;
   Uint32 mCursorLast;
   bool mShowCursor;

Modified: antargis/trunk/ext/gui/ag_frame.cc
===================================================================
--- antargis/trunk/ext/gui/ag_frame.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_frame.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,7 +1,8 @@
 #include &quot;ag_frame.h&quot;
 #include &quot;ag_screen.h&quot;
-#include &quot;ag_debug.h&quot;
 
+#include &quot;rk_debug.h&quot;
+
 AGFrame::AGFrame(AGWidget *pParent,const AGRect2 &amp;pRect,int pWidth,int pWidthH):AGWidget(pParent,pRect),
 mWidth(pWidth),mBorder(0),mWidthH(pWidthH&lt;0?pWidth:pWidthH),mTexture((int)width(),(int)height())
 {
@@ -17,7 +18,7 @@
   mBg=0;
 }
 
-AGFrame::~AGFrame()
+AGFrame::~AGFrame() throw()
   {
     delete mBorder;
     delete mBg;

Modified: antargis/trunk/ext/gui/ag_frame.h
===================================================================
--- antargis/trunk/ext/gui/ag_frame.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_frame.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -12,7 +12,7 @@
  public:
   AGFrame(AGWidget *pParent,const AGRect2 &amp;pRect,int width,int widthH=-1); // transparent frame
   AGFrame(AGWidget *pParent,const AGRect2 &amp;pRect,const AGBorder &amp;pBorder);
-  ~AGFrame();
+  ~AGFrame() throw();
 
   void setBackground(const AGBackground &amp;pBg);
 

Modified: antargis/trunk/ext/gui/ag_image.cc
===================================================================
--- antargis/trunk/ext/gui/ag_image.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_image.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include &quot;ag_image.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 
 AGImage::AGImage(AGWidget *pParent,const AGRect2 &amp;r,AGSurface pSurface,bool pTile):
   AGWidget(pParent,r),
@@ -37,7 +37,7 @@
 
 
 
-AGImage::~AGImage()
+AGImage::~AGImage() throw()
   {
   }
 

Modified: antargis/trunk/ext/gui/ag_image.h
===================================================================
--- antargis/trunk/ext/gui/ag_image.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_image.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -31,7 +31,7 @@
  public:
   AGImage(AGWidget *pParent,const AGRect2 &amp;r,AGSurface pSurface,bool pTile);
   AGImage(AGWidget *pParent,const AGRect2 &amp;r,AGTexture pTexture,bool pTile);
-  virtual ~AGImage();
+  virtual ~AGImage() throw();
 
   virtual void draw(AGPainter &amp;p);
 

Modified: antargis/trunk/ext/gui/ag_layout.cc
===================================================================
--- antargis/trunk/ext/gui/ag_layout.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_layout.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include &quot;ag_layout.h&quot;
 #include &quot;ag_xml.h&quot;
-#include &quot;ag_tools.h&quot;
+#include &quot;rk_tools.h&quot;
 #include &quot;ag_theme.h&quot;
 #include &quot;ag_listbox.h&quot;
 #include &quot;ag_combo.h&quot;
@@ -45,13 +45,17 @@
     CTRACE;
   }
 
+AGLayout::~AGLayout() throw()
+  {}
+
+
 void AGLayout::loadXML(const std::string &amp;pXMLData)
   {
     CTRACE;
     getLayoutFactory()-&gt;pushLayout(this);
 
     // disable GC here
-    // marking makes problems here - as the widgets are not inserted into the tree 
+    // marking makes problems here - as the widgets are not inserted into the tree
     // when _() is called, which itself is a ruby-dependent thingy
     Document p;
     p.parseMemory(pXMLData);
@@ -233,7 +237,7 @@
   }
 
 
-void AGLayout::mark()
+void AGLayout::mark() throw()
   {
     AGWidget::mark();
     for(std::set&lt;AGWidget*&gt;::iterator i=mTempWidgets.begin();i!=mTempWidgets.end();i++)

Modified: antargis/trunk/ext/gui/ag_layout.h
===================================================================
--- antargis/trunk/ext/gui/ag_layout.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_layout.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -32,6 +32,7 @@
 {
  public:
   AGLayout(AGWidget *pgParent);
+  virtual ~AGLayout() throw();
   
   virtual void loadXML(const std::string &amp;pXMLData);
 
@@ -42,7 +43,7 @@
 
   static void registerLayouts();
 
-  virtual void mark();
+  virtual void mark() throw();
  private:
   void insertTempWidget(AGWidget *pWidget);
    

Modified: antargis/trunk/ext/gui/ag_layoutfactory.cc
===================================================================
--- antargis/trunk/ext/gui/ag_layoutfactory.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_layoutfactory.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include &quot;ag_layoutfactory.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_kill.h&quot;
 
 AGLayoutCreator::AGLayoutCreator():mWidget(0),mClient(0)
@@ -59,7 +59,7 @@
     mClient=0;
   }
 
-void AGLayoutCreator::mark()
+void AGLayoutCreator::mark() throw()
   {
     if(mWidget)
       markObject(mWidget);

Modified: antargis/trunk/ext/gui/ag_layoutfactory.h
===================================================================
--- antargis/trunk/ext/gui/ag_layoutfactory.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_layoutfactory.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -24,7 +24,7 @@
 #define AG_LAYOUTFACTORY_H
 
 #include &lt;ag_singleton.h&gt;
-#include &lt;ag_utf8.h&gt;
+#include &lt;rk_utf8.h&gt;
 #include &lt;ag_widget.h&gt;
 #include &lt;ag_xml.h&gt;
 #include &lt;ag_layout.h&gt;
@@ -42,12 +42,12 @@
 
   void clearResult();
 
-  void mark();
+  void mark() throw();
  private:
-   
+
   AGWidget *mWidget,*mClient;
-  
 
+
 };
 
 class AGEXPORT AGLayoutFactory
@@ -62,9 +62,9 @@
   void removeCreator(const AGString &amp;pName,AGLayoutCreator *creator);
 
   std::pair&lt;AGWidget*,AGWidget*&gt; create(AGWidget *pParent,const AGRect2 &amp;pRect,const Node &amp;pNode);
-  
+
   friend AGLayoutFactory *getLayoutFactory();
-  
+
   friend void AGLayout::loadXML(const std::string &amp;pXMLData);
 
   AGLayout *getCurrentLayout();

Modified: antargis/trunk/ext/gui/ag_listbox.cc
===================================================================
--- antargis/trunk/ext/gui/ag_listbox.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_listbox.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -18,7 +18,7 @@
  * License along with this program.
  */
 
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_edit.h&quot;
 #include &quot;ag_listbox.h&quot;
 #include &quot;ag_theme.h&quot;
@@ -66,10 +66,14 @@
   mHeight=count;
   mY=0;
   mSelected=-1;
-  
+
   setTheme(&quot;&quot;);
 }
 
+AGListBox::~AGListBox() throw()
+  {}
+
+
 void AGListBox::setTheme(const AGString &amp;pTheme)
   {
     AGString themeName=pTheme;
@@ -77,7 +81,7 @@
       themeName=&quot;listbox&quot;;
     else
       themeName+=&quot;listbox&quot;;
-    
+
     AGLocalTheme theme=getTheme()-&gt;getTheme(themeName);
     mBackground=AGBackground(theme,&quot;background&quot;);
     mHilight=AGBackground(theme,&quot;selected&quot;);
@@ -89,8 +93,8 @@
       (*i)-&gt;setFont(f);
 
     rearrange();
-    
-    
+
+
   }
 
 void AGListBox::rearrange()

Modified: antargis/trunk/ext/gui/ag_listbox.h
===================================================================
--- antargis/trunk/ext/gui/ag_listbox.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_listbox.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -45,7 +45,8 @@
 {
  public:
   AGListBox(AGWidget *pParent,const AGRect2 &amp;pRect);
-
+  virtual ~AGListBox() throw();
+  
   void insertItem(AGString pID,AGStringUtf8 pValue);
   void selectItem(AGString pID);
 

Modified: antargis/trunk/ext/gui/ag_local.cc
===================================================================
--- antargis/trunk/ext/gui/ag_local.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_local.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,12 +19,12 @@
  */
 
 #include &quot;ag_local.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 
 
 AGLocalizer *gLocalizer=0;
 
-AGLocalizer::~AGLocalizer()
+AGLocalizer::~AGLocalizer() throw()
   {
     if(gLocalizer==this)
       gLocalizer=0;
@@ -38,7 +38,6 @@
 
 void setLocalizer(AGLocalizer *p)
   {
-    cdebug(&quot;setLocal:&quot;&lt;&lt;p);
     gLocalizer=p;
   }
 

Modified: antargis/trunk/ext/gui/ag_local.h
===================================================================
--- antargis/trunk/ext/gui/ag_local.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_local.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,17 +23,17 @@
 #ifndef AG_LOCAL_H
 #define AG_LOCAL_H
 
-#include &lt;ag_rubyobj.h&gt;
-#include &lt;ag_string.h&gt;
+#include &lt;rk_rubyobj.h&gt;
+#include &lt;rk_string.h&gt;
 #include &lt;ag_string_utf8.h&gt;
 
 class AGEXPORT AGLocalizer:public AGRubyObject
 {
  public:
-  virtual ~AGLocalizer();
-  
+  virtual ~AGLocalizer() throw();
+
   virtual AGStringUtf8 find(const AGString &amp;p);
-  
+
 };
 
 AGEXPORT void setLocalizer(AGLocalizer *p);

Modified: antargis/trunk/ext/gui/ag_menu.cc
===================================================================
--- antargis/trunk/ext/gui/ag_menu.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_menu.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -25,7 +25,7 @@
 #include &quot;ag_surface.h&quot;
 #include &quot;ag_theme.h&quot;
 
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 
 using namespace std;
 
@@ -42,6 +42,9 @@
     mH=0;
   }
 
+AGMenu::~AGMenu()  throw()
+  {}
+
 void AGMenu::show(AGVector2 pWishPos)
   {
     AGWidget::show();
@@ -49,11 +52,6 @@
     AGVector2 p=fromScreen(mWishPos);
     setTop(p[1]);
     setLeft(p[0]);
-
-    std::list&lt;AGWidget*&gt;::iterator i=mChildren.begin();
-    for(;i!=mChildren.end();i++)
-      cdebug((*i)-&gt;getRect().toString());
-
   }
 
 void AGMenu::addItem(const AGStringUtf8 &amp;pString)

Modified: antargis/trunk/ext/gui/ag_menu.h
===================================================================
--- antargis/trunk/ext/gui/ag_menu.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_menu.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -30,6 +30,7 @@
 {
  public:
   AGMenu(AGWidget *pParent,AGVector2 pWishPos,const AGStringUtf8 &amp;pName);
+  virtual ~AGMenu() throw();
 
   void show(AGVector2 pWishPos);
 

Modified: antargis/trunk/ext/gui/ag_menuitem.cc
===================================================================
--- antargis/trunk/ext/gui/ag_menuitem.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_menuitem.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,6 @@
  */
 
 #include &quot;ag_menuitem.h&quot;
-#include &quot;ag_debug.h&quot;
 #include &quot;ag_draw.h&quot;
 #include &quot;ag_theme.h&quot;
 #include &quot;ag_image.h&quot;
@@ -45,7 +44,7 @@
     addChild(1,0,new AGText(this,getRect().origin(),pText,font));
 
   }
-AGMenuItem::~AGMenuItem()
+AGMenuItem::~AGMenuItem() throw()
   {
   }
 
@@ -119,7 +118,6 @@
 
 bool AGMenuItem::eventMouseClick(AGEvent *m)
   {
-    cdebug(&quot;bool AGMenuItem::eventMouseClick(const AGEvent *m)&quot;);
     AGMenu *me=dynamic_cast&lt;AGMenu*&gt;(getParent());
     if(me)
       {
@@ -142,7 +140,7 @@
     mSubMenu-&gt;hide();
   }
 
-AGSubMenu::~AGSubMenu()
+AGSubMenu::~AGSubMenu() throw()
   {
   }
 

Modified: antargis/trunk/ext/gui/ag_menuitem.h
===================================================================
--- antargis/trunk/ext/gui/ag_menuitem.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_menuitem.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -32,7 +32,7 @@
 {
  public:
   AGMenuItem(AGWidget *pParent,const AGStringUtf8 &amp;pText);
-  virtual ~AGMenuItem();
+  virtual ~AGMenuItem() throw();
 
   void draw(AGPainter &amp;p);
 
@@ -59,7 +59,7 @@
 {
  public:
   AGSubMenu(AGWidget *pParent,const AGStringUtf8 &amp;ptext);
-  virtual ~AGSubMenu();
+  virtual ~AGSubMenu() throw();
 
   AGMenu *getMenu();
 

Modified: antargis/trunk/ext/gui/ag_radio.cc
===================================================================
--- antargis/trunk/ext/gui/ag_radio.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_radio.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -46,7 +46,7 @@
       mGroup-&gt;add(this);
   }
 
-AGRadio::~AGRadio()
+AGRadio::~AGRadio() throw()
   {
     if(mGroup)
       mGroup-&gt;erase(this);

Modified: antargis/trunk/ext/gui/ag_radio.h
===================================================================
--- antargis/trunk/ext/gui/ag_radio.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_radio.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -31,7 +31,7 @@
 {
  public:
   AGRadio(AGWidget *pParent,AGRect2 pRect);
-  virtual ~AGRadio();
+  virtual ~AGRadio() throw();
 
   void setGroup(AGRadioGroup *pGroup);
   bool eventMouseClick(AGEvent *m);

Modified: antargis/trunk/ext/gui/ag_radiogroup.cc
===================================================================
--- antargis/trunk/ext/gui/ag_radiogroup.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_radiogroup.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -33,7 +33,7 @@
   sigChanged(this,&quot;sigChanged&quot;)
   {
   }
-AGRadioGroup::~AGRadioGroup()
+AGRadioGroup::~AGRadioGroup() throw()
   {
     std::set&lt;AGRadio*&gt;::iterator i=mChildren.begin();
 

Modified: antargis/trunk/ext/gui/ag_radiogroup.h
===================================================================
--- antargis/trunk/ext/gui/ag_radiogroup.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_radiogroup.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -32,7 +32,7 @@
 {
  public:
   AGRadioGroup(AGWidget *pParent,const AGRect2 &amp;pr);
-  virtual ~AGRadioGroup();
+  virtual ~AGRadioGroup() throw();
 
   virtual void eventChange(const AGString &amp;p);
 

Modified: antargis/trunk/ext/gui/ag_screenwidget.cc
===================================================================
--- antargis/trunk/ext/gui/ag_screenwidget.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_screenwidget.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,21 +22,17 @@
 #include &quot;ag_screenwidget.h&quot;
 #include &quot;ag_surface.h&quot;
 #include &quot;ag_theme.h&quot;
-#include &quot;ag_debug.h&quot;
 
 
 AGScreenWidget::AGScreenWidget():
   AGWidget(0,getScreen().getRect())
   {
-    //  mTexture=AGTexture(getTheme()-&gt;getSurface(&quot;screen.background.image&quot;));
   }
-AGScreenWidget::~AGScreenWidget()
+AGScreenWidget::~AGScreenWidget() throw()
   {
   }
 
 void AGScreenWidget::draw(AGPainter &amp;p)
   {
-    //  p.clip(AGRect2(10,10,50,50));
-    //p.tile(mTexture);
     p.fillRect(p.getRect().origin(),AGColor(0,0,0));
   }

Modified: antargis/trunk/ext/gui/ag_screenwidget.h
===================================================================
--- antargis/trunk/ext/gui/ag_screenwidget.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_screenwidget.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -30,7 +30,7 @@
 {
  public:
   AGScreenWidget();
-  virtual ~AGScreenWidget();
+  virtual ~AGScreenWidget() throw();
 
   virtual void draw(AGPainter &amp;p);
  private:

Modified: antargis/trunk/ext/gui/ag_scroller.cc
===================================================================
--- antargis/trunk/ext/gui/ag_scroller.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_scroller.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #include &quot;ag_button.h&quot;
 #include &quot;ag_border.h&quot;
 #include &quot;ag_background.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 
 AGScroller::AGScroller(AGWidget *pParent,const AGRect2 &amp;pRect,bool pHor):
   AGWidget(pParent,pRect),
@@ -91,7 +91,7 @@
     setCaching(true);
   }
 
-AGScroller::~AGScroller()
+AGScroller::~AGScroller() throw()
   {
     delete mBorder;
     delete mBackground;

Modified: antargis/trunk/ext/gui/ag_scroller.h
===================================================================
--- antargis/trunk/ext/gui/ag_scroller.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_scroller.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -33,7 +33,7 @@
 {
  public:
   AGScroller(AGWidget *pParent,const AGRect2 &amp;pRect,bool pHor);
-  ~AGScroller();
+  ~AGScroller() throw();
 
   void draw(AGPainter &amp;p);
 

Modified: antargis/trunk/ext/gui/ag_table.cc
===================================================================
--- antargis/trunk/ext/gui/ag_table.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_table.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include &quot;ag_table.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 
 AGTable::AGTable(AGWidget *pWidget,const AGRect2 &amp;pRect):
   AGWidget(pWidget,pRect),
@@ -27,7 +27,7 @@
   {
   }
 
-AGTable::~AGTable()
+AGTable::~AGTable() throw()
   {
   }
 
@@ -227,8 +227,8 @@
           }
         mfx=std::max(mfx,fx);
       }
-    
-    // TODO: assign width's and heights for all fixed !!! 
+
+    // TODO: assign width's and heights for all fixed !!!
     for(mx=0;mx&lt;w;mx++)
       for(my=0;my&lt;h;my++)
         {
@@ -273,7 +273,7 @@
         }
 
     // assign positions
-    // first x 
+    // first x
     float ax=0;
     for(mx=0;mx&lt;w;mx++)
       {

Modified: antargis/trunk/ext/gui/ag_table.h
===================================================================
--- antargis/trunk/ext/gui/ag_table.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_table.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -39,7 +39,7 @@
 {
  public:
   AGTable(AGWidget *pWidget,const AGRect2 &amp;pRect);
-  virtual ~AGTable();
+  virtual ~AGTable() throw();
 
   void addFixedColumn(float size);
   void addFixedRow(float size);

Modified: antargis/trunk/ext/gui/ag_text.cc
===================================================================
--- antargis/trunk/ext/gui/ag_text.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_text.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 
 #include &quot;ag_text.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_surface.h&quot;
 #include &quot;ag_fontengine.h&quot;
 #include &quot;ag_geometry.h&quot;
@@ -44,6 +44,10 @@
     mFixedSize=false;
   }
 
+AGText::~AGText() throw()
+  {}
+
+
 void AGText::draw(AGPainter &amp;p)
   {
     float x=(width()-mFont.getWidth(mText))/2;

Modified: antargis/trunk/ext/gui/ag_text.h
===================================================================
--- antargis/trunk/ext/gui/ag_text.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_text.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -33,7 +33,8 @@
 #ifndef SWIG
   AGText(AGWidget *pParent,const AGVector2 &amp;pPoint,const AGStringUtf8 &amp;pText,const AGFont &amp;pFont);
 #endif
-
+  virtual ~AGText() throw();
+  
   void setDeriveRect();
   virtual void draw(AGPainter &amp;p);
 

Modified: antargis/trunk/ext/gui/ag_theme.cc
===================================================================
--- antargis/trunk/ext/gui/ag_theme.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_theme.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,9 +19,11 @@
  */
 
 #include &quot;ag_theme.h&quot;
-#include &quot;ag_debug.h&quot;
+
+#include &quot;rk_debug.h&quot;
+#include &quot;rk_tools.h&quot;
+
 #include &quot;ag_xml.h&quot;
-#include &quot;ag_tools.h&quot;
 #include &quot;ag_config.h&quot;
 
 #include &lt;iostream&gt;
@@ -33,7 +35,7 @@
   {
   }
 
-AGTheme::~AGTheme()
+AGTheme::~AGTheme() throw()
   {
   }
 
@@ -195,7 +197,7 @@
     }
   return i-&gt;second;
 }
- 
+
 AGBackground AGTheme::getBackground(const AGString &amp;pName) const
 {
   std::map&lt;AGString,AGBackground&gt;::const_iterator i=mBackgrounds.find(pName);
@@ -227,6 +229,9 @@
       {
       }
 
+AGLocalTheme::~AGLocalTheme() throw()
+  {}
+
 AGFont AGLocalTheme::getFont(const AGString &amp;pName) const
   {
     AGString t=getName(pName);
@@ -272,7 +277,7 @@
 }
 bool AGLocalTheme::hasColor(const AGString &amp;pName) const
 {
-  return getTheme()-&gt;hasColor(getName(pName));  
+  return getTheme()-&gt;hasColor(getName(pName));
 }
 bool AGLocalTheme::hasInt(const AGString &amp;pName) const
 {

Modified: antargis/trunk/ext/gui/ag_theme.h
===================================================================
--- antargis/trunk/ext/gui/ag_theme.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_theme.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #ifndef AG_THEME_H
 #define AG_THEME_H
 
-#include &quot;ag_base.h&quot;
+#include &quot;rk_base.h&quot;
 #include &quot;ag_font.h&quot;
 #include &quot;ag_surface.h&quot;
 
@@ -34,40 +34,41 @@
 #include &lt;map&gt;
 
 
-class AGEXPORT AGLocalTheme
+class AGEXPORT AGLocalTheme:public AGRubyObject
   {
   public:
     AGLocalTheme(const AGString &amp;pTheme);
-    
+    virtual ~AGLocalTheme() throw();
+
     AGFont getFont(const AGString &amp;pName) const;
     AGColor getColor(const AGString &amp;pName) const;
     int getInt(const AGString &amp;pName) const;
     AGSurface getSurface(const AGString &amp;pName) const;
     std::string getSurfaceName(const AGString &amp;pName) const;
-    
+
     bool hasFont(const AGString &amp;pName) const;
     bool hasColor(const AGString &amp;pName) const;
     bool hasInt(const AGString &amp;pName) const;
     bool hasSurface(const AGString &amp;pName) const;
     bool hasSurfaceName(const AGString &amp;pName) const;
-    
+
   private:
-    
+
     AGString getName(const AGString &amp;pName) const;
-    
+
     AGString mTheme;
   };
 
-class AGEXPORT AGTheme
+class AGEXPORT AGTheme:public AGRubyObject
 {
  public:
   AGTheme();
-  virtual ~AGTheme();
+  virtual ~AGTheme() throw();
 
   AGFont getFont(const AGString &amp;pName) const;
   bool hasFont(const AGString &amp;pName) const;
   void setFont(const AGString &amp;pName,AGFont pFont);
-  
+
   void setColor(const AGString &amp;pName,AGColor pColor);
   AGColor getColor(const AGString &amp;pName) const;
   bool hasColor(const AGString &amp;pName) const;
@@ -84,18 +85,18 @@
   bool hasSurfaceName(const AGString &amp;pName) const;
   void setSurfaceName(const AGString &amp;pName,const std::string &amp;pSurface);
 
-  
+
   AGLocalTheme getTheme(const AGString &amp;pTheme) const;
-  
-  
-  
+
+
+
   // advanced functions
-  
+
   AGGradient getGradient(const AGString &amp;pName) const;
   AGBackground getBackground(const AGString &amp;pName) const;
   AGBorder getBorder(const AGString &amp;pName) const;
-  
 
+
  private:
 
   AGString trunc(AGString s) const;
@@ -105,12 +106,12 @@
   std::map&lt;AGString,AGSurface&gt; mSurfaces;
   std::map&lt;AGString,std::string&gt; mSurfaceNames;
   std::map&lt;AGString,int&gt; mInts;
-  
-  
+
+
   std::map&lt;AGString,AGGradient&gt; mGradients;
   std::map&lt;AGString,AGBackground&gt; mBackgrounds;
   std::map&lt;AGString,AGBorder&gt; mBorders;
-  
+
 };
 
 AGEXPORT AGTheme *getTheme();

Modified: antargis/trunk/ext/gui/ag_theme_v2.cc
===================================================================
--- antargis/trunk/ext/gui/ag_theme_v2.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_theme_v2.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,9 +19,11 @@
  */
 
 #include &quot;ag_theme_v2.h&quot;
-#include &quot;ag_debug.h&quot;
+
+#include &quot;rk_debug.h&quot;
+#include &quot;rk_tools.h&quot;
+
 #include &quot;ag_xml.h&quot;
-#include &quot;ag_tools.h&quot;
 #include &quot;ag_config.h&quot;
 
 #include &lt;iostream&gt;
@@ -285,7 +287,20 @@
 }
 
 
+bool AGThemeV2::hasSurface(const AGString &amp;pName) const
+{
+  //FIXME
+  return true;
+}
+bool AGThemeV2::hasColor(const AGString &amp;pName) const
+{
 
+  //FIXME
+  return true;
+}
+
+
+
 ////////////////////////////////////////////////////////
 // AGThemeItem
 ////////////////////////////////////////////////////////
@@ -302,11 +317,11 @@
 }
 AGBackground AGThemeItem::getBackground() const
 {
-   
+
 }
 AGFont AGThemeItem::getFont() const
 {
-  
+
 }
 
 

Modified: antargis/trunk/ext/gui/ag_theme_v2.h
===================================================================
--- antargis/trunk/ext/gui/ag_theme_v2.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_theme_v2.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,8 @@
 #ifndef AG_THEME_V2_H
 #define AG_THEME_V2_H
 
-#include &quot;ag_base.h&quot;
+#include &quot;rk_base.h&quot;
+
 #include &quot;ag_font.h&quot;
 #include &quot;ag_surface.h&quot;
 #include &quot;ag_gradient.h&quot;

Modified: antargis/trunk/ext/gui/ag_tooltip.cc
===================================================================
--- antargis/trunk/ext/gui/ag_tooltip.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_tooltip.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,9 +22,10 @@
 #include &quot;ag_theme.h&quot;
 #include &quot;ag_screen.h&quot;
 #include &quot;ag_edit.h&quot;
-#include &quot;ag_debug.h&quot;
-#include &quot;ag_tools.h&quot;
 
+#include &quot;rk_debug.h&quot;
+#include &quot;rk_tools.h&quot;
+
 AGTooltip::AGTooltip(const AGRect2 &amp;pRect,const AGStringUtf8 &amp;pText):
   AGWidget(0,pRect),
   mText(pText),
@@ -108,6 +109,11 @@
     addChild(e);
   }
 
+AGTooltip::~AGTooltip() throw()
+  {}
+
+
+
 void AGTooltip::draw(AGPainter &amp;p)
   {
     //  p.transform(getRect());

Modified: antargis/trunk/ext/gui/ag_tooltip.h
===================================================================
--- antargis/trunk/ext/gui/ag_tooltip.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_tooltip.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -29,6 +29,7 @@
 {
  public:
   AGTooltip(const AGRect2 &amp;pRect,const AGStringUtf8 &amp;pText);
+  virtual ~AGTooltip() throw();
 
   virtual void draw(AGPainter &amp;p);
  private:

Modified: antargis/trunk/ext/gui/ag_widget.cc
===================================================================
--- antargis/trunk/ext/gui/ag_widget.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_widget.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -18,8 +18,9 @@
  * License along with this program.
  */
 
+#include &quot;rk_debug.h&quot;
+
 #include &quot;ag_widget.h&quot;
-#include &quot;ag_debug.h&quot;
 #include &quot;ag_screen.h&quot;
 #include &quot;ag_main.h&quot;
 #include &quot;ag_menu.h&quot;
@@ -84,7 +85,7 @@
       getMain()-&gt;getCollector()-&gt;insertGlobal(this);
     }
 
-AGWidget::~AGWidget()
+AGWidget::~AGWidget() throw()
   {
     allWidgets.erase(this);
     CTRACE;
@@ -177,7 +178,7 @@
         std::list&lt;AGWidget*&gt;::iterator i=mToClear.begin();
         for(;i!=mToClear.end();i++)
           {
-            (*i)-&gt;setParent(0); // lets play it safe 
+            (*i)-&gt;setParent(0); // lets play it safe
             saveDelete(*i);
           }
         mToClear.clear();
@@ -493,7 +494,7 @@
     queryRedraw();
   }
 
-void AGWidget::clear()
+void AGWidget::clear() throw()
   {
     // delay it till be draw everything - so this doesn't kill widgets while processing events
     std::copy(mChildren.begin(),mChildren.end(),std::back_inserter(mToClear));
@@ -893,7 +894,7 @@
             std::list&lt;AGWidget*&gt;::iterator i;
 
             i=std::find(mChildren.begin(),mChildren.end(),mFocus);
-            // delete children and set to front 
+            // delete children and set to front
             mChildren.erase(i);
             mChildren.push_front(mFocus);
           }
@@ -997,7 +998,7 @@
     mModal=pModal;
   }
 
-void AGWidget::mark()
+void AGWidget::mark() throw()
   {
     for(std::list&lt;AGWidget*&gt;::iterator i=mChildren.begin();i!=mChildren.end();i++)
       {

Modified: antargis/trunk/ext/gui/ag_widget.h
===================================================================
--- antargis/trunk/ext/gui/ag_widget.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_widget.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #ifndef AG_WIDGET_H
 #define AG_WIDGET_H
 
-#include &quot;ag_base.h&quot;
+#include &quot;rk_base.h&quot;
 #include &quot;ag_geometry.h&quot;
 #include &quot;ag_messageobject.h&quot;
 #include &quot;ag_projection.h&quot;
@@ -37,7 +37,7 @@
 class AGClipping;
 class AGApplication;
 
-/** 
+/**
     \defgroup widgets Widgets
     \brief contains all the widgets
 
@@ -79,9 +79,9 @@
 {
 public:
   typedef std::list&lt;AGWidget*&gt; Children;
-  
+
   AGWidget(AGWidget *pParent,const AGRect2 &amp;r);
-  virtual ~AGWidget();
+  virtual ~AGWidget() throw();
 
   AGApplication *getApp();
   void setApp(AGApplication *pApp);
@@ -92,7 +92,7 @@
   virtual void drawAfter(AGPainter &amp;p);
   virtual void drawAll(AGPainter &amp;p);
   virtual void drawChild(AGPainter &amp;p,AGWidget *pWidget);
-  
+
   AGRect2 getRect() const;
   virtual AGRect2 getClientRect() const;
   virtual void setRect(const AGRect2 &amp;pRect);
@@ -157,7 +157,7 @@
   void hide();
   void close();
 
-  virtual void mark();
+  virtual void mark() throw();
 
   virtual void addChild(AGWidget *w);
   virtual void addChildBack(AGWidget *w);
@@ -180,10 +180,10 @@
   // to prevent this, use this function to &quot;use&quot; them in each frame
   virtual void useTextures(); // when caching
   void useTexturesRecursive(); // when caching
-  
-  
-  
-  
+
+
+
+
   // geometry calculation
   AGRect2 innerToOuter(const AGRect2 &amp;pRect) const;
   AGVector2 innerToOuter(const AGVector2 &amp;pRect) const;
@@ -192,7 +192,7 @@
 
 
   // clear children
-  void clear();
+  void clear() throw();
 
   AGRect2 getScreenRect() const;
   AGRect2 toScreen(const AGRect2&amp;p) const;
@@ -202,10 +202,10 @@
 
   AGProjection2D innerToOuter() const;
   AGProjection2D outerToInner() const;
-  
+
   AGVector2 getScreenPosition() const;
-  
 
+
   // focus
 
   /** should only be called by a child */
@@ -239,36 +239,36 @@
   std::list&lt;AGRect2&gt; aquireChanges();
   void pushChangeRect(const AGRect2 &amp;pRect);
   void clearChangeRects();
-  
+
   std::list&lt;AGWidget*&gt; getChildren();
-  
+
   bool hovered() const;
-  
+
   void setClient(const AGRect2 &amp;pWorld,const AGProjection2D &amp;pProj);
   AGProjection2D getClientProjection() const;
   AGRect2 getClientWorld() const;
-  
-  
+
+
   virtual bool eventMouseButtonDownClipped(AGEvent *pEvent,const AGVector2 &amp;pPosition);
   virtual bool eventMouseButtonUpClipped(AGEvent *pEvent,const AGVector2 &amp;pPosition);
   virtual bool eventMouseMotionClipped(AGEvent *pEvent,const AGVector2 &amp;pPosition);
 
   void addChildRef(AGWidget *pWidget);
-  
-  void initEvents(); 
-  
+
+  void initEvents();
+
   virtual void eventInitEvents();
- 
-  
+
+
 protected:
   virtual bool letChildProcess(AGWidget *pChild,AGEvent *event);
 
 private:
-  
+
   AGRect2 getChildRect(const AGRect2 &amp;pRect) const;
   bool containsPoint(AGWidget *pWidget,const AGVector2 &amp;pVector) const;
-  
 
+
   AGApplication *mApp;
 
   std::list&lt;AGRect2&gt; mMyChanges;
@@ -282,7 +282,7 @@
   void gainFocusDown(AGWidget *pWidget);
 
   void checkFocus();
-  
+
   static bool valid(AGWidget *pWidget);
 
   std::list&lt;AGWidget*&gt; mToClear;
@@ -290,7 +290,7 @@
   AGRect2 mRect,mClientWorld;
   AGProjection2D mClientProj;
   bool mUseClientRect;
-  
+
   AGWidget *mParent;
   bool mChildrenEventFirst;
   bool mChildrenDrawFirst;
@@ -316,12 +316,12 @@
   AGTooltip *mTooltipWidget;
 
   std::set&lt;AGWidget*&gt; mRefChildren;
-  
+
   bool mEventsInited;
-  
+
 protected:
   std::list&lt;AGWidget*&gt; mChildren;
-  
+
 private:
   static std::set&lt;AGWidget*&gt; allWidgets;
 

Modified: antargis/trunk/ext/gui/ag_window.cc
===================================================================
--- antargis/trunk/ext/gui/ag_window.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_window.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #include &quot;ag_theme.h&quot;
 #include &quot;ag_image.h&quot;
 #include &quot;ag_text.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_button.h&quot;
 #include &quot;ag_caption.h&quot;
 #include &quot;ag_texturecache.h&quot;
@@ -35,7 +35,7 @@
 
   {
     CTRACE;
-    
+
     AGLocalTheme theme=getTheme()-&gt;getTheme(pTheme);
 
     AGString borderImage=&quot;window.border.image&quot;;
@@ -67,7 +67,7 @@
         addFixedRow(bw); // upper border
         addFixedRow(titBarHeight); // titletext and button
         //      addFixedRow(bw); // lower border below titletext
-        addRow(1.0); 
+        addRow(1.0);
         addFixedRow(bw); // lower lower below window
         addFixedColumn(bw);
         addColumn(1.0);
@@ -128,6 +128,9 @@
     arrange();
   }
 
+AGWindow::~AGWindow() throw()
+  {}
+
 AGWidget *AGWindow::getClient()
   {
     return mClient;
@@ -186,7 +189,7 @@
     closeButton-&gt;setSurface(closeSurface,false);
     title-&gt;setName(&quot;title&quot;); // FIXME: maybe name getName()+&quot;.title&quot;
 
-    //  AGListener 
+    //  AGListener
     closeButton-&gt;sigClick.connect(slot(this,&amp;AGWindow::tryClose));
     //  t-&gt;arrange();
     return t;

Modified: antargis/trunk/ext/gui/ag_window.h
===================================================================
--- antargis/trunk/ext/gui/ag_window.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/ag_window.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -29,6 +29,7 @@
 {
  public:
   AGWindow(AGWidget *pWidget,const AGRect2 &amp;pRect,const AGStringUtf8 &amp;pTitle=&quot;&quot;,const AGString &amp;pTheme=&quot;&quot;);
+  virtual ~AGWindow()  throw();
 
   AGWidget *getClient();
 

Modified: antargis/trunk/ext/gui/init.cc
===================================================================
--- antargis/trunk/ext/gui/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/gui/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,5 @@
-#include &lt;ag_base.h&gt;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_base.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &lt;ag_layout.h&gt;
 
 AGEXPORT void AG_Init_libantargisgui()

Modified: antargis/trunk/ext/math/ag_algebra.cc
===================================================================
--- antargis/trunk/ext/math/ag_algebra.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/ag_algebra.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,7 @@
 #include &quot;ag_algebra.h&quot;
-#include &quot;ag_debug.h&quot;
+
+#include &quot;rk_debug.h&quot;
+
 #include &quot;ag_gauss.h&quot;
 #include &quot;ag_stringstream.h&quot;
 
@@ -268,7 +270,7 @@
   assert(width()&gt;1);
   assert(i&lt;width());
   AGMatrixN n(width()-1,height());
- 
+
   for(size_t y=0;y&lt;height();y++)
     {
       for(size_t x=0;x&lt;i;x++)

Modified: antargis/trunk/ext/math/ag_algebra.h
===================================================================
--- antargis/trunk/ext/math/ag_algebra.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/ag_algebra.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -4,7 +4,7 @@
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
 #include &lt;vector&gt;
-#include &lt;ag_string.h&gt;
+#include &lt;rk_string.h&gt;
 #include &lt;ag_geometry.h&gt;
 
 class AGEXPORT AGMatrixN
@@ -43,15 +43,15 @@
 
   void swapRows(size_t a,size_t b);
   void swapCols(size_t a,size_t b);
-  
+
   size_t width() const;
   size_t height() const;
-  
+
   AGMatrixN skipRow(size_t i) const;
   AGMatrixN skipCol(size_t i) const;
 
  private:
-  
+
   inline size_t index(size_t x,size_t y) const { return x+y*mW; }
 
   std::vector&lt;float&gt; m;
@@ -64,11 +64,11 @@
 
 template&lt;&gt; inline float determinant&lt;AGMatrix3&gt;(const AGMatrix3&amp;t)
   {
-    return determinant(AGMatrixN(t)); 
+    return determinant(AGMatrixN(t));
   }
 template&lt;&gt; inline float determinant&lt;AGMatrix4&gt;(const AGMatrix4&amp;t)
   {
-    return determinant(AGMatrixN(t)); 
+    return determinant(AGMatrixN(t));
   }
 
 template&lt;class T&gt;

Modified: antargis/trunk/ext/math/ag_rand.cc
===================================================================
--- antargis/trunk/ext/math/ag_rand.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/ag_rand.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -18,7 +18,7 @@
  * License along with this program.
  */
 
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_main.h&quot;
 #include &quot;ag_profiler.h&quot;
 #include &quot;ag_rand.h&quot;
@@ -57,7 +57,7 @@
 
   }
 
-AGRandomizer::~AGRandomizer()
+AGRandomizer::~AGRandomizer() throw()
   {
     CTRACE;
   }

Modified: antargis/trunk/ext/math/ag_rand.h
===================================================================
--- antargis/trunk/ext/math/ag_rand.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/ag_rand.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -39,7 +39,7 @@
   // restore a randomizer from a state-string (pretty long)
   // for an initial seed - call with pSeed==&quot;&quot;
   AGRandomizer(const std::string &amp;pSeed);
-  ~AGRandomizer();
+  ~AGRandomizer() throw();
 #ifdef SWIG
   %rename(randFloat) operator()(float f);
   %rename(randInt) operator()(int i);

Modified: antargis/trunk/ext/math/ant_frustum.cc
===================================================================
--- antargis/trunk/ext/math/ant_frustum.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/ant_frustum.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include &quot;ant_frustum.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_profiler.h&quot;
 
 /////////////////////////////////////////////////////////////////////

Modified: antargis/trunk/ext/math/init.cc
===================================================================
--- antargis/trunk/ext/math/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/math/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,4 @@
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &lt;ag_main.h&gt;
 #include &lt;ag_rand.h&gt;
 

Modified: antargis/trunk/ext/sound/ag_mixer.cc
===================================================================
--- antargis/trunk/ext/sound/ag_mixer.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/sound/ag_mixer.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include &quot;ag_mixer.h&quot;
 #include &quot;ag_kill.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_mutex.h&quot;
 #include &quot;ag_fs.h&quot;
 #include &quot;ag_config.h&quot;
@@ -146,8 +146,8 @@
   }
 
 
-AGSound::~AGSound()
-  { 
+AGSound::~AGSound() throw()
+  {
     if(getCollector())
       getCollector()-&gt;removeGlobal(this);
 
@@ -291,7 +291,7 @@
         Mix_HaltMusic();
         Mix_FreeMusic(mMusic);
         mMusic=0;
-      }      
+      }
   }
 AGSound::AGSound():AGMessageObject(),sigMp3Finished(this,&quot;sigMp3Finished&quot;)
 {

Modified: antargis/trunk/ext/sound/ag_mixer.h
===================================================================
--- antargis/trunk/ext/sound/ag_mixer.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/sound/ag_mixer.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -33,7 +33,7 @@
 {
  public:
   AGSound(); // NEVER use this! - it's only provided due to swig
-  ~AGSound();
+  ~AGSound() throw();
   bool playMp3(const std::string &amp;pFilename);
   bool playMp3DRM(const std::string &amp;pFilename,AGDecryptor &amp;pDec);
 

Modified: antargis/trunk/ext/sound/init.cc
===================================================================
--- antargis/trunk/ext/sound/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/sound/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include &lt;ag_main.h&gt;
 #include &lt;ag_rand.h&gt;
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 
 extern void initSoundEngine();
 

Modified: antargis/trunk/ext/test/gl_text_3d.cc
===================================================================
--- antargis/trunk/ext/test/gl_text_3d.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/test/gl_text_3d.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,3 +1,4 @@
+#include &lt;ag_gl.h&gt;
 #include &lt;SDL.h&gt;
 #include &lt;SDL_opengl.h&gt;
 #include &lt;stdexcept&gt;
@@ -63,7 +64,6 @@
     glTexSubImage3D(GL_TEXTURE_3D,0,0,0,0,
         128,128,32,GL_RGBA,GL_UNSIGNED_BYTE,blue);
 
-
     glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
 
     glBindTexture(GL_TEXTURE_3D,tex);

Modified: antargis/trunk/ext/video/ag_clip_painttarget.cc
===================================================================
--- antargis/trunk/ext/video/ag_clip_painttarget.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_clip_painttarget.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,11 +1,15 @@
 #include &quot;ag_clip_painttarget.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_projection.h&quot;
 
 AGClipPaintTarget::AGClipPaintTarget(AGPaintTarget *pTarget):mTarget(pTarget)
 {
 }
 
+AGClipPaintTarget::~AGClipPaintTarget() throw()
+  {}
+
+
 void AGClipPaintTarget::blitTri(const AGTexture &amp;pSource,const AGTriangle2 &amp;pSrc,const AGTriangle2 &amp;pDest)
   {
     cdebug(&quot;NOT IMPLEMENTED!&quot;);

Modified: antargis/trunk/ext/video/ag_clip_painttarget.h
===================================================================
--- antargis/trunk/ext/video/ag_clip_painttarget.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_clip_painttarget.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -29,7 +29,9 @@
 {
  public:
   AGClipPaintTarget(AGPaintTarget *pTarget);
-
+  ~AGClipPaintTarget() throw();
+  
+  
   virtual void blitTri(const AGTexture &amp;pSource,const AGTriangle2 &amp;pSrc,const AGTriangle2 &amp;pDest);
 
   virtual void blit(const AGTexture &amp;pSource,const AGRect2 &amp;pDest,const AGRect2 &amp;pSrc,const AGColor &amp;pColor);

Modified: antargis/trunk/ext/video/ag_color.cc
===================================================================
--- antargis/trunk/ext/video/ag_color.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_color.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include &quot;ag_color.h&quot;
 #include &quot;ag_surface.h&quot;
-#include &quot;ag_tools.h&quot;
+#include &quot;rk_tools.h&quot;
 
 #include &lt;sstream&gt;
 

Modified: antargis/trunk/ext/video/ag_color.h
===================================================================
--- antargis/trunk/ext/video/ag_color.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_color.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,4 @@
-/*
+#/*
  * Copyright (c) 2005 by David Kamphausen. All rights reserved.
  *
  * ag_color.h
@@ -25,8 +25,8 @@
 
 #include &lt;SDL.h&gt;
 #include &lt;iostream&gt;
-#include &lt;ag_base.h&gt;
-#include &lt;ag_string.h&gt;
+#include &lt;rk_base.h&gt;
+#include &lt;rk_string.h&gt;
 
 class AGSurface;
 class AGVector4;
@@ -35,7 +35,7 @@
 {
  public:
   AGColor(int pr,int pg,int pb,int pa=255);
-  
+
   AGColor(const AGColor &amp;c);
   AGColor(const AGVector4 &amp;v);
   AGColor(Uint32 c,const AGSurface &amp;pSurface);
@@ -64,7 +64,7 @@
   void light(Uint8 l);
 
   //  SDL_Color sdlColor() const;
-  
+
   bool operator==(const AGColor &amp;c) const;
 
   //  Uint8 r,g,b;

Modified: antargis/trunk/ext/video/ag_fbo.h
===================================================================
--- antargis/trunk/ext/video/ag_fbo.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_fbo.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,7 +21,7 @@
 #ifndef AG_FBO_H
 #define AG_FBO_H
 
-#include &lt;ag_base.h&gt;
+#include &lt;rk_base.h&gt;
 
 class AGGLTexture;
 
@@ -41,7 +41,7 @@
   AGGLTexture *mTexture;
   GLuint mTextureID;
   size_t w,h;
-  
+
   unsigned int fb, depth_rb;
 
   bool mWithDepth;

Modified: antargis/trunk/ext/video/ag_font.h
===================================================================
--- antargis/trunk/ext/video/ag_font.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_font.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,9 +23,9 @@
 #ifndef __AG_FONT_H
 #define __AG_FONT_H
 
+#include &lt;rk_base.h&gt;
+#include &lt;rk_utf8.h&gt;
 #include &lt;ag_color.h&gt;
-#include &lt;ag_base.h&gt;
-#include &lt;ag_utf8.h&gt;
 
 #include &lt;ag_string_utf8.h&gt;
 

Modified: antargis/trunk/ext/video/ag_fontengine.cc
===================================================================
--- antargis/trunk/ext/video/ag_fontengine.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_fontengine.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,8 +19,7 @@
  */
 
 #include &quot;ag_fontengine.h&quot;
-#include &quot;ag_debug.h&quot;
-#include &quot;ag_kill.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_texture.h&quot;
 #include &quot;ag_fs.h&quot;
 #include &quot;ag_sgeexport.h&quot;
@@ -100,7 +99,7 @@
     //  REGISTER_SINGLETON(this);
   }
 
-AGFontEngine::~AGFontEngine()
+AGFontEngine::~AGFontEngine() throw()
   {
     // TTF_Quit is called by atexit
     // font-deletion is ignored
@@ -376,7 +375,7 @@
     return h;
   }
 
-void AGFontEngine::mark()
+void AGFontEngine::mark() throw()
   {
     for(std::map&lt;std::pair&lt;AGFont,AGStringUtf8&gt;,AGTexture*&gt;::iterator i=fontCache.begin();i!=fontCache.end();i++)
       markObject(i-&gt;second);

Modified: antargis/trunk/ext/video/ag_fontengine.h
===================================================================
--- antargis/trunk/ext/video/ag_fontengine.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_fontengine.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -35,14 +35,14 @@
 {
  public:
   AGFontEngine();
-  ~AGFontEngine();
+  ~AGFontEngine() throw();
 
   AGTexture *renderText(int BaseLineX, int BaseLineY, const AGStringUtf8 &amp;pText, const AGFont &amp;ParamIn);
 
   int getWidth(const AGFont &amp;pFont,const AGStringUtf8 &amp;pText);
   int getHeight(const AGFont &amp;pFont,const AGStringUtf8 &amp;pText);
 
-  void mark();
+  void mark() throw();
 
  private:
   std::map&lt;std::pair&lt;AGFont,AGStringUtf8&gt;,AGTexture*&gt; fontCache;

Modified: antargis/trunk/ext/video/ag_glpainter.cc
===================================================================
--- antargis/trunk/ext/video/ag_glpainter.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_glpainter.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -24,7 +24,7 @@
 #include &quot;ag_profiler.h&quot;
 #include &quot;ag_texture.h&quot;
 #include &quot;ag_rendercontext.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_vdebug.h&quot;
 #include &quot;ag_projection.h&quot;
 
@@ -54,7 +54,7 @@
           }
         glEnd();
 
-      } 
+      }
 
     void drawPoly(const std::vector&lt;AGVector2&gt; &amp;pVecs,const AGColor &amp;pColor,float pWidth)
       {
@@ -377,7 +377,7 @@
         context.setDepthTest(true);
         context.setColor(AGColor(0xFF,0xFF,0xFF,0xFF));
         context.begin();
-        
+
         AGProjection2D p(const_cast&lt;AGTexture&amp;&gt;(pSource).glTexture()-&gt;getRect(),AGRect2(0,0,1,1));
 
         glBegin(GL_TRIANGLES);
@@ -388,7 +388,7 @@
             glVertex3fv(pDest[i]);
           }
 
-        glEnd();       
+        glEnd();
       }
 
 

Modified: antargis/trunk/ext/video/ag_glscreen.cc
===================================================================
--- antargis/trunk/ext/video/ag_glscreen.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_glscreen.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include &quot;ag_glscreen.h&quot;
 #include &quot;ag_color.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_vdebug.h&quot;
 #include &quot;ag_fontengine.h&quot;
 #include &quot;ag_surfacemanager.h&quot;
@@ -157,8 +157,8 @@
 
 
 
-AGGLScreen::~AGGLScreen()
-  { 
+AGGLScreen::~AGGLScreen() throw()
+  {
   }
 
 AGTexture AGGLScreen::screenshot(bool frontBuffer)
@@ -178,25 +178,25 @@
 
     assertGL;
 #ifdef __APPLE__
-    glTexParameteri(glTexture-&gt;getTarget(), 
-        GL_TEXTURE_STORAGE_HINT_APPLE, 
-        GL_STORAGE_CACHED_APPLE); 
+    glTexParameteri(glTexture-&gt;getTarget(),
+        GL_TEXTURE_STORAGE_HINT_APPLE,
+        GL_STORAGE_CACHED_APPLE);
     assertGL;
-    glPixelStorei(GL_UNPACK_CLIENT_STORAGE_APPLE,GL_TRUE); 
+    glPixelStorei(GL_UNPACK_CLIENT_STORAGE_APPLE,GL_TRUE);
     assertGL;
 
-    glTexParameteri(glTexture-&gt;getTarget(),GL_TEXTURE_STORAGE_HINT_APPLE, GL_STORAGE_SHARED_APPLE); 
+    glTexParameteri(glTexture-&gt;getTarget(),GL_TEXTURE_STORAGE_HINT_APPLE, GL_STORAGE_SHARED_APPLE);
     assertGL;
-    glPixelStorei(GL_UNPACK_CLIENT_STORAGE_APPLE,GL_TRUE); 
+    glPixelStorei(GL_UNPACK_CLIENT_STORAGE_APPLE,GL_TRUE);
 #endif
     assertGL;
     glReadBuffer(GL_FRONT_LEFT);
     glFinish();
     assertGL;
-    glCopyTexSubImage2D(glTexture-&gt;getTarget(), 
-        0,0,0,0,0,getWidth(),getHeight()); 
+    glCopyTexSubImage2D(glTexture-&gt;getTarget(),
+        0,0,0,0,0,getWidth(),getHeight());
     assertGL;
-    // Dootherworkprocessinghere,usingadoubleortriplebuffer 
+    // Dootherworkprocessinghere,usingadoubleortriplebuffer
     glReadBuffer(GL_BACK);
 
 

Modified: antargis/trunk/ext/video/ag_glscreen.h
===================================================================
--- antargis/trunk/ext/video/ag_glscreen.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_glscreen.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,14 +23,16 @@
 #ifndef __GUI_GLSURFACE_H
 #define __GUI_GLSURFACE_H
 
+#include &lt;rk_base.h&gt;
+
+#include &lt;ag_geometry.h&gt;
+#include &quot;ag_screen.h&quot;
+#include &quot;ag_gl.h&quot;
+
 #include &lt;string&gt;
 #include &lt;map&gt;
 #include &lt;list&gt;
 #include &lt;SDL.h&gt;
-#include &lt;ag_base.h&gt;
-#include &lt;ag_geometry.h&gt;
-#include &quot;ag_screen.h&quot;
-#include &quot;ag_gl.h&quot;
 
 #define NEW_TEXTURES
 
@@ -54,7 +56,7 @@
  public:
   AGGLScreen(int W,int H,int VW=-1,int VH=-1);
 
-  virtual ~AGGLScreen();
+  virtual ~AGGLScreen() throw();
 
   virtual void blitTri(const AGTexture &amp;pSource,const AGTriangle2 &amp;pSrc,const AGTriangle2 &amp;pDest);
 

Modified: antargis/trunk/ext/video/ag_gltexture.cc
===================================================================
--- antargis/trunk/ext/video/ag_gltexture.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_gltexture.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -22,7 +22,7 @@
 #include &quot;ag_gltexture.h&quot;
 #include &quot;ag_surfacemanager.h&quot;
 #include &quot;ag_rendercontext.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_vdebug.h&quot;
 
 
@@ -249,8 +249,8 @@
   size_t bufSize=width()*height()*4;
   unsigned char *pixels=new unsigned char[bufSize];
 
-  glGetTexImage(mTarget,0,GL_RGBA, 
-      GL_UNSIGNED_INT_8_8_8_8_REV,pixels); 
+  glGetTexImage(mTarget,0,GL_RGBA,
+      GL_UNSIGNED_INT_8_8_8_8_REV,pixels);
 
   {
     // copy
@@ -265,7 +265,7 @@
         }
   }
 
-  return s;  
+  return s;
 }
 
 void AGGLTexture::initDMABuffer()
@@ -276,7 +276,7 @@
       {
         size_t texbufsize=1024*1024*64;
         dmaBuffer=new char[texbufsize];
-        glTextureRangeAPPLE(GL_TEXTURE_2D,texbufsize,dmaBuffer); 
+        glTextureRangeAPPLE(GL_TEXTURE_2D,texbufsize,dmaBuffer);
       }
       */
   }

Modified: antargis/trunk/ext/video/ag_gradient.cc
===================================================================
--- antargis/trunk/ext/video/ag_gradient.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_gradient.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,7 +21,7 @@
 #include &quot;GLee.h&quot;
 #include &quot;ag_color.h&quot;
 #include &quot;ag_geometry.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &lt;SDL.h&gt;
 
 #include &quot;ag_draw.h&quot;
@@ -29,7 +29,7 @@
 
 namespace AGSDLPainter
 {
-  void drawGradient(SDL_Surface *surface, const AGRect2&amp; prect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr) 
+  void drawGradient(SDL_Surface *surface, const AGRect2&amp; prect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr)
     {
       AGRect2 rect=prect;
       Sint32 v00,v01,v02;
@@ -201,7 +201,7 @@
       }
     }
 
-  void drawGradientAlpha(SDL_Surface *surface, const AGRect2&amp; prect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr) 
+  void drawGradientAlpha(SDL_Surface *surface, const AGRect2&amp; prect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr)
     {
       AGRect2 rect=prect;
       Sint32 v00,v01,v02,v03;

Modified: antargis/trunk/ext/video/ag_painter.cc
===================================================================
--- antargis/trunk/ext/video/ag_painter.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_painter.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -18,7 +18,7 @@
  * License along with this program.
  */
 
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &lt;ag_draw.h&gt;
 #include &lt;ag_fontengine.h&gt;
 #include &lt;ag_glscreen.h&gt;
@@ -236,7 +236,7 @@
     }
 
 
-AGPainter::~AGPainter()
+AGPainter::~AGPainter() throw()
   {
     CTRACE;
     if(mTarget.valid())

Modified: antargis/trunk/ext/video/ag_painter.h
===================================================================
--- antargis/trunk/ext/video/ag_painter.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_painter.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,13 +23,14 @@
 #ifndef __AG_PAINTER_H
 #define __AG_PAINTER_H
 
+#include &lt;rk_base.h&gt;
+
 #include &lt;ag_color.h&gt;
 #include &lt;ag_surface.h&gt;
 #include &lt;ag_geometry.h&gt;
 #include &lt;ag_font.h&gt;
 #include &lt;ag_painttarget.h&gt;
 #include &lt;ag_clip.h&gt;
-#include &lt;ag_base.h&gt;
 
 #include &lt;list&gt;
 
@@ -54,7 +55,7 @@
   AGRect2 clipRect(AGRect2 target) const;
 
   AGLine2 clipLine(AGLine2 l) const;
-  
+
   void transform(const AGMatrix3 &amp;pMatrix);
 
   void translate(const AGVector2 &amp;v);
@@ -68,15 +69,15 @@
 #define AGEXPORT
 #endif
 
-class AGEXPORT AGPainter
+class AGEXPORT AGPainter:public AGRubyObject
 {
  public:
   AGPainter();
   AGPainter(const AGPainter &amp;p);
   AGPainter(AGPaintTarget &amp;pTarget);
-  
-  ~AGPainter();
 
+  virtual ~AGPainter() throw();
+
   void putPixel(const AGVector2 &amp;p,const AGColor &amp;c);
   AGColor getPixel(int x,int y);
 
@@ -97,7 +98,7 @@
   void tile(const AGSurface &amp;pSource);
   void tile(const AGSurface &amp;pSource,const AGRect2 &amp;pDest);
   void tile(const AGSurface &amp;pSource,const AGRect2 &amp;pDest,const AGRect2 &amp;pSrc);
-  
+
   void renderText(const AGStringUtf8 &amp;pText,const AGVector2 &amp;p,const AGFont &amp;f);
 
   AGRect2 getRect() const;
@@ -108,12 +109,12 @@
   void fillRect(const AGRect2 &amp;pRect,const AGColor &amp;c);
   void drawLine(const AGVector2 &amp;p0,const AGVector2 &amp;p1,const AGColor &amp;c);
   void drawPoint(const AGVector2 &amp;p,const AGColor &amp;c,float size);
-  
+
   void fillPoly(const std::vector&lt;AGVector2&gt; &amp;pPoly,const AGColor &amp;c);
   void drawPoly(const std::vector&lt;AGVector2&gt; &amp;pPoly,const AGColor &amp;c);
 
   void fillRects(const std::vector&lt;std::pair&lt;AGRect2,AGVector4&gt; &gt; &amp;pRects);
-  
+
   void setLineWidth(float w);
 
   void pushMatrix();
@@ -131,7 +132,7 @@
   bool pointOk(const AGVector2 &amp;p) const;
 
   AGPaintTarget *getTarget();
-  
+
   void debugOutput();
 
  private:

Modified: antargis/trunk/ext/video/ag_painttarget.h
===================================================================
--- antargis/trunk/ext/video/ag_painttarget.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_painttarget.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,10 +23,11 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
+#include &lt;rk_rubyobj.h&gt;
+
 #include &lt;ag_geometry.h&gt;
 #include &lt;ag_color.h&gt;
 #include &lt;ag_font.h&gt;
-#include &lt;ag_rubyobj.h&gt;
 
 class AGSurface;
 class AGTexture;
@@ -36,7 +37,7 @@
 class AGEXPORT AGPaintTarget:public AGRubyObject
 {
  public:
-  virtual ~AGPaintTarget()
+  virtual ~AGPaintTarget() throw()
     {
     }
   virtual void blitTri(const AGTexture &amp;pSource,const AGTriangle2 &amp;pSrc,const AGTriangle2 &amp;pDest) MSTUB
@@ -49,10 +50,10 @@
   virtual void fillRect(const AGRect2 &amp;pr,const AGColor &amp;c) MSTUB
 
   virtual void fillRects(const std::vector&lt;std::pair&lt;AGRect2,AGVector4&gt; &gt; &amp;pr) MSTUB
-  
+
   virtual void fillPoly(const std::vector&lt;AGVector2&gt;&amp;pPoly,const AGColor &amp;pColor) MSTUB
   virtual void drawPoly(const std::vector&lt;AGVector2&gt;&amp;pPoly,const AGColor &amp;pColor) MSTUB
-   
+
   virtual void blit(const AGTexture &amp;pSource,const std::vector&lt;std::pair&lt;AGRect2,AGRect2&gt; &gt; &amp;pSrcDestRects,const AGColor &amp;pColor)
     MSTUB
 
@@ -60,15 +61,15 @@
   virtual void drawGradient(const AGRect2&amp; rect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr) MSTUB
 
   virtual void setLineWidth(float w) MSTUB
-  
+
   virtual void tile(const AGTexture &amp;pSource,const AGRect2 &amp;pTarget, const AGColor &amp;pColor) MSTUB
-   
+
   virtual AGRect2 getRect() const
   {
     return AGRect2(0,0,0,0);
   }
-  
 
+
   // modify single pixels - don't use this much!
 
   virtual void putPixel(int x,int y,const AGColor &amp;c) MSTUB
@@ -78,7 +79,7 @@
 
   virtual void beginPaint()
   {}
-  
+
   virtual void endPaint()
   {}
 

Modified: antargis/trunk/ext/video/ag_projection.cc
===================================================================
--- antargis/trunk/ext/video/ag_projection.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_projection.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,5 +1,5 @@
 #include &quot;ag_projection.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_algebra.h&quot;
 
 AGProjection2D::AGProjection2D() :

Modified: antargis/trunk/ext/video/ag_projection.h
===================================================================
--- antargis/trunk/ext/video/ag_projection.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_projection.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -3,7 +3,7 @@
 
 // INCLUDE_SWIG - used to filter, which files are included in swig-interfacing
 
-#include &lt;ag_base.h&gt;
+#include &lt;rk_base.h&gt;
 #include &lt;ag_geometry.h&gt;
 
 
@@ -20,11 +20,11 @@
   AGVector3 project(const AGVector3 &amp;p) const;
   AGTriangle2 project(const AGTriangle2 &amp;t) const;
   AGTriangle3 project(const AGTriangle3 &amp;t) const;
-  
+
   AGProjection2D inverse() const throw (GeometryException);
 
   void pushProjection(const AGProjection2D &amp;p);
-  
+
   AGMatrix3 getMatrix() const;
 private:
   bool mInited;

Modified: antargis/trunk/ext/video/ag_rendercontext.cc
===================================================================
--- antargis/trunk/ext/video/ag_rendercontext.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_rendercontext.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include &quot;ag_rendercontext.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_vdebug.h&quot;
 #include &quot;ag_texture.h&quot;
 #include &quot;ag_surfacemanager.h&quot;
@@ -330,7 +330,7 @@
                     }
                 }
             }
-        }  
+        }
 
 
       ///////////////////////////////

Modified: antargis/trunk/ext/video/ag_screen.cc
===================================================================
--- antargis/trunk/ext/video/ag_screen.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_screen.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -19,7 +19,7 @@
  */
 
 #include &quot;ag_screen.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_surface.h&quot;
 #include &quot;ag_texture.h&quot;
 

Modified: antargis/trunk/ext/video/ag_screen.h
===================================================================
--- antargis/trunk/ext/video/ag_screen.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_screen.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,8 +23,9 @@
 #ifndef AG_SCREEN_H
 #define AG_SCREEN_H
 
+#include &lt;rk_base.h&gt;
+
 #include &lt;ag_config.h&gt;
-#include &lt;ag_base.h&gt;
 #include &lt;ag_painttarget.h&gt;
 
 // this is virtually a pure virtual class ;-)

Modified: antargis/trunk/ext/video/ag_sdlscreen.cc
===================================================================
--- antargis/trunk/ext/video/ag_sdlscreen.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_sdlscreen.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include &quot;ag_sdlscreen.h&quot;
 #include &quot;ag_texture.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_fs.h&quot;
 #include &quot;ag_draw.h&quot;
 #include &quot;ag_fontengine.h&quot;

Modified: antargis/trunk/ext/video/ag_surface.cc
===================================================================
--- antargis/trunk/ext/video/ag_surface.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_surface.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,17 +23,16 @@
 #include &quot;ag_surface.h&quot;
 #include &quot;ag_texture.h&quot;
 #include &quot;ag_color.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_vdebug.h&quot;
 #include &quot;ag_draw.h&quot;
 #include &quot;ag_sgeexport.h&quot;
-#include &quot;ag_kill.h&quot;
 #include &quot;ag_png.h&quot;
 #include &quot;ag_glscreen.h&quot;
 #include &quot;ag_sdlpainter.h&quot;
 #include &quot;ag_surfacemanager.h&quot;
 
-#include &quot;SDL_image.h&quot;
+#include &lt;SDL_image.h&gt;
 
 #include &lt;sstream&gt;
 #include &lt;math.h&gt;
@@ -43,7 +42,7 @@
 bool gDRM=false;
 
 
-AGDecryptor *AGSurface::mDecryptor=0;  
+AGDecryptor *AGSurface::mDecryptor=0;
 
 ///////////////////////////////////////////////////////////////////////
 // Tools
@@ -51,79 +50,79 @@
 
 bool gRendering=false;
 void beginRender()
-  {
-    gRendering=true;
-  }
+{
+  gRendering=true;
+}
 void endRender()
-  {
-    gRendering=false;
-  }
+{
+  gRendering=false;
+}
 
 bool isRendering()
-  {
-    return gRendering;
-  }
+{
+  return gRendering;
+}
 
 
 void AGFreeSurface(SDL_Surface *s)
-  {
-    cdebug(s);
-    SDL_FreeSurface(s);
-  }
+{
+  cdebug(s);
+  SDL_FreeSurface(s);
+}
 
 AGInternalSurface *AGCreate32BitSurface(size_t width,size_t height)
-  {
-    /* Create a 32-bit surface with the bytes of each pixel in R,G,B,A order,
+{
+  /* Create a 32-bit surface with the bytes of each pixel in R,G,B,A order,
      as expected by OpenGL for textures */
-    AGInternalSurface *surface=new AGInternalSurface;
-    Uint32 rmask, gmask, bmask, amask;
+  AGInternalSurface *surface=new AGInternalSurface;
+  Uint32 rmask, gmask, bmask, amask;
 
-    /* SDL interprets each pixel as a 32-bit number, so our masks must depend
+  /* SDL interprets each pixel as a 32-bit number, so our masks must depend
      on the endianness (byte order) of the machine */
 #if SDL_BYTEORDER == SDL_BIG_ENDIAN
 
-    rmask = 0xff000000;
-    gmask = 0x00ff0000;
-    bmask = 0x0000ff00;
-    amask = 0x000000ff;
+  rmask = 0xff000000;
+  gmask = 0x00ff0000;
+  bmask = 0x0000ff00;
+  amask = 0x000000ff;
 #else
 
-    rmask = 0x000000ff;
-    gmask = 0x0000ff00;
-    bmask = 0x00ff0000;
-    amask = 0xff000000;
+  rmask = 0x000000ff;
+  gmask = 0x0000ff00;
+  bmask = 0x00ff0000;
+  amask = 0xff000000;
 #endif
 
-    surface-&gt;surface = SDL_CreateRGBSurface(SDL_SWSURFACE, width, height, 32,
-        rmask, gmask, bmask, amask);
-    if(!surface-&gt;surface)
-      {
-        std::cerr&lt;&lt;&quot;CreateRGBSurface failed: &quot;&lt;&lt;SDL_GetError()&lt;&lt;std::endl;
-        //        throw UI::UIException();
-      }
-
-    return surface;
+  surface-&gt;surface = SDL_CreateRGBSurface(SDL_SWSURFACE, width, height, 32,
+      rmask, gmask, bmask, amask);
+  if(!surface-&gt;surface)
+  {
+    std::cerr&lt;&lt;&quot;CreateRGBSurface failed: &quot;&lt;&lt;SDL_GetError()&lt;&lt;std::endl;
+    //        throw UI::UIException();
   }
 
+  return surface;
+}
 
 
+
 ///////////////////////////////////////////////////////////////////////
 // AGInternalSurface
 ///////////////////////////////////////////////////////////////////////
 
 AGInternalSurface::AGInternalSurface()
-  {
-    sdlTexture=0;
-    glTexture=0;
-    surface=0;
-    getSurfaceManager()-&gt;registerMe(this);
-    version=1;
-  }
+{
+  sdlTexture=0;
+  glTexture=0;
+  surface=0;
+  getSurfaceManager()-&gt;registerMe(this);
+  version=1;
+}
 
 AGInternalSurface::~AGInternalSurface()
-  {
-    getSurfaceManager()-&gt;deregisterMe(this);
-  }
+{
+  getSurfaceManager()-&gt;deregisterMe(this);
+}
 
 
 
@@ -132,26 +131,26 @@
 ///////////////////////////////////////////////////////////////////////
 
 AGSurface::AGSurface(AGInternalSurface *i):s(i)
-      {
-        getSurfaceManager()-&gt;registerMe(this);
-      }
+{
+  getSurfaceManager()-&gt;registerMe(this);
+}
 
 
 AGSurface::AGSurface():
   s(0)
-        {
-          getSurfaceManager()-&gt;registerMe(this);
-        }
+  {
+  getSurfaceManager()-&gt;registerMe(this);
+  }
 AGSurface::AGSurface(int w,int h):
   s(AGCreate32BitSurface(w,h))
-        {
-          getSurfaceManager()-&gt;registerMe(this);
-        }
+  {
+  getSurfaceManager()-&gt;registerMe(this);
+  }
 AGSurface::AGSurface(const AGSurface &amp;p):
   s(p.s)
-        {
-          getSurfaceManager()-&gt;registerMe(this);
-        }
+  {
+  getSurfaceManager()-&gt;registerMe(this);
+  }
 
 bool AGSurface::valid() const
 {
@@ -162,31 +161,31 @@
 {
   AGInternalSurface *is=0;
   if(valid())
-    {
-      is=AGCreate32BitSurface(s-&gt;surface-&gt;w,s-&gt;surface-&gt;h);
+  {
+    is=AGCreate32BitSurface(s-&gt;surface-&gt;w,s-&gt;surface-&gt;h);
 
-      // copy pixel for pixel - as blitting doesn't seem to work
-      for(int x=0;x&lt;width();x++)
-        for(int y=0;y&lt;height();y++)
-          {
-            Uint32 c;
-            Uint8 r,g,b,a;
-            c=sge_GetPixel(s-&gt;surface,x,y);
-            SDL_GetRGBA(c,s-&gt;surface-&gt;format,&amp;r,&amp;g,&amp;b,&amp;a);
+    // copy pixel for pixel - as blitting doesn't seem to work
+    for(int x=0;x&lt;width();x++)
+      for(int y=0;y&lt;height();y++)
+      {
+        Uint32 c;
+        Uint8 r,g,b,a;
+        c=sge_GetPixel(s-&gt;surface,x,y);
+        SDL_GetRGBA(c,s-&gt;surface-&gt;format,&amp;r,&amp;g,&amp;b,&amp;a);
 
-            sge_PutPixel(is-&gt;surface,x,y,SDL_MapRGBA(is-&gt;surface-&gt;format,r,g,b,a));
-          }
-    }
+        sge_PutPixel(is-&gt;surface,x,y,SDL_MapRGBA(is-&gt;surface-&gt;format,r,g,b,a));
+      }
+  }
   AGSurface ns;
   ns.s=is;
   return ns;
 }
 
-AGSurface::~AGSurface()
-  {
-    if(getSurfaceManager())
-      getSurfaceManager()-&gt;deregisterMe(this);
-  }
+AGSurface::~AGSurface() throw()
+{
+  if(getSurfaceManager())
+    getSurfaceManager()-&gt;deregisterMe(this);
+}
 
 void AGSurface::save(const std::string &amp;pName) const
 {
@@ -200,41 +199,41 @@
 
 
 AGSurface &amp;AGSurface::operator=(const AGSurface &amp;p)
-  {
-    s=p.s;
-    return *this;
-  }
+{
+  s=p.s;
+  return *this;
+}
 
 bool AGSurface::operator==(const AGSurface &amp;p) const
 {
   cdebug(&quot;operator==&quot;);
   if(width()!=p.width())
-    {
-      cdebug(&quot;width:&quot;&lt;&lt;width()&lt;&lt;&quot;!=&quot;&lt;&lt;p.width());
-      return false;
-    }
+  {
+    cdebug(&quot;width:&quot;&lt;&lt;width()&lt;&lt;&quot;!=&quot;&lt;&lt;p.width());
+    return false;
+  }
   if(height()!=p.height())
-    {
-      cdebug(&quot;height:&quot;&lt;&lt;height()&lt;&lt;&quot;!=&quot;&lt;&lt;p.height());
-      return false;
-    }
+  {
+    cdebug(&quot;height:&quot;&lt;&lt;height()&lt;&lt;&quot;!=&quot;&lt;&lt;p.height());
+    return false;
+  }
   for(size_t y=0;y&lt;height();y++)
     for(size_t x=0;x&lt;width();x++)
       if(getPixel(x,y)!=p.getPixel(x,y))
-        {
-          cdebug(x&lt;&lt;&quot;:&quot;&lt;&lt;y&lt;&lt;&quot;:&quot;&lt;&lt;getPixel(x,y)&lt;&lt;&quot;!=&quot;&lt;&lt;p.getPixel(x,y));
-          return false;
-        }
+      {
+        cdebug(x&lt;&lt;&quot;:&quot;&lt;&lt;y&lt;&lt;&quot;:&quot;&lt;&lt;getPixel(x,y)&lt;&lt;&quot;!=&quot;&lt;&lt;p.getPixel(x,y));
+        return false;
+      }
   return true;
 }
 
 
 
 void AGSurface::putPixel(int x,int y,const AGColor &amp;c)
-  {
-    sge_PutPixel(s-&gt;surface,x,y,color(c));
-    s-&gt;version++;
-  }
+{
+  sge_PutPixel(s-&gt;surface,x,y,color(c));
+  s-&gt;version++;
+}
 
 AGColor AGSurface::getPixel(int x,int y) const
 {
@@ -243,9 +242,10 @@
 
 
 
-AGSurface AGSurface::getSubSurface(const AGRect2 &amp;sr) const
+AGSurface AGSurface::getSubSurface(const AGRect2 &amp;sr) const throw(AGSurfaceEmptyException)
 {
-  CHECK_ZERO(s);
+  if(!s)
+    throw AGSurfaceEmptyException();
 
   AGInternalSurface *ns=AGCreate32BitSurface((int)sr.w(),(int)sr.h());
 
@@ -253,160 +253,172 @@
   Uint32 c;
   Uint8 r,g,b,a;
 
-  // copy 
+  // copy
   for(int x=0;x&lt;sr.w();x++)
     for(int y=0;y&lt;sr.h();y++)
-      {
-        c=sge_GetPixel(s-&gt;surface,(int)(x+sr.x()),(int)(y+sr.y()));
-        SDL_GetRGBA(c,s-&gt;surface-&gt;format,&amp;r,&amp;g,&amp;b,&amp;a);
-        c=SDL_MapRGBA(ns-&gt;surface-&gt;format,r,g,b,a);
+    {
+      c=sge_GetPixel(s-&gt;surface,(int)(x+sr.x()),(int)(y+sr.y()));
+      SDL_GetRGBA(c,s-&gt;surface-&gt;format,&amp;r,&amp;g,&amp;b,&amp;a);
+      c=SDL_MapRGBA(ns-&gt;surface-&gt;format,r,g,b,a);
 
-        sge_PutPixel(ns-&gt;surface,x,y,c);
-      }
+      sge_PutPixel(ns-&gt;surface,x,y,c);
+    }
   AGSurface nas;
   nas.s=ns;
   return nas;
 }
 
 
-Uint32 AGSurface::color(const AGColor &amp;c) const
+Uint32 AGSurface::color(const AGColor &amp;c) const throw(AGSurfaceEmptyException)
 {
-  CHECK_ZERO(s);
+  if(!s)
+    throw AGSurfaceEmptyException();
   return c.mapRGB(s-&gt;surface-&gt;format);
 }
 
-AGRect2 AGSurface::getRect() const
+AGRect2 AGSurface::getRect() const throw(AGSurfaceEmptyException)
 {
-  CHECK_ZERO(s);
+  if(!s)
+    throw AGSurfaceEmptyException();
   if(s)
     return AGRect2(0,0,s-&gt;surface-&gt;w,s-&gt;surface-&gt;h);
   else
     return AGRect2(0,0,0,0);
 }
 
-
-int AGSurface::width() const
+/**
+ * @return width of the surface
+ */
+int AGSurface::width() const throw(AGSurfaceEmptyException)
 {
-  CHECK_ZERO(s);
+  if(!s)
+    throw AGSurfaceEmptyException();
   return s-&gt;surface-&gt;w;
 }
-int AGSurface::height() const
+int AGSurface::height() const throw(AGSurfaceEmptyException)
 {
-  CHECK_ZERO(s);
+  if(!s)
+    throw AGSurfaceEmptyException();
   return s-&gt;surface-&gt;h;
 }
 
-void AGSurface::drawGradient(const AGRect2&amp; rect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr)
-  {
-    CHECK_ZERO(s);
-    AGSDLPainter::drawGradientAlpha(s-&gt;surface,rect,ul,ur,dl,dr);
-    s-&gt;version++;
-  }
+void AGSurface::drawGradient(const AGRect2&amp; rect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr)  throw(AGSurfaceEmptyException)
+{
+  if(!s)
+    throw AGSurfaceEmptyException();
+  AGSDLPainter::drawGradientAlpha(s-&gt;surface,rect,ul,ur,dl,dr);
+  s-&gt;version++;
+}
 
-void AGSurface::drawGradientAlpha(const AGRect2&amp; rect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr)
-  {
-    CHECK_ZERO(s);
-    AGSDLPainter::drawGradientAlpha(s-&gt;surface,rect,ul,ur,dl,dr);
-    s-&gt;version++;
-  }
-void AGSurface::drawBorder(const AGRect2&amp; rect,int W, const AGColor&amp; c1, const AGColor&amp; c2)
-  {
-    CHECK_ZERO(s);
-    AGSDLPainter::drawBorder(s-&gt;surface,rect,W,c1,c2);
-    s-&gt;version++;
-  }
+void AGSurface::drawGradientAlpha(const AGRect2&amp; rect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr) throw(AGSurfaceEmptyException)
+{
+  if(!s)
+    throw AGSurfaceEmptyException();
+  AGSDLPainter::drawGradientAlpha(s-&gt;surface,rect,ul,ur,dl,dr);
+  s-&gt;version++;
+}
+void AGSurface::drawBorder(const AGRect2&amp; rect,int W, const AGColor&amp; c1, const AGColor&amp; c2) throw(AGSurfaceEmptyException)
+{
+  if(!s)
+    throw AGSurfaceEmptyException();
+  AGSDLPainter::drawBorder(s-&gt;surface,rect,W,c1,c2);
+  s-&gt;version++;
+}
 
-void AGSurface::blit(const AGSurface &amp;pSource,const AGRect2 &amp;pDest,const AGRect2 &amp;pSrc,const AGColor &amp;pColor)
-  {
-    int x,y,sx,sy,dx,dy;
-    Uint32 c;
-    Uint8 r,g,b,a;
-    SDL_Surface *ss=const_cast&lt;SDL_Surface*&gt;(pSource.s-&gt;surface);
-    SDL_Surface *ds=s-&gt;surface;
+void AGSurface::blit(const AGSurface &amp;pSource,const AGRect2 &amp;pDest,const AGRect2 &amp;pSrc,const AGColor &amp;pColor) throw(AGSurfaceEmptyException)
+{
+  if(!s)
+    throw AGSurfaceEmptyException();
 
-    Uint32 colorkey=ss-&gt;format-&gt;colorkey;
-    int usekey=(ss-&gt;flags&amp;SDL_SRCCOLORKEY);
+  int x,y,sx,sy,dx,dy;
+  Uint32 c;
+  Uint8 r,g,b,a;
+  SDL_Surface *ss=const_cast&lt;SDL_Surface*&gt;(pSource.s-&gt;surface);
+  SDL_Surface *ds=s-&gt;surface;
 
-    for(y=0,sy=(int)pSrc.y(), dy=(int)pDest.y();y&lt;pSrc.h() ; y++,sy++,dy++)
-      for(x=0,sx=(int)pSrc.x(), dx=(int)pDest.x();x&lt;pSrc.w() ; x++,sx++,dx++)
-        {
-          c=sge_GetPixel(ss,sx,sy);
+  Uint32 colorkey=ss-&gt;format-&gt;colorkey;
+  int usekey=(ss-&gt;flags&amp;SDL_SRCCOLORKEY);
 
-          if(usekey)
-            if(c==colorkey)
-              continue;
+  for(y=0,sy=(int)pSrc.y(), dy=(int)pDest.y();y&lt;pSrc.h() ; y++,sy++,dy++)
+    for(x=0,sx=(int)pSrc.x(), dx=(int)pDest.x();x&lt;pSrc.w() ; x++,sx++,dx++)
+    {
+      c=sge_GetPixel(ss,sx,sy);
 
-          SDL_GetRGBA(c,ss-&gt;format,&amp;r,&amp;g,&amp;b,&amp;a);
-          c=SDL_MapRGBA(ds-&gt;format,r,g,b,a);
+      if(usekey)
+        if(c==colorkey)
+          continue;
 
-          sge_PutPixel(ds,dx,dy,c);
+      SDL_GetRGBA(c,ss-&gt;format,&amp;r,&amp;g,&amp;b,&amp;a);
+      c=SDL_MapRGBA(ds-&gt;format,r,g,b,a);
 
-        }
-    s-&gt;version++;
-  }
+      sge_PutPixel(ds,dx,dy,c);
 
+    }
+  s-&gt;version++;
+}
+
 AGInternalSurface *AGSurface::surface() const
 {
   return s;
 }
 
 AGSurface AGSurface::load(const std::string &amp;pFilename) throw (FileNotFound)
+{
+  AGSurface n;
+  n.s=new AGInternalSurface;
+  std::string file=loadFile(pFilename);
+  if(file.length()==0)
   {
-    AGSurface n;
-    n.s=new AGInternalSurface;
-    std::string file=loadFile(pFilename);
-    if(file.length()==0)
-      {
-        cdebug(&quot;File &quot;&lt;&lt;pFilename&lt;&lt;&quot; is empty!&quot;);
-        throw FileNotFound(pFilename);
-      }
+    cdebug(&quot;File &quot;&lt;&lt;pFilename&lt;&lt;&quot; is empty!&quot;);
+    throw FileNotFound(pFilename);
+  }
 
-    SDL_RWops* rw=SDL_RWFromMem(const_cast&lt;char*&gt;(file.c_str()),file.length());
+  SDL_RWops* rw=SDL_RWFromMem(const_cast&lt;char*&gt;(file.c_str()),file.length());
 
-    SDL_Surface *s=IMG_Load_RW(rw,0);
-    if(!s)
-      {
-        std::cerr&lt;&lt;&quot;error reading file:&quot;&lt;&lt;pFilename&lt;&lt;std::endl;
-      }
+  SDL_Surface *s=IMG_Load_RW(rw,0);
+  if(!s)
+  {
+    std::cerr&lt;&lt;&quot;error reading file:&quot;&lt;&lt;pFilename&lt;&lt;std::endl;
+  }
 
 
-    SDL_FreeRW(rw);;
+  SDL_FreeRW(rw);;
 
-    n.s-&gt;surface=s;
-    return n;
-  }
+  n.s-&gt;surface=s;
+  return n;
+}
 
 AGSurface AGSurface::loadDRM(const std::string &amp;pName) throw(FileNotFound)
-  {
-    assert(mDecryptor);
+{
+  assert(mDecryptor);
 
-    AGSurface n;
-    if(!mDecryptor)
-      return n;
+  AGSurface n;
+  if(!mDecryptor)
+    return n;
 
-    n.s=new AGInternalSurface;
-    std::string file=loadFile(pName);
-    if(file.length()==0)
-      throw FileNotFound(pName);
+  n.s=new AGInternalSurface;
+  std::string file=loadFile(pName);
+  if(file.length()==0)
+    throw FileNotFound(pName);
 
-    file=mDecryptor-&gt;decrypt(file,pName);
-    gDRM=true;
+  file=mDecryptor-&gt;decrypt(file,pName);
+  gDRM=true;
 
-    cdebug(&quot;FIRST:&quot;&lt;&lt;int(file[0])&lt;&lt;&quot;,&quot;&lt;&lt;int(file[1])&lt;&lt;&quot;,&quot;&lt;&lt;int(file[2]));
+  cdebug(&quot;FIRST:&quot;&lt;&lt;int(file[0])&lt;&lt;&quot;,&quot;&lt;&lt;int(file[1])&lt;&lt;&quot;,&quot;&lt;&lt;int(file[2]));
 
-    SDL_Surface *s=IMG_Load_RW(SDL_RWFromMem(const_cast&lt;char*&gt;(file.c_str()),file.length()),false);
-    assertGL;
-    if(s==0)
-      {
-        cdebug(&quot;Load file failed:&quot;&lt;&lt;pName);
-      }
-    assert(s);
-    n.s-&gt;surface=s;
-    return n;
-
+  SDL_Surface *s=IMG_Load_RW(SDL_RWFromMem(const_cast&lt;char*&gt;(file.c_str()),file.length()),false);
+  assertGL;
+  if(s==0)
+  {
+    cdebug(&quot;Load file failed:&quot;&lt;&lt;pName);
   }
+  assert(s);
+  n.s-&gt;surface=s;
+  return n;
 
+}
 
+
 AGSurface AGSurface::scale(int w,int h) const
 {
   CTRACE;
@@ -419,58 +431,58 @@
 
   for(int x=0;x&lt;w;x++)
     for(int y=0;y&lt;h;y++)
+    {
+      if(fast)
+        n.putPixel(x,y,getPixel((int)(x*ow/w),(int)(y*oh/h)));
+      else if(w&gt;ow)
       {
-        if(fast)
-          n.putPixel(x,y,getPixel((int)(x*ow/w),(int)(y*oh/h)));
-        else if(w&gt;ow)
-          {
-            // interpolate
-            float tx=x*ow/w;
-            float ty=y*oh/h;
+        // interpolate
+        float tx=x*ow/w;
+        float ty=y*oh/h;
 
-            int ix=(int)tx;
-            int iy=(int)ty;
+        int ix=(int)tx;
+        int iy=(int)ty;
 
-            float dx=tx-ix;
-            float dy=ty-iy;
+        float dx=tx-ix;
+        float dy=ty-iy;
 
-            n.putPixel(x,y,
-                AGColor((getPixel(ix,iy  ).toVec()*(1-dx) + getPixel(ix+1,iy  ).toVec()*dx) * (1-dy)+
-                    (getPixel(ix,iy+1).toVec()*(1-dx) + getPixel(ix+1,iy+1).toVec()*dx) * dy     ));
+        n.putPixel(x,y,
+            AGColor((getPixel(ix,iy  ).toVec()*(1-dx) + getPixel(ix+1,iy  ).toVec()*dx) * (1-dy)+
+                (getPixel(ix,iy+1).toVec()*(1-dx) + getPixel(ix+1,iy+1).toVec()*dx) * dy     ));
 
+      }
+      else
+      {
+        // integrate
+        size_t ps=0;
+        float r,g,b,a;
+        r=g=b=a=0;
+        float tx0=x*ow/w;
+        float ty0=y*oh/h;
+        float tx1=(x+1)*ow/w;
+        float ty1=(y+1)*oh/h;
+        for(int mx=(int)tx0;mx&lt;tx1;mx++)
+          for(int my=(int)ty0;my&lt;ty1;my++)
+          {
+            AGColor c=getPixel(mx,my);
+            r+=c.r;
+            g+=c.g;
+            b+=c.b;
+            a+=c.a;
+            ps++;
           }
-        else
-          {
-            // integrate
-            size_t ps=0;
-            float r,g,b,a;
-            r=g=b=a=0;
-            float tx0=x*ow/w;
-            float ty0=y*oh/h;
-            float tx1=(x+1)*ow/w;
-            float ty1=(y+1)*oh/h;
-            for(int mx=(int)tx0;mx&lt;tx1;mx++)
-              for(int my=(int)ty0;my&lt;ty1;my++)
-                {
-                  AGColor c=getPixel(mx,my);
-                  r+=c.r;
-                  g+=c.g;
-                  b+=c.b;
-                  a+=c.a;
-                  ps++;
-                }
-            if(ps&gt;0)
-              {
-                r/=ps;
-                g/=ps;
-                b/=ps;
-                a/=ps;
-                n.putPixel(x,y,AGColor((int)r,(int)g,(int)b,(int)a));
-              }
+        if(ps&gt;0)
+        {
+          r/=ps;
+          g/=ps;
+          b/=ps;
+          a/=ps;
+          n.putPixel(x,y,AGColor((int)r,(int)g,(int)b,(int)a));
+        }
 
 
-          }
       }
+    }
 
   return n;
 }
@@ -481,233 +493,233 @@
 
   for(int x=0;x&lt;width();x++)
     for(int y=0;y&lt;height();y++)
-      {
-        AGColor c=getPixel(x,y).grey();
-        n.putPixel(x,y,c);
-      }
+    {
+      AGColor c=getPixel(x,y).grey();
+      n.putPixel(x,y,c);
+    }
 
   return n;
 }
 
 void AGSurface::fillRect(const AGRect2 &amp;pr,const AGColor &amp;c)
-  {
-    for(int x=(int)pr.x0();x&lt;=pr.x1();x++)
-      for(int y=(int)pr.y0();y&lt;=pr.y1();y++)
-        putPixel(x,y,c);
-  }
+{
+  for(int x=(int)pr.x0();x&lt;=pr.x1();x++)
+    for(int y=(int)pr.y0();y&lt;=pr.y1();y++)
+      putPixel(x,y,c);
+}
 
 
 void AGSurface::drawLine(const AGVector2 &amp;pp0,const AGVector2 &amp;pp1,const AGColor &amp;c)
-  {
-    AGVector2 p0,p1;
+{
+  AGVector2 p0,p1;
 
-    p0=pp0;
-    p1=pp1;
+  p0=pp0;
+  p1=pp1;
 
-    float dx=p1[0]-p0[0];
-    float dy=p1[1]-p0[1];
+  float dx=p1[0]-p0[0];
+  float dy=p1[1]-p0[1];
 
-    if(fabs(dx)&gt;fabs(dy))
-      {
-        if(dx&lt;0)
-          {
-            p0=pp1;
-            p1=pp0;
-          }
+  if(fabs(dx)&gt;fabs(dy))
+  {
+    if(dx&lt;0)
+    {
+      p0=pp1;
+      p1=pp0;
+    }
 
-        dx=p1[0]-p0[0];
-        dy=p1[1]-p0[1];
+    dx=p1[0]-p0[0];
+    dy=p1[1]-p0[1];
 
-        float y=p0[1];
-        float e=0;
-        float de=((float)dy)/dx;
-        for(float x=p0[0];x&lt;=p1[0];x++)
-          {
-            putPixel(int(x),int(y),c);
-            e+=de;
-            if(e&gt;0.5)
-              {
-                e-=1.0;
-                y++;
-              }
-            else if(e&lt;-0.5)
-              {
-                e+=1.0;
-                y--;
-              }
-          }
+    float y=p0[1];
+    float e=0;
+    float de=((float)dy)/dx;
+    for(float x=p0[0];x&lt;=p1[0];x++)
+    {
+      putPixel(int(x),int(y),c);
+      e+=de;
+      if(e&gt;0.5)
+      {
+        e-=1.0;
+        y++;
       }
-    else
+      else if(e&lt;-0.5)
       {
-        if(dy&lt;0)
-          {
-            p0=pp1;
-            p1=pp0;
-          }
+        e+=1.0;
+        y--;
+      }
+    }
+  }
+  else
+  {
+    if(dy&lt;0)
+    {
+      p0=pp1;
+      p1=pp0;
+    }
 
-        dx=p1[0]-p0[0];
-        dy=p1[1]-p0[1];
+    dx=p1[0]-p0[0];
+    dy=p1[1]-p0[1];
 
-        float x=p0[0];
-        float e=0;
-        float de=((float)dx)/dy;
-        for(float y=p0[1];y&lt;=p1[1];y++)
-          {
-            putPixel(int(x),int(y),c);
-            e+=de;
-            if(e&gt;0.5)
-              {
-                e-=1.0;
-                x++;
-              }
-            else if(e&lt;-0.5)
-              {
-                e+=1.0;
-                x--;
-              }
-          }
+    float x=p0[0];
+    float e=0;
+    float de=((float)dx)/dy;
+    for(float y=p0[1];y&lt;=p1[1];y++)
+    {
+      putPixel(int(x),int(y),c);
+      e+=de;
+      if(e&gt;0.5)
+      {
+        e-=1.0;
+        x++;
       }
+      else if(e&lt;-0.5)
+      {
+        e+=1.0;
+        x--;
+      }
+    }
   }
+}
 
 /**
 
 @returns hot-spot int the left upper corner
 
  */
-AGVector2 AGSurface::shrink2Fit(int alphaThresh)
-  {
-    int x0,x1;
-    int y0,y1;
-    int x,y;
+ AGVector2 AGSurface::shrink2Fit(int alphaThresh)
+{
+  int x0,x1;
+  int y0,y1;
+  int x,y;
 
-    x0=width();
-    y0=height();
-    x1=0;
-    y1=0;
-    for(y=0;y&lt;height();y++)
-      for(x=0;x&lt;width();x++)
-        {
-          if(getPixel(x,y).a&gt;alphaThresh)
-            {
-              x0=std::min(x0,x);
-              y0=std::min(y0,y);
-              x1=std::max(x1,x);
-              y1=std::max(y1,y);
-            }
-        }
+  x0=width();
+  y0=height();
+  x1=0;
+  y1=0;
+  for(y=0;y&lt;height();y++)
+    for(x=0;x&lt;width();x++)
+    {
+      if(getPixel(x,y).a&gt;alphaThresh)
+      {
+        x0=std::min(x0,x);
+        y0=std::min(y0,y);
+        x1=std::max(x1,x);
+        y1=std::max(y1,y);
+      }
+    }
 
 
 
-    int nw=std::max(1,x1-x0+1);
-    int nh=std::max(1,y1-y0+1);
+  int nw=std::max(1,x1-x0+1);
+  int nh=std::max(1,y1-y0+1);
 
-    AGSurface n(nw,nh);
+  AGSurface n(nw,nh);
 
-    for(x=0;x&lt;nw;x++)
-      for(y=0;y&lt;nh;y++)
-        {
-          n.putPixel(x,y,getPixel(x+x0,y+y0));
-        }
-    (*this)=n;
-    return AGVector2(x0,x1);
-
-  }
-
-/**
- * \return if this and pSurface have the same extends, this is sum_pixel((this(pixel)-pSurface(pixel)^2)
- *         otherwise it's -1 
- *         the used norm for colors is sqrt((r0-r1)^2+(g0-g1)^2+(b0-b1)^2+(a0-a1)^2)
- * */
-float AGSurface::similarity(const AGSurface &amp;pSurface) const
-{
-  float value=0;
-  if(pSurface.width()!=width() || pSurface.height()!=height())
+  for(x=0;x&lt;nw;x++)
+    for(y=0;y&lt;nh;y++)
     {
-      return -1;
+      n.putPixel(x,y,getPixel(x+x0,y+y0));
     }
-  AGColor c0,c1;
-  float r,g,b,a;
-  for(size_t x=0;x&lt;width();x++)
-    for(size_t y=0;y&lt;height();y++)
-      {
-        c0=getPixel(x,y);
-        c1=pSurface.getPixel(x,y);
-        r=c0.r-c1.r;
-        b=c0.b-c1.b;
-        g=c0.g-c1.g;
-        a=c0.a-c1.a;
-        value+=sqrt(r*r+b*b+g*g+a*a)/float(0xFF);
-      }
-  return value;
+  (*this)=n;
+  return AGVector2(x0,x1);
+
 }
 
+ /**
+  * \return if this and pSurface have the same extends, this is sum_pixel((this(pixel)-pSurface(pixel)^2)
+  *         otherwise it's -1
+  *         the used norm for colors is sqrt((r0-r1)^2+(g0-g1)^2+(b0-b1)^2+(a0-a1)^2)
+  * */
+ float AGSurface::similarity(const AGSurface &amp;pSurface) const
+ {
+   float value=0;
+   if(pSurface.width()!=width() || pSurface.height()!=height())
+   {
+     return -1;
+   }
+   AGColor c0,c1;
+   float r,g,b,a;
+   for(size_t x=0;x&lt;width();x++)
+     for(size_t y=0;y&lt;height();y++)
+     {
+       c0=getPixel(x,y);
+       c1=pSurface.getPixel(x,y);
+       r=c0.r-c1.r;
+       b=c0.b-c1.b;
+       g=c0.g-c1.g;
+       a=c0.a-c1.a;
+       value+=sqrt(r*r+b*b+g*g+a*a)/float(0xFF);
+     }
+   return value;
+ }
 
-bool AGSurface::similarTo(const AGSurface &amp;pSurface,float threshold) const
-{
-  float s=similarity(pSurface);
-  if(s&lt;0)
-    return s;
-  if(width()==0 &amp;&amp; height()==0)
-    return true;
-  return sqrt(s)/(width()*height())&lt;threshold;
-}
 
+ bool AGSurface::similarTo(const AGSurface &amp;pSurface,float threshold) const
+ {
+   float s=similarity(pSurface);
+   if(s&lt;0)
+     return s;
+   if(width()==0 &amp;&amp; height()==0)
+     return true;
+   return sqrt(s)/(width()*height())&lt;threshold;
+ }
 
 
-void AGSurface::setDecryptor(AGDecryptor *pDecryptor)
-  {
-    mDecryptor=pDecryptor;
-  }
 
+ void AGSurface::setDecryptor(AGDecryptor *pDecryptor)
+ {
+   mDecryptor=pDecryptor;
+ }
 
-AGDecryptor *toDecryptor(AGPlugin *p)
-  {
-    return (AGDecryptor*)(p);
-  }
 
-std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,SDL_PixelFormat *f)
-  {
-    o&lt;&lt;&quot;(&quot;;
-    //    SDL_Palette *palette;
-    o&lt;&lt;(int)f-&gt;BitsPerPixel&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;BytesPerPixel&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Rloss&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Gloss&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Bloss&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Aloss&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Rshift&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Gshift&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Bshift&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Ashift&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Rmask&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Gmask&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Bmask&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;Amask&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;colorkey&lt;&lt;&quot;;&quot;;
-    o&lt;&lt;(int)f-&gt;alpha&lt;&lt;&quot;)&quot;;
-    o&lt;&lt;&quot;\n&quot;;
+ AGDecryptor *toDecryptor(AGPlugin *p)
+ {
+   return (AGDecryptor*)(p);
+ }
 
+ std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,SDL_PixelFormat *f)
+ {
+   o&lt;&lt;&quot;(&quot;;
+   //    SDL_Palette *palette;
+   o&lt;&lt;(int)f-&gt;BitsPerPixel&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;BytesPerPixel&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Rloss&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Gloss&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Bloss&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Aloss&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Rshift&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Gshift&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Bshift&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Ashift&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Rmask&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Gmask&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Bmask&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;Amask&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;colorkey&lt;&lt;&quot;;&quot;;
+   o&lt;&lt;(int)f-&gt;alpha&lt;&lt;&quot;)&quot;;
+   o&lt;&lt;&quot;\n&quot;;
 
-    return o;
-  }
 
-std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,SDL_Surface *f)
-  {
-    o&lt;&lt;&quot;(&quot;;
-    o&lt;&lt;f-&gt;flags&lt;&lt;&quot;,&quot;;
-    o&lt;&lt;f-&gt;format&lt;&lt;&quot;,&quot;;                /* Read-only */
-    o&lt;&lt;f-&gt;w&lt;&lt;&quot;,&quot;&lt;&lt;f-&gt;h&lt;&lt;&quot;,&quot;;
-    o&lt;&lt;f-&gt;pitch&lt;&lt;&quot;;&quot;;                           /* Read-only */
-    o&lt;&lt;f-&gt;offset&lt;&lt;&quot;;&quot;;                             /* Private */
+   return o;
+ }
 
-    o&lt;&lt;f-&gt;clip_rect&lt;&lt;&quot;;&quot;;                     /* Read-only */
+ std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,SDL_Surface *f)
+ {
+   o&lt;&lt;&quot;(&quot;;
+   o&lt;&lt;f-&gt;flags&lt;&lt;&quot;,&quot;;
+   o&lt;&lt;f-&gt;format&lt;&lt;&quot;,&quot;;                /* Read-only */
+   o&lt;&lt;f-&gt;w&lt;&lt;&quot;,&quot;&lt;&lt;f-&gt;h&lt;&lt;&quot;,&quot;;
+   o&lt;&lt;f-&gt;pitch&lt;&lt;&quot;;&quot;;                           /* Read-only */
+   o&lt;&lt;f-&gt;offset&lt;&lt;&quot;;&quot;;                             /* Private */
 
-    o&lt;&lt;f-&gt;locked&lt;&lt;&quot;;&quot;;                          /* Private */
+   o&lt;&lt;f-&gt;clip_rect&lt;&lt;&quot;;&quot;;                     /* Read-only */
 
-    o&lt;&lt;f-&gt;format_version&lt;&lt;&quot;;&quot;;            /* Private */
+   o&lt;&lt;f-&gt;locked&lt;&lt;&quot;;&quot;;                          /* Private */
 
-    /* Reference count -- used when freeing surface */
-    o&lt;&lt;f-&gt;refcount&lt;&lt;&quot;)\n&quot;;
+   o&lt;&lt;f-&gt;format_version&lt;&lt;&quot;;&quot;;            /* Private */
 
-    return o;
-  }
+   /* Reference count -- used when freeing surface */
+   o&lt;&lt;f-&gt;refcount&lt;&lt;&quot;)\n&quot;;
+
+   return o;
+ }

Modified: antargis/trunk/ext/video/ag_surface.h
===================================================================
--- antargis/trunk/ext/video/ag_surface.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_surface.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,6 +23,8 @@
 #ifndef __GUI_SURFACE_H
 #define __GUI_SURFACE_H
 
+#include &quot;rk_exception.h&quot;
+
 #include &lt;string&gt;
 #include &lt;set&gt;
 #include &lt;list&gt;
@@ -31,6 +33,7 @@
 #include &quot;ag_geometry.h&quot;
 #include &quot;ag_painttarget.h&quot;
 #include &quot;ag_gltexture.h&quot;
+#include &quot;rk_exception.h&quot;
 #include &lt;ag_plugin.h&gt;
 
 class AGColor;
@@ -74,24 +77,33 @@
     }
 };
 
+class AGSurfaceEmptyException:public AGException
+{
+public:
+  AGSurfaceEmptyException():AGException(&quot;Surface is used but empty!&quot;)
+  {
+  }
+
+};
+
 /// Generic classes - for OpenGL and &quot;normal&quot; SDL
 class AGEXPORT AGSurface:public AGPaintTarget
 {
- public:  
+ public:
   AGSurface();
   AGSurface(int w,int h);
   AGSurface(const AGSurface &amp;p); // shallow copy only
 
-  virtual ~AGSurface();
+  virtual ~AGSurface() throw();
 
   AGSurface copy() const;
 
-  int width() const;
-  int height() const;
+  int width() const throw(AGSurfaceEmptyException);
+  int height() const throw(AGSurfaceEmptyException);
 
-  AGRect2 getRect() const;
+  AGRect2 getRect() const throw(AGSurfaceEmptyException);
 
-  AGSurface getSubSurface(const AGRect2 &amp;r) const;
+  AGSurface getSubSurface(const AGRect2 &amp;r) const throw(AGSurfaceEmptyException);
 
   bool valid() const;
 
@@ -101,11 +113,11 @@
   AGSurface &amp;operator=(const AGSurface &amp;p);
   bool operator==(const AGSurface &amp;p) const;
 
-  virtual void blit(const AGSurface &amp;pSource,const AGRect2 &amp;pDest,const AGRect2 &amp;pSrc,const AGColor &amp;pColor);
+  virtual void blit(const AGSurface &amp;pSource,const AGRect2 &amp;pDest,const AGRect2 &amp;pSrc,const AGColor &amp;pColor) throw(AGSurfaceEmptyException);
 
-  void drawGradient(const AGRect2&amp; rect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr);
-  void drawGradientAlpha(const AGRect2&amp; rect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr);
-  void drawBorder(const AGRect2&amp; rect,int width, const AGColor&amp; c1, const AGColor&amp; c2);
+  void drawGradient(const AGRect2&amp; rect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr) throw(AGSurfaceEmptyException);
+  void drawGradientAlpha(const AGRect2&amp; rect, const AGColor&amp; ul, const AGColor&amp; ur, const AGColor&amp; dl, const AGColor&amp; dr) throw(AGSurfaceEmptyException);
+  void drawBorder(const AGRect2&amp; rect,int width, const AGColor&amp; c1, const AGColor&amp; c2) throw(AGSurfaceEmptyException);
 
   virtual void putPixel(int x,int y,const AGColor &amp;c);
   virtual AGColor getPixel(int x,int y) const;
@@ -126,15 +138,15 @@
   AGVector2 shrink2Fit(int alphaThresh=20);
 
   AGSurface(AGInternalSurface *i);
-  
+
   float similarity(const AGSurface &amp;pSurface) const;
   bool similarTo(const AGSurface &amp;pSurface,float threshold=0.1) const;
-  
-  
 
+
+
  private:
 
-  Uint32 color(const AGColor &amp;c) const;
+  Uint32 color(const AGColor &amp;c) const throw(AGSurfaceEmptyException);;
 
   AGInternalSurface *s;
 
@@ -143,7 +155,7 @@
   friend class AntTextureData;
   size_t mVersion;
 
-  static AGDecryptor *mDecryptor;  
+  static AGDecryptor *mDecryptor;
 };
 
 AGEXPORT void AGFreeSurface(SDL_Surface *s);

Modified: antargis/trunk/ext/video/ag_surfacemanager.cc
===================================================================
--- antargis/trunk/ext/video/ag_surfacemanager.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_surfacemanager.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,7 +23,7 @@
 #include &quot;ag_surface.h&quot;
 #include &quot;ag_texture.h&quot;
 #include &quot;ag_kill.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_config.h&quot;
 #include &quot;ag_glscreen.h&quot;
 #include &quot;ag_profiler.h&quot;

Modified: antargis/trunk/ext/video/ag_surfacemanager.h
===================================================================
--- antargis/trunk/ext/video/ag_surfacemanager.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_surfacemanager.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -21,7 +21,7 @@
 #ifndef AG_SURFACEMANAGER_H
 #define AG_SURFACEMANAGER_H
 
-#include &lt;ag_base.h&gt;
+#include &lt;rk_base.h&gt;
 #include &lt;set&gt;
 
 class AGRenderContext;

Modified: antargis/trunk/ext/video/ag_texture.cc
===================================================================
--- antargis/trunk/ext/video/ag_texture.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_texture.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -20,7 +20,7 @@
 
 #include &quot;ag_texture.h&quot;
 #include &quot;ag_glscreen.h&quot;
-#include &quot;ag_debug.h&quot;
+#include &quot;rk_debug.h&quot;
 #include &quot;ag_rendercontext.h&quot;
 #include &quot;ag_sgeexport.h&quot;
 #include &quot;ag_surfacemanager.h&quot;
@@ -137,7 +137,7 @@
   }
 
 
-AGTexture::~AGTexture()
+AGTexture::~AGTexture() throw()
   {
     if(getSurfaceManager())
       getSurfaceManager()-&gt;deregisterMe(this);

Modified: antargis/trunk/ext/video/ag_texture.h
===================================================================
--- antargis/trunk/ext/video/ag_texture.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_texture.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -36,7 +36,7 @@
   AGTexture(const AGSurface &amp;pSurface,bool p3d=false);
   AGTexture(const AGTexture &amp;t);         // shallow copy, uses same tex-id or sdl-surface
   AGTexture(int W,int H);
-  ~AGTexture();
+  ~AGTexture() throw();
 
   AGTexture &amp;operator=(const AGTexture &amp;t);
 

Modified: antargis/trunk/ext/video/ag_texturecache.h
===================================================================
--- antargis/trunk/ext/video/ag_texturecache.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_texturecache.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -23,8 +23,9 @@
 #ifndef __TEXTURE_CACHE_H__
 #define __TEXTURE_CACHE_H__
 
+#include &quot;rk_debug.h&quot;
+
 #include &quot;ag_surface.h&quot;
-#include &quot;ag_debug.h&quot;
 #include &lt;ag_fs.h&gt;
 
 #include &lt;string&gt;
@@ -42,7 +43,7 @@
     const AGTexture &amp;get(const AGString &amp;pTextureFilename,const AGRect2 &amp;pSub) throw (FileNotFound);
   private:
     std::map&lt;AGString,AGTexture*&gt; mTextures;
-    
+
     friend AGTextureCache *getTextureCache();
   };
 

Modified: antargis/trunk/ext/video/ag_vdebug.cc
===================================================================
--- antargis/trunk/ext/video/ag_vdebug.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_vdebug.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -2,6 +2,7 @@
 #include &lt;ag_video.h&gt;
 
 #include &lt;SDL_opengl.h&gt;
+#include &lt;SDL_error.h&gt;
 
 void checkGLReal(const std::string &amp;pString)
   {

Modified: antargis/trunk/ext/video/ag_vdebug.h
===================================================================
--- antargis/trunk/ext/video/ag_vdebug.h	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_vdebug.h	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,7 +1,7 @@
 #ifndef AG_VDEBUG
 #define AG_VDEBUG
 
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 
 AGEXPORT void agAssertGL(std::string s);
 AGEXPORT void checkGLReal(const std::string &amp;pString);

Modified: antargis/trunk/ext/video/ag_video.cc
===================================================================
--- antargis/trunk/ext/video/ag_video.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/ag_video.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,6 +1,6 @@
 #include &lt;ag_video.h&gt;
 
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &lt;ag_vdebug.h&gt;
 #include &lt;ag_gltexture.h&gt;
 #include &lt;ag_glscreen.h&gt;

Modified: antargis/trunk/ext/video/init.cc
===================================================================
--- antargis/trunk/ext/video/init.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ext/video/init.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,4 @@
-#include &lt;ag_debug.h&gt;
+#include &lt;rk_debug.h&gt;
 #include &lt;ag_main.h&gt;
 #include &lt;ag_video.h&gt;
 

Modified: antargis/trunk/main/starter.cc
===================================================================
--- antargis/trunk/main/starter.cc	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/main/starter.cc	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,11 +1,30 @@
 #include &lt;SDL.h&gt;
 
 #include &lt;ruby.h&gt;
+#ifdef WIN32
+#undef write
+#undef read
+#endif
 #include &lt;iostream&gt;
 
-#include &lt;ag_rtools.h&gt;
-#include &lt;ag_string.h&gt;
+#include &lt;rk_tools.h&gt;
+#include &lt;rk_string.h&gt;
 
+
+
+
+void plainLog(const std::string &amp;p)
+{
+  static FILE *f=0;
+  if(f==0)
+    f=fopen(&quot;starter.log&quot;,&quot;w&quot;);
+
+  fwrite(p.c_str(),sizeof(char),p.length(),f);
+  fwrite(&quot;\n&quot;,sizeof(char),1,f);
+
+  fflush(f);
+}
+
 std::string toLower(const std::string &amp;s)
   {
     std::string a;
@@ -39,35 +58,61 @@
 
 int main(int _argc,char*_argv[])
   {
+    plainLog(&quot;startup&quot;);
+
     ruby_init();
 
+    plainLog(&quot;ruby inited&quot;);
 
     int argc=_argc;
     char**argv=_argv;
 
     if(argc==1)
       {
+        plainLog(&quot;no args given&quot;);
         argv=new char*[2];
-        argv[0]=_argv[0];
+        argv[0]=new char[strlen(_argv[0])+10];
+        strcpy(argv[0],_argv[0]);
+        //argv[0]=_argv[0];
 
         std::string s=argv[0],sep;
 
+        plainLog(&quot;my name:&quot;+s);
+
         if(isWindows(s))
           sep=&quot;\\&quot;;
         else
           sep=&quot;/&quot;;
+
+        plainLog(&quot;dir sep:&quot;+sep);
+
+
         s=truncReverseUntil(s,sep);
+        plainLog(&quot;s:&quot;+s);
 
+        if(s.length()&gt;0)
+          s+=sep;
+        plainLog(&quot;s:&quot;+s);
+
+
         argv[1]=new char[s.length()+100];
-        strcpy(argv[1],(s+sep+&quot;antargisStarter.rb&quot;).c_str());
+        strcpy(argv[1],(s+&quot;antargisStarter.rb&quot;).c_str());
+        plainLog(std::string(&quot;argv[1]:&quot;)+argv[1]);
+
         argc=2;
       }
 
+    plainLog(&quot;setting ruby ops...&quot;);
 
     ruby_options(argc,argv);
+    plainLog(&quot;rups ops set&quot;);
     rb_gv_set(&quot;antargisStarterLoaded&quot;,Qtrue);
+    plainLog(&quot;global set&quot;);
+    plainLog(&quot;running ruby...&quot;);
 
     ruby_run();
+    plainLog(&quot;ended&quot;);
+
     std::cout&lt;&lt;&quot;CCC&quot;&lt;&lt;std::endl;
     return 0;
   }

Modified: antargis/trunk/ruby/ant_tools.rb
===================================================================
--- antargis/trunk/ruby/ant_tools.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/ant_tools.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -31,7 +31,7 @@
   dputs &quot;ERROR:&quot;+error.to_s
 end
 
-class Set&lt;Array
+class AntSet&lt;Array
   def push(x)
     super
     sort!

Modified: antargis/trunk/ruby/antargislib.rb
===================================================================
--- antargis/trunk/ruby/antargislib.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/antargislib.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -4,6 +4,7 @@
 # - init video-mode
 # - process config-file and parameter input
 #
+require 'rookey/lib/rookey/tools.rb'
 require 'pp'
 
 
@@ -101,8 +102,10 @@
 rescue
   puts &quot;Antargis-module not found - trying to load .so&quot;
   begin
-    if File.exists?(&quot;ext/antargis.so&quot;)
-      require 'ext/antargis'
+    if File.exists?(&quot;antargis.so&quot;)
+      require 'antargis'
+    elsif File.exists?(&quot;antargis.dll&quot;)
+      require 'antargis.dll'
     elsif File.exists?(&quot;antargis.bundle&quot;)
       require 'antargis.bundle'
     else

Modified: antargis/trunk/ruby/editor/campaign/drag_grid.rb
===================================================================
--- antargis/trunk/ruby/editor/campaign/drag_grid.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/editor/campaign/drag_grid.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,13 +1,13 @@
 require 'ruby/antargislib.rb'
 require 'pp'
 
-require File.join(File.split(__FILE__)[0],&quot;dialogs.rb&quot;)
-require File.join(File.split(__FILE__)[0],&quot;toolbar.rb&quot;)
+require &quot;./dialogs.rb&quot;
+require &quot;./toolbar.rb&quot;
 
-require File.join(File.split(__FILE__)[0],'ruby_tools.rb')
-require File.join(File.split(__FILE__)[0],'story_editor.rb')
-requireRelative('ruby_signals.rb',__FILE__)
-require File.join(File.split(__FILE__)[0],&quot;campaign_data.rb&quot;)
+require './ruby_tools.rb'
+require './story_editor.rb'
+require './ruby_signals.rb'
+require './campaign_data.rb'
 
 #setDebugLevel(0)
 

Modified: antargis/trunk/ruby/editor/campaign/ruby_layouts.rb
===================================================================
--- antargis/trunk/ruby/editor/campaign/ruby_layouts.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/editor/campaign/ruby_layouts.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -17,4 +17,4 @@
   getLayoutFactory.addCreator(name,creator)
 end
 
-requireRelative(&quot;effect.rb&quot;,__FILE__)
\ No newline at end of file
+require &quot;./effect.rb&quot;
\ No newline at end of file

Modified: antargis/trunk/ruby/editor/campaign/ruby_tools.rb
===================================================================
--- antargis/trunk/ruby/editor/campaign/ruby_tools.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/editor/campaign/ruby_tools.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -1,4 +1,5 @@
-def requireRelative(file,current)
+if false
+  def requireRelative(file,current)
   require File.join(File.split(current)[0],file)
 end
 
@@ -20,5 +21,7 @@
     end
   end
 end
+end
+require &quot;rookey/lib/tools.rb&quot;
 
-requireRelative(&quot;ruby_layouts.rb&quot;,__FILE__)
\ No newline at end of file
+require &quot;./ruby_layouts.rb&quot;
\ No newline at end of file

Modified: antargis/trunk/ruby/entities/ant_house.rb
===================================================================
--- antargis/trunk/ruby/entities/ant_house.rb	2009-02-16 20:12:59 UTC (rev 1285)
+++ antargis/trunk/ruby/entities/ant_house.rb	2009-02-16 20:13:26 UTC (rev 1286)
@@ -64,7 +64,7 @@
     @type=3
     setProvide(&quot;house&quot;,true)
     @defeated=[]
-    @atHome=Set.new
+    @atHome=AntSet.new
     setMinimapColor(AGColor.new(0x55,0x55,0x55))
     setMinimapSize(5)
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000241.html">[Antargis-svn] r1285 - in antargis/trunk/rookey: . configs cpp lib	lib/rookey lib/rookey/configs lib/rookey/cpp lib/rookey/swig	maintainenance nbproject nbproject/private swig
</A></li>
	<LI>Next message: <A HREF="000243.html">[Antargis-svn] r1287 - antargis/trunk/ruby/editor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#242">[ date ]</a>
              <a href="thread.html#242">[ thread ]</a>
              <a href="subject.html#242">[ subject ]</a>
              <a href="author.html#242">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/antargis-svn">More information about the Antargis-svn
mailing list</a><br>
</body></html>
